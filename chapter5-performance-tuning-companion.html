<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 5: Tune System Performance - Interactive Companion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #64748b;
            --bg-dark: #0f172a;
            --bg-darker: #020617;
            --bg-card: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --border: #334155;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --code-bg: #1e293b;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-darker) 0%, var(--bg-dark) 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 40px 20px;
            background: var(--bg-card);
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary) 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        header p {
            color: var(--text-secondary);
            font-size: 1.1em;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            background: var(--bg-card);
            padding: 15px;
            border-radius: 12px;
        }

        .nav-tab {
            flex: 1;
            min-width: 150px;
            padding: 15px 20px;
            background: var(--bg-dark);
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 600;
        }

        .nav-tab:hover {
            background: var(--primary-dark);
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .nav-tab.active {
            background: var(--primary);
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
        }

        .module {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .module.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        .card h2 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h3 {
            color: var(--text-primary);
            margin: 20px 0 10px 0;
            font-size: 1.3em;
        }

        /* Introduction-specific styles */
        .intro-hero {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.15), rgba(59, 130, 246, 0.1));
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 25px;
            text-align: center;
        }

        .intro-hero h2 {
            font-size: 2.2em;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .intro-hero p {
            font-size: 1.15em;
            line-height: 1.8;
            color: var(--text-secondary);
            max-width: 900px;
            margin: 0 auto;
        }

        .why-matters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .matter-card {
            background: var(--bg-darker);
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .matter-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.3);
        }

        .matter-card h4 {
            color: var(--primary);
            font-size: 1.25em;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .matter-card p {
            color: var(--text-secondary);
            font-size: 0.95em;
            line-height: 1.6;
        }

        .objectives-list {
            background: var(--bg-darker);
            border-left: 4px solid var(--success);
            border-radius: 8px;
            padding: 25px;
            margin: 20px 0;
        }

        .objectives-list h3 {
            color: var(--success);
            margin-bottom: 15px;
            margin-top: 0;
        }

        .objectives-list ul {
            list-style: none;
            margin-left: 0;
        }

        .objectives-list li {
            padding: 10px 0;
            padding-left: 35px;
            position: relative;
            color: var(--text-secondary);
        }

        .objectives-list li:before {
            content: "‚ö°";
            position: absolute;
            left: 0;
            color: var(--warning);
            font-size: 1.3em;
        }

        .module-overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .module-preview-card {
            background: var(--bg-darker);
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 25px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .module-preview-card:hover {
            border-color: var(--primary);
            transform: translateX(5px);
            box-shadow: 0 4px 16px rgba(37, 99, 235, 0.2);
        }

        .module-preview-card h4 {
            color: var(--primary);
            font-size: 1.2em;
            margin-bottom: 12px;
        }

        .module-preview-card p {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-bottom: 12px;
            line-height: 1.6;
        }

        .module-preview-card .skills-tag {
            display: inline-block;
            background: rgba(37, 99, 235, 0.2);
            color: var(--primary);
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            margin-top: 10px;
        }

        .cta-section {
            text-align: center;
            margin: 40px 0;
            padding: 30px;
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.1), rgba(16, 185, 129, 0.1));
            border-radius: 12px;
            border: 2px solid var(--primary);
        }

        .cta-section h3 {
            font-size: 1.8em;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .cta-section p {
            color: var(--text-secondary);
            font-size: 1.1em;
            margin-bottom: 25px;
        }

        .cta-button {
            display: inline-block;
            padding: 15px 35px;
            background: var(--primary);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1.15em;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .cta-button:hover {
            background: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.5);
        }

        .key-concepts-box {
            background: var(--bg-darker);
            border: 2px solid var(--warning);
            border-radius: 10px;
            padding: 25px;
            margin: 25px 0;
        }

        .key-concepts-box h3 {
            color: var(--warning);
            margin-top: 0;
            margin-bottom: 15px;
        }

        .key-concepts-box ul {
            color: var(--text-secondary);
            margin-left: 25px;
        }

        .key-concepts-box li {
            margin: 8px 0;
            line-height: 1.6;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .profile-card {
            background: var(--bg-dark);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .profile-card:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: 0 6px 16px rgba(37, 99, 235, 0.3);
        }

        .profile-card.selected {
            border-color: var(--success);
            background: linear-gradient(135deg, var(--bg-dark) 0%, rgba(16, 185, 129, 0.1) 100%);
        }

        .profile-card.active-detail {
            border-color: var(--primary);
            background: linear-gradient(135deg, var(--bg-dark) 0%, rgba(37, 99, 235, 0.1) 100%);
        }

        .profile-card h4 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .profile-card p {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .tag {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.8em;
            margin-right: 5px;
            margin-top: 5px;
        }

        .tag.performance { background: rgba(37, 99, 235, 0.3); color: #93c5fd; }
        .tag.power { background: rgba(16, 185, 129, 0.3); color: #6ee7b7; }
        .tag.latency { background: rgba(245, 158, 11, 0.3); color: #fcd34d; }
        .tag.throughput { background: rgba(139, 92, 246, 0.3); color: #c4b5fd; }
        .tag.balanced { background: rgba(100, 116, 139, 0.3); color: #cbd5e1; }

        .detail-panel {
            background: var(--bg-darker);
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .detail-panel.open {
            max-height: 2000px;
        }

        .profile-detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .detail-stat {
            background: var(--bg-card);
            padding: 15px;
            border-radius: 6px;
            border-left: 3px solid var(--primary);
        }

        .detail-stat-label {
            color: var(--text-secondary);
            font-size: 0.85em;
            margin-bottom: 5px;
        }

        .detail-stat-value {
            color: var(--primary);
            font-size: 1.3em;
            font-weight: bold;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 1em;
        }

        button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: var(--secondary);
        }

        button.secondary:hover {
            background: #475569;
        }

        button.success {
            background: var(--success);
        }

        button.success:hover {
            background: #059669;
        }

        .command-builder {
            background: var(--code-bg);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .command-output {
            background: var(--bg-darker);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #10b981;
            margin-top: 15px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .command-preview {
            background: var(--bg-darker);
            border-left: 4px solid var(--primary);
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            color: #60a5fa;
            font-size: 1.1em;
        }

        select, input[type="text"], input[type="number"] {
            padding: 10px;
            background: var(--bg-darker);
            border: 2px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 1em;
            min-width: 200px;
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--primary);
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .scheduler-visual {
            background: var(--bg-darker);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 30px;
            margin: 20px 0;
            min-height: 400px;
        }

        .process-node {
            background: var(--bg-card);
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 15px;
            margin: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .process-node:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
        }

        .tree-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .tree-level {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .priority-scale {
            background: linear-gradient(90deg, 
                var(--success) 0%, 
                var(--warning) 50%, 
                var(--danger) 100%);
            height: 60px;
            border-radius: 8px;
            position: relative;
            margin: 30px 0;
        }

        .scale-marker {
            position: absolute;
            bottom: -30px;
            transform: translateX(-50%);
            font-size: 0.8em;
            color: var(--text-secondary);
        }

        .draggable-process {
            background: var(--bg-card);
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 12px 20px;
            margin: 10px;
            cursor: move;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .draggable-process:hover {
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
        }

        .drop-zone {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            color: var(--text-secondary);
            min-height: 150px;
            margin: 20px 0;
            transition: all 0.3s ease;
        }

        .drop-zone.drag-over {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.1);
        }

        .process-list {
            background: var(--bg-darker);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }

        .process-item {
            background: var(--bg-card);
            border-left: 4px solid var(--primary);
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .process-info {
            flex: 1;
        }

        .process-actions {
            display: flex;
            gap: 10px;
        }

        .process-actions button {
            padding: 8px 16px;
            font-size: 0.9em;
        }

        .info-box {
            background: rgba(37, 99, 235, 0.1);
            border-left: 4px solid var(--primary);
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .info-box.warning {
            background: rgba(245, 158, 11, 0.1);
            border-left-color: var(--warning);
        }

        .info-box.success {
            background: rgba(16, 185, 129, 0.1);
            border-left-color: var(--success);
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .comparison-table th {
            background: var(--bg-darker);
            color: var(--primary);
            font-weight: 600;
        }

        .comparison-table tr:hover {
            background: rgba(37, 99, 235, 0.05);
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            color: var(--primary);
            text-decoration: underline dotted;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: var(--bg-darker);
            color: var(--text-primary);
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            border: 1px solid var(--border);
            font-size: 0.9em;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        code {
            background: var(--code-bg);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #60a5fa;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            margin-left: 10px;
        }

        .badge.new {
            background: var(--success);
            color: white;
        }

        .badge.count {
            background: var(--primary);
            color: white;
        }

        .flex-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .flex-item {
            flex: 1;
            min-width: 300px;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .nav-tab {
                width: 100%;
            }

            .comparison-grid, .why-matters-grid, .module-overview-grid {
                grid-template-columns: 1fr;
            }

            .flex-container {
                flex-direction: column;
            }

            .intro-hero h2 {
                font-size: 1.6em;
            }
        }

        .scenario-card {
            background: var(--bg-darker);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .scenario-card:hover {
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .scenario-card.active {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.05);
        }

        .animation-container {
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .cpu-core {
            width: 100px;
            height: 100px;
            background: var(--bg-card);
            border: 3px solid var(--primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px;
            position: relative;
        }

        .cpu-core.active {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.7); }
            50% { box-shadow: 0 0 0 15px rgba(37, 99, 235, 0); }
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: var(--bg-darker);
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
            border: 1px solid var(--border);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), #3b82f6);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: var(--bg-darker);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary);
            margin: 10px 0;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        footer {
            text-align: center;
            padding: 30px;
            margin-top: 50px;
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöÄ Chapter 5: Tune System Performance</h1>
            <p>Interactive Learning Companion - Deep Dive into Linux Performance Optimization</p>
        </header>

        <nav class="nav-tabs">
            <div class="nav-tab active" data-module="introduction">
                üè† Introduction
            </div>
            <div class="nav-tab" data-module="profiles">
                üìä Profile Explorer
            </div>
            <div class="nav-tab" data-module="commands">
                ‚å®Ô∏è Command Builder
            </div>
            <div class="nav-tab" data-module="scheduler">
                ‚öôÔ∏è Scheduler Visualizer
            </div>
            <div class="nav-tab" data-module="nice">
                üìà Nice Value Scale
            </div>
            <div class="nav-tab" data-module="laboratory">
                üß™ Command Laboratory
            </div>
        </nav>

        <!-- Introduction Module -->
        <div id="introduction" class="module active">
            <div class="card">
                <div class="intro-hero">
                    <h2>Welcome to Performance Tuning</h2>
                    <p>This interactive companion application transforms abstract performance concepts into hands-on, explorable experiences. Designed to complement your course materials, this tool provides safe environments to experiment with tuning profiles, process scheduling, and priority management without risk to production systems.</p>
                </div>

                <h3>Why Performance Tuning Matters</h3>
                <p>Performance tuning is the art and science of optimizing Linux systems for specific workloads and requirements. Whether you're managing enterprise servers, developer workstations, or cloud infrastructure, understanding how to balance performance, power consumption, and resource allocation is critical.</p>

                <div class="why-matters-grid">
                    <div class="matter-card">
                        <h4>üéØ Workload Optimization</h4>
                        <p>Different workloads have different needs. Database servers require low latency, file servers need high throughput, and laptops prioritize battery life. Proper tuning ensures each system performs optimally for its specific purpose.</p>
                    </div>
                    <div class="matter-card">
                        <h4>‚ö° Resource Efficiency</h4>
                        <p>Effective performance tuning maximizes hardware utilization, reduces wasted CPU cycles, and ensures critical processes get the resources they need when they need them.</p>
                    </div>
                    <div class="matter-card">
                        <h4>üí∞ Cost Savings</h4>
                        <p>Optimized systems do more with less. In cloud environments, better performance tuning can reduce the number of instances needed, directly impacting infrastructure costs.</p>
                    </div>
                    <div class="matter-card">
                        <h4>üîã Energy Management</h4>
                        <p>For battery-powered devices and environmentally-conscious data centers, power-efficient tuning extends battery life and reduces energy consumption without sacrificing necessary performance.</p>
                    </div>
                </div>

                <div class="objectives-list">
                    <h3>Learning Objectives</h3>
                    <p>By working through these interactive modules, you will master:</p>
                    <ul>
                        <li>Understanding and selecting appropriate <strong>tuned profiles</strong> for different workload scenarios</li>
                        <li>Using <code>tuned-adm</code> commands to manage system performance profiles</li>
                        <li>Comprehending how the Linux <strong>Completely Fair Scheduler (CFS)</strong> manages process execution</li>
                        <li>Understanding the relationship between <strong>nice values</strong> (-20 to +19) and process priorities</li>
                        <li>Using <code>nice</code> and <code>renice</code> commands to control process priority</li>
                        <li>Recognizing when systems are <strong>saturated vs. unsaturated</strong> and how this affects scheduling</li>
                        <li>Applying performance tuning concepts to real-world scenarios and troubleshooting situations</li>
                    </ul>
                </div>

                <h3>Interactive Modules Overview</h3>

                <div class="module-overview-grid">
                    <div class="module-preview-card" onclick="showModuleFromIntro('profiles')">
                        <h4>üìä Profile Explorer</h4>
                        <p>Explore 11 different tuned profiles with detailed comparisons. Understand the trade-offs between performance, power consumption, latency, and throughput. Use the recommendation wizard to find the perfect profile for your specific use case.</p>
                        <span class="skills-tag">Skills: Profile selection, workload analysis, system optimization</span>
                    </div>

                    <div class="module-preview-card" onclick="showModuleFromIntro('commands')">
                        <h4>‚å®Ô∏è Command Builder</h4>
                        <p>Build and simulate <code>tuned-adm</code> commands with real-time syntax validation. Practice switching profiles, viewing system recommendations, and understanding command options in a safe environment before executing on real systems.</p>
                        <span class="skills-tag">Skills: Command syntax, profile management, verification</span>
                    </div>

                    <div class="module-preview-card" onclick="showModuleFromIntro('scheduler')">
                        <h4>‚öôÔ∏è Scheduler Visualizer</h4>
                        <p>Visualize how the Completely Fair Scheduler organizes processes in a binary tree structure. Watch how virtual runtime affects process scheduling and understand the difference between saturated and unsaturated systems.</p>
                        <span class="skills-tag">Skills: Scheduler mechanics, time-slicing, CPU allocation</span>
                    </div>

                    <div class="module-preview-card" onclick="showModuleFromIntro('nice')">
                        <h4>üìà Nice Value Scale</h4>
                        <p>Internalize the nice value scale through visual, interactive manipulation. Drag processes to different priority levels and understand permission requirements. Work through real-world scenarios to apply your knowledge.</p>
                        <span class="skills-tag">Skills: Priority management, nice values, permissions</span>
                    </div>

                    <div class="module-preview-card" onclick="showModuleFromIntro('laboratory')">
                        <h4>üß™ Command Laboratory</h4>
                        <p>Practice <code>nice</code>, <code>renice</code>, <code>ps</code>, and <code>top</code> commands in a simulated process environment. Complete challenge exercises and see immediate feedback on your commands without affecting real processes.</p>
                        <span class="skills-tag">Skills: Command execution, process management, troubleshooting</span>
                    </div>
                </div>

                <div class="key-concepts-box">
                    <h3>üîë Key Concepts You'll Master</h3>
                    <ul>
                        <li><strong>Tuned Profiles:</strong> Pre-configured system optimization templates for different workload types (throughput-performance, latency-performance, powersave, balanced, etc.)</li>
                        <li><strong>Process Scheduling:</strong> How the Linux kernel decides which process runs on which CPU core and for how long</li>
                        <li><strong>Nice Values:</strong> User-space priority adjustments ranging from -20 (highest priority) to +19 (lowest priority)</li>
                        <li><strong>Priority Mapping:</strong> How nice values map to scheduler priorities (PR = nice + 20)</li>
                        <li><strong>Saturated vs. Unsaturated Systems:</strong> Understanding when CPU contention makes priority adjustments matter</li>
                        <li><strong>Real-time vs. Normal Scheduling:</strong> The difference between hard real-time processes and CFS-managed processes</li>
                    </ul>
                </div>

                <div class="info-box warning">
                    <h4>‚ö†Ô∏è How to Use This Application</h4>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li><strong>Navigate using the tabs above</strong> to access different learning modules</li>
                        <li><strong>Start with Profile Explorer</strong> to understand different tuning scenarios, then progress through the modules</li>
                        <li><strong>Experiment freely</strong> ‚Äì all simulations are safe and provide immediate feedback</li>
                        <li><strong>Use alongside your course slides</strong> to see concepts in action as you learn theory</li>
                        <li><strong>Complete the Command Laboratory challenges</strong> to validate your understanding</li>
                        <li><strong>Return to modules</strong> as reference material when working with real systems</li>
                    </ul>
                </div>

                <div class="cta-section">
                    <h3>Ready to Optimize Performance?</h3>
                    <p>Start your journey by exploring tuned profiles, or jump directly to hands-on command practice in the laboratory.</p>
                    <button class="cta-button" onclick="showModuleFromIntro('profiles')">
                        Explore Tuned Profiles ‚Üí
                    </button>
                </div>

                <div class="info-box success">
                    <h4>üí° Learning Tips</h4>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li><strong>Visualize first:</strong> Use the Scheduler Visualizer to see how processes compete for CPU time before diving into commands</li>
                        <li><strong>Remember the mantra:</strong> "Lower nice = Higher priority" ‚Äì this inverse relationship is counterintuitive but fundamental</li>
                        <li><strong>Context matters:</strong> Nice values only matter on saturated systems where processes compete for CPU</li>
                        <li><strong>Practice permissions:</strong> Understanding when you need root access is crucial for production environments</li>
                        <li><strong>Connect the dots:</strong> Notice how tuned profiles, scheduler behavior, and nice values all work together to optimize system performance</li>
                        <li><strong>Learn from scenarios:</strong> Real-world examples in the Nice Value module show practical applications of theoretical concepts</li>
                    </ul>
                </div>

                <div class="card" style="margin-top: 30px; background: var(--bg-darker);">
                    <h3 style="margin-top: 0;">üìã Quick Reference: Performance Tuning Hierarchy</h3>
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>Level</th>
                                <th>Tool/Concept</th>
                                <th>Scope</th>
                                <th>When to Use</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>System-Wide</strong></td>
                                <td>Tuned Profiles</td>
                                <td>Entire system configuration</td>
                                <td>Initial system setup, workload changes</td>
                            </tr>
                            <tr>
                                <td><strong>Kernel-Level</strong></td>
                                <td>Process Scheduler (CFS)</td>
                                <td>CPU time allocation</td>
                                <td>Automatic - understanding helps troubleshooting</td>
                            </tr>
                            <tr>
                                <td><strong>Process-Level</strong></td>
                                <td>Nice/Renice</td>
                                <td>Individual process priorities</td>
                                <td>Fine-tuning specific applications</td>
                            </tr>
                            <tr>
                                <td><strong>Real-Time</strong></td>
                                <td>RT Priorities</td>
                                <td>Critical timing processes</td>
                                <td>Hard real-time requirements (advanced)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Module 1: Profile Explorer & Comparison -->
        <div id="profiles" class="module">
            <div class="card">
                <h2>üìä Tuned Profile Explorer & Comparison Matrix</h2>
                <p>Explore and compare Linux tuning profiles to understand their characteristics and optimal use cases.</p>

                <div class="info-box">
                    <strong>üí° How to use:</strong> Click on any profile card to see detailed information. Hold Shift and click to select multiple profiles for comparison.
                </div>

                <div class="controls">
                    <button onclick="filterProfiles('all')">Show All</button>
                    <button onclick="filterProfiles('performance')" class="secondary">Performance Profiles</button>
                    <button onclick="filterProfiles('power')" class="secondary">Power-Saving Profiles</button>
                    <button onclick="clearSelection()" class="secondary">Clear Selection</button>
                </div>

                <div id="profileGrid" class="comparison-grid">
                    <!-- Profiles will be dynamically inserted here -->
                </div>

                <!-- Single Profile Detail Panel -->
                <div id="profileDetailPanel" class="detail-panel">
                    <h3 id="detailProfileName">Profile Details</h3>
                    <p id="detailProfileDescription"></p>
                    
                    <div class="profile-detail-grid">
                        <div class="detail-stat">
                            <div class="detail-stat-label">Performance Level</div>
                            <div class="detail-stat-value" id="detailPerformance">--</div>
                        </div>
                        <div class="detail-stat">
                            <div class="detail-stat-label">Power Efficiency</div>
                            <div class="detail-stat-value" id="detailPower">--</div>
                        </div>
                        <div class="detail-stat">
                            <div class="detail-stat-label">Latency</div>
                            <div class="detail-stat-value" id="detailLatency">--</div>
                        </div>
                        <div class="detail-stat">
                            <div class="detail-stat-label">Throughput</div>
                            <div class="detail-stat-value" id="detailThroughput">--</div>
                        </div>
                    </div>

                    <h4 style="margin-top: 20px;">Best Use Cases</h4>
                    <p id="detailUseCase" style="color: var(--text-secondary);"></p>

                    <h4 style="margin-top: 20px;">Active Plugins</h4>
                    <p id="detailPlugins" style="color: var(--text-secondary);"></p>

                    <h4 style="margin-top: 20px;">Technical Details</h4>
                    <p id="detailTechnical" style="color: var(--text-secondary);"></p>

                    <h4 style="margin-top: 20px;">How to Activate</h4>
                    <div class="command-preview">
                        <strong>$</strong> <span id="detailCommand">tuned-adm profile balanced</span>
                    </div>
                    
                    <button onclick="copyProfileCommand()" class="secondary" style="margin-top: 10px;">üìã Copy Command</button>
                </div>

                <!-- Comparison Panel -->
                <div id="comparisonPanel" class="detail-panel">
                    <h3>üìã Profile Comparison</h3>
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>Characteristic</th>
                                <th id="comp1Header">Profile 1</th>
                                <th id="comp2Header">Profile 2</th>
                            </tr>
                        </thead>
                        <tbody id="comparisonBody">
                            <!-- Comparison data will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h2>üéØ Profile Recommendation Wizard</h2>
                <p>Answer a few questions about your workload to get personalized profile recommendations.</p>

                <div class="form-group">
                    <label>What type of system are you configuring?</label>
                    <select id="systemType" onchange="updateRecommendation()">
                        <option value="">-- Select Type --</option>
                        <option value="desktop">Desktop Workstation</option>
                        <option value="server">Enterprise Server</option>
                        <option value="database">Database Server</option>
                        <option value="web">Web Server</option>
                        <option value="vm-guest">Virtual Machine Guest</option>
                        <option value="vm-host">Virtualization Host</option>
                        <option value="hpc">HPC Compute Node</option>
                        <option value="laptop">Laptop/Mobile Device</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>What is your primary concern?</label>
                    <select id="primaryConcern" onchange="updateRecommendation()">
                        <option value="">-- Select Concern --</option>
                        <option value="performance">Maximum Performance</option>
                        <option value="latency">Low Latency</option>
                        <option value="throughput">High Throughput</option>
                        <option value="power">Power Efficiency</option>
                        <option value="balanced">Balanced Approach</option>
                    </select>
                </div>

                <div id="recommendationResult" class="info-box success" style="display: none;">
                    <h3>üí° Recommended Profile</h3>
                    <div id="recommendationContent"></div>
                </div>
            </div>
        </div>

        <!-- Module 2: tuned-adm Command Builder -->
        <div id="commands" class="module">
            <div class="card">
                <h2>‚å®Ô∏è tuned-adm Command Builder</h2>
                <p>Build and execute tuned-adm commands with real-time syntax validation and output simulation.</p>

                <div class="info-box">
                    <strong>üí° Interactive Learning:</strong> Select operations below to build commands. See the syntax preview and simulated output before execution in real environments.
                </div>

                <h3>Select Command Operation</h3>
                <div class="controls">
                    <button onclick="setCommand('active')">Show Active Profile</button>
                    <button onclick="setCommand('list')">List All Profiles</button>
                    <button onclick="setCommand('profile_info')">Profile Info</button>
                    <button onclick="setCommand('profile')">Change Profile</button>
                    <button onclick="setCommand('recommend')">Get Recommendation</button>
                    <button onclick="setCommand('off')">Disable Tuning</button>
                </div>

                <div id="commandOptions" class="command-builder">
                    <div id="optionsContainer"></div>
                </div>

                <div class="command-preview" id="commandPreview">
                    <strong>$</strong> <span id="commandText">tuned-adm --help</span>
                </div>

                <div class="controls">
                    <button onclick="executeCommand()" class="success">‚ñ∂ Simulate Execution</button>
                    <button onclick="copyCommand()" class="secondary">üìã Copy Command</button>
                </div>

                <div class="command-output" id="commandSimOutput" style="display: none;">
                    <!-- Simulated output will appear here -->
                </div>
            </div>

            <div class="card">
                <h2>üìö Command Reference Quick Guide</h2>
                
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Command</th>
                            <th>Purpose</th>
                            <th>Example</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>tuned-adm active</code></td>
                            <td>Display currently active profile</td>
                            <td><code>tuned-adm active</code></td>
                        </tr>
                        <tr>
                            <td><code>tuned-adm list</code></td>
                            <td>List all available profiles</td>
                            <td><code>tuned-adm list</code></td>
                        </tr>
                        <tr>
                            <td><code>tuned-adm profile &lt;name&gt;</code></td>
                            <td>Switch to specified profile</td>
                            <td><code>tuned-adm profile throughput-performance</code></td>
                        </tr>
                        <tr>
                            <td><code>tuned-adm profile_info &lt;name&gt;</code></td>
                            <td>Show detailed profile information</td>
                            <td><code>tuned-adm profile_info latency-performance</code></td>
                        </tr>
                        <tr>
                            <td><code>tuned-adm recommend</code></td>
                            <td>Get system-specific recommendation</td>
                            <td><code>tuned-adm recommend</code></td>
                        </tr>
                        <tr>
                            <td><code>tuned-adm off</code></td>
                            <td>Disable all tuning</td>
                            <td><code>tuned-adm off</code></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Module 3: Process Scheduler Visualizer -->
        <div id="scheduler" class="module">
            <div class="card">
                <h2>‚öôÔ∏è Linux Process Scheduler Visualizer</h2>
                <p>Explore how the Completely Fair Scheduler (CFS) manages process priorities and CPU time distribution.</p>

                <div class="info-box">
                    <strong>üéì Key Concept:</strong> The CFS uses a binary tree structure to organize processes based on their virtual runtime. Processes with less accumulated CPU time are scheduled first.
                </div>

                <h3>Scheduler Configuration</h3>
                <div class="flex-container">
                    <div class="flex-item">
                        <div class="form-group">
                            <label>Number of CPU Cores</label>
                            <input type="number" id="cpuCores" value="4" min="1" max="8" onchange="updateScheduler()">
                        </div>
                    </div>
                    <div class="flex-item">
                        <div class="form-group">
                            <label>System Load</label>
                            <select id="systemLoad" onchange="updateScheduler()">
                                <option value="low">Low (Unsaturated)</option>
                                <option value="medium">Medium</option>
                                <option value="high">High (Saturated)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="controls">
                    <button onclick="addProcess()">‚ûï Add Process</button>
                    <button onclick="startScheduling()">‚ñ∂Ô∏è Start Scheduling</button>
                    <button onclick="pauseScheduling()">‚è∏Ô∏è Pause</button>
                    <button onclick="resetScheduler()" class="secondary">üîÑ Reset</button>
                </div>

                <div class="scheduler-visual">
                    <h4 style="text-align: center; margin-bottom: 20px;">CFS Binary Tree Visualization</h4>
                    <div id="schedulerTree" class="tree-container">
                        <div class="info-box warning" style="max-width: 600px; margin: 0 auto;">
                            Add processes to see the scheduler in action. Processes are organized by virtual runtime (CPU time used).
                        </div>
                    </div>
                </div>

                <div class="stats-grid" id="schedulerStats">
                    <!-- Stats will be populated dynamically -->
                </div>

                <div id="processList" class="process-list" style="display: none;">
                    <!-- Process list will be populated here -->
                </div>
            </div>

            <div class="card">
                <h2>üìñ Scheduler Concepts Explained</h2>
                
                <h3>Time-Slicing and Multitasking</h3>
                <p>Modern Linux uses <span class="tooltip">time-slicing<span class="tooltiptext">The technique of rapidly switching between processes to give the illusion of simultaneous execution</span></span> to manage multiple processes on limited CPU cores.</p>

                <div class="info-box">
                    <strong>Real-time vs. Normal Scheduling:</strong><br>
                    ‚Ä¢ <strong>Real-time processes</strong> use fixed priorities (0-99) and are always scheduled before normal processes<br>
                    ‚Ä¢ <strong>Normal processes</strong> use the CFS with nice values (-20 to +19) mapped to priorities (0-39)
                </div>

                <h3>The Completely Fair Scheduler (CFS)</h3>
                <p>CFS organizes processes in a time-weighted binary tree where:</p>
                <ul style="margin-left: 30px; color: var(--text-secondary);">
                    <li>The leftmost process has the lowest virtual runtime (least CPU time received)</li>
                    <li>The rightmost process has the highest virtual runtime (most CPU time received)</li>
                    <li>The scheduler always picks the leftmost process to run next</li>
                    <li>After running, processes accumulate virtual runtime and move right in the tree</li>
                </ul>

                <div class="info-box success">
                    <strong>‚ö° Performance Insight:</strong> On non-saturated systems (more cores than active threads), every process gets immediate CPU access. On saturated systems, nice values determine which processes are scheduled first.
                </div>
            </div>
        </div>

        <!-- Module 4: Nice Value Interactive Scale -->
        <div id="nice" class="module">
            <div class="card">
                <h2>üìà Nice Value Interactive Scale</h2>
                <p>Understand process priorities through visual manipulation of the nice value scale.</p>

                <div class="info-box">
                    <strong>üéØ Learning Goal:</strong> Internalize the relationship between nice values (-20 to +19) and process priorities. Remember: <strong>lower nice = higher priority!</strong>
                </div>

                <h3>Interactive Priority Scale</h3>
                <div style="background: var(--bg-darker); padding: 30px; border-radius: 8px; margin: 20px 0;">
                    <div style="margin-bottom: 40px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="color: var(--success); font-weight: bold;">HIGHEST PRIORITY</span>
                            <span style="color: var(--text-secondary);">DEFAULT (0)</span>
                            <span style="color: var(--danger); font-weight: bold;">LOWEST PRIORITY</span>
                        </div>
                        <div class="priority-scale">
                            <div class="scale-marker" style="left: 0%;">-20</div>
                            <div class="scale-marker" style="left: 25%;">-10</div>
                            <div class="scale-marker" style="left: 50%;">0</div>
                            <div class="scale-marker" style="left: 75%;">+10</div>
                            <div class="scale-marker" style="left: 100%;">+19</div>
                        </div>
                    </div>

                    <div class="info-box warning">
                        <strong>üîí Permission Rules:</strong><br>
                        ‚Ä¢ <strong>All users</strong> can increase nice (lower priority) on their own processes<br>
                        ‚Ä¢ <strong>Only root</strong> can decrease nice (raise priority) or change other users' processes
                    </div>
                </div>

                <h3>Drag Processes to the Scale</h3>
                <div id="niceProcessBank" style="background: var(--bg-darker); padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <p style="margin-bottom: 15px; color: var(--text-secondary);">Drag these processes onto the priority scale above:</p>
                    <div id="processDragArea">
                        <!-- Draggable processes will be added here -->
                    </div>
                </div>

                <div id="nicePlacedProcesses" class="drop-zone">
                    Drop processes here to set their nice values
                </div>

                <div class="controls">
                    <button onclick="addNiceProcess()">Add Process</button>
                    <button onclick="showNiceMapping()">Show Nice‚ÜîPriority Mapping</button>
                    <button onclick="resetNiceScale()" class="secondary">Reset Scale</button>
                </div>

                <div id="niceMappingTable" style="display: none; margin-top: 20px;">
                    <h3>Nice Value to Priority Mapping</h3>
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>Nice Value</th>
                                <th>Priority (PR)</th>
                                <th>Description</th>
                                <th>Who Can Set?</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>-20</code></td>
                                <td><code>0</code></td>
                                <td>Highest normal priority</td>
                                <td>Root only</td>
                            </tr>
                            <tr>
                                <td><code>-10</code></td>
                                <td><code>10</code></td>
                                <td>High priority</td>
                                <td>Root only</td>
                            </tr>
                            <tr>
                                <td><code>0</code></td>
                                <td><code>20</code></td>
                                <td>Default priority</td>
                                <td>All users</td>
                            </tr>
                            <tr>
                                <td><code>+10</code></td>
                                <td><code>30</code></td>
                                <td>Lower priority</td>
                                <td>All users</td>
                            </tr>
                            <tr>
                                <td><code>+19</code></td>
                                <td><code>39</code></td>
                                <td>Lowest priority</td>
                                <td>All users</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="info-box">
                        <strong>üìù Formula:</strong> Priority (PR) = Nice + 20<br>
                        <strong>Note:</strong> Real-time processes have negative PR values (shown as 'rt' in top output) and are not affected by nice values.
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üéÆ Nice Value Practice Scenarios</h2>
                <p>Test your understanding with real-world scenarios.</p>

                <div class="scenario-card" onclick="loadScenario(1)">
                    <h4>Scenario 1: Background Backup Job</h4>
                    <p>You're running a backup script that's slowing down interactive work. What nice value should you use?</p>
                </div>

                <div class="scenario-card" onclick="loadScenario(2)">
                    <h4>Scenario 2: Critical Database Query</h4>
                    <p>A high-priority database query needs more CPU time. How do you adjust its priority?</p>
                </div>

                <div class="scenario-card" onclick="loadScenario(3)">
                    <h4>Scenario 3: Video Encoding</h4>
                    <p>You're encoding videos overnight. How should you configure the process to not interfere with daytime work?</p>
                </div>

                <div id="scenarioDetails" class="detail-panel">
                    <!-- Scenario solution will be shown here -->
                </div>
            </div>
        </div>

        <!-- Module 5: Command Laboratory -->
        <div id="laboratory" class="module">
            <div class="card">
                <h2>üß™ Nice/Renice Command Laboratory</h2>
                <p>Practice nice and renice commands in a safe, simulated environment.</p>

                <div class="info-box">
                    <strong>üî¨ Lab Environment:</strong> This simulated system lets you practice commands without affecting real processes. Results show what would happen on a real system.
                </div>

                <h3>Simulated Process List</h3>
                <div class="controls">
                    <button onclick="labAddProcess()">Create New Process</button>
                    <button onclick="labRefresh()">Refresh List</button>
                    <button onclick="labReset()" class="secondary">Reset Lab</button>
                </div>

                <div id="labProcessList" class="process-list">
                    <!-- Lab processes will be listed here -->
                </div>

                <h3>Execute Commands</h3>
                <div class="command-builder">
                    <div class="form-group">
                        <label>Command Type</label>
                        <select id="labCommandType" onchange="updateLabCommand()">
                            <option value="nice">nice - Start with nice value</option>
                            <option value="renice">renice - Change existing process</option>
                            <option value="ps">ps - View process info</option>
                            <option value="top">top - Interactive view</option>
                        </select>
                    </div>

                    <div id="labCommandOptions">
                        <!-- Command-specific options will appear here -->
                    </div>

                    <div class="command-preview" id="labCommandPreview">
                        <strong>$</strong> <span id="labCommandText">Select a command type</span>
                    </div>

                    <div class="controls">
                        <button onclick="executeLabCommand()" class="success">‚ñ∂ Execute Command</button>
                        <button onclick="labShowHelp()" class="secondary">? Show Help</button>
                    </div>

                    <div class="command-output" id="labOutput" style="display: none;">
                        <!-- Lab command output will appear here -->
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üìù Challenge Exercises</h2>
                <p>Complete these tasks to master process priority management.</p>

                <div class="challenge" id="challenge1">
                    <h3>Challenge 1: Lower Process Priority</h3>
                    <div class="info-box warning">
                        <strong>Task:</strong> Start a long-running process (sleep 3600) with a nice value of +10 so it doesn't interfere with other work.
                    </div>
                    <button onclick="checkChallenge(1)" class="success">Check Answer</button>
                    <div id="challenge1Result" style="display: none;"></div>
                </div>

                <div class="challenge" id="challenge2">
                    <h3>Challenge 2: Increase Process Priority (Root)</h3>
                    <div class="info-box warning">
                        <strong>Task:</strong> Use renice to change process PID 1234 to a nice value of -5. You have root privileges.
                    </div>
                    <button onclick="checkChallenge(2)" class="success">Check Answer</button>
                    <div id="challenge2Result" style="display: none;"></div>
                </div>

                <div class="challenge" id="challenge3">
                    <h3>Challenge 3: View Process Priority</h3>
                    <div class="info-box warning">
                        <strong>Task:</strong> Display only the PID, command, and nice value for process PID 5678.
                    </div>
                    <button onclick="checkChallenge(3)" class="success">Check Answer</button>
                    <div id="challenge3Result" style="display: none;"></div>
                </div>

                <div class="info-box success" style="margin-top: 30px;">
                    <h3>üéì Command Quick Reference</h3>
                    <table class="comparison-table" style="margin-top: 15px;">
                        <tr>
                            <td><code>nice -n 10 command</code></td>
                            <td>Start command with nice value +10</td>
                        </tr>
                        <tr>
                            <td><code>renice -n 5 PID</code></td>
                            <td>Change process to nice value +5</td>
                        </tr>
                        <tr>
                            <td><code>ps -o pid,comm,nice PID</code></td>
                            <td>Show PID, command, and nice value</td>
                        </tr>
                        <tr>
                            <td><code>top</code> then <code>r</code></td>
                            <td>Interactive renice in top</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <footer>
            <p>Interactive Learning Companion for Linux System Administration</p>
            <p style="margin-top: 10px; font-size: 0.9em;">Built with HTML5, CSS3, and Vanilla JavaScript - Works Offline</p>
        </footer>
    </div>

    <script>
        // ===== DATA STRUCTURES =====
        
        const tunedProfiles = [
            {
                name: 'balanced',
                category: 'balanced',
                description: 'Ideal for systems that require a compromise between power saving and performance.',
                performance: 50,
                power: 50,
                latency: 'Medium',
                throughput: 'Medium',
                useCase: 'General purpose systems, default for most installations',
                plugins: ['disk', 'net', 'cpu', 'sysctl'],
                details: 'Provides balanced power consumption and performance. Uses moderate power management features.'
            },
            {
                name: 'powersave',
                category: 'power',
                description: 'Tunes the system for maximum power saving.',
                performance: 30,
                power: 90,
                latency: 'High',
                throughput: 'Low',
                useCase: 'Laptops, battery-powered devices, energy-efficient servers',
                plugins: ['disk', 'net', 'cpu', 'sysctl'],
                details: 'Aggressive power saving. May reduce performance significantly. Enables CPU frequency scaling, disk spin-down, and other power-saving features.'
            },
            {
                name: 'throughput-performance',
                category: 'performance',
                description: 'Tunes the system for maximum throughput.',
                performance: 95,
                power: 20,
                latency: 'Medium',
                throughput: 'Very High',
                useCase: 'Servers handling large data transfers, storage servers, network file servers',
                plugins: ['disk', 'net', 'cpu', 'sysctl'],
                details: 'Optimized for maximum data throughput. Disables power-saving features. Sets CPU governor to performance mode.'
            },
            {
                name: 'accelerator-performance',
                category: 'performance',
                description: 'Same as throughput-performance with reduced latency (< 100Œºs).',
                performance: 98,
                power: 15,
                latency: 'Ultra-Low (<100Œºs)',
                throughput: 'Very High',
                useCase: 'HPC systems, real-time data processing, low-latency trading systems',
                plugins: ['disk', 'net', 'cpu', 'sysctl'],
                details: 'Extends throughput-performance with additional latency reduction techniques. Disables CPU sleep states.'
            },
            {
                name: 'latency-performance',
                category: 'performance',
                description: 'Ideal for server systems requiring low latency at the expense of power consumption.',
                performance: 90,
                power: 25,
                latency: 'Low',
                throughput: 'High',
                useCase: 'Database servers, application servers, latency-sensitive services',
                plugins: ['disk', 'net', 'cpu', 'sysctl'],
                details: 'Optimized for low latency. Disables power-saving features. Locks CPU frequencies to maximum.'
            },
            {
                name: 'network-throughput',
                category: 'performance',
                description: 'Derived from throughput-performance with additional network tuning.',
                performance: 85,
                power: 30,
                latency: 'Medium',
                throughput: 'Very High',
                useCase: 'Network routers, firewalls, proxy servers, CDN edge nodes',
                plugins: ['net', 'cpu', 'sysctl'],
                details: 'Applies network-specific optimizations. Increases network buffer sizes, adjusts TCP parameters.'
            },
            {
                name: 'network-latency',
                category: 'performance',
                description: 'Derived from latency-performance with network tuning for low latency.',
                performance: 88,
                power: 28,
                latency: 'Very Low',
                throughput: 'High',
                useCase: 'VoIP servers, gaming servers, real-time communication systems',
                plugins: ['net', 'cpu', 'sysctl'],
                details: 'Optimizes network stack for minimal latency. Disables interrupt coalescing, sets aggressive TCP timers.'
            },
            {
                name: 'desktop',
                category: 'balanced',
                description: 'Derived from balanced profile with faster response for interactive applications.',
                performance: 60,
                power: 55,
                latency: 'Low',
                throughput: 'Medium',
                useCase: 'Desktop workstations, developer machines, interactive systems',
                plugins: ['disk', 'net', 'cpu', 'sysctl'],
                details: 'Optimized for desktop responsiveness. Prioritizes interactive processes, enables moderate power saving.'
            },
            {
                name: 'hpc-compute',
                category: 'performance',
                description: 'Derived from latency-performance for high-performance computing.',
                performance: 100,
                power: 10,
                latency: 'Very Low',
                throughput: 'Very High',
                useCase: 'HPC clusters, scientific computing, parallel processing workloads',
                plugins: ['cpu', 'sysctl'],
                details: 'Maximum computational performance. Disables all power-saving features. Locks CPU to maximum frequency.'
            },
            {
                name: 'virtual-guest',
                category: 'performance',
                description: 'Tunes system for maximum performance when running as a virtual machine.',
                performance: 75,
                power: 40,
                latency: 'Medium',
                throughput: 'High',
                useCase: 'KVM/VMware/Hyper-V virtual machines, cloud instances',
                plugins: ['disk', 'net', 'cpu', 'sysctl'],
                details: 'Optimized for virtualized environments. Reduces unnecessary overhead, optimizes for hypervisor interaction.'
            },
            {
                name: 'virtual-host',
                category: 'performance',
                description: 'Tunes system for maximum performance when acting as a virtualization host.',
                performance: 85,
                power: 30,
                latency: 'Low',
                throughput: 'Very High',
                useCase: 'KVM hosts, hypervisors, container hosts',
                plugins: ['disk', 'net', 'cpu', 'sysctl'],
                details: 'Optimized for hosting virtual machines. Enables features for efficient guest scheduling and I/O.'
            }
        ];

        let selectedProfiles = [];
        let schedulerProcesses = [];
        let schedulerRunning = false;
        let schedulerInterval = null;
        let processIdCounter = 1;
        let labProcesses = [];
        let labProcessIdCounter = 1000;
        let currentDetailProfile = null;

        // ===== UTILITY FUNCTIONS =====

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showModuleFromIntro(moduleName) {
            // Update active states
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.module').forEach(m => m.classList.remove('active'));
            
            // Activate the target module
            const targetTab = document.querySelector(`[data-module="${moduleName}"]`);
            const targetModule = document.getElementById(moduleName);
            
            if (targetTab && targetModule) {
                targetTab.classList.add('active');
                targetModule.classList.add('active');
                window.scrollTo(0, 0);
            }
        }

        // ===== NAVIGATION =====

        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const moduleName = this.dataset.module;
                
                // Update active states
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.module').forEach(m => m.classList.remove('active'));
                
                this.classList.add('active');
                document.getElementById(moduleName).classList.add('active');
                
                // Scroll to top
                window.scrollTo(0, 0);
            });
        });

        // ===== MODULE 1: PROFILE EXPLORER =====

        function initializeProfiles() {
            const grid = document.getElementById('profileGrid');
            grid.innerHTML = '';

            tunedProfiles.forEach(profile => {
                const card = document.createElement('div');
                card.className = 'profile-card';
                card.dataset.profile = profile.name;
                card.onclick = (e) => handleProfileClick(profile.name, e.shiftKey);

                const tags = [];
                if (profile.performance >= 80) tags.push('<span class="tag performance">High Performance</span>');
                if (profile.power >= 70) tags.push('<span class="tag power">Power Saving</span>');
                if (profile.latency.includes('Low') || profile.latency.includes('Ultra')) tags.push('<span class="tag latency">Low Latency</span>');
                if (profile.throughput.includes('High') || profile.throughput.includes('Very')) tags.push('<span class="tag throughput">High Throughput</span>');
                if (profile.category === 'balanced') tags.push('<span class="tag balanced">Balanced</span>');

                card.innerHTML = `
                    <h4>${profile.name}</h4>
                    <p>${profile.description}</p>
                    <div style="margin-top: 10px;">
                        ${tags.join('')}
                    </div>
                    <div style="margin-top: 15px; font-size: 0.85em; color: var(--text-secondary);">
                        <strong>Best for:</strong> ${profile.useCase}
                    </div>
                `;

                grid.appendChild(card);
            });
        }

        function handleProfileClick(profileName, isShiftKey) {
            if (isShiftKey) {
                // Multi-selection for comparison
                toggleProfileSelection(profileName);
            } else {
                // Single click - show detail
                showProfileDetail(profileName);
            }
        }

        function showProfileDetail(profileName) {
            const profile = tunedProfiles.find(p => p.name === profileName);
            if (!profile) return;

            // Update card visual states
            document.querySelectorAll('.profile-card').forEach(c => {
                c.classList.remove('selected', 'active-detail');
            });
            document.querySelector(`[data-profile="${profileName}"]`).classList.add('active-detail');

            // Hide comparison, show detail
            hideComparison();
            
            // Populate detail panel
            document.getElementById('detailProfileName').textContent = profile.name;
            document.getElementById('detailProfileDescription').textContent = profile.description;
            document.getElementById('detailPerformance').textContent = profile.performance + '%';
            document.getElementById('detailPower').textContent = profile.power + '%';
            document.getElementById('detailLatency').textContent = profile.latency;
            document.getElementById('detailThroughput').textContent = profile.throughput;
            document.getElementById('detailUseCase').textContent = profile.useCase;
            document.getElementById('detailPlugins').textContent = profile.plugins.join(', ');
            document.getElementById('detailTechnical').textContent = profile.details;
            document.getElementById('detailCommand').textContent = `sudo tuned-adm profile ${profile.name}`;

            // Show detail panel
            document.getElementById('profileDetailPanel').classList.add('open');
            currentDetailProfile = profileName;

            // Clear comparison selections
            selectedProfiles = [];
        }

        function toggleProfileSelection(profileName) {
            const card = document.querySelector(`[data-profile="${profileName}"]`);
            
            // Hide detail panel when doing multi-select
            document.getElementById('profileDetailPanel').classList.remove('open');
            document.querySelectorAll('.profile-card').forEach(c => c.classList.remove('active-detail'));
            
            const index = selectedProfiles.indexOf(profileName);
            if (index > -1) {
                selectedProfiles.splice(index, 1);
                card.classList.remove('selected');
            } else {
                if (selectedProfiles.length < 2) {
                    selectedProfiles.push(profileName);
                    card.classList.add('selected');
                } else {
                    // Replace oldest selection
                    const oldCard = document.querySelector(`[data-profile="${selectedProfiles[0]}"]`);
                    oldCard.classList.remove('selected');
                    selectedProfiles.shift();
                    selectedProfiles.push(profileName);
                    card.classList.add('selected');
                }
            }

            if (selectedProfiles.length === 2) {
                showComparison();
            } else {
                hideComparison();
            }
        }

        function showComparison() {
            const panel = document.getElementById('comparisonPanel');
            const body = document.getElementById('comparisonBody');
            
            const profile1 = tunedProfiles.find(p => p.name === selectedProfiles[0]);
            const profile2 = tunedProfiles.find(p => p.name === selectedProfiles[1]);

            document.getElementById('comp1Header').textContent = profile1.name;
            document.getElementById('comp2Header').textContent = profile2.name;

            body.innerHTML = `
                <tr>
                    <td><strong>Performance Level</strong></td>
                    <td>${profile1.performance}%</td>
                    <td>${profile2.performance}%</td>
                </tr>
                <tr>
                    <td><strong>Power Efficiency</strong></td>
                    <td>${profile1.power}%</td>
                    <td>${profile2.power}%</td>
                </tr>
                <tr>
                    <td><strong>Latency</strong></td>
                    <td>${profile1.latency}</td>
                    <td>${profile2.latency}</td>
                </tr>
                <tr>
                    <td><strong>Throughput</strong></td>
                    <td>${profile1.throughput}</td>
                    <td>${profile2.throughput}</td>
                </tr>
                <tr>
                    <td><strong>Use Case</strong></td>
                    <td>${profile1.useCase}</td>
                    <td>${profile2.useCase}</td>
                </tr>
                <tr>
                    <td><strong>Active Plugins</strong></td>
                    <td>${profile1.plugins.join(', ')}</td>
                    <td>${profile2.plugins.join(', ')}</td>
                </tr>
                <tr>
                    <td><strong>Technical Details</strong></td>
                    <td>${profile1.details}</td>
                    <td>${profile2.details}</td>
                </tr>
            `;

            panel.classList.add('open');
        }

        function hideComparison() {
            document.getElementById('comparisonPanel').classList.remove('open');
        }

        function filterProfiles(category) {
            document.querySelectorAll('.profile-card').forEach(card => {
                const profileName = card.dataset.profile;
                const profile = tunedProfiles.find(p => p.name === profileName);
                
                if (category === 'all') {
                    card.style.display = 'block';
                } else if (category === 'performance' && profile.category === 'performance') {
                    card.style.display = 'block';
                } else if (category === 'power' && profile.name === 'powersave') {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function clearSelection() {
            selectedProfiles = [];
            currentDetailProfile = null;
            document.querySelectorAll('.profile-card').forEach(c => {
                c.classList.remove('selected', 'active-detail');
            });
            hideComparison();
            document.getElementById('profileDetailPanel').classList.remove('open');
        }

        function copyProfileCommand() {
            const commandText = document.getElementById('detailCommand').textContent;
            navigator.clipboard.writeText(commandText).then(() => {
                alert('Command copied to clipboard!');
            });
        }

        function updateRecommendation() {
            const systemType = document.getElementById('systemType').value;
            const concern = document.getElementById('primaryConcern').value;

            if (!systemType || !concern) return;

            const recommendations = {
                'desktop-performance': 'desktop',
                'desktop-balanced': 'desktop',
                'desktop-power': 'balanced',
                'desktop-latency': 'desktop',
                'desktop-throughput': 'desktop',
                'server-performance': 'throughput-performance',
                'server-latency': 'latency-performance',
                'server-balanced': 'balanced',
                'server-throughput': 'throughput-performance',
                'server-power': 'balanced',
                'database-performance': 'throughput-performance',
                'database-latency': 'latency-performance',
                'database-throughput': 'throughput-performance',
                'database-balanced': 'latency-performance',
                'database-power': 'balanced',
                'web-throughput': 'network-throughput',
                'web-latency': 'network-latency',
                'web-performance': 'network-throughput',
                'web-balanced': 'balanced',
                'web-power': 'balanced',
                'vm-guest-performance': 'virtual-guest',
                'vm-guest-latency': 'virtual-guest',
                'vm-guest-throughput': 'virtual-guest',
                'vm-guest-balanced': 'virtual-guest',
                'vm-guest-power': 'virtual-guest',
                'vm-host-performance': 'virtual-host',
                'vm-host-latency': 'virtual-host',
                'vm-host-throughput': 'virtual-host',
                'vm-host-balanced': 'virtual-host',
                'vm-host-power': 'virtual-host',
                'hpc-performance': 'hpc-compute',
                'hpc-latency': 'hpc-compute',
                'hpc-throughput': 'hpc-compute',
                'hpc-balanced': 'hpc-compute',
                'hpc-power': 'hpc-compute',
                'laptop-power': 'powersave',
                'laptop-balanced': 'balanced',
                'laptop-performance': 'balanced',
                'laptop-latency': 'balanced',
                'laptop-throughput': 'balanced'
            };

            const key = `${systemType}-${concern}`;
            let recommended = recommendations[key] || 'balanced';

            const profile = tunedProfiles.find(p => p.name === recommended);
            
            const resultDiv = document.getElementById('recommendationResult');
            const contentDiv = document.getElementById('recommendationContent');

            contentDiv.innerHTML = `
                <h4 style="color: var(--primary); margin-bottom: 10px;">${profile.name}</h4>
                <p style="margin-bottom: 10px;">${profile.description}</p>
                <p><strong>Why this profile?</strong> ${profile.details}</p>
                <div style="margin-top: 15px;">
                    <code>sudo tuned-adm profile ${profile.name}</code>
                </div>
            `;

            resultDiv.style.display = 'block';
        }

        // ===== MODULE 2: COMMAND BUILDER =====

        const commandDatabase = {
            active: {
                syntax: 'tuned-adm active',
                description: 'Display the currently active tuning profile',
                output: 'Current active profile: virtual-guest',
                options: []
            },
            list: {
                syntax: 'tuned-adm list',
                description: 'List all available tuning profiles',
                output: `Available profiles:
- accelerator-performance  - Throughput performance based tuning with ...
- balanced                 - General non-specialized tuned profile
- desktop                  - Optimize for the desktop use-case
- hpc-compute              - Optimize for HPC compute workloads
- latency-performance      - Optimize for deterministic performance at ...
- network-latency          - Optimize for deterministic performance at ...
- network-throughput       - Optimize for streaming network throughput
- powersave                - Optimize for low power consumption
- throughput-performance   - Broadly applicable tuning that provides ...
- virtual-guest            - Optimize for running inside a virtual guest
- virtual-host             - Optimize for running KVM guests
Current active profile: virtual-guest`,
                options: []
            },
            profile_info: {
                syntax: 'tuned-adm profile_info <profile_name>',
                description: 'Show detailed information about a specific profile',
                needsProfile: true,
                output: (profileName) => {
                    const profile = tunedProfiles.find(p => p.name === profileName) || tunedProfiles[0];
                    return `Profile name:\n${profile.name}\n\nProfile summary:\n${profile.description}`;
                },
                options: ['profile']
            },
            profile: {
                syntax: 'tuned-adm profile <profile_name>',
                description: 'Switch to the specified tuning profile',
                needsProfile: true,
                output: (profileName) => `Switching to profile: ${profileName}\nProfile ${profileName} activated.`,
                options: ['profile']
            },
            recommend: {
                syntax: 'tuned-adm recommend',
                description: 'Recommend a tuning profile for the current system',
                output: 'virtual-guest',
                options: []
            },
            off: {
                syntax: 'tuned-adm off',
                description: 'Disable tuned (turn off all tuning)',
                output: 'Tuning has been disabled.',
                options: []
            }
        };

        let currentCommand = 'active';

        function setCommand(cmd) {
            currentCommand = cmd;
            updateCommandBuilder();
        }

        function updateCommandBuilder() {
            const command = commandDatabase[currentCommand];
            const optionsContainer = document.getElementById('optionsContainer');
            const commandText = document.getElementById('commandText');

            if (command.needsProfile) {
                optionsContainer.innerHTML = `
                    <div class="form-group">
                        <label>Select Profile</label>
                        <select id="selectedProfile" onchange="updateCommandPreview()">
                            ${tunedProfiles.map(p => `<option value="${p.name}">${p.name}</option>`).join('')}
                        </select>
                    </div>
                `;
                const profileName = document.getElementById('selectedProfile').value;
                commandText.textContent = `tuned-adm ${currentCommand} ${profileName}`;
            } else {
                optionsContainer.innerHTML = '<p style="color: var(--text-secondary);">No additional options required for this command.</p>';
                commandText.textContent = command.syntax;
            }
        }

        function updateCommandPreview() {
            const command = commandDatabase[currentCommand];
            const commandText = document.getElementById('commandText');

            if (command.needsProfile) {
                const profileName = document.getElementById('selectedProfile').value;
                commandText.textContent = `tuned-adm ${currentCommand} ${profileName}`;
            }
        }

        function executeCommand() {
            const command = commandDatabase[currentCommand];
            const output = document.getElementById('commandSimOutput');

            let result;
            if (command.needsProfile) {
                const profileName = document.getElementById('selectedProfile').value;
                result = typeof command.output === 'function' ? command.output(profileName) : command.output;
            } else {
                result = command.output;
            }

            output.textContent = result;
            output.style.display = 'block';
        }

        function copyCommand() {
            const commandText = document.getElementById('commandText').textContent;
            navigator.clipboard.writeText(commandText).then(() => {
                alert('Command copied to clipboard!');
            });
        }

        // ===== MODULE 3: SCHEDULER VISUALIZER =====

        function updateScheduler() {
            renderSchedulerStats();
        }

        function addProcess() {
            const name = `Process-${processIdCounter++}`;
            const nice = Math.floor(Math.random() * 40) - 20;
            const vruntime = Math.floor(Math.random() * 100);

            schedulerProcesses.push({
                pid: processIdCounter,
                name: name,
                nice: nice,
                priority: nice + 20,
                vruntime: vruntime,
                cpuTime: 0
            });

            renderSchedulerTree();
            renderSchedulerStats();
            showProcessList();
        }

        function renderSchedulerTree() {
            const container = document.getElementById('schedulerTree');
            
            if (schedulerProcesses.length === 0) {
                container.innerHTML = '<div class="info-box warning" style="max-width: 600px; margin: 0 auto;">Add processes to see the scheduler in action.</div>';
                return;
            }

            // Sort by vruntime (simulating binary tree)
            const sorted = [...schedulerProcesses].sort((a, b) => a.vruntime - b.vruntime);

            container.innerHTML = '<h4 style="text-align: center; margin-bottom: 20px;">Processes Organized by Virtual Runtime</h4>';
            
            const treeLevel = document.createElement('div');
            treeLevel.className = 'tree-level';

            sorted.forEach((proc, index) => {
                const node = document.createElement('div');
                node.className = 'process-node';
                node.innerHTML = `
                    <div style="font-weight: bold; color: var(--primary);">${proc.name}</div>
                    <div style="font-size: 0.85em; margin-top: 5px;">
                        Nice: ${proc.nice}<br>
                        VRuntime: ${proc.vruntime}<br>
                        ${index === 0 ? '<strong style="color: var(--success);">‚≠ê Next to run</strong>' : ''}
                    </div>
                `;
                treeLevel.appendChild(node);
            });

            container.appendChild(treeLevel);
        }

        function renderSchedulerStats() {
            const statsDiv = document.getElementById('schedulerStats');
            const cores = parseInt(document.getElementById('cpuCores').value);
            const load = document.getElementById('systemLoad').value;

            const loadDescriptions = {
                'low': 'System is under-loaded. All processes get immediate CPU access.',
                'medium': 'Moderate load. Processes compete for CPU time.',
                'high': 'System is saturated. Priority becomes critical.'
            };

            statsDiv.innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">CPU Cores</div>
                    <div class="stat-value">${cores}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Active Processes</div>
                    <div class="stat-value">${schedulerProcesses.length}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">System Load</div>
                    <div class="stat-value">${load.toUpperCase()}</div>
                </div>
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <div class="stat-label">${loadDescriptions[load]}</div>
                </div>
            `;
        }

        function showProcessList() {
            const listDiv = document.getElementById('processList');
            listDiv.style.display = 'block';
            
            listDiv.innerHTML = '<h4>Active Processes</h4>';
            
            schedulerProcesses.forEach(proc => {
                const item = document.createElement('div');
                item.className = 'process-item';
                item.innerHTML = `
                    <div class="process-info">
                        <strong>${proc.name}</strong> (PID: ${proc.pid})<br>
                        <span style="font-size: 0.85em; color: var(--text-secondary);">
                            Nice: ${proc.nice} | Priority: ${proc.priority} | VRuntime: ${proc.vruntime}
                        </span>
                    </div>
                    <div class="process-actions">
                        <button onclick="removeProcess(${proc.pid})">Remove</button>
                    </div>
                `;
                listDiv.appendChild(item);
            });
        }

        function removeProcess(pid) {
            schedulerProcesses = schedulerProcesses.filter(p => p.pid !== pid);
            renderSchedulerTree();
            renderSchedulerStats();
            if (schedulerProcesses.length === 0) {
                document.getElementById('processList').style.display = 'none';
            } else {
                showProcessList();
            }
        }

        function startScheduling() {
            if (schedulerRunning) return;
            
            schedulerRunning = true;
            schedulerInterval = setInterval(() => {
                if (schedulerProcesses.length === 0) {
                    pauseScheduling();
                    return;
                }

                // Simulate scheduling: increment vruntime of first process
                schedulerProcesses.sort((a, b) => a.vruntime - b.vruntime);
                schedulerProcesses[0].vruntime += 10;
                schedulerProcesses[0].cpuTime += 10;

                renderSchedulerTree();
            }, 1000);
        }

        function pauseScheduling() {
            schedulerRunning = false;
            if (schedulerInterval) {
                clearInterval(schedulerInterval);
                schedulerInterval = null;
            }
        }

        function resetScheduler() {
            pauseScheduling();
            schedulerProcesses = [];
            processIdCounter = 1;
            renderSchedulerTree();
            renderSchedulerStats();
            document.getElementById('processList').style.display = 'none';
        }

        // ===== MODULE 4: NICE VALUE SCALE =====

        let niceProcessCounter = 1;
        let placedProcesses = [];

        function addNiceProcess() {
            const bank = document.getElementById('processDragArea');
            const processName = `proc${niceProcessCounter++}`;
            
            const processDiv = document.createElement('div');
            processDiv.className = 'draggable-process';
            processDiv.draggable = true;
            processDiv.id = processName;
            processDiv.textContent = processName;
            
            processDiv.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', processName);
            });
            
            bank.appendChild(processDiv);
        }

        function initializeNiceDragDrop() {
            const dropZone = document.getElementById('nicePlacedProcesses');
            
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('drag-over');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
                
                const processName = e.dataTransfer.getData('text/plain');
                const processElement = document.getElementById(processName);
                
                if (processElement) {
                    // Simulate placing at a nice value
                    const niceValue = Math.floor(Math.random() * 40) - 20;
                    const priority = niceValue + 20;
                    
                    processElement.remove();
                    
                    const placedDiv = document.createElement('div');
                    placedDiv.className = 'process-item';
                    placedDiv.innerHTML = `
                        <div class="process-info">
                            <strong>${processName}</strong><br>
                            <span style="font-size: 0.85em;">Nice: ${niceValue} | Priority: ${priority}</span>
                        </div>
                        <button onclick="removeNiceProcess('${processName}')">Remove</button>
                    `;
                    
                    if (dropZone.textContent.includes('Drop processes')) {
                        dropZone.innerHTML = '';
                    }
                    
                    dropZone.appendChild(placedDiv);
                    placedProcesses.push({ name: processName, nice: niceValue, priority: priority });
                }
            });
            
            // Add some initial processes
            for (let i = 0; i < 5; i++) {
                addNiceProcess();
            }
        }

        function removeNiceProcess(name) {
            placedProcesses = placedProcesses.filter(p => p.name !== name);
            renderPlacedProcesses();
        }

        function renderPlacedProcesses() {
            const dropZone = document.getElementById('nicePlacedProcesses');
            
            if (placedProcesses.length === 0) {
                dropZone.innerHTML = 'Drop processes here to set their nice values';
                return;
            }
            
            dropZone.innerHTML = '';
            placedProcesses.forEach(proc => {
                const placedDiv = document.createElement('div');
                placedDiv.className = 'process-item';
                placedDiv.innerHTML = `
                    <div class="process-info">
                        <strong>${proc.name}</strong><br>
                        <span style="font-size: 0.85em;">Nice: ${proc.nice} | Priority: ${proc.priority}</span>
                    </div>
                    <button onclick="removeNiceProcess('${proc.name}')">Remove</button>
                `;
                dropZone.appendChild(placedDiv);
            });
        }

        function showNiceMapping() {
            const table = document.getElementById('niceMappingTable');
            table.style.display = table.style.display === 'none' ? 'block' : 'none';
        }

        function resetNiceScale() {
            placedProcesses = [];
            niceProcessCounter = 1;
            document.getElementById('processDragArea').innerHTML = '';
            document.getElementById('nicePlacedProcesses').innerHTML = 'Drop processes here to set their nice values';
            for (let i = 0; i < 5; i++) {
                addNiceProcess();
            }
        }

        function loadScenario(num) {
            const detailsDiv = document.getElementById('scenarioDetails');
            
            // Clear active state from all scenario cards
            document.querySelectorAll('.scenario-card').forEach(card => {
                card.classList.remove('active');
            });
            
            // Mark clicked scenario as active
            event.target.closest('.scenario-card').classList.add('active');
            
            const scenarios = {
                1: {
                    title: 'Background Backup Job',
                    problem: 'Your backup script is consuming too much CPU and making your terminal sluggish.',
                    solution: 'Use a positive nice value (e.g., +15 or +19) to lower the backup process priority.',
                    command: 'nice -n 15 backup-script.sh',
                    explanation: 'By setting nice to +15, the backup runs at lower priority than your interactive shell (nice 0), ensuring your terminal remains responsive.'
                },
                2: {
                    title: 'Critical Database Query',
                    problem: 'A critical reporting query needs to complete faster and you have root access.',
                    solution: 'Use renice with a negative value to increase priority (requires root).',
                    command: 'sudo renice -n -10 <PID>',
                    explanation: 'Negative nice values increase priority. Only root can set negative nice values. This makes the query more likely to get CPU time.'
                },
                3: {
                    title: 'Video Encoding',
                    problem: 'You want to encode videos overnight without impacting tomorrow\'s work.',
                    solution: 'Start the encoding with a high nice value.',
                    command: 'nice -n 19 ffmpeg -i input.mp4 output.mp4',
                    explanation: 'Nice value of +19 is the lowest priority. The encoding will run slowly but won\'t interfere with other processes.'
                }
            };

            const scenario = scenarios[num];
            detailsDiv.innerHTML = `
                <h3>${scenario.title}</h3>
                <div class="info-box warning">
                    <strong>Problem:</strong> ${scenario.problem}
                </div>
                <div class="info-box success">
                    <strong>Solution:</strong> ${scenario.solution}
                    <div style="margin-top: 10px;">
                        <code>${scenario.command}</code>
                    </div>
                </div>
                <p style="margin-top: 15px;"><strong>Why it works:</strong> ${scenario.explanation}</p>
            `;
            detailsDiv.classList.add('open');
        }

        // ===== MODULE 5: COMMAND LABORATORY =====

        function initializeLab() {
            // Create some initial processes
            labProcesses = [
                { pid: 1001, command: 'bash', user: 'student', nice: 0, status: 'Running' },
                { pid: 1002, command: 'firefox', user: 'student', nice: 0, status: 'Running' },
                { pid: 1003, command: 'backup.sh', user: 'student', nice: 10, status: 'Running' },
                { pid: 1004, command: 'mysql', user: 'mysql', nice: -5, status: 'Running' }
            ];
            labProcessIdCounter = 1005;
            renderLabProcessList();
        }

        function renderLabProcessList() {
            const listDiv = document.getElementById('labProcessList');
            listDiv.innerHTML = '<h4>System Processes</h4>';
            
            labProcesses.forEach(proc => {
                const item = document.createElement('div');
                item.className = 'process-item';
                item.style.borderLeftColor = proc.nice < 0 ? 'var(--success)' : proc.nice > 0 ? 'var(--warning)' : 'var(--primary)';
                
                item.innerHTML = `
                    <div class="process-info">
                        <strong>PID ${proc.pid}</strong> - ${proc.command}<br>
                        <span style="font-size: 0.85em; color: var(--text-secondary);">
                            User: ${proc.user} | Nice: ${proc.nice} | Priority: ${proc.nice + 20} | Status: ${proc.status}
                        </span>
                    </div>
                    <div class="process-actions">
                        <button onclick="labRenice(${proc.pid})">Renice</button>
                        <button onclick="labKill(${proc.pid})" class="secondary">Kill</button>
                    </div>
                `;
                listDiv.appendChild(item);
            });
        }

        function labAddProcess() {
            const commands = ['backup.sh', 'encode-video', 'compile', 'rsync', 'find', 'grep'];
            const command = commands[Math.floor(Math.random() * commands.length)];
            
            labProcesses.push({
                pid: labProcessIdCounter++,
                command: command,
                user: 'student',
                nice: 0,
                status: 'Running'
            });
            
            renderLabProcessList();
        }

        function labRenice(pid) {
            const newNice = prompt(`Enter new nice value for PID ${pid} (-20 to +19):`);
            if (newNice === null) return;
            
            const niceValue = parseInt(newNice);
            if (isNaN(niceValue) || niceValue < -20 || niceValue > 19) {
                alert('Invalid nice value! Must be between -20 and +19.');
                return;
            }
            
            const proc = labProcesses.find(p => p.pid === pid);
            if (!proc) return;
            
            const currentUser = 'student'; // Simulated
            
            if (niceValue < proc.nice && currentUser !== 'root') {
                showLabOutput(`renice: failed to set priority for ${pid} (process ID): Permission denied\n\nNote: Only root can decrease nice values (increase priority).`);
                return;
            }
            
            const oldPriority = proc.nice + 20;
            proc.nice = niceValue;
            renderLabProcessList();
            showLabOutput(`${pid} (process ID) old priority ${oldPriority}, new priority ${niceValue + 20}`);
        }

        function labKill(pid) {
            labProcesses = labProcesses.filter(p => p.pid !== pid);
            renderLabProcessList();
            showLabOutput(`Process ${pid} terminated.`);
        }

        function updateLabCommand() {
            const cmdType = document.getElementById('labCommandType').value;
            const optionsDiv = document.getElementById('labCommandOptions');
            const previewDiv = document.getElementById('labCommandText');
            
            switch(cmdType) {
                case 'nice':
                    optionsDiv.innerHTML = `
                        <div class="form-group">
                            <label>Nice Value (-20 to +19)</label>
                            <input type="number" id="labNiceValue" value="10" min="-20" max="19">
                        </div>
                        <div class="form-group">
                            <label>Command to Execute</label>
                            <input type="text" id="labCommand" value="sleep 300" placeholder="command">
                        </div>
                    `;
                    previewDiv.textContent = 'nice -n 10 sleep 300';
                    break;
                    
                case 'renice':
                    optionsDiv.innerHTML = `
                        <div class="form-group">
                            <label>New Nice Value (-20 to +19)</label>
                            <input type="number" id="labReniceValue" value="5" min="-20" max="19">
                        </div>
                        <div class="form-group">
                            <label>Target PID</label>
                            <input type="number" id="labPID" value="${labProcesses[0]?.pid || 1001}">
                        </div>
                    `;
                    previewDiv.textContent = `renice -n 5 ${labProcesses[0]?.pid || 1001}`;
                    break;
                    
                case 'ps':
                    optionsDiv.innerHTML = `
                        <div class="form-group">
                            <label>Options</label>
                            <select id="labPsOptions">
                                <option value="axo">Show all with custom format</option>
                                <option value="aux">Standard format</option>
                                <option value="pid">Specific PID</option>
                            </select>
                        </div>
                    `;
                    previewDiv.textContent = 'ps axo pid,comm,nice';
                    break;
                    
                case 'top':
                    optionsDiv.innerHTML = '<p style="color: var(--text-secondary);">Interactive process viewer. Press \'r\' in top to renice a process.</p>';
                    previewDiv.textContent = 'top';
                    break;
            }
        }

        function executeLabCommand() {
            const cmdType = document.getElementById('labCommandType').value;
            let output = '';
            
            switch(cmdType) {
                case 'nice':
                    const niceVal = document.getElementById('labNiceValue').value;
                    const cmd = document.getElementById('labCommand').value;
                    output = `Starting: ${cmd}\nNice value: ${niceVal}\nProcess started with PID ${labProcessIdCounter}\n\n[1] ${labProcessIdCounter}`;
                    
                    labProcesses.push({
                        pid: labProcessIdCounter++,
                        command: cmd,
                        user: 'student',
                        nice: parseInt(niceVal),
                        status: 'Running'
                    });
                    renderLabProcessList();
                    break;
                    
                case 'renice':
                    const reniceVal = document.getElementById('labReniceValue').value;
                    const pid = parseInt(document.getElementById('labPID').value);
                    const proc = labProcesses.find(p => p.pid === pid);
                    
                    if (proc) {
                        const oldPriority = proc.nice + 20;
                        proc.nice = parseInt(reniceVal);
                        const newPriority = proc.nice + 20;
                        output = `${pid} (process ID) old priority ${oldPriority}, new priority ${newPriority}`;
                        renderLabProcessList();
                    } else {
                        output = `renice: failed to get priority for ${pid} (process ID): No such process`;
                    }
                    break;
                    
                case 'ps':
                    output = 'PID  COMMAND          NI\n';
                    labProcesses.forEach(p => {
                        output += `${String(p.pid).padEnd(5)}${p.command.padEnd(17)}${p.nice}\n`;
                    });
                    break;
                    
                case 'top':
                    output = `Tasks: ${labProcesses.length} total,   ${labProcesses.filter(p => p.status === 'Running').length} running
%Cpu(s):  5.2 us,  2.1 sy,  0.0 ni, 92.5 id,  0.0 wa
MiB Mem :  16384 total,   8192 free,   6144 used,   2048 buff/cache

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
${labProcesses.map(p => `${String(p.pid).padEnd(5)}${p.user.padEnd(10)}${String(p.nice + 20).padEnd(4)}${String(p.nice).padEnd(4)}  165432  23456   4832 R   ${Math.floor(Math.random()*20)}   0.1   0:00.${Math.floor(Math.random()*99)} ${p.command}`).join('\n')}

Press 'r' to renice a process (simulated)`;
                    break;
            }
            
            showLabOutput(output);
        }

        function showLabOutput(output) {
            const outputDiv = document.getElementById('labOutput');
            outputDiv.textContent = output;
            outputDiv.style.display = 'block';
        }

        function labShowHelp() {
            const help = `COMMAND HELP:

nice - run a program with modified scheduling priority
  Syntax: nice -n <value> <command>
  Example: nice -n 10 backup.sh

renice - alter priority of running processes
  Syntax: renice -n <value> <PID>
  Example: renice -n 5 1234

ps - report a snapshot of the current processes
  Common options:
    -o pid,comm,nice  - custom output format
    aux              - all processes, detailed
    -p <PID>         - specific process

top - dynamic real-time view of processes
  Interactive commands (when running):
    r - renice a process
    k - kill a process
    q - quit`;
            
            showLabOutput(help);
        }

        function labRefresh() {
            renderLabProcessList();
        }

        function labReset() {
            initializeLab();
            document.getElementById('labOutput').style.display = 'none';
        }

        function checkChallenge(num) {
            const results = {
                1: {
                    answer: 'nice -n 10 sleep 3600 &',
                    explanation: 'The command <code>nice -n 10 sleep 3600 &</code> starts the sleep command with a nice value of +10, lowering its priority. The & runs it in the background.'
                },
                2: {
                    answer: 'sudo renice -n -5 1234',
                    explanation: 'The command <code>sudo renice -n -5 1234</code> changes the nice value to -5 for PID 1234. The sudo is required because decreasing nice (increasing priority) requires root privileges.'
                },
                3: {
                    answer: 'ps -o pid,comm,nice -p 5678',
                    explanation: 'The command <code>ps -o pid,comm,nice -p 5678</code> displays only the PID, command name, and nice value for the specified process ID. The -o option specifies custom output columns, and -p specifies the PID.'
                }
            };
            
            const result = results[num];
            const resultDiv = document.getElementById(`challenge${num}Result`);
            
            resultDiv.innerHTML = `
                <div class="info-box success" style="margin-top: 15px;">
                    <h4>‚úì Solution</h4>
                    <p><strong>Command:</strong> <code>${result.answer}</code></p>
                    <p style="margin-top: 10px;"><strong>Explanation:</strong> ${result.explanation}</p>
                </div>
            `;
            resultDiv.style.display = 'block';
        }

        // ===== INITIALIZATION =====

        document.addEventListener('DOMContentLoaded', function() {
            initializeProfiles();
            updateCommandBuilder();
            renderSchedulerStats();
            initializeNiceDragDrop();
            initializeLab();
        });
    </script>
</body>
</html>
