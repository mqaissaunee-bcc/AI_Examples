<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Calculus Fundamentals</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        header p {
            font-size: 1.3em;
            opacity: 0.95;
        }

        .tab-navigation {
            display: flex;
            flex-wrap: wrap;
            background: #f7fafc;
            border-bottom: 3px solid #e2e8f0;
            padding: 10px;
            gap: 10px;
            justify-content: center;
        }

        .tab-btn {
            padding: 15px 25px;
            background: white;
            border: 2px solid #cbd5e0;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #4a5568;
        }

        .tab-btn:hover {
            background: #edf2f7;
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .content-area {
            padding: 30px;
            min-height: 500px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .theory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .concept-card {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border: 2px solid #cbd5e0;
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .concept-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .concept-card h3 {
            color: #667eea;
            font-size: 1.6em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #cbd5e0;
        }

        .formula-box {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            font-size: 1.3em;
            text-align: center;
            border-left: 4px solid #667eea;
            font-family: 'Times New Roman', serif;
        }

        .explanation {
            background: #fff5e6;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #f6ad55;
            font-size: 1.05em;
            line-height: 1.7;
        }

        .tip-box {
            background: #e6f7ff;
            border-left: 4px solid #0066cc;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }

        .tip-box strong {
            color: #0066cc;
        }

        .visualization-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            margin: 20px 0;
        }

        canvas {
            border: 2px solid #cbd5e0;
            border-radius: 10px;
            background: white;
            max-width: 100%;
            display: block;
        }

        .controls-panel {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #cbd5e0;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .control-group label {
            display: block;
            margin: 10px 0 5px 0;
            font-weight: 600;
            color: #4a5568;
        }

        .control-group input[type="range"] {
            width: 100%;
            height: 8px;
            cursor: pointer;
        }

        .control-group input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #cbd5e0;
            border-radius: 8px;
            font-size: 1em;
        }

        .control-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #cbd5e0;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .info-display {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #667eea;
            font-family: monospace;
            font-size: 1.1em;
        }

        .practice-section {
            background: #f7fafc;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .question {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #cbd5e0;
        }

        .question h4 {
            color: #667eea;
            font-size: 1.4em;
            margin-bottom: 15px;
        }

        .options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .option-btn {
            padding: 15px;
            background: white;
            border: 2px solid #cbd5e0;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s ease;
            text-align: left;
        }

        .option-btn:hover {
            background: #edf2f7;
            border-color: #667eea;
            transform: scale(1.05);
        }

        .option-btn.correct {
            background: #c6f6d5;
            border-color: #48bb78;
        }

        .option-btn.incorrect {
            background: #fed7d7;
            border-color: #f56565;
        }

        .feedback {
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            text-align: center;
        }

        .feedback.correct {
            background: #c6f6d5;
            color: #22543d;
        }

        .feedback.incorrect {
            background: #fed7d7;
            color: #742a2a;
        }

        .rules-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }

        .rules-table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-size: 1.1em;
        }

        .rules-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .rules-table tr:hover {
            background: #f7fafc;
        }

        .score-display {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border: 2px solid #667eea;
            z-index: 1000;
        }

        .score-display h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        @media (max-width: 1024px) {
            .visualization-container {
                grid-template-columns: 1fr;
            }
            
            .theory-grid {
                grid-template-columns: 1fr;
            }
            
            header h1 {
                font-size: 2em;
            }
            
            .score-display {
                position: static;
                margin: 20px auto;
                max-width: 300px;
            }
        }

        .highlight {
            background: #fef5e7;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
            color: #d68910;
        }

        .function-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .function-btn {
            padding: 10px 15px;
            border: 2px solid #cbd5e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .function-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .function-btn:hover {
            border-color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìà Interactive Calculus Fundamentals</h1>
            <p>Master derivatives and integrals with visual learning and interactive exploration</p>
        </header>

        <div class="tab-navigation">
            <button class="tab-btn active" onclick="showTab('theory')">üìö Theory</button>
            <button class="tab-btn" onclick="showTab('derivatives')">üìâ Derivatives</button>
            <button class="tab-btn" onclick="showTab('integrals')">üìä Integrals</button>
            <button class="tab-btn" onclick="showTab('practice')">‚úèÔ∏è Practice</button>
            <button class="tab-btn" onclick="showTab('applications')">üåç Applications</button>
            <button class="tab-btn" onclick="showTab('reference')">üìñ Reference</button>
        </div>

        <div class="content-area">
            <!-- THEORY TAB -->
            <div id="theory" class="tab-content active">
                <h2 style="color: #667eea; font-size: 2em; margin-bottom: 20px;">Calculus Fundamentals</h2>
                <p style="font-size: 1.2em; margin-bottom: 30px;">Calculus is the mathematics of change. It has two main branches: differential calculus (derivatives) and integral calculus (integrals).</p>

                <div class="theory-grid">
                    <!-- Derivatives -->
                    <div class="concept-card">
                        <h3>üìâ Derivatives: The Rate of Change</h3>
                        <div class="explanation">
                            A derivative measures how fast a function changes. It's the slope of the tangent line at any point on a curve.
                        </div>
                        <div class="formula-box">
                            f'(x) = lim<sub>h‚Üí0</sub> [f(x+h) - f(x)] / h
                        </div>
                        <div class="explanation">
                            <strong>Physical Interpretation:</strong> If f(t) represents position, then f'(t) is velocity. If f(t) is velocity, then f'(t) is acceleration.
                        </div>
                        <div class="tip-box">
                            <strong>Notation:</strong> f'(x), dy/dx, df/dx, and Df(x) all mean the same thing - the derivative of f with respect to x.
                        </div>
                    </div>

                    <!-- Integrals -->
                    <div class="concept-card">
                        <h3>üìä Integrals: The Accumulation</h3>
                        <div class="explanation">
                            An integral measures the total accumulation or area under a curve. It's the reverse process of differentiation.
                        </div>
                        <div class="formula-box">
                            ‚à´<sub>a</sub><sup>b</sup> f(x) dx = F(b) - F(a)
                        </div>
                        <div class="explanation">
                            <strong>Physical Interpretation:</strong> If f(t) is velocity, then ‚à´f(t)dt is total distance traveled. If f(x) is density, then ‚à´f(x)dx is total mass.
                        </div>
                        <div class="tip-box">
                            <strong>The Fundamental Theorem:</strong> Integration and differentiation are inverse operations. If F'(x) = f(x), then ‚à´f(x)dx = F(x) + C.
                        </div>
                    </div>

                    <!-- Power Rule -->
                    <div class="concept-card">
                        <h3>‚ö° Power Rule</h3>
                        <div class="explanation">
                            The most fundamental differentiation rule:
                        </div>
                        <div class="formula-box">
                            d/dx [x<sup>n</sup>] = nx<sup>n-1</sup>
                        </div>
                        <div class="explanation">
                            <strong>Examples:</strong><br>
                            ‚Ä¢ d/dx [x¬≥] = 3x¬≤<br>
                            ‚Ä¢ d/dx [x‚Åµ] = 5x‚Å¥<br>
                            ‚Ä¢ d/dx [1/x] = d/dx [x‚Åª¬π] = -x‚Åª¬≤
                        </div>
                        <div class="tip-box">
                            <strong>For Integration:</strong> ‚à´x<sup>n</sup> dx = x<sup>n+1</sup>/(n+1) + C (when n ‚â† -1)
                        </div>
                    </div>

                    <!-- Product Rule -->
                    <div class="concept-card">
                        <h3>‚úñÔ∏è Product Rule</h3>
                        <div class="explanation">
                            When differentiating a product of two functions:
                        </div>
                        <div class="formula-box">
                            d/dx [f(x)¬∑g(x)] = f'(x)¬∑g(x) + f(x)¬∑g'(x)
                        </div>
                        <div class="explanation">
                            <strong>Mnemonic:</strong> "First times derivative of second, plus second times derivative of first"
                        </div>
                        <div class="explanation">
                            <strong>Example:</strong> d/dx [x¬≤¬∑sin(x)] = 2x¬∑sin(x) + x¬≤¬∑cos(x)
                        </div>
                    </div>

                    <!-- Quotient Rule -->
                    <div class="concept-card">
                        <h3>‚ûó Quotient Rule</h3>
                        <div class="explanation">
                            When differentiating a quotient of two functions:
                        </div>
                        <div class="formula-box">
                            d/dx [f(x)/g(x)] = [f'(x)¬∑g(x) - f(x)¬∑g'(x)] / [g(x)]¬≤
                        </div>
                        <div class="explanation">
                            <strong>Mnemonic:</strong> "Low d-high minus high d-low, over low squared"
                        </div>
                        <div class="explanation">
                            <strong>Example:</strong> d/dx [x¬≤/cos(x)] = [2x¬∑cos(x) - x¬≤¬∑(-sin(x))] / cos¬≤(x)
                        </div>
                    </div>

                    <!-- Chain Rule -->
                    <div class="concept-card">
                        <h3>üîó Chain Rule</h3>
                        <div class="explanation">
                            When differentiating composite functions:
                        </div>
                        <div class="formula-box">
                            d/dx [f(g(x))] = f'(g(x)) ¬∑ g'(x)
                        </div>
                        <div class="explanation">
                            <strong>Think of it as:</strong> Derivative of outer function (evaluated at inner function) times derivative of inner function
                        </div>
                        <div class="explanation">
                            <strong>Example:</strong> d/dx [sin(x¬≤)] = cos(x¬≤) ¬∑ 2x
                        </div>
                        <div class="tip-box">
                            <strong>Connection to Newton's Method:</strong> Newton's method uses f'(x) to find roots iteratively: x<sub>n+1</sub> = x<sub>n</sub> - f(x<sub>n</sub>)/f'(x<sub>n</sub>)
                        </div>
                    </div>

                    <!-- Fundamental Theorem -->
                    <div class="concept-card">
                        <h3>üéØ Fundamental Theorem of Calculus</h3>
                        <div class="explanation">
                            This theorem connects derivatives and integrals:
                        </div>
                        <div class="formula-box">
                            <strong>Part 1:</strong> d/dx [‚à´<sub>a</sub><sup>x</sup> f(t) dt] = f(x)
                        </div>
                        <div class="formula-box">
                            <strong>Part 2:</strong> ‚à´<sub>a</sub><sup>b</sup> f(x) dx = F(b) - F(a)
                        </div>
                        <div class="explanation">
                            <strong>What it means:</strong> Differentiation and integration are inverse operations. If you integrate then differentiate (or vice versa), you get back to where you started!
                        </div>
                    </div>

                    <!-- Riemann Sums -->
                    <div class="concept-card">
                        <h3>üì¶ Riemann Sums</h3>
                        <div class="explanation">
                            Riemann sums approximate the area under a curve using rectangles:
                        </div>
                        <div class="formula-box">
                            ‚à´<sub>a</sub><sup>b</sup> f(x) dx ‚âà Œ£ f(x<sub>i</sub>*) Œîx
                        </div>
                        <div class="explanation">
                            <strong>Methods:</strong><br>
                            ‚Ä¢ <strong>Left Endpoint:</strong> Use left side of each interval<br>
                            ‚Ä¢ <strong>Right Endpoint:</strong> Use right side of each interval<br>
                            ‚Ä¢ <strong>Midpoint:</strong> Use center of each interval<br>
                            ‚Ä¢ <strong>Trapezoidal:</strong> Use average of endpoints
                        </div>
                        <div class="tip-box">
                            <strong>Key Insight:</strong> As the number of rectangles approaches infinity, the Riemann sum converges to the exact integral!
                        </div>
                    </div>
                </div>
            </div>

            <!-- DERIVATIVES VISUALIZATION TAB -->
            <div id="derivatives" class="tab-content">
                <h2 style="color: #667eea; font-size: 2em; margin-bottom: 20px;">Interactive Derivative Visualization</h2>
                <p style="font-size: 1.1em; margin-bottom: 20px;">Explore how derivatives work by seeing the tangent line at any point. The derivative is the slope of this tangent line!</p>

                <div class="visualization-container">
                    <div>
                        <canvas id="derivCanvas" width="800" height="600"></canvas>
                        <div class="info-display">
                            <div>Point: (<span id="derivX">0</span>, <span id="derivY">0</span>)</div>
                            <div>Function value: f(<span id="derivX2">0</span>) = <span id="derivFval">0</span></div>
                            <div>Derivative: f'(<span id="derivX3">0</span>) = <span id="derivSlope">0</span></div>
                            <div>Tangent line: y = <span id="tangentEq">mx + b</span></div>
                        </div>
                    </div>

                    <div class="controls-panel">
                        <div class="control-group">
                            <h4>Choose Function</h4>
                            <div class="function-selector">
                                <button class="function-btn active" onclick="setDerivFunction('polynomial')">x¬≤ - 2x</button>
                                <button class="function-btn" onclick="setDerivFunction('cubic')">x¬≥ - 3x</button>
                                <button class="function-btn" onclick="setDerivFunction('sine')">sin(x)</button>
                                <button class="function-btn" onclick="setDerivFunction('exp')">e^x</button>
                                <button class="function-btn" onclick="setDerivFunction('rational')">1/(x¬≤+1)</button>
                            </div>
                        </div>

                        <div class="control-group">
                            <label>X Position: <span id="derivXSliderVal">0.0</span></label>
                            <input type="range" id="derivXSlider" min="-5" max="5" step="0.1" value="1" oninput="updateDerivative()">
                        </div>

                        <div class="control-group">
                            <label>
                                <input type="checkbox" id="showTangent" checked onchange="updateDerivative()">
                                Show Tangent Line
                            </label>
                        </div>

                        <div class="control-group">
                            <label>
                                <input type="checkbox" id="showSecant" onchange="updateDerivative()">
                                Show Secant Line (h = <span id="hValue">0.5</span>)
                            </label>
                            <input type="range" id="hSlider" min="0.1" max="2" step="0.1" value="0.5" oninput="updateDerivative()">
                        </div>

                        <div class="tip-box" style="margin-top: 20px;">
                            <strong>üí° Tip:</strong> The secant line shows the average rate of change over an interval. As h approaches 0, the secant line approaches the tangent line - this is the limit definition of the derivative!
                        </div>
                    </div>
                </div>
            </div>

            <!-- INTEGRALS VISUALIZATION TAB -->
            <div id="integrals" class="tab-content">
                <h2 style="color: #667eea; font-size: 2em; margin-bottom: 20px;">Interactive Riemann Sums</h2>
                <p style="font-size: 1.1em; margin-bottom: 20px;">See how rectangles approximate the area under a curve. As the number of rectangles increases, the approximation gets better!</p>

                <div class="visualization-container">
                    <div>
                        <canvas id="integralCanvas" width="800" height="600"></canvas>
                        <div class="info-display">
                            <div>Interval: [<span id="intA">0</span>, <span id="intB">0</span>]</div>
                            <div>Number of rectangles: <span id="numRect">0</span></div>
                            <div>Rectangle width (Œîx): <span id="deltaX">0</span></div>
                            <div>Approximate area: <span id="approxArea">0</span></div>
                            <div>Exact integral: <span id="exactInt">0</span></div>
                            <div>Error: <span id="intError">0</span></div>
                        </div>
                    </div>

                    <div class="controls-panel">
                        <div class="control-group">
                            <h4>Choose Function</h4>
                            <div class="function-selector">
                                <button class="function-btn active" onclick="setIntegralFunction('parabola')">x¬≤</button>
                                <button class="function-btn" onclick="setIntegralFunction('sine')">sin(x)</button>
                                <button class="function-btn" onclick="setIntegralFunction('exp')">e^x</button>
                                <button class="function-btn" onclick="setIntegralFunction('sqrt')">‚àöx</button>
                            </div>
                        </div>

                        <div class="control-group">
                            <h4>Riemann Sum Method</h4>
                            <select id="riemannMethod" onchange="updateIntegral()">
                                <option value="left">Left Endpoint</option>
                                <option value="right">Right Endpoint</option>
                                <option value="midpoint" selected>Midpoint</option>
                                <option value="trapezoidal">Trapezoidal</option>
                            </select>
                        </div>

                        <div class="control-group">
                            <label>Number of Rectangles: <span id="nRectDisplay">10</span></label>
                            <input type="range" id="nRectSlider" min="1" max="100" value="10" oninput="updateIntegral()">
                        </div>

                        <div class="control-group">
                            <label>Left Boundary (a): <span id="intADisplay">0</span></label>
                            <input type="range" id="intASlider" min="-2" max="2" step="0.1" value="0" oninput="updateIntegral()">
                        </div>

                        <div class="control-group">
                            <label>Right Boundary (b): <span id="intBDisplay">3</span></label>
                            <input type="range" id="intBSlider" min="0" max="6" step="0.1" value="3" oninput="updateIntegral()">
                        </div>

                        <div class="tip-box" style="margin-top: 20px;">
                            <strong>üí° Watch:</strong> As you increase the number of rectangles, the approximation gets closer to the exact value!
                        </div>
                    </div>
                </div>
            </div>

            <!-- PRACTICE TAB -->
            <div id="practice" class="tab-content">
                <h2 style="color: #667eea; font-size: 2em; margin-bottom: 20px;">Practice Problems</h2>
                <div class="practice-section" id="practiceArea">
                    <div class="question" id="currentQuestion">
                        <!-- Questions will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- APPLICATIONS TAB -->
            <div id="applications" class="tab-content">
                <h2 style="color: #667eea; font-size: 2em; margin-bottom: 20px;">Real-World Applications of Calculus</h2>
                <p style="font-size: 1.2em; margin-bottom: 30px;">Calculus is everywhere! From physics to economics, biology to engineering, derivatives and integrals help us understand and predict change.</p>

                <div class="theory-grid">
                    <div class="concept-card">
                        <h3>üöó Physics: Motion Analysis</h3>
                        <div class="explanation">
                            <strong>Position, Velocity, Acceleration:</strong> These are related through derivatives!
                        </div>
                        <div class="formula-box">
                            velocity = ds/dt (derivative of position)<br>
                            acceleration = dv/dt (derivative of velocity)
                        </div>
                        <div class="explanation">
                            If a car's position is s(t) = t¬≥ - 6t¬≤ + 9t meters at time t seconds:
                            <br>‚Ä¢ Velocity: v(t) = 3t¬≤ - 12t + 9 m/s
                            <br>‚Ä¢ Acceleration: a(t) = 6t - 12 m/s¬≤
                            <br>‚Ä¢ At t = 2s, the car has zero velocity (v(2) = 0) and is momentarily stopped!
                        </div>
                    </div>

                    <div class="concept-card">
                        <h3>üìà Economics: Marginal Analysis</h3>
                        <div class="explanation">
                            <strong>Marginal Cost/Revenue:</strong> The derivative tells us how cost or revenue changes with one more unit.
                        </div>
                        <div class="formula-box">
                            Marginal Cost = dC/dq<br>
                            Marginal Revenue = dR/dq
                        </div>
                        <div class="explanation">
                            If C(q) = 1000 + 50q + 0.1q¬≤ is the cost to produce q items:
                            <br>‚Ä¢ Marginal cost: MC = 50 + 0.2q
                            <br>‚Ä¢ At q = 100, MC = $70 per unit
                            <br>‚Ä¢ This tells the company the cost of producing one more item
                        </div>
                        <div class="tip-box">
                            <strong>Profit Maximization:</strong> Set marginal revenue equal to marginal cost: MR = MC
                        </div>
                    </div>

                    <div class="concept-card">
                        <h3>üèóÔ∏è Engineering: Optimization</h3>
                        <div class="explanation">
                            <strong>Finding Maximum/Minimum:</strong> Derivatives help find optimal designs.
                        </div>
                        <div class="explanation">
                            <strong>Example - Box Design:</strong> A company needs a box with volume 1000 cm¬≥ and a square base. What dimensions minimize surface area (and cost)?
                            <br><br>
                            Setting V = x¬≤h = 1000, we get h = 1000/x¬≤
                            <br>Surface area: S(x) = 2x¬≤ + 4xh = 2x¬≤ + 4000/x
                            <br>Minimize by setting S'(x) = 0:
                            <br>S'(x) = 4x - 4000/x¬≤ = 0
                            <br>Optimal: x = 10 cm, h = 10 cm (a cube!)
                        </div>
                    </div>

                    <div class="concept-card">
                        <h3>üå°Ô∏è Related Rates</h3>
                        <div class="explanation">
                            <strong>Connecting Rates of Change:</strong> When multiple quantities change together.
                        </div>
                        <div class="explanation">
                            <strong>Inflating Balloon:</strong> A spherical balloon is being inflated at 100 cm¬≥/s. How fast is the radius increasing when r = 5 cm?
                            <br><br>
                            Volume: V = (4/3)œÄr¬≥
                            <br>Differentiate both sides: dV/dt = 4œÄr¬≤(dr/dt)
                            <br>Given dV/dt = 100, r = 5:
                            <br>100 = 4œÄ(25)(dr/dt)
                            <br>dr/dt = 1/œÄ ‚âà 0.32 cm/s
                        </div>
                    </div>

                    <div class="concept-card">
                        <h3>üíä Medicine: Drug Concentration</h3>
                        <div class="explanation">
                            <strong>Pharmacokinetics:</strong> Calculus models how drug concentration changes over time.
                        </div>
                        <div class="formula-box">
                            C(t) = C‚ÇÄe^(-kt)
                        </div>
                        <div class="explanation">
                            Where C(t) is concentration at time t, C‚ÇÄ is initial dose, k is elimination rate.
                            <br><br>
                            <strong>Rate of change:</strong> C'(t) = -kC‚ÇÄe^(-kt)
                            <br>
                            <strong>Total amount eliminated:</strong> ‚à´‚ÇÄ^‚àû |C'(t)| dt = C‚ÇÄ
                        </div>
                        <div class="tip-box">
                            <strong>Clinical use:</strong> Helps determine dosing schedules to maintain therapeutic levels
                        </div>
                    </div>

                    <div class="concept-card">
                        <h3>üåä Population Dynamics</h3>
                        <div class="explanation">
                            <strong>Growth Models:</strong> Derivatives describe population change.
                        </div>
                        <div class="formula-box">
                            dP/dt = kP (exponential growth)<br>
                            dP/dt = kP(1 - P/M) (logistic growth)
                        </div>
                        <div class="explanation">
                            <strong>Bacteria Growth:</strong> If a bacterial population doubles every hour:
                            <br>P(t) = P‚ÇÄ ¬∑ 2^t
                            <br>Growth rate: P'(t) = P‚ÇÄ ¬∑ 2^t ¬∑ ln(2)
                            <br>At any time, the population is growing at rate P(t) ¬∑ ln(2) bacteria per hour
                        </div>
                    </div>

                    <div class="concept-card">
                        <h3>üéØ Newton's Method</h3>
                        <div class="explanation">
                            <strong>Root Finding:</strong> Uses derivatives to solve equations numerically.
                        </div>
                        <div class="formula-box">
                            x_{n+1} = x_n - f(x_n)/f'(x_n)
                        </div>
                        <div class="explanation">
                            To find ‚àö2 (solve x¬≤ - 2 = 0):
                            <br>f(x) = x¬≤ - 2, f'(x) = 2x
                            <br>Starting with x‚ÇÄ = 1.5:
                            <br>x‚ÇÅ = 1.5 - (1.5¬≤ - 2)/(2¬∑1.5) = 1.4167
                            <br>x‚ÇÇ = 1.4142 (very close to ‚àö2!)
                        </div>
                        <div class="tip-box">
                            <strong>Power:</strong> Converges quadratically - doubles accuracy each iteration!
                        </div>
                    </div>

                    <div class="concept-card">
                        <h3>‚ö° Electrical Engineering</h3>
                        <div class="explanation">
                            <strong>Circuits:</strong> Current, voltage, and charge are related through calculus.
                        </div>
                        <div class="formula-box">
                            i(t) = dq/dt (current is derivative of charge)<br>
                            v(t) = L ¬∑ di/dt (voltage across inductor)
                        </div>
                        <div class="explanation">
                            <strong>RC Circuit:</strong> A capacitor discharges through a resistor:
                            <br>V(t) = V‚ÇÄe^(-t/RC)
                            <br>Current: i(t) = V'(t)/R = -(V‚ÇÄ/RC)e^(-t/RC)
                            <br>Total charge released: Q = ‚à´‚ÇÄ^‚àû |i(t)| dt = CV‚ÇÄ
                        </div>
                    </div>

                    <div class="concept-card">
                        <h3>üìê Area and Volume</h3>
                        <div class="explanation">
                            <strong>Geometric Calculations:</strong> Integrals compute areas and volumes of complex shapes.
                        </div>
                        <div class="explanation">
                            <strong>Area between curves:</strong>
                            <br>A = ‚à´‚Çê·µá [f(x) - g(x)] dx
                            <br><br>
                            <strong>Volume of revolution:</strong> Rotating y = f(x) around x-axis:
                            <br>V = œÄ‚à´‚Çê·µá [f(x)]¬≤ dx
                        </div>
                        <div class="explanation">
                            <strong>Example:</strong> Volume of a sphere of radius r:
                            <br>Rotate y = ‚àö(r¬≤ - x¬≤) around x-axis from -r to r:
                            <br>V = œÄ‚à´‚Çã·µ£ ≥ (r¬≤ - x¬≤) dx = (4/3)œÄr¬≥
                        </div>
                    </div>
                </div>
            </div>

            <!-- REFERENCE TAB -->
            <div id="reference" class="tab-content">
                <h2 style="color: #667eea; font-size: 2em; margin-bottom: 20px;">Quick Reference Guide</h2>

                <div class="concept-card">
                    <h3>üìã Common Derivatives</h3>
                    <table class="rules-table">
                        <tr>
                            <th>Function</th>
                            <th>Derivative</th>
                        </tr>
                        <tr>
                            <td>f(x) = c (constant)</td>
                            <td>f'(x) = 0</td>
                        </tr>
                        <tr>
                            <td>f(x) = x^n</td>
                            <td>f'(x) = nx^(n-1)</td>
                        </tr>
                        <tr>
                            <td>f(x) = e^x</td>
                            <td>f'(x) = e^x</td>
                        </tr>
                        <tr>
                            <td>f(x) = a^x</td>
                            <td>f'(x) = a^x ¬∑ ln(a)</td>
                        </tr>
                        <tr>
                            <td>f(x) = ln(x)</td>
                            <td>f'(x) = 1/x</td>
                        </tr>
                        <tr>
                            <td>f(x) = sin(x)</td>
                            <td>f'(x) = cos(x)</td>
                        </tr>
                        <tr>
                            <td>f(x) = cos(x)</td>
                            <td>f'(x) = -sin(x)</td>
                        </tr>
                        <tr>
                            <td>f(x) = tan(x)</td>
                            <td>f'(x) = sec¬≤(x)</td>
                        </tr>
                    </table>
                </div>

                <div class="concept-card" style="margin-top: 20px;">
                    <h3>üìã Common Integrals</h3>
                    <table class="rules-table">
                        <tr>
                            <th>Function</th>
                            <th>Integral</th>
                        </tr>
                        <tr>
                            <td>‚à´ x^n dx</td>
                            <td>x^(n+1)/(n+1) + C (n ‚â† -1)</td>
                        </tr>
                        <tr>
                            <td>‚à´ 1/x dx</td>
                            <td>ln|x| + C</td>
                        </tr>
                        <tr>
                            <td>‚à´ e^x dx</td>
                            <td>e^x + C</td>
                        </tr>
                        <tr>
                            <td>‚à´ a^x dx</td>
                            <td>a^x/ln(a) + C</td>
                        </tr>
                        <tr>
                            <td>‚à´ sin(x) dx</td>
                            <td>-cos(x) + C</td>
                        </tr>
                        <tr>
                            <td>‚à´ cos(x) dx</td>
                            <td>sin(x) + C</td>
                        </tr>
                        <tr>
                            <td>‚à´ sec¬≤(x) dx</td>
                            <td>tan(x) + C</td>
                        </tr>
                    </table>
                </div>

                <div class="concept-card" style="margin-top: 20px;">
                    <h3>üéØ Differentiation Rules Summary</h3>
                    <table class="rules-table">
                        <tr>
                            <th>Rule</th>
                            <th>Formula</th>
                        </tr>
                        <tr>
                            <td>Constant Multiple</td>
                            <td>d/dx [cf(x)] = c¬∑f'(x)</td>
                        </tr>
                        <tr>
                            <td>Sum Rule</td>
                            <td>d/dx [f(x) + g(x)] = f'(x) + g'(x)</td>
                        </tr>
                        <tr>
                            <td>Product Rule</td>
                            <td>d/dx [f(x)g(x)] = f'(x)g(x) + f(x)g'(x)</td>
                        </tr>
                        <tr>
                            <td>Quotient Rule</td>
                            <td>d/dx [f(x)/g(x)] = [f'(x)g(x) - f(x)g'(x)]/[g(x)]¬≤</td>
                        </tr>
                        <tr>
                            <td>Chain Rule</td>
                            <td>d/dx [f(g(x))] = f'(g(x)) ¬∑ g'(x)</td>
                        </tr>
                    </table>
                </div>

                <div class="concept-card" style="margin-top: 20px;">
                    <h3>üí° Study Tips</h3>
                    <div class="explanation">
                        <p style="margin: 10px 0;"><strong>1. Master the basics:</strong> Power rule, sum rule, and constant multiple rule are essential.</p>
                        <p style="margin: 10px 0;"><strong>2. Practice chain rule:</strong> Most complex derivatives use the chain rule repeatedly.</p>
                        <p style="margin: 10px 0;"><strong>3. Understand conceptually:</strong> Don't just memorize - know what derivatives and integrals mean.</p>
                        <p style="margin: 10px 0;"><strong>4. Check your work:</strong> Differentiate your integral (or integrate your derivative) to verify.</p>
                        <p style="margin: 10px 0;"><strong>5. Draw pictures:</strong> Visualize tangent lines for derivatives, area for integrals.</p>
                        <p style="margin: 10px 0;"><strong>6. Work backwards:</strong> Know that integration and differentiation are inverses.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="score-display" id="scoreDisplay" style="display: none;">
        <h3>üìä Your Progress</h3>
        <div>Correct: <strong id="correctCount">0</strong></div>
        <div>Total: <strong id="totalCount">0</strong></div>
        <div>Score: <strong id="percentage">0%</strong></div>
    </div>

    <script>
        // Global variables
        let currentQuestionIndex = 0;
        let correctAnswers = 0;
        let totalQuestions = 0;
        let derivFunction = 'polynomial';
        let integralFunction = 'parabola';

        // Practice questions
        const questions = [
            {
                question: "What is the derivative of f(x) = x¬≥?",
                options: ["3x¬≤", "x¬≤", "3x", "x¬≥/3"],
                correct: 0,
                explanation: "Using the power rule: d/dx[x¬≥] = 3x¬≤"
            },
            {
                question: "What is d/dx[sin(x)]?",
                options: ["cos(x)", "-cos(x)", "-sin(x)", "sin(x)"],
                correct: 0,
                explanation: "The derivative of sin(x) is cos(x)"
            },
            {
                question: "Using the product rule, what is d/dx[x¬∑e^x]?",
                options: ["e^x + x¬∑e^x", "e^x", "x¬∑e^x", "2x¬∑e^x"],
                correct: 0,
                explanation: "Product rule: (x)'¬∑e^x + x¬∑(e^x)' = e^x + x¬∑e^x = e^x(1 + x)"
            },
            {
                question: "What is ‚à´x¬≤ dx?",
                options: ["x¬≥/3 + C", "2x + C", "x¬≥ + C", "3x¬≤ + C"],
                correct: 0,
                explanation: "Power rule for integration: ‚à´x¬≤ dx = x¬≥/3 + C"
            },
            {
                question: "What is the chain rule formula?",
                options: ["d/dx[f(g(x))] = f'(g(x))¬∑g'(x)", "d/dx[f(g(x))] = f'(x)¬∑g'(x)", "d/dx[f(g(x))] = f(x)¬∑g'(x)", "d/dx[f(g(x))] = f'(g(x))"],
                correct: 0,
                explanation: "Chain rule: derivative of outer function (at inner function) times derivative of inner function"
            },
            {
                question: "Using the chain rule, what is d/dx[sin(x¬≤)]?",
                options: ["2x¬∑cos(x¬≤)", "cos(x¬≤)", "2x¬∑sin(x¬≤)", "x¬≤¬∑cos(x¬≤)"],
                correct: 0,
                explanation: "Chain rule: cos(x¬≤)¬∑(2x) = 2x¬∑cos(x¬≤)"
            },
            {
                question: "What is d/dx[e^x]?",
                options: ["e^x", "xe^(x-1)", "e", "1"],
                correct: 0,
                explanation: "The exponential function e^x is its own derivative!"
            },
            {
                question: "What is ‚à´cos(x) dx?",
                options: ["sin(x) + C", "-sin(x) + C", "cos(x) + C", "-cos(x) + C"],
                correct: 0,
                explanation: "The integral of cos(x) is sin(x) + C"
            },
            {
                question: "If f(x) = x¬≤ - 4x + 3, what is f'(2)?",
                options: ["0", "2", "4", "-1"],
                correct: 0,
                explanation: "f'(x) = 2x - 4, so f'(2) = 2(2) - 4 = 0"
            },
            {
                question: "What does it mean when f'(x) = 0?",
                options: ["The function has a horizontal tangent (critical point)", "The function equals zero", "The function is undefined", "The function is linear"],
                correct: 0,
                explanation: "f'(x) = 0 means the slope is zero - a horizontal tangent line, indicating a potential maximum, minimum, or inflection point"
            }
        ];

        // Tab switching
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-btn');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            buttons.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'derivatives') {
                setTimeout(() => updateDerivative(), 100);
            } else if (tabName === 'integrals') {
                setTimeout(() => updateIntegral(), 100);
            } else if (tabName === 'practice') {
                if (currentQuestionIndex === 0) {
                    loadQuestion();
                    document.getElementById('scoreDisplay').style.display = 'block';
                }
            }
        }

        // Derivative functions
        function getFunction(x, type) {
            switch(type) {
                case 'polynomial': return x*x - 2*x;
                case 'cubic': return x*x*x - 3*x;
                case 'sine': return Math.sin(x);
                case 'exp': return Math.exp(x);
                case 'rational': return 1/(x*x + 1);
                default: return x*x - 2*x;
            }
        }

        function getDerivative(x, type) {
            switch(type) {
                case 'polynomial': return 2*x - 2;
                case 'cubic': return 3*x*x - 3;
                case 'sine': return Math.cos(x);
                case 'exp': return Math.exp(x);
                case 'rational': return -2*x/Math.pow(x*x + 1, 2);
                default: return 2*x - 2;
            }
        }

        function setDerivFunction(type) {
            derivFunction = type;
            document.querySelectorAll('#derivatives .function-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateDerivative();
        }

        function updateDerivative() {
            const canvas = document.getElementById('derivCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const x = parseFloat(document.getElementById('derivXSlider').value);
            const showTangent = document.getElementById('showTangent').checked;
            const showSecant = document.getElementById('showSecant').checked;
            const h = parseFloat(document.getElementById('hSlider').value);
            
            document.getElementById('derivXSliderVal').textContent = x.toFixed(1);
            document.getElementById('hValue').textContent = h.toFixed(1);
            
            const fx = getFunction(x, derivFunction);
            const slope = getDerivative(x, derivFunction);
            
            document.getElementById('derivX').textContent = x.toFixed(2);
            document.getElementById('derivY').textContent = fx.toFixed(2);
            document.getElementById('derivX2').textContent = x.toFixed(2);
            document.getElementById('derivFval').textContent = fx.toFixed(3);
            document.getElementById('derivX3').textContent = x.toFixed(2);
            document.getElementById('derivSlope').textContent = slope.toFixed(3);
            
            const b = fx - slope * x;
            document.getElementById('tangentEq').textContent = 
                `${slope.toFixed(2)}x ${b >= 0 ? '+' : ''} ${b.toFixed(2)}`;
            
            drawDerivativeVisualization(ctx, canvas.width, canvas.height, x, showTangent, showSecant, h);
        }

        function drawDerivativeVisualization(ctx, width, height, xPos, showTangent, showSecant, h) {
            ctx.clearRect(0, 0, width, height);
            
            const scale = 60;
            const offsetX = width / 2;
            const offsetY = height / 2;
            
            // Draw axes
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(0, offsetY);
            ctx.lineTo(width, offsetY);
            ctx.moveTo(offsetX, 0);
            ctx.lineTo(offsetX, height);
            ctx.stroke();
            
            // Draw grid
            ctx.strokeStyle = '#f0f0f0';
            for (let i = -10; i <= 10; i++) {
                const screenX = offsetX + i * scale;
                const screenY = offsetY - i * scale;
                
                if (screenX >= 0 && screenX <= width) {
                    ctx.beginPath();
                    ctx.moveTo(screenX, 0);
                    ctx.lineTo(screenX, height);
                    ctx.stroke();
                }
                
                if (screenY >= 0 && screenY <= height) {
                    ctx.beginPath();
                    ctx.moveTo(0, screenY);
                    ctx.lineTo(width, screenY);
                    ctx.stroke();
                }
            }
            
            // Draw function
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            let first = true;
            for (let x = -6; x <= 6; x += 0.01) {
                const y = getFunction(x, derivFunction);
                const screenX = offsetX + x * scale;
                const screenY = offsetY - y * scale;
                
                if (screenY >= -50 && screenY <= height + 50) {
                    if (first) {
                        ctx.moveTo(screenX, screenY);
                        first = false;
                    } else {
                        ctx.lineTo(screenX, screenY);
                    }
                }
            }
            ctx.stroke();
            
            // Draw tangent line
            if (showTangent) {
                const fx = getFunction(xPos, derivFunction);
                const slope = getDerivative(xPos, derivFunction);
                
                ctx.strokeStyle = '#e74c3c';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                
                for (let x = -6; x <= 6; x += 0.1) {
                    const y = slope * (x - xPos) + fx;
                    const screenX = offsetX + x * scale;
                    const screenY = offsetY - y * scale;
                    
                    if (x === -6) {
                        ctx.moveTo(screenX, screenY);
                    } else {
                        ctx.lineTo(screenX, screenY);
                    }
                }
                ctx.stroke();
                ctx.setLineDash([]);
            }
            
            // Draw secant line
            if (showSecant) {
                const fx1 = getFunction(xPos, derivFunction);
                const fx2 = getFunction(xPos + h, derivFunction);
                const secantSlope = (fx2 - fx1) / h;
                
                ctx.strokeStyle = '#2ecc71';
                ctx.lineWidth = 2;
                ctx.setLineDash([10, 5]);
                ctx.beginPath();
                
                for (let x = -6; x <= 6; x += 0.1) {
                    const y = secantSlope * (x - xPos) + fx1;
                    const screenX = offsetX + x * scale;
                    const screenY = offsetY - y * scale;
                    
                    if (x === -6) {
                        ctx.moveTo(screenX, screenY);
                    } else {
                        ctx.lineTo(screenX, screenY);
                    }
                }
                ctx.stroke();
                ctx.setLineDash([]);
                
                // Draw second point for secant
                const screenX2 = offsetX + (xPos + h) * scale;
                const screenY2 = offsetY - fx2 * scale;
                ctx.fillStyle = '#2ecc71';
                ctx.beginPath();
                ctx.arc(screenX2, screenY2, 6, 0, 2 * Math.PI);
                ctx.fill();
            }
            
            // Draw point
            const fx = getFunction(xPos, derivFunction);
            const screenX = offsetX + xPos * scale;
            const screenY = offsetY - fx * scale;
            
            ctx.fillStyle = '#e74c3c';
            ctx.beginPath();
            ctx.arc(screenX, screenY, 8, 0, 2 * Math.PI);
            ctx.fill();
            
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        // Integral functions
        function getIntegralFunction(x, type) {
            switch(type) {
                case 'parabola': return x*x;
                case 'sine': return Math.sin(x);
                case 'exp': return Math.exp(x);
                case 'sqrt': return Math.sqrt(Math.abs(x));
                default: return x*x;
            }
        }

        function getExactIntegral(a, b, type) {
            switch(type) {
                case 'parabola': return (b*b*b - a*a*a) / 3;
                case 'sine': return -Math.cos(b) + Math.cos(a);
                case 'exp': return Math.exp(b) - Math.exp(a);
                case 'sqrt': 
                    const antiderivB = (2/3) * Math.pow(Math.abs(b), 1.5);
                    const antiderivA = (2/3) * Math.pow(Math.abs(a), 1.5);
                    return antiderivB - antiderivA;
                default: return (b*b*b - a*a*a) / 3;
            }
        }

        function setIntegralFunction(type) {
            integralFunction = type;
            document.querySelectorAll('#integrals .function-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateIntegral();
        }

        function updateIntegral() {
            const canvas = document.getElementById('integralCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const n = parseInt(document.getElementById('nRectSlider').value);
            const a = parseFloat(document.getElementById('intASlider').value);
            const b = parseFloat(document.getElementById('intBSlider').value);
            const method = document.getElementById('riemannMethod').value;
            
            document.getElementById('nRectDisplay').textContent = n;
            document.getElementById('intADisplay').textContent = a.toFixed(1);
            document.getElementById('intBDisplay').textContent = b.toFixed(1);
            
            if (b <= a) {
                document.getElementById('intBSlider').value = a + 0.5;
                return;
            }
            
            const dx = (b - a) / n;
            let sum = 0;
            
            for (let i = 0; i < n; i++) {
                let xi;
                if (method === 'left') {
                    xi = a + i * dx;
                } else if (method === 'right') {
                    xi = a + (i + 1) * dx;
                } else if (method === 'midpoint') {
                    xi = a + (i + 0.5) * dx;
                } else { // trapezoidal
                    const left = getIntegralFunction(a + i * dx, integralFunction);
                    const right = getIntegralFunction(a + (i + 1) * dx, integralFunction);
                    sum += (left + right) / 2 * dx;
                    continue;
                }
                sum += getIntegralFunction(xi, integralFunction) * dx;
            }
            
            const exact = getExactIntegral(a, b, integralFunction);
            const error = Math.abs(sum - exact);
            
            document.getElementById('intA').textContent = a.toFixed(2);
            document.getElementById('intB').textContent = b.toFixed(2);
            document.getElementById('numRect').textContent = n;
            document.getElementById('deltaX').textContent = dx.toFixed(4);
            document.getElementById('approxArea').textContent = sum.toFixed(4);
            document.getElementById('exactInt').textContent = exact.toFixed(4);
            document.getElementById('intError').textContent = error.toFixed(4);
            
            drawIntegralVisualization(ctx, canvas.width, canvas.height, a, b, n, method);
        }

        function drawIntegralVisualization(ctx, width, height, a, b, n, method) {
            ctx.clearRect(0, 0, width, height);
            
            const scale = 60;
            const offsetX = width / 2;
            const offsetY = height - 50;
            
            // Draw axes
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(0, offsetY);
            ctx.lineTo(width, offsetY);
            ctx.moveTo(offsetX, 0);
            ctx.lineTo(offsetX, height);
            ctx.stroke();
            
            // Draw rectangles
            const dx = (b - a) / n;
            ctx.fillStyle = 'rgba(102, 126, 234, 0.3)';
            ctx.strokeStyle = 'rgba(102, 126, 234, 0.8)';
            ctx.lineWidth = 1;
            
            for (let i = 0; i < n; i++) {
                let xi, yi;
                const xLeft = a + i * dx;
                const xRight = a + (i + 1) * dx;
                
                if (method === 'left') {
                    xi = xLeft;
                    yi = getIntegralFunction(xi, integralFunction);
                } else if (method === 'right') {
                    xi = xRight;
                    yi = getIntegralFunction(xi, integralFunction);
                } else if (method === 'midpoint') {
                    xi = (xLeft + xRight) / 2;
                    yi = getIntegralFunction(xi, integralFunction);
                } else { // trapezoidal
                    const yLeft = getIntegralFunction(xLeft, integralFunction);
                    const yRight = getIntegralFunction(xRight, integralFunction);
                    
                    const screenXLeft = offsetX + xLeft * scale;
                    const screenXRight = offsetX + xRight * scale;
                    const screenYLeft = offsetY - yLeft * scale;
                    const screenYRight = offsetY - yRight * scale;
                    
                    ctx.beginPath();
                    ctx.moveTo(screenXLeft, offsetY);
                    ctx.lineTo(screenXLeft, screenYLeft);
                    ctx.lineTo(screenXRight, screenYRight);
                    ctx.lineTo(screenXRight, offsetY);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                    continue;
                }
                
                const screenX = offsetX + xLeft * scale;
                const screenY = offsetY - yi * scale;
                const rectWidth = dx * scale;
                const rectHeight = yi * scale;
                
                ctx.fillRect(screenX, screenY, rectWidth, rectHeight);
                ctx.strokeRect(screenX, screenY, rectWidth, rectHeight);
            }
            
            // Draw function
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            let first = true;
            for (let x = -6; x <= 6; x += 0.01) {
                const y = getIntegralFunction(x, integralFunction);
                const screenX = offsetX + x * scale;
                const screenY = offsetY - y * scale;
                
                if (y >= 0 && screenY >= 0 && screenY <= height) {
                    if (first) {
                        ctx.moveTo(screenX, screenY);
                        first = false;
                    } else {
                        ctx.lineTo(screenX, screenY);
                    }
                }
            }
            ctx.stroke();
            
            // Draw interval markers
            const screenA = offsetX + a * scale;
            const screenB = offsetX + b * scale;
            
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(screenA, offsetY - 10);
            ctx.lineTo(screenA, offsetY + 10);
            ctx.moveTo(screenB, offsetY - 10);
            ctx.lineTo(screenB, offsetY + 10);
            ctx.stroke();
            
            ctx.fillStyle = '#333';
            ctx.font = 'bold 14px Arial';
            ctx.fillText('a', screenA - 5, offsetY + 25);
            ctx.fillText('b', screenB - 5, offsetY + 25);
        }

        // Practice questions
        function loadQuestion() {
            const q = questions[currentQuestionIndex];
            const questionHTML = `
                <h4>Question ${currentQuestionIndex + 1} of ${questions.length}</h4>
                <p style="font-size: 1.2em; margin: 20px 0;">${q.question}</p>
                <div class="options">
                    ${q.options.map((opt, i) => `
                        <button class="option-btn" onclick="checkAnswer(${i})">${opt}</button>
                    `).join('')}
                </div>
                <div id="feedback"></div>
            `;
            
            document.getElementById('currentQuestion').innerHTML = questionHTML;
        }

        function checkAnswer(selected) {
            const q = questions[currentQuestionIndex];
            const options = document.querySelectorAll('.option-btn');
            const feedback = document.getElementById('feedback');
            
            totalQuestions++;
            
            options.forEach((btn, i) => {
                btn.disabled = true;
                if (i === q.correct) {
                    btn.classList.add('correct');
                } else if (i === selected) {
                    btn.classList.add('incorrect');
                }
            });
            
            if (selected === q.correct) {
                correctAnswers++;
                feedback.innerHTML = `
                    <div class="feedback correct">
                        ‚úÖ Correct! ${q.explanation}
                    </div>
                    <button class="btn btn-primary" onclick="nextQuestion()">Next Question ‚Üí</button>
                `;
            } else {
                feedback.innerHTML = `
                    <div class="feedback incorrect">
                        ‚ùå Not quite. ${q.explanation}
                    </div>
                    <button class="btn btn-primary" onclick="nextQuestion()">Next Question ‚Üí</button>
                `;
            }
            
            updateScore();
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex >= questions.length) {
                const percentage = totalQuestions > 0 ? Math.round((correctAnswers / totalQuestions) * 100) : 0;
                document.getElementById('currentQuestion').innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <h3 style="color: #667eea; font-size: 2em; margin-bottom: 20px;">üéâ Practice Complete!</h3>
                        <p style="font-size: 1.3em; margin: 20px 0;">You've completed all practice questions!</p>
                        <div class="info-display" style="max-width: 400px; margin: 30px auto;">
                            <div style="font-size: 1.5em; margin: 10px 0;">Your Score: <strong>${percentage}%</strong></div>
                            <div style="font-size: 1.2em; margin: 10px 0;">Correct: ${correctAnswers} / ${totalQuestions}</div>
                        </div>
                        <button class="btn btn-primary" onclick="resetPractice()" style="font-size: 1.3em; padding: 20px 50px; margin-top: 20px;">
                            üîÑ Start Over
                        </button>
                    </div>
                `;
            } else {
                loadQuestion();
            }
        }

        function resetPractice() {
            currentQuestionIndex = 0;
            correctAnswers = 0;
            totalQuestions = 0;
            updateScore();
            loadQuestion();
        }

        function updateScore() {
            document.getElementById('correctCount').textContent = correctAnswers;
            document.getElementById('totalCount').textContent = totalQuestions;
            const percentage = totalQuestions > 0 ? Math.round((correctAnswers / totalQuestions) * 100) : 0;
            document.getElementById('percentage').textContent = percentage + '%';
        }

        // Initialize on load
        window.onload = function() {
            updateDerivative();
            updateIntegral();
        };
    </script>
</body>
</html>