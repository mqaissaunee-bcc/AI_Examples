<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PythonQuest: Interactive Learning Adventure</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeInDown 1s ease-out;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .game-board {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            margin-bottom: 20px;
        }

        .main-panel {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .side-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .challenge-area {
            padding: 30px;
            min-height: 500px;
        }

        .challenge-title {
            font-size: 1.8em;
            color: #4a5568;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .level-badge {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
        }

        .challenge-description {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #4299e1;
        }

        .code-editor {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            min-height: 200px;
            border: none;
            resize: vertical;
            width: 100%;
            outline: none;
        }

        .code-editor:focus {
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.5);
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #4299e1, #3182ce);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(66, 153, 225, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(72, 187, 120, 0.4);
        }

        .btn-hint {
            background: linear-gradient(45deg, #ed8936, #dd6b20);
            color: white;
        }

        .btn-hint:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(237, 137, 54, 0.4);
        }

        .stats-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .stats-title {
            font-size: 1.3em;
            color: #4a5568;
            margin-bottom: 20px;
            text-align: center;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: #f7fafc;
            border-radius: 8px;
        }

        .stat-value {
            font-weight: bold;
            color: #4299e1;
            font-size: 1.1em;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4299e1, #3182ce);
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .leaderboard {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .output-area {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            min-height: 100px;
            white-space: pre-wrap;
            border: 2px solid #2d3748;
        }

        .output-success {
            border-color: #48bb78;
            background: linear-gradient(135deg, #1a202c, #22543d);
        }

        .output-error {
            border-color: #f56565;
            background: linear-gradient(135deg, #1a202c, #742a2a);
        }

        .hint-box {
            background: linear-gradient(135deg, #fef5e7, #fed7aa);
            border: 1px solid #f6ad55;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            display: none;
        }

        .hint-box.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        .achievement-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transform: translateX(400px);
            transition: transform 0.5s ease;
            z-index: 1000;
        }

        .achievement-popup.show {
            transform: translateX(0);
        }

        .topic-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .topic-btn {
            padding: 8px 16px;
            border: 2px solid #4299e1;
            background: white;
            color: #4299e1;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .topic-btn.active {
            background: #4299e1;
            color: white;
        }

        .topic-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(66, 153, 225, 0.3);
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @media (max-width: 768px) {
            .game-board {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .challenge-area {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>üêç PythonQuest</h1>
            <p>Master Python through Interactive Adventures</p>
        </div>

        <div class="game-board">
            <div class="main-panel">
                <div class="challenge-area">
                    <div class="topic-selector">
                        <button class="topic-btn active" onclick="selectTopic('basics')">Basics</button>
                        <button class="topic-btn" onclick="selectTopic('variables')">Variables</button>
                        <button class="topic-btn" onclick="selectTopic('loops')">Loops</button>
                        <button class="topic-btn" onclick="selectTopic('functions')">Functions</button>
                        <button class="topic-btn" onclick="selectTopic('lists')">Lists</button>
                    </div>

                    <div class="challenge-title">
                        <span id="challenge-icon">üéØ</span>
                        <span id="challenge-name">Welcome to Python!</span>
                        <span class="level-badge" id="level-badge">Level 1</span>
                    </div>

                    <div class="challenge-description" id="challenge-description">
                        <strong>Your Mission:</strong> Write a Python program that prints "Hello, World!" to the console. This is the traditional first program that every programmer writes!
                        <br><br>
                        <strong>Concept:</strong> The <code>print()</code> function displays text on the screen. Text strings must be enclosed in quotes.
                    </div>

                    <textarea class="code-editor" id="code-editor" placeholder="# Write your Python code here...
print('Hello, World!')"></textarea>

                    <div class="button-group">
                        <button class="btn btn-primary" onclick="runCode()">üöÄ Run Code</button>
                        <button class="btn btn-secondary" onclick="checkSolution()">‚úÖ Check Solution</button>
                        <button class="btn btn-hint" onclick="showHint()">üí° Get Hint</button>
                    </div>

                    <div class="hint-box" id="hint-box">
                        <strong>üí° Hint:</strong> <span id="hint-text">Use the print() function with your text in quotes. Remember to include both opening and closing quotes!</span>
                    </div>

                    <div class="output-area" id="output-area">Ready to code! Write your solution above and click "Run Code" to see the output.</div>
                </div>
            </div>

            <div class="side-panel">
                <div class="stats-panel">
                    <div class="stats-title">üèÜ Your Progress</div>
                    <div class="stat-item">
                        <span>Level</span>
                        <span class="stat-value" id="player-level">1</span>
                    </div>
                    <div class="stat-item">
                        <span>XP Points</span>
                        <span class="stat-value" id="player-xp">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Challenges Solved</span>
                        <span class="stat-value" id="challenges-solved">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Streak</span>
                        <span class="stat-value" id="streak">0</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="xp-progress" style="width: 0%"></div>
                    </div>
                    <small style="text-align: center; display: block; margin-top: 10px; color: #666;">
                        Next level: <span id="xp-needed">100</span> XP
                    </small>
                </div>

                <div class="leaderboard">
                    <div class="stats-title">üéñÔ∏è Achievements</div>
                    <div id="achievements-list">
                        <div style="text-align: center; color: #666; font-style: italic;">
                            Complete challenges to unlock achievements!
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="achievement-popup" id="achievement-popup">
        <div style="font-size: 1.2em; font-weight: bold; margin-bottom: 5px;">üéâ Achievement Unlocked!</div>
        <div id="achievement-text">First Steps Complete!</div>
    </div>

    <script>
        // Game state management
        let gameState = {
            currentTopic: 'basics',
            currentChallenge: 0,
            playerLevel: 1,
            playerXP: 0,
            challengesSolved: 0,
            streak: 0,
            achievements: [],
            solvedChallenges: new Set()
        };

        // Challenge database with educational content
        const challenges = {
            basics: [
                {
                    name: "Welcome to Python!",
                    icon: "üéØ",
                    description: `<strong>Your Mission:</strong> Write a Python program that prints "Hello, World!" to the console. This is the traditional first program that every programmer writes!
                    <br><br>
                    <strong>Concept:</strong> The <code>print()</code> function displays text on the screen. Text strings must be enclosed in quotes.`,
                    hint: "Use the print() function with your text in quotes. Remember to include both opening and closing quotes!",
                    solution: `print('Hello, World!')`,
                    expectedOutput: "Hello, World!",
                    xpReward: 50
                },
                {
                    name: "Python Calculator",
                    icon: "üßÆ",
                    description: `<strong>Your Mission:</strong> Create a simple calculator that adds two numbers: 15 and 27.
                    <br><br>
                    <strong>Concept:</strong> Python can perform mathematical operations like addition (+), subtraction (-), multiplication (*), and division (/).`,
                    hint: "Use the + operator to add numbers. You can print the result directly: print(15 + 27)",
                    solution: `print(15 + 27)`,
                    expectedOutput: "42",
                    xpReward: 75
                },
                {
                    name: "String Magic",
                    icon: "‚ú®",
                    description: `<strong>Your Mission:</strong> Print your name followed by the text " is learning Python!"
                    <br><br>
                    <strong>Concept:</strong> Strings can be combined (concatenated) using the + operator.`,
                    hint: "Combine strings with +. For example: print('Alice' + ' is learning Python!')",
                    solution: `print('Student is learning Python!')`,
                    expectedOutput: "Student is learning Python!",
                    xpReward: 75,
                    flexible: true
                }
            ],
            variables: [
                {
                    name: "Variable Basics",
                    icon: "üì¶",
                    description: `<strong>Your Mission:</strong> Create a variable called 'name' with your name, then print it.
                    <br><br>
                    <strong>Concept:</strong> Variables store data that can be used later. Use the = operator to assign values.`,
                    hint: "Create a variable: name = 'YourName', then print it with: print(name)",
                    solution: `name = 'Student'\nprint(name)`,
                    expectedOutput: "Student",
                    xpReward: 100,
                    flexible: true
                },
                {
                    name: "Age Calculator",
                    icon: "üéÇ",
                    description: `<strong>Your Mission:</strong> Create variables for birth_year (2005) and current_year (2024), then calculate and print the age.
                    <br><br>
                    <strong>Concept:</strong> Variables can store numbers and be used in calculations.`,
                    hint: "Create two variables, then subtract: age = current_year - birth_year",
                    solution: `birth_year = 2005\ncurrent_year = 2024\nage = current_year - birth_year\nprint(age)`,
                    expectedOutput: "19",
                    xpReward: 125
                },
                {
                    name: "Temperature Converter",
                    icon: "üå°Ô∏è",
                    description: `<strong>Your Mission:</strong> Convert 32 degrees Fahrenheit to Celsius using the formula: C = (F - 32) * 5/9
                    <br><br>
                    <strong>Concept:</strong> Variables make complex calculations easier to read and modify.`,
                    hint: "fahrenheit = 32, then celsius = (fahrenheit - 32) * 5/9",
                    solution: `fahrenheit = 32\ncelsius = (fahrenheit - 32) * 5/9\nprint(celsius)`,
                    expectedOutput: "0.0",
                    xpReward: 150
                }
            ],
            loops: [
                {
                    name: "Count to Five",
                    icon: "üî¢",
                    description: `<strong>Your Mission:</strong> Use a for loop to print numbers from 1 to 5.
                    <br><br>
                    <strong>Concept:</strong> For loops repeat code a specific number of times. Use range() to generate numbers.`,
                    hint: "Use: for i in range(1, 6): print(i)",
                    solution: `for i in range(1, 6):\n    print(i)`,
                    expectedOutput: "1\n2\n3\n4\n5",
                    xpReward: 150
                },
                {
                    name: "Multiplication Table",
                    icon: "‚úñÔ∏è",
                    description: `<strong>Your Mission:</strong> Create a multiplication table for 3 (3x1, 3x2, 3x3, 3x4, 3x5).
                    <br><br>
                    <strong>Concept:</strong> Loops can perform calculations repeatedly with different values.`,
                    hint: "Use a for loop: for i in range(1, 6): print(3 * i)",
                    solution: `for i in range(1, 6):\n    print(3 * i)`,
                    expectedOutput: "3\n6\n9\n12\n15",
                    xpReward: 175
                },
                {
                    name: "Pattern Maker",
                    icon: "üî∑",
                    description: `<strong>Your Mission:</strong> Create a pattern by printing stars. Print 1 star, then 2 stars, then 3 stars.
                    <br><br>
                    <strong>Concept:</strong> String multiplication (*) can repeat characters, and loops can create patterns.`,
                    hint: "Use: for i in range(1, 4): print('*' * i)",
                    solution: `for i in range(1, 4):\n    print('*' * i)`,
                    expectedOutput: "*\n**\n***",
                    xpReward: 200
                }
            ],
            functions: [
                {
                    name: "My First Function",
                    icon: "‚öôÔ∏è",
                    description: `<strong>Your Mission:</strong> Create a function called 'greet' that prints "Hello from my function!" and then call it.
                    <br><br>
                    <strong>Concept:</strong> Functions are reusable blocks of code. Use 'def' to define them.`,
                    hint: "def greet():\n    print('Hello from my function!')\ngreet()",
                    solution: `def greet():\n    print('Hello from my function!')\ngreet()`,
                    expectedOutput: "Hello from my function!",
                    xpReward: 200
                },
                {
                    name: "Function with Parameters",
                    icon: "üìù",
                    description: `<strong>Your Mission:</strong> Create a function called 'say_hello' that takes a name parameter and prints "Hello, [name]!". Call it with "Python".
                    <br><br>
                    <strong>Concept:</strong> Functions can accept inputs (parameters) to work with different data.`,
                    hint: "def say_hello(name):\n    print('Hello, ' + name + '!')\nsay_hello('Python')",
                    solution: `def say_hello(name):\n    print('Hello, ' + name + '!')\nsay_hello('Python')`,
                    expectedOutput: "Hello, Python!",
                    xpReward: 225
                },
                {
                    name: "Return Values",
                    icon: "‚Ü©Ô∏è",
                    description: `<strong>Your Mission:</strong> Create a function called 'add_numbers' that takes two numbers, adds them, and returns the result. Call it with 8 and 12, then print the result.
                    <br><br>
                    <strong>Concept:</strong> Functions can return values using the 'return' keyword.`,
                    hint: "def add_numbers(a, b):\n    return a + b\nresult = add_numbers(8, 12)\nprint(result)",
                    solution: `def add_numbers(a, b):\n    return a + b\nresult = add_numbers(8, 12)\nprint(result)`,
                    expectedOutput: "20",
                    xpReward: 250
                }
            ],
            lists: [
                {
                    name: "My First List",
                    icon: "üìã",
                    description: `<strong>Your Mission:</strong> Create a list of three fruits: 'apple', 'banana', 'orange', then print the list.
                    <br><br>
                    <strong>Concept:</strong> Lists store multiple items in a single variable using square brackets [].`,
                    hint: "fruits = ['apple', 'banana', 'orange']\nprint(fruits)",
                    solution: `fruits = ['apple', 'banana', 'orange']\nprint(fruits)`,
                    expectedOutput: "['apple', 'banana', 'orange']",
                    xpReward: 175
                },
                {
                    name: "List Indexing",
                    icon: "üîç",
                    description: `<strong>Your Mission:</strong> Create a list with numbers [10, 20, 30, 40] and print the first and last items.
                    <br><br>
                    <strong>Concept:</strong> List items can be accessed by their index. First item is index 0, last item is index -1.`,
                    hint: "numbers = [10, 20, 30, 40]\nprint(numbers[0])\nprint(numbers[-1])",
                    solution: `numbers = [10, 20, 30, 40]\nprint(numbers[0])\nprint(numbers[-1])`,
                    expectedOutput: "10\n40",
                    xpReward: 200
                },
                {
                    name: "List Methods",
                    icon: "üõ†Ô∏è",
                    description: `<strong>Your Mission:</strong> Create a list [1, 2, 3], add the number 4 to it using append(), then print the list.
                    <br><br>
                    <strong>Concept:</strong> Lists have built-in methods like append() to add items, remove() to remove items, etc.`,
                    hint: "numbers = [1, 2, 3]\nnumbers.append(4)\nprint(numbers)",
                    solution: `numbers = [1, 2, 3]\nnumbers.append(4)\nprint(numbers)`,
                    expectedOutput: "[1, 2, 3, 4]",
                    xpReward: 225
                }
            ]
        };

        // Achievement definitions
        const achievements = [
            { id: 'first_program', name: 'First Steps', description: 'Completed your first program!', icon: 'üéâ' },
            { id: 'calculator', name: 'Math Wizard', description: 'Mastered basic calculations!', icon: 'üßÆ' },
            { id: 'variables_master', name: 'Variable Master', description: 'Learned to use variables!', icon: 'üì¶' },
            { id: 'loop_master', name: 'Loop Legend', description: 'Mastered loops and repetition!', icon: 'üîÑ' },
            { id: 'function_master', name: 'Function Expert', description: 'Created your first functions!', icon: '‚öôÔ∏è' },
            { id: 'list_master', name: 'List Learner', description: 'Learned to work with lists!', icon: 'üìã' },
            { id: 'streak_5', name: 'On Fire!', description: 'Solved 5 challenges in a row!', icon: 'üî•' },
            { id: 'level_up', name: 'Level Up!', description: 'Reached a new level!', icon: '‚≠ê' }
        ];

        // Initialize game
        function initGame() {
            loadCurrentChallenge();
            updateUI();
        }

        // Topic selection
        function selectTopic(topic) {
            gameState.currentTopic = topic;
            gameState.currentChallenge = 0;
            
            // Update topic buttons
            document.querySelectorAll('.topic-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            loadCurrentChallenge();
        }

        // Load current challenge
        function loadCurrentChallenge() {
            const challenge = getCurrentChallenge();
            if (!challenge) return;

            document.getElementById('challenge-icon').textContent = challenge.icon;
            document.getElementById('challenge-name').textContent = challenge.name;
            document.getElementById('level-badge').textContent = `Level ${gameState.currentChallenge + 1}`;
            document.getElementById('challenge-description').innerHTML = challenge.description;
            document.getElementById('hint-text').textContent = challenge.hint;
            document.getElementById('code-editor').value = '';
            document.getElementById('output-area').textContent = 'Ready to code! Write your solution above and click "Run Code" to see the output.';
            document.getElementById('output-area').className = 'output-area';
            document.getElementById('hint-box').classList.remove('show');
        }

        // Get current challenge
        function getCurrentChallenge() {
            const topicChallenges = challenges[gameState.currentTopic];
            return topicChallenges && topicChallenges[gameState.currentChallenge] ? topicChallenges[gameState.currentChallenge] : null;
        }

        // Run code (simulation)
        function runCode() {
            const code = document.getElementById('code-editor').value.trim();
            const outputArea = document.getElementById('output-area');
            
            if (!code) {
                outputArea.textContent = 'Please write some code first!';
                outputArea.className = 'output-area output-error';
                return;
            }

            // Simple Python code simulation
            try {
                const output = simulatePythonCode(code);
                outputArea.textContent = output;
                outputArea.className = 'output-area';
            } catch (error) {
                outputArea.textContent = `Error: ${error.message}`;
                outputArea.className = 'output-area output-error';
            }
        }

        // Simulate Python code execution
        function simulatePythonCode(code) {
            const lines = code.split('\n').map(line => line.trim()).filter(line => line && !line.startsWith('#'));
            let output = [];
            let variables = {};

            for (let line of lines) {
                if (line.startsWith('print(')) {
                    const match = line.match(/print\((.+)\)/);
                    if (match) {
                        let content = match[1];
                        
                        // Handle variables
                        for (let [varName, varValue] of Object.entries(variables)) {
                            content = content.replace(new RegExp(`\\b${varName}\\b`, 'g'), 
                                typeof varValue === 'string' ? `'${varValue}'` : varValue);
                        }
                        
                        // Evaluate simple expressions
                        try {
                            // Handle string concatenation and basic math
                            content = content.replace(/'/g, '"');
                            if (content.includes('"')) {
                                // String handling
                                const result = eval(content);
                                output.push(String(result));
                            } else {
                                // Numeric calculation
                                const result = eval(content);
                                output.push(String(result));
                            }
                        } catch (e) {
                            output.push(content.replace(/"/g, ''));
                        }
                    }
                } else if (line.includes('=') && !line.includes('==')) {
                    // Variable assignment
                    const [varName, varValue] = line.split('=').map(s => s.trim());
                    if (varValue.startsWith("'") && varValue.endsWith("'")) {
                        variables[varName] = varValue.slice(1, -1);
                    } else if (varValue.startsWith('"') && varValue.endsWith('"')) {
                        variables[varName] = varValue.slice(1, -1);
                    } else {
                        try {
                            // Handle mathematical expressions
                            let evalValue = varValue;
                            for (let [vName, vValue] of Object.entries(variables)) {
                                evalValue = evalValue.replace(new RegExp(`\\b${vName}\\b`, 'g'), vValue);
                            }
                            variables[varName] = eval(evalValue);
                        } catch (e) {
                            variables[varName] = varValue;
                        }
                    }
                } else if (line.startsWith('for ')) {
                    // Simple for loop handling
                    const match = line.match(/for\s+(\w+)\s+in\s+range\((.+)\):/);
                    if (match) {
                        const [, loopVar, rangeExpr] = match;
                        const rangeMatch = rangeExpr.match(/(\d+),?\s*(\d+)?/);
                        if (rangeMatch) {
                            const start = rangeMatch[2] ? parseInt(rangeMatch[1]) : 1;
                            const end = rangeMatch[2] ? parseInt(rangeMatch[2]) : parseInt(rangeMatch[1]) + 1;
                            
                            // Find the next indented line(s)
                            const codeLines = code.split('\n');
                            const currentLineIndex = codeLines.findIndex(l => l.includes(line));
                            
                            for (let i = start; i < end; i++) {
                                variables[loopVar] = i;
                                // Execute loop body (simplified)
                                for (let j = currentLineIndex + 1; j < codeLines.length; j++) {
                                    const loopLine = codeLines[j].trim();
                                    if (!loopLine.startsWith(' ') && !loopLine.startsWith('\t') && loopLine) break;
                                    
                                    if (loopLine.includes('print(')) {
                                        const printMatch = loopLine.match(/print\((.+)\)/);
                                        if (printMatch) {
                                            let printContent = printMatch[1];
                                            for (let [vName, vValue] of Object.entries(variables)) {
                                                printContent = printContent.replace(new RegExp(`\\b${vName}\\b`, 'g'), vValue);
                                            }
                                            try {
                                                const result = eval(printContent.replace(/'/g, '"'));
                                                output.push(String(result));
                                            } catch (e) {
                                                output.push(printContent.replace(/['"]/g, ''));
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                } else if (line.startsWith('def ')) {
                    // Function definition (simplified)
                    const match = line.match(/def\s+(\w+)\(([^)]*)\):/);
                    if (match) {
                        const [, funcName, params] = match;
                        variables[funcName] = { type: 'function', params: params.split(',').map(p => p.trim()).filter(p => p) };
                    }
                } else if (line.includes('(') && line.includes(')') && variables[line.split('(')[0]]) {
                    // Function call (simplified)
                    const funcName = line.split('(')[0];
                    if (variables[funcName] && variables[funcName].type === 'function') {
                        // Simple function simulation
                        if (funcName === 'greet') {
                            output.push('Hello from my function!');
                        } else if (funcName === 'say_hello') {
                            const args = line.match(/\((.+)\)/)[1].replace(/['"]/g, '');
                            output.push(`Hello, ${args}!`);
                        } else if (funcName === 'add_numbers') {
                            const args = line.match(/\((.+)\)/)[1].split(',').map(a => parseInt(a.trim()));
                            const result = args[0] + args[1];
                            if (line.includes('=')) {
                                const varName = line.split('=')[0].trim();
                                variables[varName] = result;
                            } else {
                                output.push(String(result));
                            }
                        }
                    }
                }
            }

            return output.length > 0 ? output.join('\n') : 'Code executed successfully (no output)';
        }

        // Check solution
        function checkSolution() {
            const challenge = getCurrentChallenge();
            if (!challenge) return;

            const code = document.getElementById('code-editor').value.trim();
            const outputArea = document.getElementById('output-area');

            if (!code) {
                outputArea.textContent = 'Please write some code first!';
                outputArea.className = 'output-area output-error';
                return;
            }

            try {
                const output = simulatePythonCode(code);
                const isCorrect = challenge.flexible ? 
                    output.toLowerCase().includes(challenge.expectedOutput.toLowerCase()) || 
                    (challenge.expectedOutput === "Student is learning Python!" && output.includes("is learning Python!")) :
                    output === challenge.expectedOutput;

                if (isCorrect) {
                    outputArea.textContent = `‚úÖ Correct! Output: ${output}`;
                    outputArea.className = 'output-area output-success';
                    
                    // Award XP and update progress
                    const challengeKey = `${gameState.currentTopic}_${gameState.currentChallenge}`;
                    if (!gameState.solvedChallenges.has(challengeKey)) {
                        gameState.playerXP += challenge.xpReward;
                        gameState.challengesSolved++;
                        gameState.streak++;
                        gameState.solvedChallenges.add(challengeKey);
                        
                        // Check for level up
                        const newLevel = Math.floor(gameState.playerXP / 500) + 1;
                        if (newLevel > gameState.playerLevel) {
                            gameState.playerLevel = newLevel;
                            showAchievement('Level Up!', `Welcome to Level ${newLevel}!`);
                        }
                        
                        // Check for achievements
                        checkAchievements();
                        updateUI();

                        const topicChallenges = challenges[gameState.currentTopic];
                        if (gameState.currentChallenge < topicChallenges.length - 1) {
                            setTimeout(() => {
                                nextChallenge();
                            }, 2000);
                        } else {
                            // At the end of topic, show Next Topic button
                            const buttonGroup = document.querySelector('.button-group');
                            if (!document.getElementById('next-topic-btn')) {
                                const nextTopicBtn = document.createElement('button');
                                nextTopicBtn.className = 'btn btn-primary';
                                nextTopicBtn.id = 'next-topic-btn';
                                nextTopicBtn.innerHTML = 'üìò Next Topic';
                                nextTopicBtn.onclick = () => {
                                    document.querySelector('.topic-btn.active')?.nextElementSibling?.click();
                                    nextTopicBtn.remove();
                                };
                                buttonGroup.appendChild(nextTopicBtn);
                            }
                            showAchievement('Topic Complete!', `You mastered ${gameState.currentTopic}!`);
                        }
                    }
                } else {
                    outputArea.textContent = `‚ùå Not quite right. Expected: "${challenge.expectedOutput}", Got: "${output}". Try again!`;
                    outputArea.className = 'output-area output-error';
                    gameState.streak = 0;
                }
            } catch (error) {
                outputArea.textContent = `Error in your code: ${error.message}`;
                outputArea.className = 'output-area output-error';
                gameState.streak = 0;
            }
        }

        // Show hint
        function showHint() {
            const hintBox = document.getElementById('hint-box');
            hintBox.classList.toggle('show');
        }

        // Next challenge
        function nextChallenge() {
            const topicChallenges = challenges[gameState.currentTopic];
            if (gameState.currentChallenge < topicChallenges.length - 1) {
                gameState.currentChallenge++;
                loadCurrentChallenge();
            } else {
                // Topic completed
                showAchievement('Topic Complete!', `You mastered ${gameState.currentTopic}!`);
            }
        }

        // Check achievements
        function checkAchievements() {
            const newAchievements = [];
            
            if (gameState.challengesSolved >= 1 && !gameState.achievements.includes('first_program')) {
                newAchievements.push('first_program');
            }
            
            if (gameState.currentTopic === 'basics' && gameState.currentChallenge >= 1 && !gameState.achievements.includes('calculator')) {
                newAchievements.push('calculator');
            }
            
            if (gameState.currentTopic === 'variables' && gameState.challengesSolved >= 3 && !gameState.achievements.includes('variables_master')) {
                newAchievements.push('variables_master');
            }
            
            if (gameState.currentTopic === 'loops' && gameState.challengesSolved >= 6 && !gameState.achievements.includes('loop_master')) {
                newAchievements.push('loop_master');
            }
            
            if (gameState.currentTopic === 'functions' && gameState.challengesSolved >= 9 && !gameState.achievements.includes('function_master')) {
                newAchievements.push('function_master');
            }
            
            if (gameState.currentTopic === 'lists' && gameState.challengesSolved >= 12 && !gameState.achievements.includes('list_master')) {
                newAchievements.push('list_master');
            }
            
            if (gameState.streak >= 5 && !gameState.achievements.includes('streak_5')) {
                newAchievements.push('streak_5');
            }

            // Show new achievements
            newAchievements.forEach(achId => {
                gameState.achievements.push(achId);
                const achievement = achievements.find(a => a.id === achId);
                if (achievement) {
                    showAchievement(achievement.name, achievement.description);
                }
            });
        }

        // Show achievement popup
        function showAchievement(title, description) {
            const popup = document.getElementById('achievement-popup');
            document.getElementById('achievement-text').innerHTML = `<strong>${title}</strong><br>${description}`;
            popup.classList.add('show');
            
            setTimeout(() => {
                popup.classList.remove('show');
            }, 3000);
        }

        // Update UI
        function updateUI() {
            document.getElementById('player-level').textContent = gameState.playerLevel;
            document.getElementById('player-xp').textContent = gameState.playerXP;
            document.getElementById('challenges-solved').textContent = gameState.challengesSolved;
            document.getElementById('streak').textContent = gameState.streak;
            
            // Update progress bar
            const xpForCurrentLevel = (gameState.playerLevel - 1) * 500;
            const xpForNextLevel = gameState.playerLevel * 500;
            const xpProgress = ((gameState.playerXP - xpForCurrentLevel) / (xpForNextLevel - xpForCurrentLevel)) * 100;
            document.getElementById('xp-progress').style.width = `${Math.min(xpProgress, 100)}%`;
            document.getElementById('xp-needed').textContent = xpForNextLevel - gameState.playerXP;
            
            // Update achievements display
            updateAchievementsDisplay();
        }

        // Update achievements display
        function updateAchievementsDisplay() {
            const achievementsList = document.getElementById('achievements-list');
            if (gameState.achievements.length === 0) {
                achievementsList.innerHTML = '<div style="text-align: center; color: #666; font-style: italic;">Complete challenges to unlock achievements!</div>';
                return;
            }
            
            achievementsList.innerHTML = '';
            gameState.achievements.forEach(achId => {
                const achievement = achievements.find(a => a.id === achId);
                if (achievement) {
                    const achElement = document.createElement('div');
                    achElement.style.cssText = 'padding: 10px; margin-bottom: 10px; background: #f7fafc; border-radius: 8px; border-left: 4px solid #4299e1;';
                    achElement.innerHTML = `
                        <div style="font-weight: bold; color: #4a5568;">${achievement.icon} ${achievement.name}</div>
                        <div style="font-size: 0.9em; color: #666; margin-top: 5px;">${achievement.description}</div>
                    `;
                    achievementsList.appendChild(achElement);
                }
            });
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                runCode();
            } else if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                checkSolution();
            }
        });

        // Initialize the game
        initGame();
    </script>
</body>
</html>
