<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HTML Previewer</title>

<!-- CodeMirror 5 core -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/codemirror.min.css">

<!-- Themes that actually exist on cdnjs for CM5 -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/theme/dracula.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/theme/monokai.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/theme/solarized.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/theme/one-dark.min.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/mode/css/css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/mode/htmlmixed/htmlmixed.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/addon/edit/closetag.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/addon/edit/matchbrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/addon/edit/closebrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/addon/selection/active-line.min.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Syne:wght@400;700;800&display=swap');

/* â”€â”€ Night Owl theme â€” embedded because it is not an official CM5 cdnjs theme â”€â”€ */
.cm-s-night-owl.CodeMirror {
  background: #011627;
  color: #d6deeb;
}
.cm-s-night-owl div.CodeMirror-selected { background: #1d3b53; }
.cm-s-night-owl .CodeMirror-line::selection,
.cm-s-night-owl .CodeMirror-line > span::selection,
.cm-s-night-owl .CodeMirror-line > span > span::selection { background: #1d3b53; }
.cm-s-night-owl .CodeMirror-gutters { background: #01111d; border-right: 1px solid #0e3153; }
.cm-s-night-owl .CodeMirror-guttermarker        { color: #d6deeb; }
.cm-s-night-owl .CodeMirror-guttermarker-subtle { color: #4d7fa8; }
.cm-s-night-owl .CodeMirror-linenumber          { color: #4d7fa8; }
.cm-s-night-owl .CodeMirror-cursor              { border-left: 2px solid #80a4c2; }
.cm-s-night-owl span.cm-comment   { color: #637777; font-style: italic; }
.cm-s-night-owl span.cm-atom      { color: #ff5874; }
.cm-s-night-owl span.cm-number    { color: #f78c6c; }
.cm-s-night-owl span.cm-keyword   { color: #c792ea; font-style: italic; }
.cm-s-night-owl span.cm-operator  { color: #7fdbca; }
.cm-s-night-owl span.cm-variable  { color: #d6deeb; }
.cm-s-night-owl span.cm-variable-2{ color: #addb67; }
.cm-s-night-owl span.cm-variable-3{ color: #7fdbca; }
.cm-s-night-owl span.cm-def       { color: #82aaff; }
.cm-s-night-owl span.cm-property  { color: #80cbc4; }
.cm-s-night-owl span.cm-string    { color: #ecc48d; }
.cm-s-night-owl span.cm-string-2  { color: #f78c6c; }
.cm-s-night-owl span.cm-meta      { color: #80cbc4; }
.cm-s-night-owl span.cm-qualifier { color: #7fdbca; }
.cm-s-night-owl span.cm-builtin   { color: #addb67; }
.cm-s-night-owl span.cm-bracket   { color: #d6deeb; }
.cm-s-night-owl span.cm-tag       { color: #7fdbca; }
.cm-s-night-owl span.cm-attribute { color: #addb67; }
.cm-s-night-owl span.cm-hr        { color: #637777; }
.cm-s-night-owl span.cm-link      { color: #ff5874; }
.cm-s-night-owl span.cm-error     { color: #ff5874; }
.cm-s-night-owl .CodeMirror-activeline-background { background: rgba(29,59,83,0.5); }
.cm-s-night-owl .CodeMirror-matchingbracket { text-decoration: underline; color: #7fdbca !important; }

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:          #011627;
  --surface:     #01111d;
  --border:      #0e3153;
  --accent:      #22d3ee;
  --accent-dim:  rgba(34,211,238,0.12);
  --accent-hover:#67e8f9;
  --text:        #d6deeb;
  --muted:       #4d7fa8;
  --mono: 'JetBrains Mono', monospace;
  --sans: 'Syne', sans-serif;
}

html, body { height: 100%; background: var(--bg); color: var(--text); font-family: var(--sans); }
body { display: flex; flex-direction: column; min-height: 100vh; overflow: hidden; }

/* â”€â”€ HEADER â”€â”€ */
header {
  padding: 10px 18px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  gap: 12px;
  background: var(--surface);
  flex-shrink: 0;
  user-select: none;
}
header h1 {
  font-size: 1rem;
  font-weight: 800;
  letter-spacing: -0.02em;
  color: var(--accent);
  white-space: nowrap;
}
.live-badge {
  font-family: var(--mono);
  font-size: 0.58rem;
  background: var(--accent-dim);
  color: var(--accent);
  border: 1px solid rgba(34,211,238,0.3);
  padding: 2px 7px;
  border-radius: 2px;
  letter-spacing: 0.1em;
  text-transform: uppercase;
}
.toolbar {
  display: flex;
  gap: 5px;
  margin-left: auto;
  align-items: center;
}
.toolbar-sep {
  width: 1px;
  height: 18px;
  background: var(--border);
  margin: 0 3px;
}

/* â”€â”€ BUTTONS â”€â”€ */
button {
  font-family: var(--mono);
  font-size: 0.7rem;
  font-weight: 600;
  letter-spacing: 0.04em;
  border: 1px solid var(--border);
  background: transparent;
  color: var(--muted);
  padding: 5px 12px;
  border-radius: 4px;
  cursor: pointer;
  transition: border-color 0.15s, color 0.15s, background 0.15s;
  white-space: nowrap;
}
button:hover { border-color: var(--accent); color: var(--accent); }
button.primary {
  background: var(--accent);
  color: var(--bg);
  border-color: var(--accent);
  font-weight: 700;
}
button.primary:hover { background: var(--accent-hover); border-color: var(--accent-hover); }
button.icon-btn { padding: 5px 9px; font-size: 0.85rem; line-height: 1; }

/* â”€â”€ WORKSPACE â”€â”€ */
.workspace {
  display: flex;
  flex: 1;
  overflow: hidden;
}

/* Initial 50/50 split */
#pane-editor  { flex: 0 0 50%; width: 50%; transition: width 0.25s ease, min-width 0.25s ease; overflow: hidden; }
#pane-preview { flex: 1 1 auto; }

/* Editor hidden state */
#pane-editor.hidden { flex: 0 0 0 !important; width: 0 !important; min-width: 0 !important; }
#divider.editor-hidden { display: none; }

button.active { border-color: var(--accent); color: var(--accent); background: var(--accent-dim); }

.pane {
  display: flex;
  flex-direction: column;
  overflow: hidden;
  min-width: 80px;
}
.pane-header {
  padding: 6px 14px;
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  font-family: var(--mono);
  font-size: 0.64rem;
  letter-spacing: 0.12em;
  color: var(--muted);
  text-transform: uppercase;
  display: flex;
  align-items: center;
  gap: 7px;
  flex-shrink: 0;
  user-select: none;
}
.pane-dot {
  width: 6px; height: 6px;
  border-radius: 50%;
  background: var(--accent);
  opacity: 0.55;
  flex-shrink: 0;
}

/* â”€â”€ DIVIDER â”€â”€ */
.divider {
  width: 5px;
  background: var(--border);
  cursor: col-resize;
  flex-shrink: 0;
  position: relative;
  transition: background 0.15s;
  z-index: 10;
}
.divider:hover,
.divider.dragging { background: var(--accent); }
.divider::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  height: 40px;
  width: 3px;
  border-left: 1px dotted rgba(255,255,255,0.2);
  border-right: 1px dotted rgba(255,255,255,0.2);
}

/* â”€â”€ EDITOR â”€â”€ */
.editor-wrap {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  position: relative;
}
.CodeMirror {
  position: absolute !important;
  inset: 0;
  height: 100% !important;
  font-family: var(--mono) !important;
  font-size: 0.82rem !important;
  line-height: 1.72 !important;
}
.CodeMirror-activeline-background { background: rgba(255,255,255,0.04) !important; }
.CodeMirror-scroll::-webkit-scrollbar { width: 7px; height: 7px; }
.CodeMirror-scroll::-webkit-scrollbar-track { background: transparent; }
.CodeMirror-scroll::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
.CodeMirror-scroll::-webkit-scrollbar-thumb:hover { background: var(--muted); }

/* â”€â”€ PREVIEW â”€â”€ */
iframe { flex: 1; border: none; background: #fff; }

/* â”€â”€ STATUS BAR â”€â”€ */
.status-bar {
  padding: 4px 18px;
  background: var(--surface);
  border-top: 1px solid var(--border);
  font-family: var(--mono);
  font-size: 0.63rem;
  color: var(--muted);
  display: flex;
  align-items: center;
  gap: 18px;
  flex-shrink: 0;
  user-select: none;
}
.indicator { display: flex; align-items: center; gap: 5px; }
.status-dot {
  width: 5px; height: 5px;
  border-radius: 50%;
  background: var(--muted);
  transition: background 0.3s;
}
.status-dot.ready   { background: var(--accent); }
.status-dot.warning { background: #f59e0b; }
.status-dot.error   { background: #f87171; }
.status-right { margin-left: auto; display: flex; gap: 18px; }

/* â”€â”€ MODALS â”€â”€ */
.modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.65);
  backdrop-filter: blur(3px);
  z-index: 200;
  align-items: center;
  justify-content: center;
}
.modal-overlay.open { display: flex; }
.modal {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 26px 30px;
  min-width: 360px;
  max-width: 520px;
  width: 90vw;
  display: flex;
  flex-direction: column;
  gap: 18px;
  box-shadow: 0 24px 64px rgba(0,0,0,0.5);
}
.modal-title {
  font-family: var(--sans);
  font-size: 1rem;
  font-weight: 800;
  color: var(--text);
  letter-spacing: -0.01em;
  display: flex;
  align-items: center;
  gap: 10px;
}
.modal-title-icon { font-size: 1.1rem; opacity: 0.7; }
.field-label {
  font-family: var(--mono);
  font-size: 0.65rem;
  color: var(--muted);
  letter-spacing: 0.1em;
  text-transform: uppercase;
  display: block;
  margin-bottom: 6px;
}
.modal input[type="text"] {
  width: 100%;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--text);
  font-family: var(--mono);
  font-size: 0.8rem;
  padding: 8px 11px;
  outline: none;
  transition: border-color 0.15s, box-shadow 0.15s;
}
.modal input[type="text"]:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-dim);
}
.modal-actions { display: flex; gap: 8px; justify-content: flex-end; padding-top: 4px; }

/* â”€â”€ SETTINGS â”€â”€ */
.settings-section { display: flex; flex-direction: column; gap: 8px; }
.settings-section-title {
  font-family: var(--mono);
  font-size: 0.6rem;
  color: var(--muted);
  letter-spacing: 0.14em;
  text-transform: uppercase;
  padding-bottom: 6px;
  border-bottom: 1px solid var(--border);
}
.theme-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
}
.theme-card {
  border: 2px solid var(--border);
  border-radius: 5px;
  padding: 8px 10px;
  cursor: pointer;
  transition: border-color 0.15s, transform 0.1s;
  background: var(--bg);
  display: flex;
  flex-direction: column;
  gap: 4px;
}
.theme-card:hover { border-color: var(--muted); transform: translateY(-1px); }
.theme-card.active { border-color: var(--accent); }
.theme-card-name {
  font-family: var(--mono);
  font-size: 0.65rem;
  font-weight: 600;
  color: var(--text);
}
.theme-swatch { display: flex; gap: 3px; margin-top: 2px; }
.theme-swatch span {
  width: 10px; height: 10px;
  border-radius: 50%;
  flex-shrink: 0;
}
.color-row {
  display: flex;
  align-items: center;
  gap: 10px;
}
.color-row label {
  font-family: var(--mono);
  font-size: 0.68rem;
  color: var(--text);
  flex: 1;
}
.color-row input[type="color"] {
  width: 36px;
  height: 28px;
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 2px;
  background: var(--bg);
  cursor: pointer;
}
.settings-divider { height: 1px; background: var(--border); }
.reset-link {
  font-family: var(--mono);
  font-size: 0.65rem;
  color: var(--muted);
  background: none;
  border: none;
  cursor: pointer;
  text-decoration: underline;
  padding: 0;
  letter-spacing: 0.03em;
}
.reset-link:hover { color: var(--accent); border: none; }

#file-input { display: none; }

@media (max-width: 720px) {
  .workspace { flex-direction: column; }
  #pane-editor  { flex: 0 0 50%; width: 100%; height: 50%; }
  #pane-preview { flex: 1; width: 100%; }
  .divider { width: 100%; height: 5px; cursor: row-resize; }
  header { flex-wrap: wrap; }
  .toolbar { width: 100%; justify-content: flex-end; }
  .theme-grid { grid-template-columns: repeat(2, 1fr); }
}
</style>
</head>
<body>

<header>
  <h1>HTML Previewer</h1>
  <span class="live-badge">Live</span>
  <div class="toolbar">
    <button onclick="openFile()">Open</button>
    <button onclick="saveFile()">Save</button>
    <button onclick="clearEditor()">Clear</button>
    <button onclick="copyCode()">Copy</button>
    <div class="toolbar-sep"></div>
    <button id="toggle-btn" class="icon-btn" onclick="toggleEditor()" title="Show/hide editor">&#10092;&#10093;</button>
    <button class="icon-btn" onclick="openSettings()" title="Settings">âš™</button>
    <div class="toolbar-sep"></div>
    <button class="primary" onclick="renderPreview()">&#9654; Run</button>
  </div>
</header>

<input type="file" id="file-input" accept=".html,.htm,.txt" onchange="handleFileOpen(event)">

<!-- Save Modal -->
<div class="modal-overlay" id="save-modal" onclick="closeSaveModalOverlay(event)">
  <div class="modal">
    <div class="modal-title"><span class="modal-title-icon">ðŸ’¾</span>Save File</div>
    <div>
      <label class="field-label" for="save-name">Filename</label>
      <input type="text" id="save-name" placeholder="my-page.html" onkeydown="saveName_keydown(event)">
    </div>
    <div class="modal-actions">
      <button onclick="closeSaveModal()">Cancel</button>
      <button class="primary" onclick="confirmSave()">Download</button>
    </div>
  </div>
</div>

<!-- Settings Modal -->
<div class="modal-overlay" id="settings-modal" onclick="closeSettingsOverlay(event)">
  <div class="modal">
    <div class="modal-title"><span class="modal-title-icon">âš™</span>Settings</div>

    <div class="settings-section">
      <div class="settings-section-title">Editor Theme</div>
      <div class="theme-grid" id="theme-grid"></div>
    </div>

    <div class="settings-divider"></div>

    <div class="settings-section">
      <div class="settings-section-title">Shell Colors</div>
      <div class="color-row">
        <label>Background</label>
        <input type="color" id="col-bg" oninput="applyShellColor('--bg', this.value)">
      </div>
      <div class="color-row">
        <label>Surface (header / status bar)</label>
        <input type="color" id="col-surface" oninput="applyShellColor('--surface', this.value)">
      </div>
      <div class="color-row">
        <label>Accent color</label>
        <input type="color" id="col-accent" oninput="updateAccent(this.value)">
      </div>
      <div class="color-row">
        <label>Border / divider</label>
        <input type="color" id="col-border" oninput="applyShellColor('--border', this.value)">
      </div>
      <div class="color-row">
        <label>Text</label>
        <input type="color" id="col-text" oninput="applyShellColor('--text', this.value)">
      </div>
      <div class="color-row">
        <label>Muted text</label>
        <input type="color" id="col-muted" oninput="applyShellColor('--muted', this.value)">
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:4px;">
        <button class="reset-link" onclick="resetShellColors()">Reset to theme defaults</button>
      </div>
    </div>

    <div class="modal-actions">
      <button class="primary" onclick="closeSettings()">Done</button>
    </div>
  </div>
</div>

<!-- Workspace -->
<div class="workspace" id="workspace">
  <div class="pane" id="pane-editor">
    <div class="pane-header"><span class="pane-dot"></span>HTML / CSS / JS</div>
    <div class="editor-wrap">
      <textarea id="editor-ta"></textarea>
    </div>
  </div>
  <div class="divider" id="divider"></div>
  <div class="pane" id="pane-preview">
    <div class="pane-header"><span class="pane-dot"></span>Preview</div>
    <iframe id="preview" sandbox="allow-scripts allow-same-origin allow-forms allow-modals" title="HTML Preview"></iframe>
  </div>
</div>

<div class="status-bar">
  <div class="indicator">
    <span class="status-dot" id="status-dot"></span>
    <span id="status-text">Ready</span>
  </div>
  <div class="status-right">
    <span id="cursor-pos">Ln 1, Col 1</span>
    <span id="char-count">0 chars</span>
  </div>
</div>

<script>
'use strict';

// â”€â”€ Theme definitions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Note: "night-owl" CSS is embedded above since it is not an official CM5 cdnjs theme.
// All other themes load from cdnjs.
const THEMES = [
  {
    id: 'night-owl',
    name: 'Night Owl',
    swatches: ['#011627','#22d3ee','#addb67','#c792ea'],
    shell: {
      '--bg':           '#011627',
      '--surface':      '#01111d',
      '--border':       '#0e3153',
      '--accent':       '#22d3ee',
      '--accent-dim':   'rgba(34,211,238,0.12)',
      '--accent-hover': '#67e8f9',
      '--text':         '#d6deeb',
      '--muted':        '#4d7fa8',
    }
  },
  {
    id: 'dracula',
    name: 'Dracula',
    swatches: ['#282a36','#ff79c6','#50fa7b','#bd93f9'],
    shell: {
      '--bg':           '#1e1f29',
      '--surface':      '#17181e',
      '--border':       '#3a3c4e',
      '--accent':       '#bd93f9',
      '--accent-dim':   'rgba(189,147,249,0.12)',
      '--accent-hover': '#d6b4ff',
      '--text':         '#f8f8f2',
      '--muted':        '#6272a4',
    }
  },
  {
    id: 'monokai',
    name: 'Monokai',
    swatches: ['#272822','#f92672','#a6e22e','#66d9e8'],
    shell: {
      '--bg':           '#1e1f1c',
      '--surface':      '#191a17',
      '--border':       '#3d3e38',
      '--accent':       '#a6e22e',
      '--accent-dim':   'rgba(166,226,46,0.12)',
      '--accent-hover': '#c2f059',
      '--text':         '#f8f8f2',
      '--muted':        '#75715e',
    }
  },
  {
    id: 'solarized dark',
    name: 'Solarized Dark',
    swatches: ['#002b36','#268bd2','#2aa198','#859900'],
    shell: {
      '--bg':           '#001f27',
      '--surface':      '#01161d',
      '--border':       '#073643',
      '--accent':       '#268bd2',
      '--accent-dim':   'rgba(38,139,210,0.12)',
      '--accent-hover': '#5aaceb',
      '--text':         '#93a1a1',
      '--muted':        '#586e75',
    }
  },
  {
    id: 'one-dark',
    name: 'One Dark',
    swatches: ['#282c34','#e06c75','#98c379','#61afef'],
    shell: {
      '--bg':           '#21252b',
      '--surface':      '#1b1f23',
      '--border':       '#3d424a',
      '--accent':       '#61afef',
      '--accent-dim':   'rgba(97,175,239,0.12)',
      '--accent-hover': '#9dcfff',
      '--text':         '#abb2bf',
      '--muted':        '#5c6370',
    }
  },
];

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentFilename = 'index.html';
let activeThemeId   = 'night-owl';
let customShell     = {};

const preview    = document.getElementById('preview');
const statusDot  = document.getElementById('status-dot');
const statusText = document.getElementById('status-text');
const charCount  = document.getElementById('char-count');
const cursorPos  = document.getElementById('cursor-pos');
const root       = document.documentElement;

// â”€â”€ CodeMirror init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const cm = CodeMirror.fromTextArea(document.getElementById('editor-ta'), {
  mode:              'htmlmixed',
  theme:             'night-owl',
  lineNumbers:       true,
  lineWrapping:      false,
  autoCloseTags:     true,
  autoCloseBrackets: true,
  matchBrackets:     true,
  styleActiveLine:   true,
  tabSize:           2,
  indentWithTabs:    false,
  extraKeys: {
    'Ctrl-Enter': () => renderPreview(),
    'Cmd-Enter':  () => renderPreview(),
    'Ctrl-S':     () => saveFile(),
    'Cmd-S':      () => saveFile(),
    'Tab':        cm  => cm.execCommand('insertSoftTab'),
  }
});

cm.on('cursorActivity', () => {
  const c = cm.getCursor();
  cursorPos.textContent = 'Ln ' + (c.line + 1) + ', Col ' + (c.ch + 1);
});
cm.on('change', () => {
  const n = cm.getValue().length;
  charCount.textContent = n.toLocaleString() + ' char' + (n !== 1 ? 's' : '');
});

// â”€â”€ Theme application â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function applyTheme(id) {
  const theme = THEMES.find(t => t.id === id);
  if (!theme) return;
  activeThemeId = id;
  cm.setOption('theme', id);

  // Merge theme shell with any custom overrides
  const merged = Object.assign({}, theme.shell, customShell);
  Object.entries(merged).forEach(([k, v]) => root.style.setProperty(k, v));
  syncColorPickers(merged);

  document.querySelectorAll('.theme-card').forEach(c => {
    c.classList.toggle('active', c.dataset.id === id);
  });
}

function applyShellColor(prop, value) {
  customShell[prop] = value;
  root.style.setProperty(prop, value);
}

function updateAccent(value) {
  customShell['--accent'] = value;
  root.style.setProperty('--accent', value);
  root.style.setProperty('--accent-dim', hexToRgba(value, 0.12));
  root.style.setProperty('--accent-hover', lightenHex(value, 30));
}

function resetShellColors() {
  customShell = {};
  const theme = THEMES.find(t => t.id === activeThemeId);
  if (!theme) return;
  Object.entries(theme.shell).forEach(([k, v]) => root.style.setProperty(k, v));
  syncColorPickers(theme.shell);
}

function syncColorPickers(vars) {
  const map = {
    'col-bg':      '--bg',
    'col-surface': '--surface',
    'col-accent':  '--accent',
    'col-border':  '--border',
    'col-text':    '--text',
    'col-muted':   '--muted',
  };
  Object.entries(map).forEach(([elId, prop]) => {
    const el = document.getElementById(elId);
    if (el && vars[prop]) el.value = cssColorToHex(vars[prop]);
  });
}

// â”€â”€ Settings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildThemeGrid() {
  const grid = document.getElementById('theme-grid');
  grid.innerHTML = '';
  THEMES.forEach(theme => {
    const card = document.createElement('div');
    card.className = 'theme-card' + (theme.id === activeThemeId ? ' active' : '');
    card.dataset.id = theme.id;
    card.onclick = () => applyTheme(theme.id);

    const name = document.createElement('div');
    name.className = 'theme-card-name';
    name.textContent = theme.name;

    const swatch = document.createElement('div');
    swatch.className = 'theme-swatch';
    theme.swatches.forEach(color => {
      const sp = document.createElement('span');
      sp.style.background = color;
      swatch.appendChild(sp);
    });

    card.appendChild(name);
    card.appendChild(swatch);
    grid.appendChild(card);
  });
}

function openSettings() {
  buildThemeGrid();
  const currentVars = {};
  ['--bg','--surface','--accent','--border','--text','--muted'].forEach(v => {
    currentVars[v] = getComputedStyle(root).getPropertyValue(v).trim();
  });
  syncColorPickers(currentVars);
  document.getElementById('settings-modal').classList.add('open');
}
function closeSettings() {
  document.getElementById('settings-modal').classList.remove('open');
  cm.focus();
}
function closeSettingsOverlay(e) {
  if (e.target === document.getElementById('settings-modal')) closeSettings();
}

// â”€â”€ Core functions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderPreview() {
  const code = cm.getValue().trim();
  if (!code) { setStatus('No content to render', 'warning'); return; }
  try {
    const doc = preview.contentDocument || preview.contentWindow.document;
    doc.open(); doc.write(code); doc.close();
    setStatus('Rendered', 'ready');
  } catch (e) {
    setStatus('Error: ' + e.message, 'error');
  }
}

function clearEditor() {
  if (cm.getValue().length > 0 && !confirm('Clear the editor? This cannot be undone.')) return;
  cm.setValue('');
  const doc = preview.contentDocument || preview.contentWindow.document;
  doc.open(); doc.write(''); doc.close();
  setStatus('Editor cleared', 'warning');
  cm.focus();
}

function copyCode() {
  navigator.clipboard.writeText(cm.getValue())
    .then(() => setStatus('Copied to clipboard', 'ready'))
    .catch(() => setStatus('Copy failed', 'error'));
}

function openFile() {
  document.getElementById('file-input').value = '';
  document.getElementById('file-input').click();
}
function handleFileOpen(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    cm.setValue(ev.target.result);
    currentFilename = file.name;
    setStatus('Opened: ' + file.name, 'ready');
    renderPreview();
    cm.focus();
  };
  reader.readAsText(file);
}

function saveFile() {
  const inp = document.getElementById('save-name');
  inp.value = currentFilename;
  document.getElementById('save-modal').classList.add('open');
  setTimeout(() => { inp.focus(); inp.select(); }, 60);
}
function closeSaveModal() {
  document.getElementById('save-modal').classList.remove('open');
  cm.focus();
}
function closeSaveModalOverlay(e) {
  if (e.target === document.getElementById('save-modal')) closeSaveModal();
}
function saveName_keydown(e) {
  if (e.key === 'Enter')  { e.preventDefault(); confirmSave(); }
  if (e.key === 'Escape') { e.preventDefault(); closeSaveModal(); }
}
function confirmSave() {
  let name = document.getElementById('save-name').value.trim() || 'index.html';
  if (!name.match(/\.(html?|txt)$/i)) name += '.html';
  currentFilename = name;
  const blob = new Blob([cm.getValue()], { type: 'text/html' });
  const url  = URL.createObjectURL(blob);
  const a    = document.createElement('a');
  a.href = url; a.download = name; a.click();
  URL.revokeObjectURL(url);
  closeSaveModal();
  setStatus('Saved: ' + name, 'ready');
}

// â”€â”€ Status bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let statusTimer = null;
function setStatus(msg, state) {
  statusText.textContent = msg;
  statusDot.className = 'status-dot ' + (state || '');
  clearTimeout(statusTimer);
  statusTimer = setTimeout(() => {
    statusText.textContent = 'Ready';
    statusDot.className = 'status-dot ready';
  }, 2500);
}

// â”€â”€ Resizable split pane â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function initDivider() {
  const divider     = document.getElementById('divider');
  const workspace   = document.getElementById('workspace');
  const editorPane  = document.getElementById('pane-editor');
  const previewPane = document.getElementById('pane-preview');

  let dragging = false, startX = 0, startW = 0;

  divider.addEventListener('mousedown', e => {
    dragging = true;
    startX = e.clientX;
    startW = editorPane.getBoundingClientRect().width;
    divider.classList.add('dragging');
    document.body.style.cursor = 'col-resize';
    document.body.style.userSelect = 'none';
    previewPane.style.pointerEvents = 'none'; // stop iframe eating mouse events
  });

  document.addEventListener('mousemove', e => {
    if (!dragging) return;
    const totalW = workspace.getBoundingClientRect().width - 5;
    let newW = Math.max(120, Math.min(totalW - 120, startW + (e.clientX - startX)));
    editorPane.style.flex  = 'none';
    editorPane.style.width = newW + 'px';
  });

  document.addEventListener('mouseup', () => {
    if (!dragging) return;
    dragging = false;
    divider.classList.remove('dragging');
    document.body.style.cursor = '';
    document.body.style.userSelect = '';
    previewPane.style.pointerEvents = '';
  });
})();

// â”€â”€ Color utilities â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function hexToRgba(hex, alpha) {
  hex = hex.replace('#','');
  if (hex.length === 3) hex = hex.split('').map(x=>x+x).join('');
  return `rgba(${parseInt(hex.slice(0,2),16)},${parseInt(hex.slice(2,4),16)},${parseInt(hex.slice(4,6),16)},${alpha})`;
}
function lightenHex(hex, amt) {
  hex = hex.replace('#','');
  if (hex.length === 3) hex = hex.split('').map(x=>x+x).join('');
  return '#' + [0,2,4].map(i => Math.min(255, parseInt(hex.slice(i,i+2),16)+amt).toString(16).padStart(2,'0')).join('');
}
function cssColorToHex(color) {
  if (!color) return '#000000';
  if (color.startsWith('#')) return color.slice(0,7);
  const m = color.match(/\d+/g);
  if (!m) return '#000000';
  return '#' + m.slice(0,3).map(n => parseInt(n).toString(16).padStart(2,'0')).join('');
}

// â”€â”€ Editor toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let editorVisible = true;
let savedEditorWidth = null;

function toggleEditor() {
  const editorPane = document.getElementById('pane-editor');
  const divider    = document.getElementById('divider');
  const btn        = document.getElementById('toggle-btn');

  if (editorVisible) {
    // Save current width before hiding
    savedEditorWidth = editorPane.getBoundingClientRect().width;
    editorPane.classList.add('hidden');
    divider.classList.add('editor-hidden');
    btn.classList.add('active');
    btn.title = 'Show editor';
    editorVisible = false;
  } else {
    editorPane.classList.remove('hidden');
    divider.classList.remove('editor-hidden');
    btn.classList.remove('active');
    btn.title = 'Hide editor';
    // Restore saved width or fall back to 50%
    if (savedEditorWidth) {
      editorPane.style.flex  = 'none';
      editorPane.style.width = savedEditorWidth + 'px';
    } else {
      editorPane.style.flex  = '0 0 50%';
      editorPane.style.width = '50%';
    }
    editorVisible = true;
    cm.focus();
  }
}

// â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
applyTheme('night-owl');
setStatus('Ready', 'ready');
cm.focus();
</script>
</body>
</html>
