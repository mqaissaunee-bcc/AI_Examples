<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HTML Previewer</title>

<!-- CodeMirror 5 core -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/theme/dracula.min.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/mode/css/css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/mode/htmlmixed/htmlmixed.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/addon/edit/closetag.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/addon/edit/matchbrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/addon/edit/closebrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/addon/selection/active-line.min.js"></script>

<style>
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Syne:wght@400;700;800&display=swap');

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #0d0d0f;
    --surface: #16161a;
    --border: #2a2a32;
    --accent: #e8ff47;
    --accent-dim: rgba(232,255,71,0.12);
    --text: #e8e8f0;
    --muted: #666680;
    --mono: 'JetBrains Mono', monospace;
    --sans: 'Syne', sans-serif;
  }

  html, body { height: 100%; background: var(--bg); color: var(--text); font-family: var(--sans); }

  body { display: flex; flex-direction: column; min-height: 100vh; }

  header {
    padding: 12px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 14px;
    background: var(--surface);
    flex-shrink: 0;
  }

  header h1 {
    font-size: 1.05rem;
    font-weight: 800;
    letter-spacing: -0.02em;
    color: var(--accent);
  }

  .tag {
    font-family: var(--mono);
    font-size: 0.62rem;
    background: var(--accent-dim);
    color: var(--accent);
    border: 1px solid rgba(232,255,71,0.3);
    padding: 2px 8px;
    border-radius: 2px;
    letter-spacing: 0.08em;
  }

  .toolbar {
    display: flex;
    gap: 6px;
    margin-left: auto;
    align-items: center;
  }

  button {
    font-family: var(--mono);
    font-size: 0.72rem;
    font-weight: 600;
    letter-spacing: 0.05em;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--muted);
    padding: 5px 13px;
    border-radius: 3px;
    cursor: pointer;
    transition: all 0.15s;
    white-space: nowrap;
  }

  button:hover { border-color: var(--accent); color: var(--accent); }

  button.primary {
    background: var(--accent);
    color: #0d0d0f;
    border-color: var(--accent);
    font-weight: 700;
  }

  button.primary:hover { background: #d4ea2e; border-color: #d4ea2e; color: #0d0d0f; }

  .workspace {
    display: grid;
    grid-template-columns: 1fr 1fr;
    flex: 1;
    overflow: hidden;
  }

  .pane {
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .pane + .pane { border-left: 1px solid var(--border); }

  .pane-header {
    padding: 7px 16px;
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    font-family: var(--mono);
    font-size: 0.68rem;
    letter-spacing: 0.1em;
    color: var(--muted);
    text-transform: uppercase;
    display: flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 0;
  }

  .pane-header .dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--accent);
    opacity: 0.6;
  }

  /* ── CodeMirror sizing ── */
  .editor-wrap {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
  }

  .CodeMirror {
    position: absolute !important;
    inset: 0;
    height: 100% !important;
    font-family: var(--mono) !important;
    font-size: 0.82rem !important;
    line-height: 1.7 !important;
  }

  .CodeMirror-gutters {
    background: #21222c !important;
    border-right: 1px solid #3a3c4e !important;
  }

  .CodeMirror-linenumber { color: #6272a4 !important; }

  .CodeMirror-activeline-background { background: rgba(255,255,255,0.04) !important; }

  .CodeMirror-scroll::-webkit-scrollbar { width: 8px; height: 8px; }
  .CodeMirror-scroll::-webkit-scrollbar-track { background: #282a36; }
  .CodeMirror-scroll::-webkit-scrollbar-thumb { background: #44475a; border-radius: 4px; }
  .CodeMirror-scroll::-webkit-scrollbar-thumb:hover { background: #6272a4; }

  /* ── Preview ── */
  iframe { flex: 1; border: none; background: #fff; }

  /* ── Status bar ── */
  .status-bar {
    padding: 5px 20px;
    background: var(--surface);
    border-top: 1px solid var(--border);
    font-family: var(--mono);
    font-size: 0.66rem;
    color: var(--muted);
    display: flex;
    align-items: center;
    gap: 20px;
    flex-shrink: 0;
  }

  .indicator { display: flex; align-items: center; gap: 6px; }

  .status-dot { width: 5px; height: 5px; border-radius: 50%; background: var(--muted); }
  .status-dot.ready { background: var(--accent); }

  .status-right { margin-left: auto; display: flex; gap: 20px; }

  /* ── Modal ── */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.72);
    z-index: 100;
    align-items: center;
    justify-content: center;
  }

  .modal-overlay.open { display: flex; }

  .modal {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 28px 32px;
    min-width: 340px;
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .modal h2 {
    font-family: var(--sans);
    font-size: 1rem;
    font-weight: 700;
    color: var(--text);
    letter-spacing: -0.01em;
  }

  .modal label {
    font-family: var(--mono);
    font-size: 0.68rem;
    color: var(--muted);
    letter-spacing: 0.08em;
    text-transform: uppercase;
    display: block;
    margin-bottom: 6px;
  }

  .modal input[type="text"] {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 3px;
    color: var(--text);
    font-family: var(--mono);
    font-size: 0.82rem;
    padding: 8px 12px;
    outline: none;
    transition: border-color 0.15s;
  }

  .modal input[type="text"]:focus { border-color: var(--accent); }

  .modal-actions { display: flex; gap: 8px; justify-content: flex-end; margin-top: 4px; }

  #file-input { display: none; }

  @media (max-width: 720px) {
    .workspace { grid-template-columns: 1fr; grid-template-rows: 1fr 1fr; }
    .pane + .pane { border-left: none; border-top: 1px solid var(--border); }
    header { flex-wrap: wrap; }
    .toolbar { width: 100%; justify-content: flex-end; }
  }
</style>
</head>
<body>

<header>
  <h1>HTML Previewer</h1>
  <span class="tag">LIVE</span>
  <div class="toolbar">
    <button onclick="openFile()">Open</button>
    <button onclick="saveFile()">Save</button>
    <button onclick="clearEditor()">Clear</button>
    <button onclick="copyCode()">Copy</button>
    <button class="primary" onclick="renderPreview()">&#9654; Run</button>
  </div>
</header>

<input type="file" id="file-input" accept=".html,.htm,.txt" onchange="handleFileOpen(event)">

<div class="modal-overlay" id="save-modal" onclick="closeSaveModalOverlay(event)">
  <div class="modal">
    <h2>Save File</h2>
    <div>
      <label for="save-name">Filename</label>
      <input type="text" id="save-name" placeholder="my-page.html" onkeydown="saveName_keydown(event)">
    </div>
    <div class="modal-actions">
      <button onclick="closeSaveModal()">Cancel</button>
      <button class="primary" onclick="confirmSave()">Download</button>
    </div>
  </div>
</div>

<div class="workspace">
  <div class="pane">
    <div class="pane-header"><span class="dot"></span>HTML / CSS / JS</div>
    <div class="editor-wrap">
      <textarea id="editor-ta"></textarea>
    </div>
  </div>
  <div class="pane">
    <div class="pane-header"><span class="dot"></span>Preview</div>
    <iframe id="preview" sandbox="allow-scripts allow-same-origin allow-forms allow-modals" title="HTML Preview"></iframe>
  </div>
</div>

<div class="status-bar">
  <div class="indicator">
    <span class="status-dot" id="status-dot"></span>
    <span id="status-text">Ready</span>
  </div>
  <div class="status-right">
    <span id="cursor-pos">Ln 1, Col 1</span>
    <span id="char-count">0 chars</span>
  </div>
</div>

<script>
// ── State
let currentFilename = 'index.html';
const preview    = document.getElementById('preview');
const statusDot  = document.getElementById('status-dot');
const statusText = document.getElementById('status-text');
const charCount  = document.getElementById('char-count');
const cursorPos  = document.getElementById('cursor-pos');

// ── CodeMirror
const cm = CodeMirror.fromTextArea(document.getElementById('editor-ta'), {
  mode:              'htmlmixed',
  theme:             'dracula',
  lineNumbers:       true,
  lineWrapping:      false,
  autoCloseTags:     true,
  autoCloseBrackets: true,
  matchBrackets:     true,
  styleActiveLine:   true,
  tabSize:           2,
  indentWithTabs:    false,
  extraKeys: {
    'Ctrl-Enter': () => renderPreview(),
    'Cmd-Enter':  () => renderPreview(),
    'Ctrl-S':     () => saveFile(),
    'Cmd-S':      () => saveFile(),
    'Tab':        cm  => cm.execCommand('insertSoftTab')
  }
});

cm.on('cursorActivity', () => {
  const c = cm.getCursor();
  cursorPos.textContent = 'Ln ' + (c.line + 1) + ', Col ' + (c.ch + 1);
});

cm.on('change', () => {
  const n = cm.getValue().length;
  charCount.textContent = n.toLocaleString() + ' char' + (n !== 1 ? 's' : '');
});

// ── Render
function renderPreview() {
  const code = cm.getValue().trim();
  if (!code) { setStatus('No content to render', false); return; }
  try {
    const doc = preview.contentDocument || preview.contentWindow.document;
    doc.open();
    doc.write(code);
    doc.close();
    setStatus('Rendered', true);
  } catch (e) {
    setStatus('Error: ' + e.message, false);
  }
}

// ── Clear
function clearEditor() {
  if (cm.getValue().length > 0 && !confirm('Clear the editor?')) return;
  cm.setValue('');
  const doc = preview.contentDocument || preview.contentWindow.document;
  doc.open(); doc.write(''); doc.close();
  setStatus('Cleared', false);
  cm.focus();
}

// ── Copy
function copyCode() {
  navigator.clipboard.writeText(cm.getValue())
    .then(() => setStatus('Copied to clipboard', true))
    .catch(() => setStatus('Copy failed', false));
}

// ── Open
function openFile() {
  document.getElementById('file-input').value = '';
  document.getElementById('file-input').click();
}

function handleFileOpen(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    cm.setValue(ev.target.result);
    currentFilename = file.name;
    setStatus('Opened: ' + file.name, true);
    renderPreview();
    cm.focus();
  };
  reader.readAsText(file);
}

// ── Save
function saveFile() {
  const inp = document.getElementById('save-name');
  inp.value = currentFilename;
  document.getElementById('save-modal').classList.add('open');
  setTimeout(() => { inp.focus(); inp.select(); }, 60);
}

function closeSaveModal() {
  document.getElementById('save-modal').classList.remove('open');
  cm.focus();
}

function closeSaveModalOverlay(e) {
  if (e.target === document.getElementById('save-modal')) closeSaveModal();
}

function saveName_keydown(e) {
  if (e.key === 'Enter')  { e.preventDefault(); confirmSave(); }
  if (e.key === 'Escape') { e.preventDefault(); closeSaveModal(); }
}

function confirmSave() {
  let name = document.getElementById('save-name').value.trim() || 'index.html';
  if (!name.match(/\.(html?|txt)$/i)) name += '.html';
  currentFilename = name;
  const blob = new Blob([cm.getValue()], { type: 'text/html' });
  const url  = URL.createObjectURL(blob);
  const a    = document.createElement('a');
  a.href = url; a.download = name; a.click();
  URL.revokeObjectURL(url);
  closeSaveModal();
  setStatus('Saved: ' + name, true);
}

// ── Status helper
let statusTimer = null;
function setStatus(msg, good) {
  statusText.textContent = msg;
  statusDot.className = 'status-dot' + (good ? ' ready' : '');
  clearTimeout(statusTimer);
  if (good) {
    statusTimer = setTimeout(() => {
      statusText.textContent = 'Ready';
      statusDot.className = 'status-dot ready';
    }, 2500);
  }
}

// ── Init
setStatus('Ready', true);
cm.focus();
</script>
</body>
</html>
