<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Integration Refresher â€” Physics &amp; Engineering</title>
<style>
:root{--bg-primary:#0D1117;--bg-secondary:#161B22;--bg-card:#1C2128;--bg-card-hover:#242B35;--bg-input:#0D1117;--text-primary:#E6EDF3;--text-secondary:#8B949E;--text-muted:#6E7681;--accent-cyan:#39D2C0;--accent-cyan-dim:rgba(57,210,192,0.15);--accent-orange:#F0883E;--accent-orange-dim:rgba(240,136,62,0.15);--accent-blue:#58A6FF;--accent-blue-dim:rgba(88,166,255,0.15);--accent-purple:#BC8CFF;--accent-purple-dim:rgba(188,140,255,0.15);--accent-green:#3FB950;--accent-green-dim:rgba(63,185,80,0.15);--accent-red:#F85149;--accent-red-dim:rgba(248,81,73,0.15);--accent-yellow:#D29922;--accent-yellow-dim:rgba(210,153,34,0.15);--border:#30363D;--border-light:#21262D;--radius-sm:6px;--radius-md:10px;--radius-lg:16px;--shadow-md:0 4px 12px rgba(0,0,0,0.4);--font-display:'Playfair Display',Georgia,serif;--font-body:'Source Sans 3','Segoe UI',Tahoma,sans-serif;--font-mono:'JetBrains Mono','Consolas',monospace;--transition-fast:150ms ease;--transition-med:300ms ease}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}html{scroll-behavior:smooth;font-size:16px}
body{font-family:var(--font-body);background:var(--bg-primary);color:var(--text-primary);line-height:1.65;min-height:100vh;overflow-x:hidden}
:focus-visible{outline:3px solid var(--accent-cyan);outline-offset:2px;border-radius:3px}
.skip-link{position:absolute;top:-100%;left:1rem;background:var(--accent-cyan);color:var(--bg-primary);padding:.75rem 1.5rem;border-radius:var(--radius-sm);font-weight:700;z-index:10000;text-decoration:none;transition:top var(--transition-fast)}.skip-link:focus{top:1rem}
body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(ellipse 80% 60% at 10% 20%,rgba(57,210,192,.06) 0%,transparent 60%),radial-gradient(ellipse 60% 50% at 90% 80%,rgba(188,140,255,.05) 0%,transparent 60%),radial-gradient(ellipse 50% 40% at 50% 50%,rgba(88,166,255,.03) 0%,transparent 60%);pointer-events:none;z-index:0}
body::after{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(rgba(57,210,192,.03) 1px,transparent 1px),linear-gradient(90deg,rgba(57,210,192,.03) 1px,transparent 1px);background-size:60px 60px;pointer-events:none;z-index:0}
h1,h2,h3,h4{font-family:var(--font-display);font-weight:700;line-height:1.2}
.app-container{position:relative;z-index:1;max-width:1320px;margin:0 auto;padding:0 1.5rem}
header{padding:2.5rem 0 2rem;border-bottom:1px solid var(--border);margin-bottom:2rem}
.header-inner{display:flex;align-items:flex-end;justify-content:space-between;flex-wrap:wrap;gap:1.5rem}
.header-brand h1{font-size:clamp(2rem,4vw,3rem);letter-spacing:-.02em;background:linear-gradient(135deg,var(--accent-cyan),var(--accent-blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.header-brand p{color:var(--text-secondary);font-size:1.05rem;margin-top:.35rem}
.header-brand .ii{display:inline-block;font-size:1.3em;margin-right:.15em;color:var(--accent-cyan);-webkit-text-fill-color:var(--accent-cyan)}
nav[role="tablist"]{display:flex;gap:.25rem;background:var(--bg-secondary);padding:.3rem;border-radius:var(--radius-lg);border:1px solid var(--border);flex-wrap:wrap}
.nav-tab{padding:.6rem 1.1rem;border:none;background:transparent;color:var(--text-secondary);font-family:var(--font-body);font-size:.88rem;font-weight:600;border-radius:var(--radius-md);cursor:pointer;transition:all var(--transition-fast);white-space:nowrap}
.nav-tab:hover{color:var(--text-primary);background:var(--bg-card)}.nav-tab[aria-selected="true"]{background:var(--accent-cyan);color:var(--bg-primary);box-shadow:0 2px 8px rgba(57,210,192,.3)}
.controls-bar{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:1rem;margin:1.5rem 0;padding:1rem 1.25rem;background:var(--bg-secondary);border:1px solid var(--border);border-radius:var(--radius-md)}
.controls-bar label{font-weight:600;font-size:.95rem;color:var(--text-secondary)}
.difficulty-group{display:flex;gap:.35rem}
.diff-btn{padding:.45rem 1rem;border:1px solid var(--border);background:var(--bg-card);color:var(--text-secondary);font-family:var(--font-body);font-size:.85rem;font-weight:600;border-radius:var(--radius-sm);cursor:pointer;transition:all var(--transition-fast)}
.diff-btn:hover{border-color:var(--accent-cyan);color:var(--text-primary)}.diff-btn[aria-pressed="true"]{background:var(--accent-cyan-dim);border-color:var(--accent-cyan);color:var(--accent-cyan)}
.progress-indicator{display:flex;align-items:center;gap:.75rem;font-size:.9rem;color:var(--text-secondary)}
.progress-bar-track{width:120px;height:6px;background:var(--bg-primary);border-radius:3px;overflow:hidden}
.progress-bar-fill{height:100%;background:var(--accent-green);border-radius:3px;transition:width var(--transition-med);width:0%}
.tab-panel{display:none;animation:fadePanel .4s ease}.tab-panel[aria-hidden="false"]{display:block}
@keyframes fadePanel{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
.section-title{font-size:1.6rem;margin-bottom:1.25rem;display:flex;align-items:center;gap:.65rem}
.section-title .icon{width:36px;height:36px;border-radius:var(--radius-sm);display:grid;place-items:center;font-size:1.1rem;flex-shrink:0}
.icon-cyan{background:var(--accent-cyan-dim);color:var(--accent-cyan)}.icon-orange{background:var(--accent-orange-dim);color:var(--accent-orange)}.icon-blue{background:var(--accent-blue-dim);color:var(--accent-blue)}.icon-purple{background:var(--accent-purple-dim);color:var(--accent-purple)}.icon-yellow{background:var(--accent-yellow-dim);color:var(--accent-yellow)}
.card-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:1rem;margin-bottom:2.5rem}
.formula-card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-md);padding:1.35rem;transition:all var(--transition-med);cursor:default;position:relative;overflow:hidden;animation:popIn .3s ease backwards}
.formula-card::before{content:'';position:absolute;top:0;left:0;width:4px;height:100%;border-radius:4px 0 0 4px}
.formula-card.cat-basic::before{background:var(--accent-cyan)}.formula-card.cat-technique::before{background:var(--accent-orange)}.formula-card.cat-application::before{background:var(--accent-blue)}.formula-card.cat-multi::before{background:var(--accent-purple)}
.formula-card:hover{border-color:var(--border-light);background:var(--bg-card-hover);transform:translateY(-2px);box-shadow:var(--shadow-md)}
.card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:.75rem}
.card-title{font-family:var(--font-display);font-size:1.1rem;font-weight:700}.card-tag{font-size:.72rem;font-weight:700;text-transform:uppercase;letter-spacing:.06em;padding:.2rem .55rem;border-radius:99px}
.tag-basic{background:var(--accent-cyan-dim);color:var(--accent-cyan)}.tag-technique{background:var(--accent-orange-dim);color:var(--accent-orange)}.tag-application{background:var(--accent-blue-dim);color:var(--accent-blue)}.tag-multi{background:var(--accent-purple-dim);color:var(--accent-purple)}
.card-formula{font-family:var(--font-mono);font-size:1.02rem;color:var(--text-primary);background:var(--bg-primary);padding:.85rem 1rem;border-radius:var(--radius-sm);margin-bottom:.75rem;line-height:1.8;border:1px solid var(--border-light);overflow-x:auto;white-space:pre-wrap}
.card-example{font-size:.88rem;color:var(--text-secondary);line-height:1.7}.card-example strong{color:var(--text-primary)}.card-example code{font-family:var(--font-mono);font-size:.85em;background:var(--bg-primary);padding:.1rem .4rem;border-radius:3px;color:var(--accent-cyan)}
.methods-list{display:flex;flex-direction:column;gap:1.25rem;margin-bottom:2rem}
.method-card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden;transition:all var(--transition-med)}.method-card:hover{border-color:var(--border-light);box-shadow:var(--shadow-md)}
.method-header{padding:1.25rem 1.5rem;cursor:pointer;display:flex;align-items:center;justify-content:space-between;gap:1rem;user-select:none;transition:background var(--transition-fast)}.method-header:hover{background:var(--bg-card-hover)}
.method-header-left{display:flex;align-items:center;gap:1rem}
.method-number{width:38px;height:38px;border-radius:var(--radius-sm);display:grid;place-items:center;font-family:var(--font-mono);font-size:.85rem;font-weight:700;flex-shrink:0}
.method-header h3{font-size:1.15rem;font-family:var(--font-display)}.method-header .method-when{font-size:.82rem;font-weight:600;color:var(--text-muted);margin-top:.15rem;font-family:var(--font-body)}
.method-chevron{font-size:1.2rem;color:var(--text-muted);transition:transform var(--transition-med);flex-shrink:0}.method-card.open .method-chevron{transform:rotate(180deg)}
.method-body{max-height:0;overflow:hidden;transition:max-height .5s ease,padding .3s ease;padding:0 1.5rem}.method-card.open .method-body{max-height:4000px;padding:0 1.5rem 1.5rem}
.method-section{margin-bottom:1.25rem}.method-section:last-child{margin-bottom:0}
.method-section h4{font-family:var(--font-body);font-size:.82rem;font-weight:700;text-transform:uppercase;letter-spacing:.07em;margin-bottom:.6rem;display:flex;align-items:center;gap:.5rem}
.method-section h4 .dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.method-formula-block{font-family:var(--font-mono);font-size:1.02rem;color:var(--text-primary);background:var(--bg-primary);padding:1rem 1.25rem;border-radius:var(--radius-sm);border:1px solid var(--border-light);line-height:2;margin-bottom:.75rem;overflow-x:auto;white-space:pre-wrap}
.method-prose{font-size:.92rem;color:var(--text-secondary);line-height:1.75}.method-prose code{font-family:var(--font-mono);color:var(--accent-cyan);background:var(--bg-primary);padding:.1rem .35rem;border-radius:3px;font-size:.88em}
.method-walkthrough{background:var(--bg-primary);border:1px solid var(--border-light);border-radius:var(--radius-md);padding:1.25rem}
.walk-step{display:flex;gap:1rem;margin-bottom:.85rem;padding-bottom:.85rem;border-bottom:1px solid var(--border-light)}.walk-step:last-child{margin-bottom:0;padding-bottom:0;border-bottom:none}
.walk-num{width:26px;height:26px;border-radius:50%;display:grid;place-items:center;font-family:var(--font-mono);font-size:.75rem;font-weight:700;flex-shrink:0;margin-top:.1rem}
.walk-content{font-size:.92rem;color:var(--text-secondary);line-height:1.7}.walk-content .math{display:block;font-family:var(--font-mono);color:var(--text-primary);margin:.35rem 0;font-size:1rem}
.tip-box{background:var(--accent-cyan-dim);border:1px solid rgba(57,210,192,.25);border-radius:var(--radius-sm);padding:.85rem 1rem;margin-top:.5rem;font-size:.88rem;color:var(--accent-cyan);line-height:1.65}
.warn-box{background:var(--accent-orange-dim);border:1px solid rgba(240,136,62,.25);border-radius:var(--radius-sm);padding:.85rem 1rem;margin-top:.5rem;font-size:.88rem;color:var(--accent-orange);line-height:1.65}
.decision-tree{background:var(--bg-primary);border:1px solid var(--border);border-radius:var(--radius-md);padding:1.25rem;margin:1rem 0}
.dt-row{display:flex;align-items:flex-start;gap:.75rem;margin-bottom:.6rem}.dt-row:last-child{margin-bottom:0}
.dt-arrow{color:var(--accent-cyan);font-family:var(--font-mono);font-weight:700;font-size:.9rem;flex-shrink:0;margin-top:.15rem}
.dt-text{font-size:.9rem;color:var(--text-secondary);line-height:1.6}.dt-text strong{color:var(--text-primary)}
.problem-container{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:2rem;margin-bottom:1.5rem}
.problem-meta{display:flex;align-items:center;gap:.75rem;margin-bottom:1.25rem;flex-wrap:wrap}
.problem-number{font-family:var(--font-mono);font-size:.8rem;font-weight:700;color:var(--accent-cyan);background:var(--accent-cyan-dim);padding:.25rem .65rem;border-radius:99px}
.problem-difficulty{font-size:.8rem;font-weight:600;padding:.25rem .65rem;border-radius:99px}
.diff-easy{background:var(--accent-green-dim);color:var(--accent-green)}.diff-medium{background:var(--accent-orange-dim);color:var(--accent-orange)}.diff-hard{background:var(--accent-red-dim);color:var(--accent-red)}
.problem-category{font-size:.8rem;color:var(--text-muted);font-weight:600}
.problem-context{font-size:.92rem;color:var(--text-secondary);line-height:1.7;margin-bottom:1rem;padding:.85rem 1rem;background:var(--bg-secondary);border-radius:var(--radius-sm);border-left:3px solid var(--accent-blue)}
.problem-statement{font-size:1.15rem;font-family:var(--font-mono);color:var(--text-primary);background:var(--bg-primary);padding:1.25rem 1.5rem;border-radius:var(--radius-md);border:1px solid var(--border-light);margin-bottom:1.25rem;line-height:1.8;overflow-x:auto}
.problem-hint{font-size:.9rem;color:var(--text-secondary);font-style:italic;margin-bottom:1rem;padding-left:1rem;border-left:3px solid var(--accent-cyan-dim)}
.answer-area{display:flex;gap:.75rem;align-items:stretch;margin-bottom:1rem;flex-wrap:wrap}
.answer-input{flex:1;min-width:200px;padding:.75rem 1rem;font-family:var(--font-mono);font-size:1rem;background:var(--bg-input);border:2px solid var(--border);border-radius:var(--radius-sm);color:var(--text-primary);transition:border-color var(--transition-fast)}
.answer-input::placeholder{color:var(--text-muted)}.answer-input:focus{border-color:var(--accent-cyan);outline:none}
.btn{padding:.75rem 1.5rem;font-family:var(--font-body);font-size:.92rem;font-weight:700;border:none;border-radius:var(--radius-sm);cursor:pointer;transition:all var(--transition-fast);white-space:nowrap}
.btn-primary{background:var(--accent-cyan);color:var(--bg-primary)}.btn-primary:hover{background:#2FC4B3;box-shadow:0 2px 12px rgba(57,210,192,.3)}
.btn-secondary{background:var(--bg-secondary);color:var(--text-secondary);border:1px solid var(--border)}.btn-secondary:hover{border-color:var(--accent-cyan);color:var(--text-primary)}
.btn-ghost{background:transparent;color:var(--accent-cyan);border:1px solid var(--accent-cyan-dim)}.btn-ghost:hover{background:var(--accent-cyan-dim)}
.solution-panel{display:none;margin-top:1.25rem;animation:slideDown .4s ease}.solution-panel.visible{display:block}
@keyframes slideDown{from{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}
.solution-steps{background:var(--bg-primary);border:1px solid var(--border);border-radius:var(--radius-md);padding:1.5rem}
.solution-steps h4{font-family:var(--font-body);font-size:.85rem;font-weight:700;text-transform:uppercase;letter-spacing:.08em;color:var(--accent-cyan);margin-bottom:1rem}
.step{display:flex;gap:1rem;margin-bottom:1rem;padding-bottom:1rem;border-bottom:1px solid var(--border-light)}.step:last-child{border-bottom:none;margin-bottom:0;padding-bottom:0}
.step-num{width:28px;height:28px;background:var(--accent-cyan-dim);color:var(--accent-cyan);font-family:var(--font-mono);font-size:.8rem;font-weight:700;border-radius:50%;display:grid;place-items:center;flex-shrink:0;margin-top:.15rem}
.step-content{font-size:.95rem;line-height:1.7;color:var(--text-secondary)}.step-content .math-line{display:block;font-family:var(--font-mono);color:var(--text-primary);margin:.4rem 0;font-size:1rem}
.feedback{padding:.75rem 1rem;border-radius:var(--radius-sm);font-weight:600;font-size:.92rem;margin-top:.75rem;display:none}
.feedback.correct{display:block;background:var(--accent-green-dim);color:var(--accent-green);border:1px solid rgba(63,185,80,.3)}
.feedback.incorrect{display:block;background:var(--accent-red-dim);color:var(--accent-red);border:1px solid rgba(248,81,73,.3)}
.problem-nav{display:flex;justify-content:space-between;align-items:center;gap:1rem;margin-top:1rem}
.stats-row{display:flex;gap:1rem;flex-wrap:wrap;margin-bottom:1rem}
.stat-card{flex:1;min-width:110px;background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-md);padding:1rem 1.25rem;text-align:center}
.stat-value{font-family:var(--font-mono);font-size:1.8rem;font-weight:700}.stat-label{font-size:.78rem;font-weight:600;color:var(--text-muted);text-transform:uppercase;letter-spacing:.06em;margin-top:.25rem}
.subcategory-bar{display:flex;flex-wrap:wrap;gap:.5rem;margin-bottom:1.5rem}
.subcat-btn{padding:.4rem 1rem;border:1px solid var(--border);background:var(--bg-card);color:var(--text-secondary);font-family:var(--font-body);font-size:.82rem;font-weight:600;border-radius:99px;cursor:pointer;transition:all var(--transition-fast)}
.subcat-btn:hover{border-color:var(--accent-cyan);color:var(--text-primary)}.subcat-btn.active{background:var(--accent-cyan-dim);border-color:var(--accent-cyan);color:var(--accent-cyan)}
.visual-container{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:2rem;margin-bottom:1.5rem}
.visual-controls{display:flex;flex-wrap:wrap;gap:1rem;margin-bottom:1.5rem;align-items:flex-end}
.control-group{display:flex;flex-direction:column;gap:.4rem}.control-group label{font-size:.82rem;font-weight:600;color:var(--text-secondary);text-transform:uppercase;letter-spacing:.05em}
.control-group select{font-family:var(--font-body);font-size:.9rem;padding:.5rem .75rem;background:var(--bg-input);border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text-primary);min-width:200px;cursor:pointer}
.control-group input[type="range"]{-webkit-appearance:none;appearance:none;height:6px;background:var(--border);border-radius:3px;border:none;padding:0;min-width:150px;cursor:pointer}
.control-group input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;background:var(--accent-cyan);border-radius:50%;cursor:pointer}
.canvas-wrapper{background:var(--bg-primary);border:1px solid var(--border-light);border-radius:var(--radius-md);padding:1rem;display:flex;justify-content:center;overflow:hidden}
canvas{display:block;max-width:100%}
.visual-info{margin-top:1rem;padding:1rem 1.25rem;background:var(--bg-primary);border:1px solid var(--border-light);border-radius:var(--radius-sm);font-size:.9rem;color:var(--text-secondary);line-height:1.7}
.visual-info code{font-family:var(--font-mono);color:var(--accent-cyan);background:var(--bg-card);padding:.1rem .4rem;border-radius:3px}
.visual-info .cv{font-family:var(--font-mono);color:var(--accent-orange);font-weight:700}
footer{margin-top:3rem;padding:1.5rem 0;border-top:1px solid var(--border);text-align:center;color:var(--text-muted);font-size:.85rem}
@keyframes popIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}
@media(max-width:768px){.app-container{padding:0 1rem}.header-inner{flex-direction:column;align-items:flex-start}nav[role="tablist"]{width:100%}.card-grid{grid-template-columns:1fr}.problem-container,.visual-container{padding:1.25rem}.controls-bar{flex-direction:column;align-items:flex-start}}
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Source+Sans+3:wght@400;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap');
</style>
</head>
<body>
<a href="#main-content" class="skip-link">Skip to main content</a>
<div class="app-container">
<header><div class="header-inner">
<div class="header-brand"><h1><span class="ii" aria-hidden="true">âˆ«</span> Integration Refresher</h1><p>A comprehensive review for physics &amp; engineering students</p></div>
<nav role="tablist" aria-label="Main sections">
<button class="nav-tab" role="tab" aria-selected="true" aria-controls="panel-reference" id="tab-reference">Reference</button>
<button class="nav-tab" role="tab" aria-selected="false" aria-controls="panel-methods" id="tab-methods">Methods Guide</button>
<button class="nav-tab" role="tab" aria-selected="false" aria-controls="panel-practice" id="tab-practice">Practice</button>
<button class="nav-tab" role="tab" aria-selected="false" aria-controls="panel-visual" id="tab-visual">Visual Demos</button>
</nav></div></header>
<main id="main-content">
<div class="controls-bar">
<div><label id="diff-label">Difficulty Level</label>
<div class="difficulty-group" role="group" aria-labelledby="diff-label">
<button class="diff-btn" aria-pressed="true" data-diff="easy">Easy</button>
<button class="diff-btn" aria-pressed="false" data-diff="medium">Medium</button>
<button class="diff-btn" aria-pressed="false" data-diff="hard">Hard</button>
<button class="diff-btn" aria-pressed="false" data-diff="all">All</button>
</div></div>
<div class="progress-indicator" aria-live="polite"><span id="progress-text">0 / 0 solved</span>
<div class="progress-bar-track" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Progress"><div class="progress-bar-fill" id="progress-fill"></div></div></div>
</div>

<section class="tab-panel" id="panel-reference" role="tabpanel" aria-labelledby="tab-reference" aria-hidden="false">
<div class="subcategory-bar" role="group" aria-label="Filter cards">
<button class="subcat-btn active ref-filter" data-filter="all">All</button>
<button class="subcat-btn ref-filter" data-filter="basic">Basic Rules</button>
<button class="subcat-btn ref-filter" data-filter="technique">Techniques</button>
<button class="subcat-btn ref-filter" data-filter="application">Applications</button>
<button class="subcat-btn ref-filter" data-filter="multi">Multivariable</button>
</div>
<div class="card-grid" id="reference-grid"></div>
</section>

<section class="tab-panel" id="panel-methods" role="tabpanel" aria-labelledby="tab-methods" aria-hidden="true">
<h2 class="section-title"><span class="icon icon-yellow" aria-hidden="true">ğŸ§­</span> Integration Methods Guide</h2>
<p style="color:var(--text-secondary);margin-bottom:.75rem;font-size:.95rem">Click any method to expand its walkthrough with formulas, worked physics/engineering examples, and decision guidance.</p>
<div class="decision-tree" style="margin-bottom:1.5rem">
<h3 style="font-size:1rem;margin-bottom:.85rem;font-family:var(--font-display);color:var(--accent-cyan)">ğŸ”€ Which Method Do I Use? â€” Quick Decision Tree</h3>
<div class="dt-row"><span class="dt-arrow">â†’</span><span class="dt-text"><strong>Product of two types</strong> (polyÃ—trig, polyÃ—eË£, polyÃ—ln)? â†’ <strong>Integration by Parts</strong></span></div>
<div class="dt-row"><span class="dt-arrow">â†’</span><span class="dt-text"><strong>Composite f(g(x))</strong> with g'(x) nearby? â†’ <strong>u-Substitution</strong></span></div>
<div class="dt-row"><span class="dt-arrow">â†’</span><span class="dt-text"><strong>Rational P(x)/Q(x)</strong>, deg(P)&lt;deg(Q)? â†’ <strong>Partial Fractions</strong></span></div>
<div class="dt-row"><span class="dt-arrow">â†’</span><span class="dt-text"><strong>âˆš(aÂ²âˆ’xÂ²), âˆš(aÂ²+xÂ²), âˆš(xÂ²âˆ’aÂ²)</strong>? â†’ <strong>Trig Substitution</strong></span></div>
<div class="dt-row"><span class="dt-arrow">â†’</span><span class="dt-text"><strong>sinâ¿xÂ·cosáµx</strong> or trig powers? â†’ <strong>Trig Identities / Reduction</strong></span></div>
<div class="dt-row"><span class="dt-arrow">â†’</span><span class="dt-text"><strong>Repeated by-parts</strong> with polynomial Ã— eË£/sin/cos? â†’ <strong>Tabular Integration</strong></span></div>
<div class="dt-row"><span class="dt-arrow">â†’</span><span class="dt-text"><strong>No closed form</strong> or measured data? â†’ <strong>Numerical Methods</strong></span></div>
<div class="dt-row"><span class="dt-arrow">â†’</span><span class="dt-text"><strong>Infinite limits / discontinuity</strong>? â†’ <strong>Improper Integral</strong> with limits</span></div>
</div>
<div class="methods-list" id="methods-list"></div>
</section>

<section class="tab-panel" id="panel-practice" role="tabpanel" aria-labelledby="tab-practice" aria-hidden="true">
<div class="stats-row">
<div class="stat-card"><div class="stat-value" style="color:var(--accent-green)" id="stat-correct">0</div><div class="stat-label">Correct</div></div>
<div class="stat-card"><div class="stat-value" style="color:var(--accent-red)" id="stat-incorrect">0</div><div class="stat-label">Incorrect</div></div>
<div class="stat-card"><div class="stat-value" style="color:var(--accent-orange)" id="stat-streak">0</div><div class="stat-label">Streak</div></div>
<div class="stat-card"><div class="stat-value" style="color:var(--accent-blue)" id="stat-total">0</div><div class="stat-label">Attempted</div></div>
</div>
<div class="subcategory-bar" role="group" aria-label="Filter by domain">
<button class="subcat-btn active prob-filter" data-pf="all">All Problems</button>
<button class="subcat-btn prob-filter" data-pf="math">Pure Math</button>
<button class="subcat-btn prob-filter" data-pf="physics">Physics</button>
<button class="subcat-btn prob-filter" data-pf="engineering">Engineering</button>
</div>
<div id="practice-area"></div>
<div class="problem-nav">
<button class="btn btn-secondary" id="btn-prev">â† Previous</button>
<span id="problem-counter" style="color:var(--text-muted);font-family:var(--font-mono);font-size:.9rem"></span>
<button class="btn btn-secondary" id="btn-next">Next â†’</button>
</div>
</section>

<section class="tab-panel" id="panel-visual" role="tabpanel" aria-labelledby="tab-visual" aria-hidden="true">
<h2 class="section-title"><span class="icon icon-blue" aria-hidden="true">ğŸ“</span> Interactive Visualizations</h2>
<div class="visual-container">
<div class="visual-controls">
<div class="control-group"><label for="viz-type">Visualization</label><select id="viz-type">
<option value="area">Area Under Curve</option><option value="riemann">Riemann Sum</option>
<option value="trapezoid">Trapezoidal Rule</option><option value="simpson">Simpson's Rule</option>
<option value="volume-disk">Volume â€” Disk</option><option value="volume-shell">Volume â€” Shell</option>
</select></div>
<div class="control-group"><label for="viz-func">Function</label><select id="viz-func">
<option value="x2">f(x) = xÂ²</option><option value="sinx">f(x) = sin(x)</option>
<option value="sqrtx">f(x) = âˆšx</option><option value="ex">f(x) = eË£</option><option value="1overx">f(x) = 1/x</option>
</select></div>
<div class="control-group"><label for="viz-n">Subdivisions: <strong id="n-display">20</strong></label><input type="range" id="viz-n" min="2" max="100" value="20"></div>
<div class="control-group"><label for="viz-a">a = <strong id="a-display">0.0</strong></label><input type="range" id="viz-a" min="-2" max="4" value="0" step="0.1"></div>
<div class="control-group"><label for="viz-b">b = <strong id="b-display">3.0</strong></label><input type="range" id="viz-b" min="0" max="6" value="3" step="0.1"></div>
<button class="btn btn-primary" id="btn-draw">Draw</button>
</div>
<div class="canvas-wrapper"><canvas id="viz-canvas" width="760" height="460">Your browser does not support canvas.</canvas></div>
<div class="visual-info" id="viz-info" aria-live="polite">Select a visualization and press <strong>Draw</strong>.</div>
</div>
</section>
</main>
<footer><p>Integration Refresher â€” Built for physics &amp; engineering students</p></footer>
</div>
<script>
/* === DATA === */
const REF=[
{cat:'basic',title:'Power Rule',formula:'âˆ« xâ¿ dx = xâ¿âºÂ¹/(n+1) + C,  n â‰  -1',example:'<strong>Ex:</strong> <code>âˆ« xÂ³ dx = xâ´/4 + C</code>'},
{cat:'basic',title:'Constant Multiple',formula:'âˆ« kÂ·f(x) dx = k Â· âˆ« f(x) dx',example:'<strong>Ex:</strong> <code>âˆ« 5xÂ² dx = 5xÂ³/3 + C</code>'},
{cat:'basic',title:'Sum / Difference',formula:'âˆ« [f(x) Â± g(x)] dx = âˆ«f dx Â± âˆ«g dx',example:'<strong>Ex:</strong> <code>âˆ«(xÂ²+3x) dx = xÂ³/3+3xÂ²/2+C</code>'},
{cat:'basic',title:'Exponential',formula:'âˆ« eË£ dx = eË£ + C\nâˆ« aË£ dx = aË£/ln(a) + C',example:'<strong>Ex:</strong> <code>âˆ« 2Ë£ dx = 2Ë£/ln(2)+C</code>'},
{cat:'basic',title:'Natural Log',formula:'âˆ« 1/x dx = ln|x| + C',example:'<strong>Ex:</strong> <code>âˆ«â‚Â³ 1/x dx = ln(3)</code>'},
{cat:'basic',title:'Trig â€” sin & cos',formula:'âˆ« sin(x) dx = -cos(x) + C\nâˆ« cos(x) dx = sin(x) + C',example:'<strong>Ex:</strong> <code>âˆ«â‚€Ï€ sin(x) dx = 2</code>'},
{cat:'basic',title:'Trig â€” sec & csc',formula:'âˆ« secÂ²(x) dx = tan(x) + C\nâˆ« cscÂ²(x) dx = -cot(x) + C',example:'<strong>Ex:</strong> <code>âˆ« secÂ²(x) dx = tan(x)+C</code>'},
{cat:'basic',title:'Inverse Trig',formula:'âˆ« 1/âˆš(1-xÂ²) dx = arcsin(x) + C\nâˆ« 1/(1+xÂ²) dx = arctan(x) + C',example:'<strong>Ex:</strong> <code>âˆ«â‚€Â¹ 1/(1+xÂ²) dx = Ï€/4</code>'},
{cat:'technique',title:'u-Substitution',formula:'âˆ« f(g(x))Â·g\'(x) dx = âˆ« f(u) du\nu = g(x), du = g\'(x) dx',example:'<strong>Ex:</strong> <code>âˆ« 2xÂ·cos(xÂ²) dx</code> â†’ u=xÂ² â†’ <code>sin(xÂ²)+C</code>'},
{cat:'technique',title:'Integration by Parts',formula:'âˆ« u dv = uv âˆ’ âˆ« v du\nLIATE: Log, Inverse trig, Algebraic, Trig, Exp',example:'<strong>Ex:</strong> <code>âˆ« xÂ·eË£ dx = (xâˆ’1)eË£+C</code>'},
{cat:'technique',title:'Trig Substitution',formula:'âˆš(aÂ²âˆ’xÂ²): x = aÂ·sinÎ¸\nâˆš(aÂ²+xÂ²): x = aÂ·tanÎ¸\nâˆš(xÂ²âˆ’aÂ²): x = aÂ·secÎ¸',example:'<strong>Ex:</strong> <code>âˆ«âˆš(4âˆ’xÂ²) dx</code> â†’ x=2sinÎ¸'},
{cat:'technique',title:'Partial Fractions',formula:'P(x)/Q(x) = A/(xâˆ’râ‚) + B/(xâˆ’râ‚‚) + ...\nRepeated: A/(xâˆ’r) + B/(xâˆ’r)Â²',example:'<strong>Ex:</strong> <code>âˆ« 1/(xÂ²âˆ’1) dx = Â½ln|xâˆ’1|âˆ’Â½ln|x+1|+C</code>'},
{cat:'technique',title:'Trig Identities',formula:'sinÂ²x = (1âˆ’cos2x)/2\ncosÂ²x = (1+cos2x)/2\nsinxÂ·cosx = sin(2x)/2',example:'<strong>Ex:</strong> <code>âˆ« sinÂ²x dx = x/2âˆ’sin(2x)/4+C</code>'},
{cat:'technique',title:'Tabular (Repeated Parts)',formula:'Alternating +/âˆ’ columns:\n  Derivatives of polynomial | Integrals of eË£ or trig\nMultiply diagonally and sum.',example:'<strong>Ex:</strong> <code>âˆ« xÂ³eË£ dx</code> â†’ table method gives <code>(xÂ³âˆ’3xÂ²+6xâˆ’6)eË£+C</code>'},
{cat:'technique',title:'Improper Integrals',formula:'âˆ«â‚âˆ f(x) dx = lim(tâ†’âˆ) âˆ«â‚áµ— f(x) dx\nConverges if limit is finite.',example:'<strong>Ex:</strong> <code>âˆ«â‚âˆ 1/xÂ² dx = 1</code> (converges)'},
{cat:'technique',title:'Trapezoidal Rule',formula:'âˆ«â‚áµ‡ f dx â‰ˆ Î”x/2[fâ‚€+2fâ‚+2fâ‚‚+...+2fâ‚™â‚‹â‚+fâ‚™]\nError â‰¤ M(bâˆ’a)Â³/(12nÂ²)',example:'<strong>Numerical:</strong> Use when no closed-form antiderivative exists'},
{cat:'technique',title:'Simpson\'s Rule',formula:'âˆ«â‚áµ‡ f dx â‰ˆ Î”x/3[fâ‚€+4fâ‚+2fâ‚‚+4fâ‚ƒ+...+fâ‚™]\nn must be even. Error â‰¤ M(bâˆ’a)âµ/(180nâ´)',example:'<strong>O(nâ´):</strong> Much more accurate than trapezoidal for smooth functions'},
{cat:'application',title:'Area Between Curves',formula:'A = âˆ«â‚áµ‡ [f(x)âˆ’g(x)] dx, f(x) â‰¥ g(x)',example:'<strong>Ex:</strong> Area between y=x and y=xÂ²: <code>1/6</code>'},
{cat:'application',title:'Volume â€” Disk Method',formula:'V = Ï€ âˆ«â‚áµ‡ [f(x)]Â² dx  (about x-axis)',example:'<strong>Ex:</strong> Rotate y=xÂ², 0â†’1: <code>V=Ï€/5</code>'},
{cat:'application',title:'Volume â€” Shell Method',formula:'V = 2Ï€ âˆ«â‚áµ‡ xÂ·f(x) dx  (about y-axis)',example:'<strong>Ex:</strong> Rotate y=xÂ², 0â†’1: <code>V=Ï€/2</code>'},
{cat:'application',title:'Arc Length',formula:'L = âˆ«â‚áµ‡ âˆš(1+[f\'(x)]Â²) dx',example:'<strong>Ex:</strong> Arc length of y=x^(3/2) from 0 to 4'},
{cat:'application',title:'Work (Physics)',formula:'W = âˆ«â‚áµ‡ F(x) dx\nSprings: F=kx   Gravity: F=mg',example:'<strong>Ex:</strong> Spring k=10: <code>W=âˆ«â‚€â°Â·âµ 10x dx = 1.25 J</code>'},
{cat:'application',title:'Center of Mass',formula:'xÌ„ = (1/M)âˆ«â‚áµ‡ xÂ·Ï(x) dx,  M=âˆ«Ï(x)dx',example:'<strong>Ex:</strong> Rod Ï(x)=x on [0,2]: <code>xÌ„=4/3</code>'},
{cat:'application',title:'Hydrostatic Force',formula:'F = âˆ«â‚áµ‡ ÏÂ·gÂ·w(y)Â·(dâˆ’y) dy',example:'<strong>Engineering:</strong> Force on dam = âˆ« pressure Ã— width dy'},
{cat:'application',title:'Moment of Inertia',formula:'I = âˆ« rÂ² dm = âˆ«â‚áµ‡ xÂ²Â·Ï(x) dx',example:'<strong>Ex:</strong> Thin rod about end: <code>I=MLÂ²/3</code>'},
{cat:'multi',title:'Double Integral',formula:'âˆ¬_R f(x,y) dA = âˆ«â‚áµ‡âˆ«_{c}^{d} f(x,y) dy dx',example:'<strong>Ex:</strong> âˆ¬ xy dA over [0,1]Ã—[0,2] = 1'},
{cat:'multi',title:'Triple Integral',formula:'âˆ­_E f(x,y,z) dV = âˆ«âˆ«âˆ« f dz dy dx',example:'<strong>Ex:</strong> Volume of unit sphere = 4Ï€/3'},
{cat:'multi',title:'Polar Coordinates',formula:'âˆ¬ f dA = âˆ«âˆ« f(rcosÎ¸,rsinÎ¸)Â·r dr dÎ¸\nDon\'t forget the r!',example:'<strong>Ex:</strong> Area of circle r=2: <code>4Ï€</code>'},
{cat:'multi',title:'Spherical Coordinates',formula:'dV = ÏÂ²sin(Ï†) dÏ dÏ† dÎ¸',example:'<strong>Ex:</strong> âˆ«âˆ«âˆ« ÏÂ²sinÏ† dÏ dÏ† dÎ¸ = 4Ï€RÂ³/3'},
{cat:'multi',title:'Line Integral (Vector)',formula:'âˆ«_C FÂ·dr = âˆ«â‚áµ‡ F(r(t))Â·r\'(t) dt',example:'<strong>Physics:</strong> Work = âˆ«_C FÂ·dr along a path'},
{cat:'multi',title:'Green\'s Theorem',formula:'âˆ®_C (Pdx+Qdy) = âˆ¬_D (âˆ‚Q/âˆ‚xâˆ’âˆ‚P/âˆ‚y) dA',example:'<strong>Converts:</strong> line integral â†” double integral'},
{cat:'multi',title:'Stokes\' Theorem',formula:'âˆ®_C FÂ·dr = âˆ¬_S (âˆ‡Ã—F)Â·dS',example:'<strong>Relates:</strong> circulation â†” curl flux through S'},
{cat:'multi',title:'Divergence Theorem',formula:'âˆ¬_S FÂ·dS = âˆ­_E (âˆ‡Â·F) dV',example:'<strong>Relates:</strong> flux through S â†” divergence in E'},
];

const METHODS=[
{id:'usub',num:'1',title:'u-Substitution (Change of Variables)',when:'Inner function g(x) with g\'(x) nearby',color:'--accent-cyan',
formula:'âˆ« f(g(x))Â·g\'(x) dx = âˆ« f(u) du\nu = g(x),  du = g\'(x) dx',
howTo:'Look for a composite function where the derivative of the inner part appears as a factor. Substitute u = g(x), replace dx, integrate, substitute back.',
wt:{title:'Physics â€” RC Circuit Charging',ctx:'Current i(t) = (Vâ‚€/R)e^(âˆ’t/RC). Find charge q(t) = âˆ« i(t) dt.',
steps:[{t:'Set up:',m:'q = âˆ« (Vâ‚€/R)e^(âˆ’t/RC) dt'},{t:'Let u = âˆ’t/(RC), du = âˆ’dt/(RC):',m:'= (Vâ‚€/R)(âˆ’RC) âˆ« eáµ˜ du = âˆ’Vâ‚€CÂ·eáµ˜'},{t:'Substitute back & apply q(0)=0:',m:'q(t) = Vâ‚€C(1 âˆ’ e^(âˆ’t/RC))'}]},
tips:'If g\'(x) is off by a constant, adjust with the constant. Try this method first â€” it\'s the most common!',
warn:'Don\'t forget to change limits for definite integrals. Replace ALL x-terms before integrating.'},

{id:'byparts',num:'2',title:'Integration by Parts',when:'Product of two different types (polyÃ—eË£, polyÃ—trig, polyÃ—ln)',color:'--accent-orange',
formula:'âˆ« u dv = uv âˆ’ âˆ« v du\n\nLIATE priority (choose u first):\n  L-Logarithmic  I-Inverse trig  A-Algebraic  T-Trig  E-Exponential',
howTo:'Pick u using LIATE (higher = better u). Set dv as everything else. Differentiate u â†’ du, integrate dv â†’ v, apply formula.',
wt:{title:'Engineering â€” Beam Moment Calculation',ctx:'Bending moment: M = âˆ«â‚€á´¸ xÂ·wâ‚€sin(Ï€x/L) dx for a beam with sinusoidal load.',
steps:[{t:'u = x, dv = wâ‚€sin(Ï€x/L)dx:',m:'du = dx, v = âˆ’wâ‚€L/Ï€Â·cos(Ï€x/L)'},{t:'Apply formula:',m:'= âˆ’wâ‚€Lx/Ï€Â·cos(Ï€x/L) + wâ‚€L/Ï€ âˆ«cos(Ï€x/L)dx'},{t:'Integrate remaining:',m:'= âˆ’wâ‚€Lx/Ï€Â·cos(Ï€x/L) + wâ‚€LÂ²/Ï€Â²Â·sin(Ï€x/L)'},{t:'Evaluate [0,L]: sin(Ï€)=0, cos(Ï€)=âˆ’1:',m:'M = wâ‚€LÂ²/Ï€'}]},
tips:'If by-parts cycles back to the original (eË£sin, eË£cos), call it I and solve algebraically. For polynomials Ã— eË£/trig, consider tabular method.',
warn:'Wrong choice of u makes it harder. If âˆ«v du is more complex than the original, swap.'},

{id:'tabular',num:'3',title:'Tabular Integration (Repeated By Parts)',when:'Polynomial Ã— eË£ or sin/cos â€” needs multiple rounds',color:'--accent-green',
formula:'Two columns with alternating +/âˆ’ signs:\n  Derivatives of poly â†’ 0 | Successive integrals of eË£/trig\nMultiply diagonally, sum all products.',
howTo:'List derivatives of polynomial until 0. List antiderivatives of other factor. Multiply diagonally with alternating signs and sum.',
wt:{title:'Physics â€” Impulse from Time-Varying Thrust',ctx:'Rocket thrust F(t) = tÂ²e^(âˆ’t). Total impulse J = âˆ«â‚€âˆ tÂ²e^(âˆ’t) dt.',
steps:[{t:'Table: +tÂ²Ã—e^(âˆ’t), âˆ’2tÃ—(âˆ’e^(âˆ’t)), +2Ã—e^(âˆ’t):',m:'+tÂ²(âˆ’e^(âˆ’t)) âˆ’ 2t(e^(âˆ’t)) + 2(âˆ’e^(âˆ’t))'},{t:'Simplify:',m:'= âˆ’e^(âˆ’t)(tÂ²+2t+2) + C'},{t:'Evaluate [0,âˆ): e^(âˆ’âˆ)â†’0, at t=0: âˆ’(0+0+2)(1)=âˆ’2:',m:'J = 0âˆ’(âˆ’2) = 2 (this is Î“(3) = 2!)'}]},
tips:'Massive time-saver for âˆ«xâ¿eáµƒË£ dx and âˆ«xâ¿sin(ax) dx. The table replaces many rounds of by-parts visually.',
warn:'Only works when one factor differentiates to 0 (polynomials). For ln(x)Â·eË£, use standard by-parts.'},

{id:'partial',num:'4',title:'Partial Fraction Decomposition',when:'Rational function P(x)/Q(x), Q factorable, deg(P)<deg(Q)',color:'--accent-purple',
formula:'Distinct linear: P/[(xâˆ’a)(xâˆ’b)] = A/(xâˆ’a) + B/(xâˆ’b)\nRepeated: P/(xâˆ’a)Â² = A/(xâˆ’a) + B/(xâˆ’a)Â²\nQuadratic: (Ax+B)/(xÂ²+bx+c)',
howTo:'Factor denominator. Set up partial fractions with unknowns. Multiply through, substitute roots (or compare coefficients) to solve. Integrate each simple fraction.',
wt:{title:'Engineering â€” Transfer Function (Controls)',ctx:'Inverse Laplace: decompose (2s+1)/[s(s+1)(s+3)].',
steps:[{t:'Setup:',m:'A/s + B/(s+1) + C/(s+3)'},{t:'Multiply through, plug in s=0,âˆ’1,âˆ’3:',m:'A=1/3, B=1/2, C=âˆ’5/6'},{t:'Integrate:',m:'(1/3)ln|s|+(1/2)ln|s+1|âˆ’(5/6)ln|s+3|+K'}]},
tips:'If deg(P)â‰¥deg(Q), do long division first. The "cover-up method" (plugging roots) is fastest for linear factors.',
warn:'Don\'t forget (Ax+B) numerator for irreducible quadratics like (xÂ²+1).'},

{id:'trigsub',num:'5',title:'Trig Substitution',when:'Contains âˆš(aÂ²âˆ’xÂ²), âˆš(aÂ²+xÂ²), or âˆš(xÂ²âˆ’aÂ²)',color:'--accent-blue',
formula:'âˆš(aÂ²âˆ’xÂ²): x=asinÎ¸ â†’ âˆš=acosÎ¸\nâˆš(aÂ²+xÂ²): x=atanÎ¸ â†’ âˆš=asecÎ¸\nâˆš(xÂ²âˆ’aÂ²): x=asecÎ¸ â†’ âˆš=atanÎ¸',
howTo:'Identify radical form, make substitution, replace dx and radical, integrate in Î¸, back-substitute using reference triangle.',
wt:{title:'Physics â€” Electric Field of Charged Ring',ctx:'E-field involves âˆ« dx/(xÂ²+RÂ²)^(3/2). Evaluate using trig sub.',
steps:[{t:'Form âˆš(xÂ²+aÂ²): let x=RtanÎ¸:',m:'dx = RsecÂ²Î¸ dÎ¸, âˆš(xÂ²+RÂ²) = RsecÎ¸'},{t:'Substitute:',m:'âˆ« RsecÂ²Î¸/(RsecÎ¸)Â³ dÎ¸ = (1/RÂ²)âˆ«cosÎ¸ dÎ¸'},{t:'Integrate & back-sub:',m:'= sinÎ¸/RÂ² = x/(RÂ²âˆš(xÂ²+RÂ²)) + C'}]},
tips:'Draw reference triangle for back-substitution. Complete the square first if radical has xÂ²+bx+c.',
warn:'Pay attention to domain. Don\'t forget to change limits for definite integrals.'},

{id:'trigident',num:'6',title:'Trig Powers & Reduction Formulas',when:'sinâ¿xÂ·cosáµx, tanâ¿xÂ·secáµx, etc.',color:'--accent-red',
formula:'sinÂ²x = (1âˆ’cos2x)/2,  cosÂ²x = (1+cos2x)/2\nOdd power: peel one off, use sinÂ²+cosÂ²=1, u-sub\nReduction: âˆ«sinâ¿x dx = âˆ’(1/n)sinâ¿â»Â¹xÂ·cosx + (nâˆ’1)/n âˆ«sinâ¿â»Â²x dx',
howTo:'Odd exponent: peel off one factor, Pythagorean identity, then u-sub. Both even: half-angle identities to reduce powers.',
wt:{title:'Physics â€” RMS Value of AC Voltage',ctx:'V_rms = âˆš(1/T Â· âˆ«(0â†’T) Vâ‚€Â²sinÂ²(Ï‰t) dt). Evaluate the integral.',
steps:[{t:'Half-angle: sinÂ²(Ï‰t) = (1âˆ’cos(2Ï‰t))/2:',m:'âˆ«(0â†’T) Vâ‚€Â²(1âˆ’cos(2Ï‰t))/2 dt'},{t:'Integrate (cos termâ†’0 over full period):',m:'= Vâ‚€Â²T/2'},{t:'V_rms = âˆš(Vâ‚€Â²/2):',m:'V_rms = Vâ‚€/âˆš2 â‰ˆ 0.707Â·Vâ‚€'}]},
tips:'Wallis\' formulas give direct results for âˆ«â‚€^(Ï€/2) sinâ¿x dx. For even powers, repeated half-angle always works.',
warn:'When peeling off a factor, the remaining power must be even for Pythagorean identity to work.'},

{id:'numerical',num:'7',title:'Numerical Integration Methods',when:'No closed-form antiderivative, or using measured data',color:'--accent-yellow',
formula:'Trapezoidal (O(nâ»Â²)):\n  âˆ«f dx â‰ˆ Î”x/2[fâ‚€+2fâ‚+...+2fâ‚™â‚‹â‚+fâ‚™]\nSimpson\'s (O(nâ»â´), n even):\n  âˆ«f dx â‰ˆ Î”x/3[fâ‚€+4fâ‚+2fâ‚‚+4fâ‚ƒ+...+fâ‚™]\nMidpoint (O(nâ»Â²)):\n  âˆ«f dx â‰ˆ Î”xÂ·Î£f(xÌ„áµ¢)',
howTo:'Divide [a,b] into n subintervals. Evaluate f at required points. Apply weighted sum formula. Simpson\'s is best for smooth functions.',
wt:{title:'Engineering â€” Heat Transfer from Sensor Data',ctx:'Thermocouple: x=[0,2,4,6,8]cm, T=[100,85,68,52,40]Â°C. Estimate âˆ«â‚€â¸ T(x)dx by Simpson\'s.',
steps:[{t:'n=4, Î”x=2:',m:'â‰ˆ (2/3)[100+4(85)+2(68)+4(52)+40]'},{t:'Calculate:',m:'= (2/3)[100+340+136+208+40]=(2/3)(824)'},{t:'Result:',m:'â‰ˆ 549.3 Â°CÂ·cm'}]},
tips:'Simpson\'s is exact for polynomials up to degree 3. For measured data with even intervals, it\'s the go-to choice.',
warn:'Simpson\'s requires even n. Noisy data accumulates error â€” consider smoothing first.'},

{id:'improper',num:'8',title:'Improper Integrals',when:'Infinite limits or discontinuity in integrand',color:'--accent-cyan',
formula:'âˆ«â‚âˆ f dx = lim(tâ†’âˆ) âˆ«â‚áµ— f dx\nâˆ«â‚áµ‡ with discont. at c: split at c, take limits\np-test: âˆ«â‚âˆ 1/xáµ– dx converges iff p > 1',
howTo:'Replace problematic bound with variable t. Evaluate proper integral. Take limit. Finite limit = convergence.',
wt:{title:'Physics â€” Gravitational Potential Energy',ctx:'Derive U(R) = work to bring mass m from âˆ to R: W = âˆ«á´¿âˆ (âˆ’GMm/rÂ²) dr.',
steps:[{t:'Integrate:',m:'âˆ’GMmÂ·[âˆ’1/r] from R to âˆ = âˆ’GMm(0âˆ’(âˆ’1/R))'},{t:'Simplify:',m:'= âˆ’GMm/R'},{t:'This is gravitational PE (negative = bound):',m:'U(R) = âˆ’GMm/R'}]},
tips:'âˆ«â‚âˆ 1/xáµ–: converges if p>1, diverges if pâ‰¤1. The Gamma function Î“(n) = âˆ«â‚€âˆ xâ¿â»Â¹e^(âˆ’x)dx generalizes the factorial.',
warn:'Don\'t "plug in âˆ" â€” you must write lim notation. Watch for hidden discontinuities inside [a,b].'},
];

const PROBLEMS=[
{diff:'easy',cat:'Basic',dom:'math',statement:'âˆ« 4xÂ³ dx',hint:'Power rule.',answer:'x^4+C',alt:['x^4 + C']},
{diff:'easy',cat:'Basic',dom:'math',statement:'âˆ« cos(x) dx',hint:'What has derivative cos(x)?',answer:'sin(x)+C',alt:['sin(x) + C']},
{diff:'easy',cat:'Basic',dom:'math',statement:'âˆ« (3xÂ²+2xâˆ’1) dx',hint:'Integrate each term.',answer:'x^3+x^2-x+C',alt:['x^3 + x^2 - x + C']},
{diff:'easy',cat:'Basic',dom:'math',statement:'âˆ«(0 to 1) 2x dx',hint:'Power rule, evaluate [0,1].',answer:'1',alt:['1.0'],steps:[{text:'âˆ«2x dx = xÂ². Evaluate:',math:'[xÂ²] from 0 to 1 = 1'}]},
{diff:'easy',cat:'Basic',dom:'math',statement:'âˆ« 1/(1+xÂ²) dx',hint:'Standard inverse trig.',answer:'arctan(x)+C',alt:['atan(x)+C']},
{diff:'easy',cat:'Kinematics',dom:'physics',ctx:'A ball dropped from rest has v(t)=9.8t m/s. Find distance fallen in 3 seconds.',statement:'âˆ«(0 to 3) 9.8t dt',hint:'Integrate velocity â†’ displacement.',answer:'44.1',alt:['44.1 m'],steps:[{text:'9.8Â·[tÂ²/2] from 0 to 3 = 9.8Ã—4.5:',math:'= 44.1 m'}]},
{diff:'easy',cat:'Circuits',dom:'engineering',ctx:'Constant current i=5A for 2 seconds. Find charge q=âˆ«i dt.',statement:'âˆ«(0 to 2) 5 dt',hint:'âˆ« constant = constant Ã— t.',answer:'10',alt:['10 C'],steps:[{text:'5Ã—[t] from 0 to 2 = 10 C',math:'q = 10 coulombs'}]},
{diff:'easy',cat:'Kinematics',dom:'physics',ctx:'Acceleration a(t)=6t m/sÂ². Starting from rest, find velocity at t=2s.',statement:'âˆ« from 0 to 2 of 6t dt',hint:'âˆ«6t dt = 3tÂ². Evaluate at t=2.',answer:'12',alt:['12 m/s'],steps:[{text:'v = âˆ«(0â†’2) 6t dt = [3tÂ²](0â†’2):',math:'= 3(4) = 12 m/s'}]},

{diff:'medium',cat:'u-Substitution',dom:'math',statement:'âˆ« xÂ·sin(xÂ²) dx',hint:'Let u=xÂ².',answer:'-cos(x^2)/2+C',alt:['-(1/2)cos(x^2)+C'],steps:[{text:'u=xÂ², du=2x dx:',math:'Â½âˆ«sin(u)du = âˆ’cos(xÂ²)/2+C'}]},
{diff:'medium',cat:'By Parts',dom:'math',statement:'âˆ« xÂ·eË£ dx',hint:'u=x, dv=eË£dx.',answer:'(x-1)e^x+C',alt:['xe^x-e^x+C'],steps:[{text:'uvâˆ’âˆ«vdu:',math:'xeË£âˆ’eË£+C = (xâˆ’1)eË£+C'}]},
{diff:'medium',cat:'Trig Identity',dom:'math',statement:'âˆ« sinÂ²(x) dx',hint:'sinÂ²x = (1âˆ’cos2x)/2.',answer:'x/2-sin(2x)/4+C',alt:['x/2 - sin(2x)/4 + C'],steps:[{text:'Half-angle â†’ integrate:',math:'x/2 âˆ’ sin(2x)/4 + C'}]},
{diff:'medium',cat:'u-Sub',dom:'math',statement:'âˆ« 2x/(xÂ²+1) dx',hint:'Let u=xÂ²+1.',answer:'ln(x^2+1)+C',alt:['ln|x^2+1|+C'],steps:[{text:'u=xÂ²+1, du=2x dx:',math:'âˆ«du/u = ln(xÂ²+1)+C'}]},
{diff:'medium',cat:'Braking',dom:'physics',ctx:'A car brakes: v(t)=20âˆ’5t m/s. Distance before stopping at t=4s?',statement:'âˆ«(0 to 4) (20âˆ’5t) dt',hint:'Integrate term by term.',answer:'40',alt:['40 m'],steps:[{text:'[20tâˆ’5tÂ²/2] from 0 to 4:',math:'= 80âˆ’40 = 40 m'}]},
{diff:'medium',cat:'Spring Work',dom:'physics',ctx:'Spring k=10 N/m compressed 0.5m. Find work W=âˆ«kx dx.',statement:'âˆ«(0 to 0.5) 10x dx',hint:'Power rule on 10x.',answer:'1.25',alt:['5/4','1.25 J'],steps:[{text:'10Â·[xÂ²/2] from 0 to 0.5 = 5(0.25):',math:'W = 1.25 J'}]},
{diff:'medium',cat:'RC Circuit',dom:'engineering',ctx:'Total charge on capacitor: q = âˆ«(0â†’âˆ) (Vâ‚€/R)e^(âˆ’t/RC) dt. Evaluate (Vâ‚€=12V, R=1kÎ©, C=100Î¼F).',statement:'âˆ«(0 to âˆ) (Vâ‚€/R)Â·e^(âˆ’t/RC) dt',hint:'Antiderivative of e^(âˆ’t/RC) is âˆ’RCÂ·e^(âˆ’t/RC).',answer:'V0*C',alt:['Vâ‚€C','0.0012','1.2e-3'],steps:[{text:'(Vâ‚€/R)Â·[âˆ’RCÂ·e^(âˆ’t/RC)] from 0 to âˆ:',math:'= Vâ‚€C(1âˆ’0) = Vâ‚€C = 1.2 mC'}]},
{diff:'medium',cat:'Entropy',dom:'engineering',ctx:'Ideal gas entropy: Î”S = nR Â· âˆ«(300â†’600) (1/T) dT. With n=1, R=8.314.',statement:'âˆ«(300 to 600) 8.314/T dT',hint:'âˆ«1/T = lnT.',answer:'5.76',alt:['5.76 J/K','5.763'],steps:[{text:'8.314Â·[ln T] from 300 to 600:',math:'= 8.314Â·ln(2) â‰ˆ 5.76 J/K'}]},
{diff:'medium',cat:'Beam Loading',dom:'engineering',ctx:'Simply supported beam: max moment from âˆ«(0â†’L/2) wâ‚€(L/2âˆ’x) dx.',statement:'âˆ«(0 to L/2) wâ‚€(L/2âˆ’x) dx',hint:'Integrate (L/2âˆ’x) term by term.',answer:'w0*L^2/8',alt:['wâ‚€LÂ²/8'],steps:[{text:'wâ‚€Â·[(L/2)xâˆ’xÂ²/2] from 0 to L/2:',math:'= wâ‚€(LÂ²/4âˆ’LÂ²/8) = wâ‚€LÂ²/8'}]},
{diff:'medium',cat:'Reliability',dom:'engineering',ctx:'Exponential PDF f(t)=Î»e^(âˆ’Î»t). Verify âˆ«(0â†’âˆ) f(t) dt = 1.',statement:'âˆ«(0 to âˆ) Î»e^(âˆ’Î»t) dt',hint:'Antiderivative: âˆ’e^(âˆ’Î»t).',answer:'1',alt:['1.0'],steps:[{text:'[âˆ’e^(âˆ’Î»t)] from 0 to âˆ:',math:'= 0âˆ’(âˆ’1) = 1 âœ“'}]},

{diff:'hard',cat:'Trig Sub',dom:'math',statement:'âˆ« 1/âˆš(4âˆ’xÂ²) dx',hint:'x=2sinÎ¸.',answer:'arcsin(x/2)+C',alt:['asin(x/2)+C'],steps:[{text:'x=2sinÎ¸, âˆš(4âˆ’xÂ²)=2cosÎ¸:',math:'âˆ«dÎ¸ = arcsin(x/2)+C'}]},
{diff:'hard',cat:'Repeated Parts',dom:'math',statement:'âˆ« xÂ²Â·eË£ dx',hint:'By parts twice or tabular method.',answer:'(x^2-2x+2)e^x+C',alt:['e^x(x^2-2x+2)+C'],steps:[{text:'Tabular: +xÂ²eË£âˆ’2xeË£+2eË£:',math:'= (xÂ²âˆ’2x+2)eË£+C'}]},
{diff:'hard',cat:'By Parts',dom:'math',statement:'âˆ« ln(x) dx',hint:'u=ln(x), dv=dx.',answer:'xln(x)-x+C',alt:['x*ln(x)-x+C','xlnx-x+C'],steps:[{text:'u=lnx, v=x:',math:'xlnxâˆ’âˆ«dx = xlnxâˆ’x+C'}]},
{diff:'hard',cat:'Partial Fractions',dom:'math',statement:'âˆ« 1/(xÂ²âˆ’1) dx',hint:'Factor (xâˆ’1)(x+1).',answer:'(1/2)ln|x-1|-(1/2)ln|x+1|+C',alt:['(1/2)ln|(x-1)/(x+1)|+C'],steps:[{text:'A=1/2, B=âˆ’1/2:',math:'Â½ln|xâˆ’1|âˆ’Â½ln|x+1|+C'}]},
{diff:'hard',cat:'Disk Volume',dom:'math',statement:'V = Ï€ Â· âˆ«(0 to 1) xâ´ dx',hint:'Power rule on xâ´.',answer:'pi/5',alt:['Ï€/5','0.628'],steps:[{text:'Ï€Â·[xâµ/5] from 0 to 1:',math:'= Ï€/5'}]},
{diff:'hard',cat:'Double Integral',dom:'math',statement:'âˆ«(0 to 1) âˆ«(0 to 2) xy dy dx',hint:'Inner first: âˆ«xy dy.',answer:'1',alt:['1.0'],steps:[{text:'Inner: xÂ·[yÂ²/2](0â†’2)=2x. Outer: [xÂ²](0â†’1):',math:'= 1'}]},
{diff:'hard',cat:'Gauss\'s Law',dom:'physics',ctx:'Electric field inside uniformly charged sphere: q_enc = 4Ï€Ïâ‚€ Â· âˆ«(0â†’R) rÂ² dr. Find the integral.',statement:'âˆ«(0 to R) rÂ² dr',hint:'Power rule: âˆ«rÂ²dr = rÂ³/3.',answer:'R^3/3',alt:['RÂ³/3'],steps:[{text:'[rÂ³/3] from 0 to R = RÂ³/3',math:'q_enc = (4/3)Ï€RÂ³Ïâ‚€ â†’ E = Ïâ‚€R/(3Îµâ‚€)'}]},
{diff:'hard',cat:'Hydrostatic Force',dom:'engineering',ctx:'Force on rectangular dam (width w, height H): F = âˆ«(0â†’H) ÏgÂ·wÂ·(Hâˆ’y) dy.',statement:'âˆ«(0 to H) Ïgw(Hâˆ’y) dy',hint:'Expand and integrate (Hâˆ’y).',answer:'ÏgwH^2/2',alt:['rho*g*w*H^2/2','pgwHÂ²/2'],steps:[{text:'ÏgwÂ·[Hyâˆ’yÂ²/2] from 0 to H:',math:'= Ïgw(HÂ²âˆ’HÂ²/2) = Â½ÏgwHÂ²'}]},
{diff:'hard',cat:'Moment of Inertia',dom:'engineering',ctx:'Thin rod (mass M, length L) about one end: I=âˆ«xÂ²dm, dm=(M/L)dx.',statement:'âˆ«(0 to L) (M/L)xÂ² dx',hint:'Factor M/L, power rule on xÂ².',answer:'ML^2/3',alt:['MLÂ²/3'],steps:[{text:'(M/L)Â·[xÂ³/3] from 0 to L:',math:'= (M/L)(LÂ³/3) = MLÂ²/3'}]},
{diff:'hard',cat:'AC Power',dom:'physics',ctx:'Average power: P = (1/T)Â·âˆ«(0â†’T) Vâ‚€Â²sinÂ²(Ï‰t)/R dt. Evaluate âˆ«(0â†’T) Vâ‚€Â²sinÂ²(Ï‰t) dt.',statement:'âˆ«(0 to T) Vâ‚€Â²sinÂ²(Ï‰t) dt',hint:'Half-angle identity. cos term vanishes over full period.',answer:'V0^2*T/2',alt:['Vâ‚€Â²T/2'],steps:[{text:'Vâ‚€Â²(1âˆ’cos2Ï‰t)/2 integrated:',math:'Vâ‚€Â²/2Â·[tâˆ’sin(2Ï‰t)/(2Ï‰)] from 0 to T = Vâ‚€Â²T/2'}]},
{diff:'hard',cat:'Gravity',dom:'physics',ctx:'Gravitational PE: W = âˆ«(Râ†’âˆ) (âˆ’GMm/rÂ²) dr.',statement:'âˆ«(R to âˆ) âˆ’GMm/rÂ² dr',hint:'âˆ«râ»Â² dr = âˆ’râ»Â¹. Improper integral.',answer:'-GMm/R',alt:['GMm/R'],steps:[{text:'âˆ’GMm[âˆ’1/r]á´¿âˆ:',math:'= âˆ’GMm(0âˆ’(âˆ’1/R)) = âˆ’GMm/R'}]},
{diff:'hard',cat:'Polar',dom:'math',statement:'âˆ«(0 to 2Ï€) âˆ«(0 to 3) rÂ² dr dÎ¸',hint:'Inner âˆ«rÂ²dr, then outer âˆ«dÎ¸.',answer:'18pi',alt:['18Ï€','56.55'],steps:[{text:'Inner: 9. Outer: 9Â·2Ï€:',math:'= 18Ï€'}]},
{diff:'medium',cat:'Trapezoidal Rule',dom:'math',ctx:'Use the trapezoidal rule with n=4 to approximate âˆ«(0 to 2) xÂ² dx. Compare to the exact answer of 8/3.',statement:'Trap. Rule: n=4, Î”x=0.5, f(x)=xÂ² on [0,2]',hint:'T = Î”x/2Â·[f(0)+2f(0.5)+2f(1)+2f(1.5)+f(2)]. Compute each f value.',answer:'2.75',alt:['11/4','2.750'],steps:[{text:'f values: f(0)=0, f(0.5)=0.25, f(1)=1, f(1.5)=2.25, f(2)=4:',math:'T = 0.5/2Â·[0 + 2(0.25) + 2(1) + 2(2.25) + 4]'},{text:'Compute:',math:'= 0.25Â·[0 + 0.5 + 2 + 4.5 + 4] = 0.25Â·11 = 2.75'},{text:'Exact: 8/3 â‰ˆ 2.667. Error â‰ˆ 0.083 (overestimate since xÂ² is concave up).',math:'Error = 2.75 âˆ’ 2.667 = 0.083'}]},
{diff:'hard',cat:'Simpson\'s Rule',dom:'engineering',ctx:'A strain gauge records stress Ïƒ at positions along a beam: x=[0,1,2,3,4] m, Ïƒ=[0,12,20,18,0] MPa. Estimate âˆ«(0 to 4) Ïƒ(x) dx using Simpson\'s rule.',statement:'Simpson\'s: Î”x=1, values [0,12,20,18,0]',hint:'S = Î”x/3Â·[fâ‚€ + 4fâ‚ + 2fâ‚‚ + 4fâ‚ƒ + fâ‚„]. n=4 (even âœ“).',answer:'53.33',alt:['160/3','53.3','53.333'],steps:[{text:'Apply Simpson\'s with Î”x=1:',math:'S = 1/3Â·[0 + 4(12) + 2(20) + 4(18) + 0]'},{text:'Compute:',math:'= 1/3Â·[0 + 48 + 40 + 72 + 0] = 160/3 â‰ˆ 53.33'}]},
{diff:'medium',cat:'Trapezoidal Rule',dom:'physics',ctx:'A rocket\'s thrust is measured at 1-second intervals: t=[0,1,2,3,4]s, F=[0,120,200,150,0] N. Estimate the total impulse J = âˆ«(0 to 4) F(t) dt using the trapezoidal rule.',statement:'Trap. Rule: Î”t=1, F=[0,120,200,150,0] N',hint:'T = Î”t/2Â·[Fâ‚€ + 2Fâ‚ + 2Fâ‚‚ + 2Fâ‚ƒ + Fâ‚„].',answer:'470',alt:['470 NÂ·s','470.0'],steps:[{text:'Apply trapezoidal rule with Î”t=1:',math:'T = 1/2Â·[0 + 2(120) + 2(200) + 2(150) + 0]'},{text:'Compute:',math:'= 0.5Â·[0 + 240 + 400 + 300 + 0] = 0.5Â·940 = 470'},{text:'Total impulse J â‰ˆ 470 NÂ·s. By impulse-momentum theorem:',math:'J = Î”p = 470 NÂ·s'}]},
{diff:'hard',cat:'Tabular Method',dom:'math',ctx:'Use the tabular method (repeated integration by parts) to evaluate this integral.',statement:'âˆ« xÂ³Â·cos(x) dx',hint:'Derivatives of xÂ³: 3xÂ², 6x, 6, 0. Integrals of cos(x): sin(x), âˆ’cos(x), âˆ’sin(x), cos(x). Alternate signs.',answer:'(x^3-6x)sin(x)+(3x^2-6)cos(x)+C',alt:['x^3*sinx-3x^2*cosx-6x*sinx+6cosx+C'],steps:[{text:'Tabular: +xÂ³Â·sin(x), âˆ’3xÂ²Â·(âˆ’cos(x)), +6xÂ·(âˆ’sin(x)), âˆ’6Â·cos(x):',math:'+xÂ³sin(x) + 3xÂ²cos(x) âˆ’ 6xsin(x) âˆ’ 6cos(x) + C'},{text:'Group:',math:'= (xÂ³âˆ’6x)sin(x) + (3xÂ²âˆ’6)cos(x) + C'}]},
];

const METHOD_MAP={"Basic":"Power Rule / Basic Integration","Kinematics":"Power Rule (applied to physics)","Circuits":"Constant Integration","u-Substitution":"u-Substitution","u-Sub":"u-Substitution","By Parts":"Integration by Parts (LIATE)","Trig Identity":"Trig Identity (Half-Angle)","Area":"Definite Integral â€” Area","Braking":"Power Rule (applied to kinematics)","Spring Work":"Power Rule (applied to workâ€“energy)","RC Circuit":"u-Substitution + Improper Integral","Entropy":"Logarithmic Integration (âˆ«1/T dT)","Beam Loading":"Power Rule (applied to structural eng.)","Reliability":"Improper Integral (exponential decay)","Trig Sub":"Trig Substitution (âˆš(aÂ²âˆ’xÂ²) form)","Repeated Parts":"Tabular Integration (repeated by-parts)","Tabular Method":"Tabular Integration (repeated by-parts)","Partial Fractions":"Partial Fraction Decomposition","Disk Volume":"Disk Method (volume of revolution)","Double Integral":"Iterated Double Integral","Gauss's Law":"Power Rule (applied to Gauss's Law)","Hydrostatic Force":"Power Rule (applied to fluid statics)","Moment of Inertia":"Power Rule (applied to rotational dynamics)","AC Power":"Trig Identity (Half-Angle) + Definite Integral","Gravity":"Improper Integral (gravitational PE)","Polar":"Iterated Integral in Polar Coordinates","Trapezoidal Rule":"Numerical â€” Trapezoidal Rule","Simpson's Rule":"Numerical â€” Simpson's Rule"};
/* === STATE === */
const S={tab:'reference',diff:'easy',pi:0,fp:[],solved:new Set(),ok:0,bad:0,streak:0,rf:'all',pf:'all'};
const $=s=>document.querySelector(s), $$=s=>[...document.querySelectorAll(s)];

/* === TABS === */
$$('.nav-tab').forEach(t=>t.addEventListener('click',()=>{
  $$('.nav-tab').forEach(x=>x.setAttribute('aria-selected','false'));t.setAttribute('aria-selected','true');
  const p=t.getAttribute('aria-controls');$$('.tab-panel').forEach(x=>x.setAttribute('aria-hidden','true'));$('#'+p).setAttribute('aria-hidden','false');
  S.tab=p.replace('panel-','');if(S.tab==='visual')drawViz();
}));

/* === DIFFICULTY === */
$$('.diff-btn').forEach(b=>b.addEventListener('click',()=>{
  $$('.diff-btn').forEach(x=>x.setAttribute('aria-pressed','false'));b.setAttribute('aria-pressed','true');
  S.diff=b.dataset.diff;filterP();renderP();renderCards();
}));
function filterP(){
  let p=S.diff==='all'?[...PROBLEMS]:PROBLEMS.filter(x=>x.diff===S.diff);
  if(S.pf!=='all')p=p.filter(x=>x.dom===S.pf);S.fp=p;S.pi=0;updateProg();
}

/* === REF CARDS === */
function renderCards(){
  const g=$('#reference-grid'),f=S.rf,d=S.diff;
  const dm={easy:['basic'],medium:['basic','technique'],hard:['basic','technique','application','multi'],all:['basic','technique','application','multi']};
  const ac=dm[d]||dm.all;
  const cs=REF.filter(c=>(f==='all'||c.cat===f)&&ac.includes(c.cat));
  const tl={basic:'Basic',technique:'Technique',application:'Application',multi:'Multivariable'};
  g.innerHTML=cs.map(c=>`<article class="formula-card cat-${c.cat}" tabindex="0"><div class="card-header"><span class="card-title">${c.title}</span><span class="card-tag tag-${c.cat}">${tl[c.cat]}</span></div><pre class="card-formula">${c.formula}</pre><div class="card-example">${c.example}</div></article>`).join('');
}
$$('.ref-filter').forEach(b=>b.addEventListener('click',()=>{$$('.ref-filter').forEach(x=>x.classList.remove('active'));b.classList.add('active');S.rf=b.dataset.filter;renderCards();}));

/* === METHODS GUIDE === */
function renderMethods(){
  $('#methods-list').innerHTML=METHODS.map(m=>{
    const c=`var(${m.color})`,cd=`var(${m.color}-dim)`;
    return`<div class="method-card" id="m-${m.id}">
    <div class="method-header" role="button" tabindex="0" aria-expanded="false" onclick="togM('${m.id}')" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();togM('${m.id}')}">
    <div class="method-header-left"><div class="method-number" style="background:${cd};color:${c}">${m.num}</div><div><h3>${m.title}</h3><div class="method-when">When: ${m.when}</div></div></div>
    <span class="method-chevron" aria-hidden="true">â–¼</span></div>
    <div class="method-body" id="mb-${m.id}">
    <div class="method-section"><h4><span class="dot" style="background:${c}"></span> Core Formula</h4><div class="method-formula-block">${m.formula}</div></div>
    <div class="method-section"><h4><span class="dot" style="background:${c}"></span> How To Apply</h4><p class="method-prose">${m.howTo}</p></div>
    <div class="method-section"><h4><span class="dot" style="background:${c}"></span> ${m.wt.title}</h4><p class="method-prose" style="margin-bottom:.75rem;font-style:italic;color:var(--text-muted)">${m.wt.ctx}</p>
    <div class="method-walkthrough">${m.wt.steps.map((s,i)=>`<div class="walk-step"><div class="walk-num" style="background:${cd};color:${c}">${i+1}</div><div class="walk-content">${s.t}<span class="math">${s.m}</span></div></div>`).join('')}</div></div>
    <div class="method-section"><div class="tip-box"><strong>ğŸ’¡ Tips:</strong> ${m.tips}</div><div class="warn-box" style="margin-top:.5rem"><strong>âš ï¸ Pitfalls:</strong> ${m.warn}</div></div>
    </div></div>`;
  }).join('');
}
window.togM=function(id){const c=$('#m-'+id);c.classList.toggle('open');c.querySelector('.method-header').setAttribute('aria-expanded',c.classList.contains('open'));};

/* === PRACTICE === */
function renderP(){
  const a=$('#practice-area');
  if(!S.fp.length){a.innerHTML='<p style="color:var(--text-secondary);text-align:center;padding:3rem">No problems match current filters.</p>';$('#problem-counter').textContent='0 / 0';return;}
  const i=S.pi,p=S.fp[i],dc={easy:'diff-easy',medium:'diff-medium',hard:'diff-hard'}[p.diff],sv=S.solved.has(PROBLEMS.indexOf(p));
  const di={math:'ğŸ“',physics:'âš›ï¸',engineering:'âš™ï¸'}[p.dom]||'';
  a.innerHTML=`<div class="problem-container">
  <div class="problem-meta"><span class="problem-number">Problem ${i+1}</span><span class="problem-difficulty ${dc}">${p.diff[0].toUpperCase()+p.diff.slice(1)}</span><span class="problem-category">${di} ${p.cat}</span>${sv?'<span style="color:var(--accent-green);font-weight:700;font-size:.85rem">âœ“ Solved</span>':''}</div>
  ${p.ctx?`<div class="problem-context">${p.ctx}</div>`:''}
  <div class="problem-statement">${p.statement}</div>
  <div class="problem-hint">ğŸ’¡ ${p.hint}</div>
  <div class="answer-area"><label for="ai" class="sr-only">Answer</label><input type="text" id="ai" class="answer-input" placeholder="Type answer (e.g. x^2/2+C)" autocomplete="off">
  <button class="btn btn-primary" id="bc">Check</button><button class="btn btn-ghost" id="bs">Show Solution</button></div>
  <div class="feedback" id="fb" role="alert"></div>
  <div class="solution-panel" id="sp">${p.steps?`<div class="solution-steps"><h4>Step-by-Step</h4><div style="margin-bottom:1rem;padding:0.6rem 1rem;background:var(--accent-purple-dim);border:1px solid rgba(188,140,255,0.25);border-radius:var(--radius-sm);font-size:0.88rem;color:var(--accent-purple);font-weight:600">ğŸ”§ Method: <span style="color:var(--text-primary)">${METHOD_MAP[p.cat]||p.cat}</span></div>${p.steps.map((s,j)=>`<div class="step"><div class="step-num">${j+1}</div><div class="step-content">${s.text}<span class="math-line">${s.math}</span></div></div>`).join('')}</div>`:'<div class="solution-steps"><h4>Answer</h4><div style="margin-bottom:1rem;padding:0.6rem 1rem;background:var(--accent-purple-dim);border:1px solid rgba(188,140,255,0.25);border-radius:var(--radius-sm);font-size:0.88rem;color:var(--accent-purple);font-weight:600">ğŸ”§ Method: <span style="color:var(--text-primary)">${METHOD_MAP[p.cat]||p.cat}</span></div><div class="step"><div class="step-num">1</div><div class="step-content">The answer is:<span class="math-line">'+p.answer+'</span></div></div></div>'}</div></div>`;
  $('#problem-counter').textContent=`${i+1} / ${S.fp.length}`;
  $('#bc').addEventListener('click',chkAns);$('#bs').addEventListener('click',showSol);
  $('#ai').addEventListener('keydown',e=>{if(e.key==='Enter')chkAns()});
}
function norm(s){return s.replace(/\s+/g,'').replace(/\*/g,'').toLowerCase();}
function chkAns(){
  const inp=$('#ai'),fb=$('#fb'),ua=norm(inp.value.trim()),p=S.fp[S.pi],cn=norm(p.answer),alts=(p.alt||[]).map(norm),gi=PROBLEMS.indexOf(p);
  if(!ua){inp.focus();return;}
  if(ua===cn||alts.includes(ua)){fb.className='feedback correct';fb.textContent='âœ“ Correct! Well done.';if(!S.solved.has(gi)){S.ok++;S.streak++;S.solved.add(gi);}}
  else{fb.className='feedback incorrect';fb.textContent='âœ— Not quite. Expected: '+p.answer;if(!S.solved.has(gi)){S.bad++;S.streak=0;}}
  updStats();updateProg();showSol();
}
function showSol(){const p=$('#sp');if(p)p.classList.add('visible');}
function updStats(){$('#stat-correct').textContent=S.ok;$('#stat-incorrect').textContent=S.bad;$('#stat-streak').textContent=S.streak;$('#stat-total').textContent=S.ok+S.bad;}
function updateProg(){
  const t=S.fp.length,s=S.fp.filter(p=>S.solved.has(PROBLEMS.indexOf(p))).length,pct=t?(s/t*100):0;
  $('#progress-text').textContent=`${s}/${t} solved`;$('#progress-fill').style.width=pct+'%';$('.progress-bar-track').setAttribute('aria-valuenow',Math.round(pct));
}
$('#btn-prev').addEventListener('click',()=>{if(!S.fp.length)return;S.pi=(S.pi-1+S.fp.length)%S.fp.length;renderP();});
$('#btn-next').addEventListener('click',()=>{if(!S.fp.length)return;S.pi=(S.pi+1)%S.fp.length;renderP();});
$$('.prob-filter').forEach(b=>b.addEventListener('click',()=>{$$('.prob-filter').forEach(x=>x.classList.remove('active'));b.classList.add('active');S.pf=b.dataset.pf;filterP();renderP();}));

/* === VISUAL === */
const FN={x2:{fn:x=>x*x,l:'xÂ²',d:x=>2*x},sinx:{fn:x=>Math.sin(x),l:'sin(x)',d:x=>Math.cos(x)},sqrtx:{fn:x=>Math.sqrt(Math.max(0,x)),l:'âˆšx',d:x=>x>0?.5/Math.sqrt(x):0},ex:{fn:x=>Math.exp(x),l:'eË£',d:x=>Math.exp(x)},'1overx':{fn:x=>x?1/x:0,l:'1/x',d:x=>x?-1/(x*x):0}};
function gvp(){const t=$('#viz-type').value,fk=$('#viz-func').value,n=+$('#viz-n').value;let a=+$('#viz-a').value,b=+$('#viz-b').value;if(a>=b)b=a+.5;if(fk==='1overx'&&a<=0)a=.1;if(fk==='sqrtx'&&a<0)a=0;return{t,fk,n,a,b,f:FN[fk]};}
function drawViz(){
  const cv=$('#viz-canvas'),cx=cv.getContext('2d'),W=cv.width,H=cv.height,{t,n,a,b,f}=gvp(),fn=f.fn;
  cx.fillStyle='#0D1117';cx.fillRect(0,0,W,H);
  const P=50,pW=W-2*P,pH=H-2*P;let yMn=0,yMx=1;
  for(let i=0;i<=200;i++){const x=a+(b-a)*i/200,y=fn(x);if(isFinite(y)){yMn=Math.min(yMn,y);yMx=Math.max(yMx,y);}}
  const yr=yMx-yMn||1,yp=yr*.1;yMn-=yp;yMx+=yp;
  const tc=(x,y)=>[P+(x-a)/(b-a)*pW,P+(1-(y-yMn)/(yMx-yMn))*pH];
  cx.strokeStyle='rgba(57,210,192,.08)';cx.lineWidth=1;
  for(let i=0;i<=8;i++){const[,cy]=tc(a,yMn+(yMx-yMn)*i/8);cx.beginPath();cx.moveTo(P,cy);cx.lineTo(W-P,cy);cx.stroke();}
  for(let i=0;i<=8;i++){const[cx2]=tc(a+(b-a)*i/8,0);cx.beginPath();cx.moveTo(cx2,P);cx.lineTo(cx2,H-P);cx.stroke();}
  cx.strokeStyle='#30363D';cx.lineWidth=2;
  const[,y0c]=tc(a,0);if(y0c>=P&&y0c<=H-P){cx.beginPath();cx.moveTo(P,y0c);cx.lineTo(W-P,y0c);cx.stroke();}
  if(a<=0&&b>=0){const[x0c]=tc(0,0);cx.beginPath();cx.moveTo(x0c,P);cx.lineTo(x0c,H-P);cx.stroke();}
  cx.fillStyle='#8B949E';cx.font='12px JetBrains Mono,monospace';cx.textAlign='center';
  for(let i=0;i<=4;i++){const xv=a+(b-a)*i/4,[cxv]=tc(xv,0);cx.fillText(xv.toFixed(1),cxv,H-P+18);}
  cx.textAlign='right';for(let i=0;i<=4;i++){const yv=yMn+(yMx-yMn)*i/4,[,cy]=tc(a,yv);cx.fillText(yv.toFixed(2),P-8,cy+4);}
  let val=0;const dx=(b-a)/n;
  if(t==='area'){cx.beginPath();const[sx,sy]=tc(a,0);cx.moveTo(sx,sy);for(let i=0;i<=200;i++){const x=a+(b-a)*i/200,[cx2,cy]=tc(x,fn(x));cx.lineTo(cx2,cy);}cx.lineTo(tc(b,0)[0],sy);cx.closePath();cx.fillStyle='rgba(57,210,192,.2)';cx.fill();for(let i=0;i<n;i++){const xi=a+i*dx;val+=(fn(xi)+fn(xi+dx))/2*dx;}}
  else if(t==='riemann'){for(let i=0;i<n;i++){const xi=a+i*dx,yi=fn(xi),[c1,cy1]=tc(xi,yi),[c2]=tc(xi+dx,0),[,y0]=tc(xi,0);cx.fillStyle='rgba(57,210,192,.25)';cx.fillRect(c1,Math.min(cy1,y0),c2-c1,Math.abs(cy1-y0));cx.strokeStyle='rgba(57,210,192,.5)';cx.lineWidth=1;cx.strokeRect(c1,Math.min(cy1,y0),c2-c1,Math.abs(cy1-y0));val+=yi*dx;}}
  else if(t==='trapezoid'){for(let i=0;i<n;i++){const x0=a+i*dx,x1=a+(i+1)*dx,y0v=fn(x0),y1v=fn(x1),[cx0,cy0]=tc(x0,y0v),[cx1,cy1]=tc(x1,y1v),[,b0]=tc(x0,0),[,b1]=tc(x1,0);cx.beginPath();cx.moveTo(cx0,b0);cx.lineTo(cx0,cy0);cx.lineTo(cx1,cy1);cx.lineTo(cx1,b1);cx.closePath();cx.fillStyle=`rgba(88,166,255,${.15+.08*Math.sin(i*.5)})`;cx.fill();cx.strokeStyle='rgba(88,166,255,.5)';cx.lineWidth=1;cx.stroke();val+=(y0v+y1v)/2*dx;}}
  else if(t==='simpson'){const ne=n%2===0?n:n+1,sd=(b-a)/ne;for(let i=0;i<ne;i+=2){const x0=a+i*sd,x1=a+(i+1)*sd,x2=a+(i+2)*sd,y0v=fn(x0),y1v=fn(x1),y2v=fn(x2);cx.beginPath();const[,bs]=tc(x0,0);cx.moveTo(tc(x0,0)[0],bs);for(let j=0;j<=20;j++){const tt=j/20,xp=x0+tt*(x2-x0),yp=y0v*(xp-x1)*(xp-x2)/((x0-x1)*(x0-x2))+y1v*(xp-x0)*(xp-x2)/((x1-x0)*(x1-x2))+y2v*(xp-x0)*(xp-x1)/((x2-x0)*(x2-x1));const[cxp,cyp]=tc(xp,yp);cx.lineTo(cxp,cyp);}cx.lineTo(tc(x2,0)[0],bs);cx.closePath();cx.fillStyle=`rgba(188,140,255,${.15+.06*Math.sin(i*.4)})`;cx.fill();cx.strokeStyle='rgba(188,140,255,.5)';cx.lineWidth=1;cx.stroke();val+=sd/3*(y0v+4*y1v+y2v);}}
  else if(t==='volume-disk'){for(let i=0;i<n;i++){const xi=a+i*dx+dx/2,yi=fn(xi),[cxi,cy0]=tc(xi,0),[,cyT]=tc(xi,yi);const rPx=Math.abs(cy0-cyT),wP=pW/n*.8;cx.beginPath();cx.ellipse(cxi,cy0,wP/2,rPx,0,0,2*Math.PI);cx.fillStyle=`rgba(88,166,255,${.15+.1*Math.sin(i*.5)})`;cx.fill();cx.strokeStyle='rgba(88,166,255,.5)';cx.lineWidth=1;cx.stroke();val+=Math.PI*yi*yi*dx;}}
  else if(t==='volume-shell'){for(let i=0;i<n;i++){const xi=a+i*dx+dx/2,yi=fn(xi),[c1]=tc(xi-dx/2,0),[c2]=tc(xi+dx/2,0),[,cyH]=tc(xi,yi),[,cy0]=tc(xi,0);cx.fillStyle=`rgba(188,140,255,${.15+.08*Math.sin(i*.7)})`;cx.fillRect(c1,Math.min(cyH,cy0),c2-c1,Math.abs(cyH-cy0));cx.strokeStyle='rgba(188,140,255,.5)';cx.lineWidth=1;cx.strokeRect(c1,Math.min(cyH,cy0),c2-c1,Math.abs(cyH-cy0));val+=2*Math.PI*xi*yi*dx;}}
  // Curve
  cx.beginPath();cx.strokeStyle='#39D2C0';cx.lineWidth=3;cx.shadowColor='rgba(57,210,192,.4)';cx.shadowBlur=8;
  for(let i=0;i<=200;i++){const x=a+(b-a)*i/200,[cxv,cyv]=tc(x,fn(x));i===0?cx.moveTo(cxv,cyv):cx.lineTo(cxv,cyv);}cx.stroke();cx.shadowBlur=0;
  // Bounds
  cx.setLineDash([5,5]);cx.strokeStyle='#F0883E';cx.lineWidth=2;
  const[ax]=tc(a,0);cx.beginPath();cx.moveTo(ax,P);cx.lineTo(ax,H-P);cx.stroke();
  const[bx]=tc(b,0);cx.beginPath();cx.moveTo(bx,P);cx.lineTo(bx,H-P);cx.stroke();cx.setLineDash([]);
  cx.fillStyle='#F0883E';cx.font='bold 14px JetBrains Mono,monospace';cx.textAlign='center';
  cx.fillText('a='+a.toFixed(1),ax,H-P+35);cx.fillText('b='+b.toFixed(1),bx,H-P+35);
  cx.fillStyle='#39D2C0';cx.font='bold 16px JetBrains Mono,monospace';cx.textAlign='left';cx.fillText('f(x) = '+f.l,P+10,P+20);
  const tl={area:'Area Under Curve',riemann:'Riemann Sum (n='+n+')',trapezoid:'Trapezoidal Rule (n='+n+')',simpson:"Simpson's Rule (n="+n+')',
  'volume-disk':'Volume â€” Disk Method','volume-shell':'Volume â€” Shell Method'};
  const fl={area:'âˆ«<sub>a</sub><sup>b</sup> f(x) dx',riemann:'Î£ f(xáµ¢)Î”x',trapezoid:'Î”x/2 [fâ‚€+2fâ‚+...+fâ‚™]',simpson:'Î”x/3 [fâ‚€+4fâ‚+2fâ‚‚+...+fâ‚™]',
  'volume-disk':'Ï€âˆ«[f(x)]Â² dx','volume-shell':'2Ï€âˆ«xÂ·f(x) dx'};
  $('#viz-info').innerHTML=`<strong>${tl[t]}</strong> for <code>f(x)=${f.l}</code> on <code>[${a.toFixed(1)},${b.toFixed(1)}]</code><br>Formula: ${fl[t]}<br>Numerical approx (n=${n}): <span class="cv">${val.toFixed(6)}</span>`;
}
$('#viz-n').addEventListener('input',function(){$('#n-display').textContent=this.value;});
$('#viz-a').addEventListener('input',function(){$('#a-display').textContent=(+this.value).toFixed(1);});
$('#viz-b').addEventListener('input',function(){$('#b-display').textContent=(+this.value).toFixed(1);});
$('#btn-draw').addEventListener('click',drawViz);$('#viz-type').addEventListener('change',drawViz);$('#viz-func').addEventListener('change',drawViz);

/* === INIT === */
renderMethods();filterP();renderCards();renderP();
</script>
</body>
</html>
