<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bloomberg Terminal Simulator - Authentic Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500;600&display=swap');
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* ============================================
           AUTHENTIC BLOOMBERG COLOR PALETTE
           Based on Screenshot Analysis
           ============================================ */
        :root {
            /* Backgrounds */
            --bb-black: #000000;
            --bb-dark: #0a0a0a;
            --bb-panel: #111111;
            --bb-row-alt: #0d0d0d;
            
            /* Borders */
            --bb-border: #333333;
            --bb-border-light: #444444;
            
            /* Bloomberg Signature Colors */
            --bb-amber: #FF8800;
            --bb-amber-dim: #CC6600;
            --bb-amber-glow: rgba(255, 136, 0, 0.08);
            
            /* Interactive Blue */
            --bb-blue: #00A3E0;
            --bb-blue-dark: #003366;
            --bb-blue-hover: #00B8FF;
            
            /* Data Colors */
            --bb-green: #00FF00;
            --bb-green-dim: #00CC00;
            --bb-red: #FF3333;
            --bb-red-dim: #CC2929;
            --bb-yellow: #FFFF00;
            --bb-gold: #D4AF37;
            
            /* Text */
            --bb-white: #FFFFFF;
            --bb-grey: #888888;
            --bb-grey-dim: #666666;
            
            /* Typography */
            --font-mono: 'JetBrains Mono', 'IBM Plex Mono', 'Consolas', 'Monaco', monospace;
        }

        body {
            font-family: var(--font-mono);
            background-color: var(--bb-black);
            color: var(--bb-amber);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            font-size: 12px;
            line-height: 1.4;
        }

        /* ============================================
           TOP HEADER BAR - Ticker & Command
           ============================================ */
        .top-bar {
            background: var(--bb-dark);
            border-bottom: 1px solid var(--bb-border);
            display: flex;
            align-items: center;
            padding: 0;
            height: 36px;
        }

        .ticker-box {
            background: var(--bb-panel);
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-right: 1px solid var(--bb-border);
            height: 100%;
        }

        .ticker-symbol {
            color: var(--bb-white);
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .ticker-type {
            color: var(--bb-amber);
            font-size: 11px;
        }

        .export-btn {
            background: var(--bb-amber);
            color: #000;
            border: none;
            padding: 6px 14px;
            font-size: 11px;
            font-weight: 600;
            font-family: var(--font-mono);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 12px;
        }

        .export-btn:hover {
            background: #FFA033;
        }

        .export-btn::after {
            content: 'â–¼';
            font-size: 8px;
        }

        .command-area {
            flex: 1;
            padding: 0 16px;
            display: flex;
            align-items: center;
        }

        #command-input {
            flex: 1;
            max-width: 600px;
            background: var(--bb-blue-dark);
            border: 1px solid #005080;
            color: var(--bb-white);
            padding: 6px 12px;
            font-family: var(--font-mono);
            font-size: 13px;
            font-weight: 500;
            text-transform: uppercase;
            outline: none;
            letter-spacing: 0.5px;
        }

        #command-input::placeholder {
            color: #5588AA;
            text-transform: none;
        }

        #command-input:focus {
            border-color: var(--bb-blue);
            box-shadow: 0 0 0 1px var(--bb-blue);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
            padding-right: 16px;
            font-size: 10px;
        }

        .header-time {
            color: var(--bb-amber);
            font-weight: 600;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--bb-grey);
        }

        .status-dot {
            width: 6px;
            height: 6px;
            background: var(--bb-green);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        /* ============================================
           TAB NAVIGATION - Bloomberg Style
           ============================================ */
        .tab-bar {
            background: var(--bb-dark);
            border-bottom: 1px solid var(--bb-border);
            display: flex;
            padding: 0 16px;
            gap: 0;
        }

        .tab {
            padding: 10px 20px;
            color: var(--bb-grey);
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.15s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .tab:hover {
            color: var(--bb-white);
            background: rgba(255, 255, 255, 0.03);
        }

        .tab.active {
            color: var(--bb-amber);
            border-bottom-color: var(--bb-amber);
        }

        /* ============================================
           MAIN CONTENT LAYOUT
           ============================================ */
        .main-container {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 280px;
            overflow: hidden;
        }

        .main-container.no-sidebar {
            grid-template-columns: 1fr;
        }

        .content-area {
            background: var(--bb-black);
            overflow-y: auto;
            padding: 0;
        }

        /* ============================================
           SECTION HEADERS - Yellow/Amber Style
           ============================================ */
        .section-header {
            background: linear-gradient(180deg, #D4A000 0%, #B38600 100%);
            color: #000;
            padding: 5px 12px;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-header-dark {
            background: var(--bb-panel);
            color: var(--bb-amber);
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 600;
            border-bottom: 1px solid var(--bb-border);
            border-left: 3px solid var(--bb-amber);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-header .timestamp,
        .section-header-dark .timestamp {
            font-weight: 400;
            font-size: 10px;
        }

        .section-header-dark .timestamp {
            color: var(--bb-grey);
        }

        /* ============================================
           DATA TABLES - Authentic Bloomberg Style
           ============================================ */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table thead {
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table th {
            background: var(--bb-panel);
            text-align: left;
            color: var(--bb-blue);
            font-size: 10px;
            font-weight: 600;
            padding: 6px 10px;
            border-bottom: 1px solid var(--bb-border);
            letter-spacing: 0.5px;
            text-transform: uppercase;
            white-space: nowrap;
        }

        .data-table th.right {
            text-align: right;
        }

        .data-table td {
            padding: 5px 10px;
            color: var(--bb-white);
            border-bottom: 1px solid #1a1a1a;
            font-size: 11px;
        }

        .data-table td.right {
            text-align: right;
        }

        .data-table tr:hover {
            background: var(--bb-amber-glow);
        }

        .data-table .positive { color: var(--bb-green); }
        .data-table .negative { color: var(--bb-red); }
        .data-table .highlight { color: var(--bb-amber); }
        .data-table .white { color: var(--bb-white); }
        .data-table .dim { color: var(--bb-grey); }

        /* Row with yellow/amber background highlight */
        .data-table tr.highlight-row {
            background: rgba(255, 136, 0, 0.15);
        }

        /* Table with column groups */
        .data-table .col-group-header {
            background: var(--bb-row-alt);
            text-align: center;
            color: var(--bb-grey);
            font-size: 9px;
            padding: 4px;
            border-bottom: 1px solid var(--bb-border);
        }

        /* ============================================
           FILTER & CONTROL BAR
           ============================================ */
        .control-bar {
            background: var(--bb-panel);
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            border-bottom: 1px solid var(--bb-border);
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-label {
            color: var(--bb-grey);
            font-size: 10px;
            text-transform: uppercase;
        }

        .dropdown-control {
            background: var(--bb-dark);
            border: 1px solid var(--bb-border);
            color: var(--bb-white);
            padding: 5px 28px 5px 10px;
            font-size: 11px;
            font-family: var(--font-mono);
            cursor: pointer;
            appearance: none;
            position: relative;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 8 8'%3E%3Cpath fill='%2300A3E0' d='M0 2l4 4 4-4z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
        }

        .dropdown-control:focus {
            outline: none;
            border-color: var(--bb-blue);
        }

        /* Period Selector Buttons */
        .period-selector {
            display: flex;
            gap: 2px;
        }

        .period-btn {
            background: var(--bb-dark);
            border: 1px solid var(--bb-border);
            color: var(--bb-grey);
            padding: 5px 12px;
            font-size: 10px;
            font-family: var(--font-mono);
            cursor: pointer;
            transition: all 0.15s;
        }

        .period-btn:first-child {
            border-radius: 2px 0 0 2px;
        }

        .period-btn:last-child {
            border-radius: 0 2px 2px 0;
        }

        .period-btn:hover {
            color: var(--bb-white);
            border-color: var(--bb-blue);
        }

        .period-btn.active {
            background: var(--bb-blue);
            color: var(--bb-white);
            border-color: var(--bb-blue);
        }

        /* ============================================
           RIGHT SIDEBAR - "About the Data" Style
           ============================================ */
        .info-sidebar {
            background: var(--bb-dark);
            border-left: 1px solid var(--bb-border);
            overflow-y: auto;
            font-size: 10px;
        }

        .sidebar-section {
            padding: 12px 14px;
            border-bottom: 1px solid var(--bb-border);
        }

        .sidebar-title {
            color: var(--bb-amber);
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .help-badge {
            background: var(--bb-border);
            color: var(--bb-blue);
            padding: 1px 5px;
            border-radius: 2px;
            font-size: 9px;
            font-weight: 600;
            cursor: help;
        }

        .sidebar-text {
            color: var(--bb-grey);
            line-height: 1.6;
        }

        .sidebar-item {
            display: flex;
            justify-content: space-between;
            padding: 3px 0;
        }

        .sidebar-item .label {
            color: var(--bb-grey);
        }

        .sidebar-item .value {
            color: var(--bb-white);
        }

        /* ============================================
           CHART CONTAINERS
           ============================================ */
        .chart-panel {
            background: var(--bb-panel);
            border: 1px solid var(--bb-border);
            margin: 16px;
        }

        .chart-header {
            padding: 8px 12px;
            border-bottom: 1px solid var(--bb-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chart-title {
            color: var(--bb-white);
            font-size: 11px;
            font-weight: 600;
        }

        .chart-controls {
            display: flex;
            gap: 8px;
        }

        .chart-body {
            padding: 12px;
            height: 280px;
            position: relative;
        }

        /* ============================================
           FUNCTION KEYS KEYBOARD
           ============================================ */
        .keyboard-bar {
            background: linear-gradient(180deg, #1a1a1a 0%, #0d0d0d 100%);
            padding: 10px 20px;
            border-top: 1px solid var(--bb-border);
            display: flex;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .fn-key {
            padding: 8px 14px;
            border: none;
            border-radius: 2px;
            font-family: var(--font-mono);
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.1s;
            position: relative;
            box-shadow: 0 2px 0 rgba(0,0,0,0.5);
        }

        .fn-key:active {
            transform: translateY(1px);
            box-shadow: 0 1px 0 rgba(0,0,0,0.5);
        }

        .fn-key.red { background: #CC0000; color: white; }
        .fn-key.green { background: #009900; color: white; }
        .fn-key.yellow { background: var(--bb-gold); color: black; }
        .fn-key.grey { background: #444; color: white; }

        .fn-key .key-label {
            display: block;
            font-size: 9px;
            font-weight: 400;
            margin-top: 2px;
            opacity: 0.8;
        }

        /* ============================================
           BLOOMBERG FOOTER / STATUS BAR
           ============================================ */
        .footer-bar {
            background: var(--bb-dark);
            border-top: 1px solid var(--bb-border);
            padding: 4px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 9px;
        }

        .bloomberg-brand {
            color: var(--bb-amber);
            font-weight: 700;
            letter-spacing: 2px;
        }

        .footer-info {
            color: var(--bb-grey);
            display: flex;
            gap: 24px;
        }

        /* ============================================
           VIEW PANELS
           ============================================ */
        .view-panel {
            display: none;
        }

        .view-panel.active {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ============================================
           WELCOME SCREEN
           ============================================ */
        .welcome-panel {
            padding: 24px;
        }

        .welcome-header {
            text-align: center;
            padding: 32px 0;
            border-bottom: 1px solid var(--bb-border);
            margin-bottom: 24px;
        }

        .welcome-logo {
            font-size: 28px;
            font-weight: 700;
            color: var(--bb-amber);
            letter-spacing: 4px;
            margin-bottom: 8px;
        }

        .welcome-subtitle {
            color: var(--bb-grey);
            font-size: 12px;
        }

        .market-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .market-card {
            background: var(--bb-panel);
            border: 1px solid var(--bb-border);
            padding: 16px;
        }

        .market-card-label {
            color: var(--bb-grey);
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .market-card-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--bb-white);
        }

        .market-card-change {
            font-size: 12px;
            margin-top: 4px;
        }

        .quick-commands {
            background: var(--bb-panel);
            border: 1px solid var(--bb-border);
            padding: 16px;
        }

        .quick-commands h3 {
            color: var(--bb-blue);
            font-size: 11px;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .command-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 8px;
        }

        .command-item {
            display: flex;
            gap: 12px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.15s;
            border-radius: 2px;
        }

        .command-item:hover {
            background: var(--bb-amber-glow);
        }

        .command-code {
            color: var(--bb-white);
            font-weight: 600;
            min-width: 60px;
        }

        .command-desc {
            color: var(--bb-amber-dim);
        }

        /* ============================================
           NEWS ITEMS
           ============================================ */
        .news-list {
            padding: 0 16px;
        }

        .news-item {
            padding: 12px 0;
            border-bottom: 1px solid #1a1a1a;
            cursor: pointer;
            transition: all 0.15s;
        }

        .news-item:hover {
            padding-left: 8px;
            background: var(--bb-amber-glow);
        }

        .news-time {
            color: var(--bb-amber);
            font-size: 10px;
            margin-bottom: 4px;
        }

        .news-headline {
            color: var(--bb-white);
            font-size: 12px;
            line-height: 1.4;
        }

        .news-source {
            color: var(--bb-grey);
            font-size: 9px;
            margin-top: 4px;
        }

        /* ============================================
           STATS GRID
           ============================================ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1px;
            background: var(--bb-border);
            margin: 16px;
            border: 1px solid var(--bb-border);
        }

        .stat-box {
            background: var(--bb-panel);
            padding: 12px;
        }

        .stat-label {
            color: var(--bb-grey);
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .stat-value {
            color: var(--bb-white);
            font-size: 16px;
            font-weight: 600;
        }

        .stat-value.positive { color: var(--bb-green); }
        .stat-value.negative { color: var(--bb-red); }

        /* ============================================
           MULTI-PANEL LAYOUT (Bloomberg Style)
           ============================================ */
        .multi-panel-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1px;
            background: var(--bb-border);
            height: 100%;
        }

        .grid-panel {
            background: var(--bb-black);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .grid-panel-header {
            background: var(--bb-panel);
            padding: 6px 10px;
            border-bottom: 1px solid var(--bb-border);
            font-size: 10px;
            color: var(--bb-amber);
            font-weight: 600;
        }

        .grid-panel-content {
            flex: 1;
            overflow: auto;
            padding: 8px;
        }

        /* ============================================
           EXERCISE MODAL
           ============================================ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--bb-dark);
            border: 1px solid var(--bb-amber);
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            background: var(--bb-amber);
            color: #000;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: #000;
            font-size: 20px;
            cursor: pointer;
            padding: 0 8px;
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            background: var(--bb-panel);
            padding: 12px 16px;
            border-top: 1px solid var(--bb-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .exercise-title {
            color: var(--bb-white);
            font-size: 16px;
            margin-bottom: 16px;
        }

        .exercise-instructions {
            color: var(--bb-grey);
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .exercise-steps {
            background: var(--bb-panel);
            border: 1px solid var(--bb-border);
            padding: 16px;
            margin-bottom: 16px;
        }

        .exercise-steps h4 {
            color: var(--bb-blue);
            font-size: 11px;
            margin-bottom: 12px;
        }

        .exercise-steps ol {
            color: var(--bb-white);
            padding-left: 20px;
        }

        .exercise-steps li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .exercise-hint {
            background: rgba(0, 163, 224, 0.1);
            border: 1px solid var(--bb-blue);
            padding: 12px;
        }

        .exercise-hint h4 {
            color: var(--bb-blue);
            font-size: 10px;
            margin-bottom: 8px;
        }

        .exercise-hint p {
            color: var(--bb-grey);
            font-size: 11px;
        }

        .exercise-nav-btn {
            background: var(--bb-panel);
            border: 1px solid var(--bb-border);
            color: var(--bb-white);
            padding: 8px 16px;
            font-family: var(--font-mono);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .exercise-nav-btn:hover:not(:disabled) {
            border-color: var(--bb-amber);
            color: var(--bb-amber);
        }

        .exercise-nav-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .exercise-nav-btn.primary {
            background: var(--bb-amber);
            color: #000;
            border-color: var(--bb-amber);
        }

        .exercise-progress {
            display: flex;
            gap: 6px;
        }

        .progress-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--bb-border);
            cursor: pointer;
            transition: all 0.15s;
        }

        .progress-dot.active {
            background: var(--bb-amber);
        }

        .progress-dot.completed {
            background: var(--bb-green);
        }

        /* Exercise Deliverable Section */
        .exercise-deliverable {
            background: var(--bb-panel);
            border: 1px solid var(--bb-amber);
            padding: 16px;
            margin-top: 16px;
        }

        .exercise-deliverable h4 {
            color: var(--bb-amber);
            font-size: 11px;
            margin-bottom: 12px;
        }

        .deliverable-question {
            display: block;
            color: var(--bb-white);
            font-size: 12px;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .deliverable-input {
            width: 100%;
            background: var(--bb-dark);
            border: 1px solid var(--bb-border);
            color: var(--bb-white);
            padding: 10px 12px;
            font-family: var(--font-mono);
            font-size: 12px;
            outline: none;
        }

        .deliverable-input:focus {
            border-color: var(--bb-amber);
        }

        .deliverable-input::placeholder {
            color: var(--bb-grey-dim);
        }

        /* Securities Modal */
        .securities-modal-content {
            background: var(--bb-dark);
            border: 1px solid var(--bb-blue);
            max-width: 900px;
            width: 95%;
            max-height: 85vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .securities-modal-header {
            background: var(--bb-blue);
            color: #000;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
        }

        .securities-modal-body {
            padding: 16px;
            overflow-y: auto;
            flex: 1;
        }

        .securities-search {
            width: 100%;
            background: var(--bb-panel);
            border: 1px solid var(--bb-border);
            color: var(--bb-white);
            padding: 10px 14px;
            font-family: var(--font-mono);
            font-size: 13px;
            margin-bottom: 16px;
            outline: none;
        }

        .securities-search:focus {
            border-color: var(--bb-blue);
        }

        .securities-search::placeholder {
            color: var(--bb-grey-dim);
        }

        .sector-group {
            margin-bottom: 20px;
        }

        .sector-title {
            color: var(--bb-amber);
            font-size: 12px;
            font-weight: 600;
            padding: 6px 0;
            border-bottom: 1px solid var(--bb-border);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .securities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 6px;
        }

        .security-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 10px;
            background: var(--bb-panel);
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.15s;
        }

        .security-item:hover {
            border-color: var(--bb-blue);
            background: rgba(0, 163, 224, 0.1);
        }

        .security-ticker {
            color: var(--bb-white);
            font-weight: 600;
            min-width: 50px;
        }

        .security-name {
            color: var(--bb-grey);
            font-size: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .security-item.hidden {
            display: none;
        }

        /* Student Info Section */
        .student-info-bar {
            background: var(--bb-panel);
            border-bottom: 1px solid var(--bb-border);
            padding: 12px 16px;
            display: flex;
            gap: 16px;
            align-items: center;
            flex-wrap: wrap;
        }

        .student-field {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .student-field label {
            color: var(--bb-grey);
            font-size: 10px;
            text-transform: uppercase;
        }

        .student-field input {
            background: var(--bb-dark);
            border: 1px solid var(--bb-border);
            color: var(--bb-white);
            padding: 6px 10px;
            font-family: var(--font-mono);
            font-size: 11px;
            width: 150px;
            outline: none;
        }

        .student-field input:focus {
            border-color: var(--bb-blue);
        }

        .student-field input[type="date"] {
            width: 130px;
        }

        .save-report-btn {
            background: var(--bb-green);
            color: #000;
            border: none;
            padding: 8px 16px;
            font-family: var(--font-mono);
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .save-report-btn:hover {
            background: #00DD00;
        }

        .save-report-btn:disabled {
            background: var(--bb-grey-dim);
            cursor: not-allowed;
        }

        /* Score Report Modal */
        .report-modal-content {
            background: var(--bb-dark);
            border: 1px solid var(--bb-green);
            max-width: 800px;
            width: 95%;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .report-modal-header {
            background: var(--bb-green);
            color: #000;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
        }

        .report-modal-body {
            padding: 0;
            overflow-y: auto;
            flex: 1;
        }

        .report-content {
            padding: 24px;
        }

        .report-header {
            text-align: center;
            border-bottom: 2px solid var(--bb-amber);
            padding-bottom: 20px;
            margin-bottom: 20px;
        }

        .report-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--bb-amber);
            letter-spacing: 2px;
            margin-bottom: 8px;
        }

        .report-subtitle {
            color: var(--bb-grey);
            font-size: 12px;
        }

        .report-student-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            background: var(--bb-panel);
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid var(--bb-border);
        }

        .report-info-item {
            text-align: center;
        }

        .report-info-label {
            color: var(--bb-grey);
            font-size: 10px;
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .report-info-value {
            color: var(--bb-white);
            font-size: 14px;
            font-weight: 600;
        }

        .report-summary {
            display: flex;
            justify-content: center;
            gap: 32px;
            margin-bottom: 24px;
            padding: 16px;
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid var(--bb-green);
        }

        .summary-stat {
            text-align: center;
        }

        .summary-stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--bb-green);
        }

        .summary-stat-label {
            color: var(--bb-grey);
            font-size: 10px;
            text-transform: uppercase;
        }

        .report-answers {
            border: 1px solid var(--bb-border);
        }

        .report-answer-item {
            padding: 12px 16px;
            border-bottom: 1px solid var(--bb-border);
        }

        .report-answer-item:last-child {
            border-bottom: none;
        }

        .report-answer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .report-answer-num {
            background: var(--bb-amber);
            color: #000;
            padding: 2px 8px;
            font-size: 10px;
            font-weight: 600;
        }

        .report-answer-title {
            color: var(--bb-white);
            font-weight: 600;
            flex: 1;
            margin-left: 12px;
        }

        .report-answer-status {
            font-size: 10px;
            padding: 2px 8px;
        }

        .report-answer-status.answered {
            background: var(--bb-green);
            color: #000;
        }

        .report-answer-status.unanswered {
            background: var(--bb-red);
            color: #fff;
        }

        .report-answer-question {
            color: var(--bb-grey);
            font-size: 11px;
            margin-bottom: 6px;
        }

        .report-answer-response {
            color: var(--bb-white);
            font-size: 12px;
            background: var(--bb-dark);
            padding: 8px 12px;
            border-left: 3px solid var(--bb-blue);
        }

        .report-answer-response.empty {
            color: var(--bb-grey-dim);
            font-style: italic;
            border-left-color: var(--bb-red);
        }

        .report-footer {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid var(--bb-border);
            margin-top: 20px;
        }

        .report-timestamp {
            color: var(--bb-grey);
            font-size: 10px;
        }

        .report-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            padding: 16px;
            background: var(--bb-panel);
            border-top: 1px solid var(--bb-border);
        }

        .report-btn {
            padding: 10px 24px;
            font-family: var(--font-mono);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            border: none;
        }

        .report-btn.print {
            background: var(--bb-blue);
            color: #fff;
        }

        .report-btn.download {
            background: var(--bb-amber);
            color: #000;
        }

        .report-btn.close {
            background: var(--bb-grey);
            color: #fff;
        }

        /* Print Styles */
        @media print {
            body * {
                visibility: hidden;
            }
            
            #report-modal, #report-modal * {
                visibility: visible;
            }
            
            #report-modal {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                background: white;
            }

            .report-modal-content {
                border: none;
                max-width: 100%;
                max-height: none;
                background: white;
            }

            .report-modal-header,
            .report-actions,
            .modal-close {
                display: none !important;
            }

            .report-content {
                color: black;
            }

            .report-title,
            .report-info-value,
            .report-answer-title,
            .report-answer-response {
                color: black !important;
            }

            .report-student-info,
            .report-answers,
            .report-answer-item {
                border-color: #ccc !important;
            }

            .summary-stat-value {
                color: #008800 !important;
            }
        }

        /* ============================================
           SCROLLBAR STYLING
           ============================================ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bb-black);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--bb-border);
            border-radius: 0;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--bb-grey-dim);
        }

        /* ============================================
           RESPONSIVE ADJUSTMENTS
           ============================================ */
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            
            .info-sidebar {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- TOP HEADER BAR -->
    <div class="top-bar">
        <div class="ticker-box">
            <span class="ticker-symbol" id="current-ticker">AAPL US</span>
            <span class="ticker-type">Equity</span>
        </div>
        <button class="export-btn">Export</button>
        <div class="command-area">
            <input type="text" id="command-input" placeholder="Enter command (e.g., DES, FA, GP, NEWS, WEI)...">
        </div>
        <div class="header-right">
            <div class="status-indicator">
                <span class="status-dot"></span>
                <span>CONNECTED</span>
            </div>
            <span class="header-time" id="header-time">00:00:00</span>
        </div>
    </div>

    <!-- TAB NAVIGATION -->
    <div class="tab-bar">
        <div class="tab active" data-tab="overview">Overview</div>
        <div class="tab" data-tab="fundamentals">Fundamentals</div>
        <div class="tab" data-tab="charts">Charts</div>
        <div class="tab" data-tab="news">News</div>
        <div class="tab" data-tab="economics">Economics</div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-container">
        <div class="content-area">
            <!-- WELCOME VIEW -->
            <div class="view-panel active" id="view-welcome">
                <div class="welcome-panel">
                    <div class="welcome-header">
                        <div class="welcome-logo">BLOOMBERG</div>
                        <div class="welcome-subtitle">Terminal Simulator - Educational Edition</div>
                    </div>
                    
                    <div class="market-overview">
                        <div class="market-card">
                            <div class="market-card-label">S&P 500</div>
                            <div class="market-card-value" id="welcome-spx">5,234.18</div>
                            <div class="market-card-change positive" id="welcome-spx-change">+0.45%</div>
                        </div>
                        <div class="market-card">
                            <div class="market-card-label">Dow Jones</div>
                            <div class="market-card-value" id="welcome-djia">39,127.14</div>
                            <div class="market-card-change positive" id="welcome-djia-change">+0.32%</div>
                        </div>
                        <div class="market-card">
                            <div class="market-card-label">Nasdaq</div>
                            <div class="market-card-value" id="welcome-ndx">18,456.82</div>
                            <div class="market-card-change negative" id="welcome-ndx-change">-0.18%</div>
                        </div>
                        <div class="market-card">
                            <div class="market-card-label">10Y Treasury</div>
                            <div class="market-card-value" id="welcome-tsy">4.28%</div>
                            <div class="market-card-change negative" id="welcome-tsy-change">+2 bps</div>
                        </div>
                    </div>

                    <div class="quick-commands">
                        <h3>Quick Commands</h3>
                        <div class="command-grid">
                            <div class="command-item" onclick="openSecuritiesModal()">
                                <span class="command-code">STOCKS</span>
                                <span class="command-desc">View All Securities</span>
                            </div>
                            <div class="command-item" onclick="executeCommand('DES')">
                                <span class="command-code">DES</span>
                                <span class="command-desc">Security Description</span>
                            </div>
                            <div class="command-item" onclick="executeCommand('FA')">
                                <span class="command-code">FA</span>
                                <span class="command-desc">Financial Analysis</span>
                            </div>
                            <div class="command-item" onclick="executeCommand('GP')">
                                <span class="command-code">GP</span>
                                <span class="command-desc">Price Chart</span>
                            </div>
                            <div class="command-item" onclick="executeCommand('ERN')">
                                <span class="command-code">ERN</span>
                                <span class="command-desc">Earnings</span>
                            </div>
                            <div class="command-item" onclick="executeCommand('NEWS')">
                                <span class="command-code">NEWS</span>
                                <span class="command-desc">News Headlines</span>
                            </div>
                            <div class="command-item" onclick="executeCommand('WEI')">
                                <span class="command-code">WEI</span>
                                <span class="command-desc">Economic Indicators</span>
                            </div>
                            <div class="command-item" onclick="executeCommand('ECOW')">
                                <span class="command-code">ECOW</span>
                                <span class="command-desc">World Economics</span>
                            </div>
                            <div class="command-item" onclick="executeCommand('GC')">
                                <span class="command-code">GC</span>
                                <span class="command-desc">Yield Curve</span>
                            </div>
                            <div class="command-item" onclick="executeCommand('CRNCY')">
                                <span class="command-code">CRNCY</span>
                                <span class="command-desc">Currency Rates</span>
                            </div>
                            <div class="command-item" onclick="openExerciseModal()">
                                <span class="command-code">PRACTICE</span>
                                <span class="command-desc">Practice Exercises</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- DESCRIPTION VIEW -->
            <div class="view-panel" id="view-des">
                <div class="section-header">
                    <span>Security Description</span>
                    <span class="timestamp" id="des-timestamp"></span>
                </div>
                <div class="stats-grid" id="des-stats"></div>
                <div style="padding: 16px;">
                    <div class="chart-panel">
                        <div class="chart-header">
                            <span class="chart-title">Price History</span>
                            <div class="period-selector" id="des-period-selector">
                                <button class="period-btn" onclick="handleDesPeriodChange('1M', this)">1M</button>
                                <button class="period-btn" onclick="handleDesPeriodChange('3M', this)">3M</button>
                                <button class="period-btn active" onclick="handleDesPeriodChange('6M', this)">6M</button>
                                <button class="period-btn" onclick="handleDesPeriodChange('1Y', this)">1Y</button>
                                <button class="period-btn" onclick="handleDesPeriodChange('5Y', this)">5Y</button>
                                <button class="period-btn" onclick="handleDesPeriodChange('Max', this)">Max</button>
                            </div>
                        </div>
                        <div class="chart-body">
                            <canvas id="des-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FINANCIAL ANALYSIS VIEW -->
            <div class="view-panel" id="view-fa">
                <div class="section-header">
                    <span>Financial Analysis</span>
                    <span class="timestamp" id="fa-timestamp"></span>
                </div>
                <div class="control-bar">
                    <div class="control-group">
                        <span class="control-label">Period</span>
                        <select class="dropdown-control">
                            <option>Annual</option>
                            <option>Quarterly</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <span class="control-label">Currency</span>
                        <select class="dropdown-control">
                            <option>USD</option>
                            <option>EUR</option>
                            <option>GBP</option>
                        </select>
                    </div>
                </div>
                <div style="padding: 16px;" id="fa-content"></div>
            </div>

            <!-- PRICE CHART VIEW -->
            <div class="view-panel" id="view-gp">
                <div class="section-header">
                    <span>Price Graph</span>
                    <span class="timestamp" id="gp-timestamp"></span>
                </div>
                <div class="control-bar">
                    <div class="control-group">
                        <span class="control-label">Chart Type</span>
                        <select class="dropdown-control" id="chart-type-select" onchange="handleChartTypeChange(this.value)">
                            <option value="line">Line</option>
                            <option value="candlestick">Candlestick</option>
                            <option value="area">Area</option>
                        </select>
                    </div>
                    <div class="period-selector" id="gp-period-selector">
                        <button class="period-btn" onclick="handlePeriodChange('1M', this)">1M</button>
                        <button class="period-btn" onclick="handlePeriodChange('3M', this)">3M</button>
                        <button class="period-btn active" onclick="handlePeriodChange('6M', this)">6M</button>
                        <button class="period-btn" onclick="handlePeriodChange('1Y', this)">1Y</button>
                        <button class="period-btn" onclick="handlePeriodChange('2Y', this)">2Y</button>
                        <button class="period-btn" onclick="handlePeriodChange('5Y', this)">5Y</button>
                        <button class="period-btn" onclick="handlePeriodChange('Max', this)">Max</button>
                    </div>
                </div>
                <div style="padding: 16px;">
                    <div class="chart-panel" style="height: 400px;">
                        <div class="chart-body" style="height: 100%;">
                            <canvas id="gp-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- EARNINGS VIEW -->
            <div class="view-panel" id="view-ern">
                <div class="section-header">
                    <span>Earnings Analysis</span>
                    <span class="timestamp" id="ern-timestamp"></span>
                </div>
                <div style="padding: 16px;" id="ern-content"></div>
            </div>

            <!-- NEWS VIEW -->
            <div class="view-panel" id="view-news">
                <div class="section-header">
                    <span>News Headlines</span>
                    <span class="timestamp" id="news-timestamp"></span>
                </div>
                <div class="control-bar">
                    <div class="control-group">
                        <span class="control-label">Filter</span>
                        <select class="dropdown-control">
                            <option>All News</option>
                            <option>Company Specific</option>
                            <option>Market News</option>
                            <option>Economic</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <span class="control-label">Source</span>
                        <select class="dropdown-control">
                            <option>All Sources</option>
                            <option>Bloomberg</option>
                            <option>Reuters</option>
                            <option>Dow Jones</option>
                        </select>
                    </div>
                </div>
                <div class="news-list" id="news-content"></div>
            </div>

            <!-- ECONOMIC INDICATORS VIEW -->
            <div class="view-panel" id="view-wei">
                <div class="section-header">
                    <span>World Economic Indicators</span>
                    <span class="timestamp" id="wei-timestamp"></span>
                </div>
                <div style="padding: 0;" id="wei-content"></div>
            </div>

            <!-- WORLD ECONOMICS VIEW -->
            <div class="view-panel" id="view-ecow">
                <div class="section-header">
                    <span>World Economic Overview</span>
                    <span class="timestamp" id="ecow-timestamp"></span>
                </div>
                <div style="padding: 0;" id="ecow-content"></div>
            </div>

            <!-- YIELD CURVE VIEW -->
            <div class="view-panel" id="view-gc">
                <div class="section-header">
                    <span>Government Yield Curve - United States</span>
                    <span class="timestamp" id="gc-timestamp"></span>
                </div>
                <div style="padding: 16px; display: grid; grid-template-columns: 1fr 300px; gap: 16px;">
                    <div class="chart-panel">
                        <div class="chart-header">
                            <span class="chart-title">US Treasury Yield Curve</span>
                        </div>
                        <div class="chart-body">
                            <canvas id="gc-chart"></canvas>
                        </div>
                    </div>
                    <div id="gc-data"></div>
                </div>
            </div>

            <!-- CURRENCY VIEW -->
            <div class="view-panel" id="view-crncy">
                <div class="section-header">
                    <span>Currency Monitor</span>
                    <span class="timestamp" id="crncy-timestamp"></span>
                </div>
                <div style="padding: 0;" id="crncy-content"></div>
            </div>
        </div>

        <!-- RIGHT SIDEBAR -->
        <div class="info-sidebar" id="info-sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">
                    About the Data
                    <span class="help-badge">?</span>
                </div>
                <div class="sidebar-text" id="sidebar-about">
                    Enter a command to view security data and market information.
                    <br><br>
                    Type commands like DES, FA, GP, NEWS in the command bar above.
                </div>
            </div>
            <div class="sidebar-section">
                <div class="sidebar-title">Data Source</div>
                <div class="sidebar-text" id="sidebar-source">
                    Simulated market data for educational purposes. Data is generated algorithmically and does not represent real market values.
                </div>
            </div>
            <div class="sidebar-section">
                <div class="sidebar-title">Function Keys</div>
                <div class="sidebar-text">
                    <div class="sidebar-item">
                        <span class="label">DES</span>
                        <span class="value">Description</span>
                    </div>
                    <div class="sidebar-item">
                        <span class="label">FA</span>
                        <span class="value">Financials</span>
                    </div>
                    <div class="sidebar-item">
                        <span class="label">GP</span>
                        <span class="value">Price Graph</span>
                    </div>
                    <div class="sidebar-item">
                        <span class="label">NEWS</span>
                        <span class="value">Headlines</span>
                    </div>
                    <div class="sidebar-item">
                        <span class="label">WEI</span>
                        <span class="value">Eco Indicators</span>
                    </div>
                    <div class="sidebar-item">
                        <span class="label">GC</span>
                        <span class="value">Yield Curve</span>
                    </div>
                    <div class="sidebar-item">
                        <span class="label">CRNCY</span>
                        <span class="value">Currencies</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- FUNCTION KEY BAR -->
    <div class="keyboard-bar">
        <button class="fn-key red" onclick="executeCommand('MENU')">MENU<span class="key-label">F1</span></button>
        <button class="fn-key green" onclick="executeCommand('NEWS')">NEWS<span class="key-label">F2</span></button>
        <button class="fn-key yellow" onclick="executeCommand('DES')">DES<span class="key-label">F3</span></button>
        <button class="fn-key grey" onclick="executeCommand('FA')">FA<span class="key-label">F4</span></button>
        <button class="fn-key grey" onclick="executeCommand('GP')">GP<span class="key-label">F5</span></button>
        <button class="fn-key grey" onclick="executeCommand('ERN')">ERN<span class="key-label">F6</span></button>
        <button class="fn-key grey" onclick="executeCommand('WEI')">WEI<span class="key-label">F7</span></button>
        <button class="fn-key grey" onclick="executeCommand('GC')">GC<span class="key-label">F8</span></button>
        <button class="fn-key grey" onclick="executeCommand('CRNCY')">CRNCY<span class="key-label">F9</span></button>
        <button class="fn-key yellow" onclick="openSecuritiesModal()">STOCKS<span class="key-label">F10</span></button>
        <button class="fn-key green" onclick="openExerciseModal()">PRACTICE<span class="key-label">F11</span></button>
        <button class="fn-key red" onclick="showView('welcome')">HOME<span class="key-label">F12</span></button>
    </div>

    <!-- FOOTER BAR -->
    <div class="footer-bar">
        <span class="bloomberg-brand">BLOOMBERG</span>
        <div class="footer-info">
            <span>Educational Simulator</span>
            <span>|</span>
            <span id="footer-date"></span>
            <span>|</span>
            <span>BMC Prep Edition</span>
        </div>
    </div>

    <!-- EXERCISE MODAL -->
    <div class="modal-overlay" id="exercise-modal">
        <div class="modal-content" style="max-width: 750px;">
            <div class="modal-header">
                <span>ðŸ“‹ Practice Exercise <span id="exercise-counter">1 of 10</span></span>
                <button class="modal-close" onclick="closeExerciseModal()">Ã—</button>
            </div>
            <div class="student-info-bar">
                <div class="student-field">
                    <label>Student Name:</label>
                    <input type="text" id="student-name" placeholder="Enter your name" 
                           onchange="updateStudentInfo('name', this.value)">
                </div>
                <div class="student-field">
                    <label>Class:</label>
                    <input type="text" id="student-class" placeholder="e.g., FIN 301" 
                           onchange="updateStudentInfo('className', this.value)">
                </div>
                <div class="student-field">
                    <label>Date:</label>
                    <input type="date" id="student-date" 
                           onchange="updateStudentInfo('date', this.value)">
                </div>
                <button class="save-report-btn" onclick="generateReport()">
                    ðŸ“„ Save Report
                </button>
            </div>
            <div class="modal-body" id="exercise-body"></div>
            <div class="modal-footer">
                <button class="exercise-nav-btn" id="exercise-prev" onclick="prevExercise()">â† Previous</button>
                <div class="exercise-progress" id="exercise-progress"></div>
                <button class="exercise-nav-btn primary" id="exercise-next" onclick="nextExercise()">Next â†’</button>
            </div>
        </div>
    </div>

    <!-- SCORE REPORT MODAL -->
    <div class="modal-overlay" id="report-modal">
        <div class="report-modal-content">
            <div class="report-modal-header">
                <span>ðŸ“Š Practice Exercise Report</span>
                <button class="modal-close" onclick="closeReportModal()">Ã—</button>
            </div>
            <div class="report-modal-body" id="report-body"></div>
            <div class="report-actions">
                <button class="report-btn print" onclick="printReport()">ðŸ–¨ï¸ Print Report</button>
                <button class="report-btn download" onclick="downloadReport()">ðŸ’¾ Download PDF</button>
                <button class="report-btn close" onclick="closeReportModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- SECURITIES MODAL -->
    <div class="modal-overlay" id="securities-modal">
        <div class="securities-modal-content">
            <div class="securities-modal-header">
                <span>ðŸ“Š Available Securities & Indices</span>
                <button class="modal-close" onclick="closeSecuritiesModal()">Ã—</button>
            </div>
            <div class="securities-modal-body">
                <input type="text" 
                       class="securities-search" 
                       id="securities-search" 
                       placeholder="Search by ticker or company name..."
                       oninput="filterSecurities(this.value)">
                <div id="securities-list"></div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // STATE MANAGEMENT
        // ============================================
        const state = {
            currentTicker: 'AAPL',
            currentView: 'welcome',
            charts: {}
        };

        // Period to days mapping (shared across charts)
        const periodToDays = {
            '1M': 30,
            '3M': 90,
            '6M': 180,
            '1Y': 365,
            '2Y': 730,
            '5Y': 1825,
            'Max': 3650
        };

        // ============================================
        // MARKET DATA GENERATOR
        // ============================================
        const MarketData = {
            securities: {
                // Technology
                'AAPL': { name: 'Apple Inc.', sector: 'Technology', basePrice: 178.50, currency: 'USD' },
                'MSFT': { name: 'Microsoft Corp.', sector: 'Technology', basePrice: 378.20, currency: 'USD' },
                'GOOGL': { name: 'Alphabet Inc.', sector: 'Technology', basePrice: 141.80, currency: 'USD' },
                'AMZN': { name: 'Amazon.com Inc.', sector: 'Technology', basePrice: 178.90, currency: 'USD' },
                'NVDA': { name: 'NVIDIA Corp.', sector: 'Technology', basePrice: 875.30, currency: 'USD' },
                'META': { name: 'Meta Platforms Inc.', sector: 'Technology', basePrice: 505.75, currency: 'USD' },
                'AVGO': { name: 'Broadcom Inc.', sector: 'Technology', basePrice: 1320.45, currency: 'USD' },
                'ORCL': { name: 'Oracle Corp.', sector: 'Technology', basePrice: 125.60, currency: 'USD' },
                'CRM': { name: 'Salesforce Inc.', sector: 'Technology', basePrice: 272.30, currency: 'USD' },
                'AMD': { name: 'Advanced Micro Devices', sector: 'Technology', basePrice: 156.80, currency: 'USD' },
                'INTC': { name: 'Intel Corp.', sector: 'Technology', basePrice: 42.35, currency: 'USD' },
                'IBM': { name: 'IBM Corp.', sector: 'Technology', basePrice: 168.90, currency: 'USD' },
                'CSCO': { name: 'Cisco Systems', sector: 'Technology', basePrice: 48.75, currency: 'USD' },
                'ADBE': { name: 'Adobe Inc.', sector: 'Technology', basePrice: 485.20, currency: 'USD' },
                
                // Consumer Cyclical
                'TSLA': { name: 'Tesla Inc.', sector: 'Consumer Cyclical', basePrice: 242.50, currency: 'USD' },
                'HD': { name: 'Home Depot Inc.', sector: 'Consumer Cyclical', basePrice: 345.80, currency: 'USD' },
                'MCD': { name: 'McDonald\'s Corp.', sector: 'Consumer Cyclical', basePrice: 285.40, currency: 'USD' },
                'NKE': { name: 'Nike Inc.', sector: 'Consumer Cyclical', basePrice: 98.25, currency: 'USD' },
                'SBUX': { name: 'Starbucks Corp.', sector: 'Consumer Cyclical', basePrice: 92.15, currency: 'USD' },
                'LOW': { name: 'Lowe\'s Companies', sector: 'Consumer Cyclical', basePrice: 225.60, currency: 'USD' },
                'TGT': { name: 'Target Corp.', sector: 'Consumer Cyclical', basePrice: 145.30, currency: 'USD' },
                'BKNG': { name: 'Booking Holdings', sector: 'Consumer Cyclical', basePrice: 3650.00, currency: 'USD' },
                
                // Financial Services
                'JPM': { name: 'JPMorgan Chase', sector: 'Financial Services', basePrice: 195.40, currency: 'USD' },
                'V': { name: 'Visa Inc.', sector: 'Financial Services', basePrice: 275.30, currency: 'USD' },
                'MA': { name: 'Mastercard Inc.', sector: 'Financial Services', basePrice: 458.90, currency: 'USD' },
                'BAC': { name: 'Bank of America', sector: 'Financial Services', basePrice: 37.25, currency: 'USD' },
                'WFC': { name: 'Wells Fargo & Co.', sector: 'Financial Services', basePrice: 58.40, currency: 'USD' },
                'GS': { name: 'Goldman Sachs', sector: 'Financial Services', basePrice: 385.20, currency: 'USD' },
                'MS': { name: 'Morgan Stanley', sector: 'Financial Services', basePrice: 95.80, currency: 'USD' },
                'BLK': { name: 'BlackRock Inc.', sector: 'Financial Services', basePrice: 785.50, currency: 'USD' },
                'C': { name: 'Citigroup Inc.', sector: 'Financial Services', basePrice: 58.90, currency: 'USD' },
                'AXP': { name: 'American Express', sector: 'Financial Services', basePrice: 225.40, currency: 'USD' },
                'SCHW': { name: 'Charles Schwab', sector: 'Financial Services', basePrice: 72.35, currency: 'USD' },
                
                // Healthcare
                'UNH': { name: 'UnitedHealth Group', sector: 'Healthcare', basePrice: 525.80, currency: 'USD' },
                'JNJ': { name: 'Johnson & Johnson', sector: 'Healthcare', basePrice: 158.45, currency: 'USD' },
                'LLY': { name: 'Eli Lilly & Co.', sector: 'Healthcare', basePrice: 752.30, currency: 'USD' },
                'PFE': { name: 'Pfizer Inc.', sector: 'Healthcare', basePrice: 28.15, currency: 'USD' },
                'ABBV': { name: 'AbbVie Inc.', sector: 'Healthcare', basePrice: 168.90, currency: 'USD' },
                'MRK': { name: 'Merck & Co.', sector: 'Healthcare', basePrice: 125.40, currency: 'USD' },
                'TMO': { name: 'Thermo Fisher Scientific', sector: 'Healthcare', basePrice: 572.80, currency: 'USD' },
                'ABT': { name: 'Abbott Laboratories', sector: 'Healthcare', basePrice: 112.35, currency: 'USD' },
                'DHR': { name: 'Danaher Corp.', sector: 'Healthcare', basePrice: 252.60, currency: 'USD' },
                'BMY': { name: 'Bristol-Myers Squibb', sector: 'Healthcare', basePrice: 52.40, currency: 'USD' },
                
                // Energy
                'XOM': { name: 'Exxon Mobil Corp.', sector: 'Energy', basePrice: 108.25, currency: 'USD' },
                'CVX': { name: 'Chevron Corp.', sector: 'Energy', basePrice: 155.80, currency: 'USD' },
                'COP': { name: 'ConocoPhillips', sector: 'Energy', basePrice: 118.45, currency: 'USD' },
                'SLB': { name: 'Schlumberger Ltd.', sector: 'Energy', basePrice: 52.30, currency: 'USD' },
                'EOG': { name: 'EOG Resources', sector: 'Energy', basePrice: 125.60, currency: 'USD' },
                'OXY': { name: 'Occidental Petroleum', sector: 'Energy', basePrice: 62.15, currency: 'USD' },
                
                // Consumer Staples
                'PG': { name: 'Procter & Gamble', sector: 'Consumer Staples', basePrice: 162.30, currency: 'USD' },
                'KO': { name: 'Coca-Cola Co.', sector: 'Consumer Staples', basePrice: 60.45, currency: 'USD' },
                'PEP': { name: 'PepsiCo Inc.', sector: 'Consumer Staples', basePrice: 172.80, currency: 'USD' },
                'COST': { name: 'Costco Wholesale', sector: 'Consumer Staples', basePrice: 725.40, currency: 'USD' },
                'WMT': { name: 'Walmart Inc.', sector: 'Consumer Staples', basePrice: 165.25, currency: 'USD' },
                'PM': { name: 'Philip Morris Intl.', sector: 'Consumer Staples', basePrice: 95.80, currency: 'USD' },
                'MO': { name: 'Altria Group', sector: 'Consumer Staples', basePrice: 42.35, currency: 'USD' },
                'CL': { name: 'Colgate-Palmolive', sector: 'Consumer Staples', basePrice: 88.90, currency: 'USD' },
                
                // Industrials
                'CAT': { name: 'Caterpillar Inc.', sector: 'Industrials', basePrice: 342.50, currency: 'USD' },
                'BA': { name: 'Boeing Co.', sector: 'Industrials', basePrice: 185.30, currency: 'USD' },
                'HON': { name: 'Honeywell Intl.', sector: 'Industrials', basePrice: 198.45, currency: 'USD' },
                'UPS': { name: 'United Parcel Service', sector: 'Industrials', basePrice: 145.80, currency: 'USD' },
                'RTX': { name: 'RTX Corp.', sector: 'Industrials', basePrice: 98.25, currency: 'USD' },
                'LMT': { name: 'Lockheed Martin', sector: 'Industrials', basePrice: 445.60, currency: 'USD' },
                'GE': { name: 'General Electric', sector: 'Industrials', basePrice: 158.90, currency: 'USD' },
                'DE': { name: 'Deere & Company', sector: 'Industrials', basePrice: 385.40, currency: 'USD' },
                'MMM': { name: '3M Company', sector: 'Industrials', basePrice: 95.25, currency: 'USD' },
                
                // Communication Services
                'NFLX': { name: 'Netflix Inc.', sector: 'Communication Services', basePrice: 628.50, currency: 'USD' },
                'DIS': { name: 'Walt Disney Co.', sector: 'Communication Services', basePrice: 112.30, currency: 'USD' },
                'CMCSA': { name: 'Comcast Corp.', sector: 'Communication Services', basePrice: 42.85, currency: 'USD' },
                'VZ': { name: 'Verizon Comm.', sector: 'Communication Services', basePrice: 40.25, currency: 'USD' },
                'T': { name: 'AT&T Inc.', sector: 'Communication Services', basePrice: 17.80, currency: 'USD' },
                'TMUS': { name: 'T-Mobile US', sector: 'Communication Services', basePrice: 165.40, currency: 'USD' },
                
                // Utilities
                'NEE': { name: 'NextEra Energy', sector: 'Utilities', basePrice: 72.45, currency: 'USD' },
                'DUK': { name: 'Duke Energy', sector: 'Utilities', basePrice: 98.30, currency: 'USD' },
                'SO': { name: 'Southern Company', sector: 'Utilities', basePrice: 72.15, currency: 'USD' },
                'D': { name: 'Dominion Energy', sector: 'Utilities', basePrice: 48.60, currency: 'USD' },
                
                // Real Estate
                'AMT': { name: 'American Tower Corp.', sector: 'Real Estate', basePrice: 198.75, currency: 'USD' },
                'PLD': { name: 'Prologis Inc.', sector: 'Real Estate', basePrice: 128.40, currency: 'USD' },
                'CCI': { name: 'Crown Castle Intl.', sector: 'Real Estate', basePrice: 112.30, currency: 'USD' },
                'EQIX': { name: 'Equinix Inc.', sector: 'Real Estate', basePrice: 785.60, currency: 'USD' },
                'SPG': { name: 'Simon Property Group', sector: 'Real Estate', basePrice: 152.45, currency: 'USD' },
                
                // Materials
                'LIN': { name: 'Linde PLC', sector: 'Materials', basePrice: 458.30, currency: 'USD' },
                'APD': { name: 'Air Products & Chem.', sector: 'Materials', basePrice: 248.75, currency: 'USD' },
                'SHW': { name: 'Sherwin-Williams', sector: 'Materials', basePrice: 325.40, currency: 'USD' },
                'FCX': { name: 'Freeport-McMoRan', sector: 'Materials', basePrice: 42.85, currency: 'USD' },
                'NEM': { name: 'Newmont Corp.', sector: 'Materials', basePrice: 38.25, currency: 'USD' },
                
                // Indices
                'SPX': { name: 'S&P 500 Index', sector: 'Index', basePrice: 5234.18, currency: 'USD' },
                'DJIA': { name: 'Dow Jones Industrial', sector: 'Index', basePrice: 39127.14, currency: 'USD' },
                'NDX': { name: 'Nasdaq 100', sector: 'Index', basePrice: 18456.82, currency: 'USD' },
                'RUT': { name: 'Russell 2000', sector: 'Index', basePrice: 2045.32, currency: 'USD' },
                'VIX': { name: 'CBOE Volatility Index', sector: 'Index', basePrice: 14.25, currency: 'USD' }
            },

            getPrice(ticker, volatility = 0.02) {
                const security = this.securities[ticker] || this.securities['AAPL'];
                const variation = (Math.random() - 0.5) * 2 * volatility;
                return security.basePrice * (1 + variation);
            },

            getPriceHistory(ticker, days = 180) {
                const security = this.securities[ticker] || this.securities['AAPL'];
                const data = [];
                let price = security.basePrice * 0.85;
                
                for (let i = 0; i < days; i++) {
                    const change = (Math.random() - 0.48) * 0.03;
                    price = price * (1 + change);
                    const date = new Date();
                    date.setDate(date.getDate() - (days - i));
                    data.push({
                        date: date.toISOString().split('T')[0],
                        price: price,
                        volume: Math.floor(Math.random() * 50000000) + 10000000
                    });
                }
                return data;
            },

            getFinancials(ticker) {
                const base = {
                    revenue: [365000, 394000, 383000, 395000],
                    netIncome: [99800, 94680, 96995, 100000],
                    eps: [6.11, 5.89, 6.13, 6.42],
                    pe: 28.5,
                    marketCap: 2.85,
                    dividend: 0.96,
                    dividendYield: 0.54
                };
                return base;
            },

            getEarnings(ticker) {
                return [
                    { quarter: 'Q4 2024', actual: 2.18, estimate: 2.10, surprise: '+3.8%', date: '2024-01-25' },
                    { quarter: 'Q3 2024', actual: 1.46, estimate: 1.39, surprise: '+5.0%', date: '2024-10-31' },
                    { quarter: 'Q2 2024', actual: 1.40, estimate: 1.35, surprise: '+3.7%', date: '2024-08-01' },
                    { quarter: 'Q1 2024', actual: 1.53, estimate: 1.50, surprise: '+2.0%', date: '2024-05-02' }
                ];
            },

            getNews() {
                return [
                    { time: '14:32', headline: 'Fed Officials Signal Patience on Rate Cuts Amid Sticky Inflation', source: 'Bloomberg' },
                    { time: '13:45', headline: 'Tech Stocks Rally as AI Spending Forecasts Exceed Expectations', source: 'Reuters' },
                    { time: '12:18', headline: 'Treasury Yields Climb After Strong Jobs Data', source: 'Dow Jones' },
                    { time: '11:05', headline: 'European Markets Close Higher on Banking Sector Strength', source: 'Bloomberg' },
                    { time: '10:22', headline: 'Oil Prices Surge on Supply Concerns in Middle East', source: 'Reuters' },
                    { time: '09:45', headline: 'Apple Announces Record Services Revenue in Q4', source: 'Bloomberg' },
                    { time: '08:30', headline: 'Jobless Claims Fall to Lowest Level Since February', source: 'Labor Dept' },
                    { time: '07:15', headline: 'Asian Markets Mixed as China Data Disappoints', source: 'Bloomberg' }
                ];
            },

            getEconomicIndicators() {
                return [
                    { indicator: 'GDP Growth (Q3)', value: '2.8%', previous: '3.0%', forecast: '2.5%', change: 'positive' },
                    { indicator: 'Unemployment Rate', value: '3.7%', previous: '3.8%', forecast: '3.7%', change: 'positive' },
                    { indicator: 'CPI YoY', value: '3.2%', previous: '3.4%', forecast: '3.1%', change: 'negative' },
                    { indicator: 'Core PCE YoY', value: '2.8%', previous: '2.9%', forecast: '2.8%', change: 'positive' },
                    { indicator: 'Fed Funds Rate', value: '5.25-5.50%', previous: '5.25-5.50%', forecast: '5.25-5.50%', change: 'neutral' },
                    { indicator: 'Non-Farm Payrolls', value: '+275K', previous: '+229K', forecast: '+200K', change: 'positive' },
                    { indicator: 'Consumer Confidence', value: '106.7', previous: '104.7', forecast: '105.0', change: 'positive' },
                    { indicator: 'ISM Manufacturing', value: '49.1', previous: '47.8', forecast: '48.5', change: 'positive' }
                ];
            },

            getWorldEconomics() {
                return [
                    { country: 'United States', gdp: '2.8%', inflation: '3.2%', unemployment: '3.7%', rate: '5.50%' },
                    { country: 'European Union', gdp: '0.4%', inflation: '2.9%', unemployment: '6.4%', rate: '4.50%' },
                    { country: 'United Kingdom', gdp: '0.2%', inflation: '4.0%', unemployment: '4.2%', rate: '5.25%' },
                    { country: 'Japan', gdp: '1.2%', inflation: '2.8%', unemployment: '2.4%', rate: '0.10%' },
                    { country: 'China', gdp: '5.2%', inflation: '0.2%', unemployment: '5.0%', rate: '3.45%' },
                    { country: 'Germany', gdp: '-0.3%', inflation: '2.5%', unemployment: '5.7%', rate: '4.50%' },
                    { country: 'France', gdp: '0.7%', inflation: '2.9%', unemployment: '7.3%', rate: '4.50%' },
                    { country: 'Canada', gdp: '1.1%', inflation: '2.9%', unemployment: '5.8%', rate: '5.00%' }
                ];
            },

            getYieldCurve() {
                return [
                    { maturity: '1M', yield: '5.45', change: '+0.02' },
                    { maturity: '3M', yield: '5.38', change: '+0.01' },
                    { maturity: '6M', yield: '5.28', change: '-0.01' },
                    { maturity: '1Y', yield: '4.98', change: '-0.03' },
                    { maturity: '2Y', yield: '4.62', change: '-0.05' },
                    { maturity: '5Y', yield: '4.21', change: '-0.04' },
                    { maturity: '10Y', yield: '4.28', change: '-0.02' },
                    { maturity: '30Y', yield: '4.45', change: '+0.01' }
                ];
            },

            getCurrencyRates() {
                return [
                    { pair: 'EUR/USD', rate: '1.0842', change: '+0.0015' },
                    { pair: 'GBP/USD', rate: '1.2645', change: '-0.0023' },
                    { pair: 'USD/JPY', rate: '150.25', change: '+0.45' },
                    { pair: 'USD/CHF', rate: '0.8812', change: '+0.0008' },
                    { pair: 'AUD/USD', rate: '0.6534', change: '-0.0012' },
                    { pair: 'USD/CAD', rate: '1.3568', change: '+0.0025' },
                    { pair: 'EUR/GBP', rate: '0.8574', change: '+0.0018' },
                    { pair: 'EUR/JPY', rate: '162.88', change: '+0.52' }
                ];
            }
        };

        // ============================================
        // EXERCISES DATA - With Deliverables
        // ============================================
        const Exercises = [
            {
                title: 'Find Apple\'s P/E Ratio',
                instructions: 'Load Apple stock and find its Price-to-Earnings ratio. The P/E ratio is one of the most common valuation metrics used by investors to determine if a stock is over or undervalued.',
                steps: [
                    'Type <code>AAPL</code> in the command bar and press Enter',
                    'Type <code>FA</code> to open Financial Analysis',
                    'Find the P/E Ratio in the Key Ratios section'
                ],
                hint: 'P/E = Price / Earnings Per Share. A higher P/E suggests investors expect higher growth. The S&P 500 average P/E is typically around 20-25x.',
                deliverable: {
                    question: 'What is Apple\'s P/E Ratio?',
                    answerType: 'number',
                    placeholder: 'Enter the P/E ratio (e.g., 28.5)'
                }
            },
            {
                title: 'Analyze the Yield Curve',
                instructions: 'View the current US Treasury yield curve and determine if it\'s normal, flat, or inverted. An inverted yield curve is historically one of the most reliable recession predictors.',
                steps: [
                    'Type <code>GC</code> in the command bar and press Enter',
                    'Compare the 2-Year yield to the 10-Year yield',
                    'Calculate the spread: 10Y yield minus 2Y yield'
                ],
                hint: 'If 2Y yield > 10Y yield, the curve is inverted (negative spread). A normal curve has long-term yields higher than short-term.',
                deliverable: {
                    question: 'What is the 2Y-10Y spread, and is the curve Normal, Flat, or Inverted?',
                    answerType: 'text',
                    placeholder: 'e.g., -0.34%, Inverted'
                }
            },
            {
                title: 'Currency Analysis - EUR/USD',
                instructions: 'Find the EUR/USD exchange rate and understand what it means for international trade and investment.',
                steps: [
                    'Type <code>CRNCY</code> in the command bar and press Enter',
                    'Locate EUR/USD in the currency table',
                    'Note both the rate and the daily percentage change'
                ],
                hint: 'A rate of 1.08 means 1 Euro = $1.08 USD. If EUR/USD rises, the Euro is strengthening (or USD weakening).',
                deliverable: {
                    question: 'What is the current EUR/USD rate and its daily % change?',
                    answerType: 'text',
                    placeholder: 'e.g., 1.0842, +0.15%'
                }
            },
            {
                title: 'Economic Indicators Review',
                instructions: 'Find key US economic data and determine if the economy is showing signs of strength or weakness based on actual vs forecast comparisons.',
                steps: [
                    'Type <code>WEI</code> in the command bar and press Enter',
                    'Find GDP Growth and Unemployment Rate',
                    'Compare Actual values to Forecasts - did they beat or miss?'
                ],
                hint: 'Actual > Forecast = Positive surprise (usually bullish for markets). Actual < Forecast = Negative surprise (usually bearish).',
                deliverable: {
                    question: 'What is the current GDP Growth rate and Unemployment rate?',
                    answerType: 'text',
                    placeholder: 'e.g., GDP: 2.8%, Unemployment: 3.7%'
                }
            },
            {
                title: 'Compare Global Economies',
                instructions: 'Analyze economic data across different countries to identify which economies are growing fastest and which central banks have the highest rates.',
                steps: [
                    'Type <code>ECOW</code> in the command bar and press Enter',
                    'Compare GDP Growth rates across all countries',
                    'Identify the country with highest growth and highest policy rate'
                ],
                hint: 'Higher policy rates are used to fight inflation but can slow growth. China typically has highest GDP growth among major economies.',
                deliverable: {
                    question: 'Which country has the highest GDP growth? Which has the highest policy rate?',
                    answerType: 'text',
                    placeholder: 'e.g., Highest GDP: China (5.2%), Highest Rate: US (5.50%)'
                }
            },
            {
                title: 'Microsoft Profitability Analysis',
                instructions: 'Analyze Microsoft\'s profitability metrics to understand the health and efficiency of its business operations.',
                steps: [
                    'Type <code>MSFT</code> in the command bar and press Enter',
                    'Type <code>FA</code> to open Financial Analysis',
                    'Find Operating Margin and Net Margin in Key Ratios'
                ],
                hint: 'Operating Margin shows profitability from core operations. Net Margin is bottom-line profit after all expenses. Higher is better.',
                deliverable: {
                    question: 'What are Microsoft\'s Operating Margin and Net Margin?',
                    answerType: 'text',
                    placeholder: 'e.g., Operating: 29.8%, Net: 25.3%'
                }
            },
            {
                title: 'Earnings Surprise Analysis',
                instructions: 'Review NVIDIA\'s earnings history to see if management consistently beats or misses analyst expectations.',
                steps: [
                    'Type <code>NVDA</code> in the command bar and press Enter',
                    'Type <code>ERN</code> to view Earnings history',
                    'Review the Surprise % column for the last 4 quarters'
                ],
                hint: 'Consistent positive surprises suggest conservative guidance (under-promise, over-deliver). This is generally viewed positively by investors.',
                deliverable: {
                    question: 'What was NVIDIA\'s earnings surprise % for the most recent quarter?',
                    answerType: 'text',
                    placeholder: 'e.g., +3.8%'
                }
            },
            {
                title: 'News Impact Assessment',
                instructions: 'Review current market news and identify headlines that could have the biggest impact on stock prices or market direction.',
                steps: [
                    'Type <code>NEWS</code> in the command bar and press Enter',
                    'Scan headlines for Fed policy, major earnings, or economic data',
                    'Identify which headline would likely move markets most'
                ],
                hint: 'Fed policy news typically has the broadest market impact. Earnings affect individual stocks. Geopolitical news can cause volatility.',
                deliverable: {
                    question: 'What is the top headline, and would it likely be bullish or bearish for stocks?',
                    answerType: 'text',
                    placeholder: 'e.g., "Fed Signals Rate Cuts" - Bullish'
                }
            },
            {
                title: 'Stock Price Performance',
                instructions: 'Analyze Tesla\'s stock chart to understand its recent price performance and volatility.',
                steps: [
                    'Type <code>TSLA</code> in the command bar and press Enter',
                    'Type <code>GP</code> to view the Price Graph',
                    'Change the period to 1Y using the period buttons',
                    'Observe the price trend - is it up, down, or sideways?'
                ],
                hint: 'Look at the starting and ending prices to calculate approximate return. Tesla is known for high volatility.',
                deliverable: {
                    question: 'What is Tesla\'s approximate current price and is the 1Y trend Up, Down, or Sideways?',
                    answerType: 'text',
                    placeholder: 'e.g., $242.50, Up'
                }
            },
            {
                title: 'Fixed Income Analysis',
                instructions: 'Analyze the full Treasury yield curve to understand the term structure of interest rates and calculate key spreads.',
                steps: [
                    'Type <code>GC</code> in the command bar and press Enter',
                    'Note the 3-Month, 2-Year, and 10-Year yields',
                    'Calculate both the 3M-10Y spread and 2Y-10Y spread'
                ],
                hint: 'The 3M-10Y spread is watched by the Fed. The 2Y-10Y spread is popular among traders. Both being negative signals recession risk.',
                deliverable: {
                    question: 'What are the 3M, 2Y, and 10Y yields?',
                    answerType: 'text',
                    placeholder: 'e.g., 3M: 5.38%, 2Y: 4.62%, 10Y: 4.28%'
                }
            }
        ];

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        function formatNumber(num, decimals = 2) {
            return num.toLocaleString('en-US', { minimumFractionDigits: decimals, maximumFractionDigits: decimals });
        }

        function formatCurrency(num) {
            if (num >= 1e12) return '$' + (num / 1e12).toFixed(2) + 'T';
            if (num >= 1e9) return '$' + (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return '$' + (num / 1e6).toFixed(2) + 'M';
            return '$' + formatNumber(num);
        }

        function getTimestamp() {
            return new Date().toLocaleString('en-US', { 
                month: 'short', day: 'numeric', year: 'numeric',
                hour: '2-digit', minute: '2-digit', second: '2-digit'
            });
        }

        // ============================================
        // VIEW MANAGEMENT
        // ============================================
        function showView(viewId) {
            document.querySelectorAll('.view-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            const view = document.getElementById('view-' + viewId);
            if (view) {
                view.classList.add('active');
                state.currentView = viewId;
            }

            // Update tabs
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            
            // Map views to tabs
            const tabMap = {
                'welcome': 'overview',
                'des': 'overview',
                'fa': 'fundamentals',
                'ern': 'fundamentals',
                'gp': 'charts',
                'gc': 'charts',
                'news': 'news',
                'wei': 'economics',
                'ecow': 'economics',
                'crncy': 'economics'
            };
            
            const targetTab = tabMap[viewId];
            if (targetTab) {
                const tab = document.querySelector(`.tab[data-tab="${targetTab}"]`);
                if (tab) tab.classList.add('active');
            }

            updateSidebar(viewId);
        }

        function updateSidebar(viewId) {
            const aboutEl = document.getElementById('sidebar-about');
            const sourceEl = document.getElementById('sidebar-source');
            
            const sidebarContent = {
                'welcome': {
                    about: 'Enter a command to view security data and market information.<br><br>Type commands like DES, FA, GP, NEWS in the command bar above.',
                    source: 'Simulated market data for educational purposes.'
                },
                'des': {
                    about: 'Security Description provides a comprehensive overview including company information, key statistics, and price history.',
                    source: 'Company data and market prices are simulated for educational purposes.'
                },
                'fa': {
                    about: 'Financial Analysis displays income statement, balance sheet, and key financial ratios.',
                    source: 'Financial statements based on simulated data.'
                },
                'gp': {
                    about: 'Price Graph shows historical price movements with customizable time periods.',
                    source: 'Price data is algorithmically generated.'
                },
                'news': {
                    about: 'Real-time news headlines from major financial news sources.',
                    source: 'News headlines are simulated examples.'
                },
                'wei': {
                    about: 'Key economic indicators that drive monetary policy and market sentiment.',
                    source: 'Economic data is simulated for training purposes.'
                },
                'gc': {
                    about: 'Treasury yield curve shows the relationship between yields and maturities.',
                    source: 'Yield data is simulated.'
                },
                'crncy': {
                    about: 'Major currency pairs and exchange rates updated in real-time.',
                    source: 'Currency rates are simulated.'
                }
            };

            const content = sidebarContent[viewId] || sidebarContent['welcome'];
            aboutEl.innerHTML = content.about;
            sourceEl.textContent = content.source;
        }

        // ============================================
        // COMMAND PROCESSING
        // ============================================
        const commandInput = document.getElementById('command-input');

        commandInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                executeCommand(commandInput.value);
                commandInput.value = '';
            }
        });

        function executeCommand(cmd) {
            const command = cmd.toUpperCase().trim();
            
            // Check if it's a ticker
            if (MarketData.securities[command]) {
                state.currentTicker = command;
                document.getElementById('current-ticker').textContent = command + ' US';
                showDescription();
                return;
            }

            switch(command) {
                case 'DES':
                    showDescription();
                    break;
                case 'FA':
                    showFinancialAnalysis();
                    break;
                case 'GP':
                    showPriceChart();
                    break;
                case 'ERN':
                    showEarnings();
                    break;
                case 'NEWS':
                    showNews();
                    break;
                case 'WEI':
                    showEconomicIndicators();
                    break;
                case 'ECOW':
                    showWorldEconomics();
                    break;
                case 'GC':
                    showYieldCurve();
                    break;
                case 'CRNCY':
                    showCurrencyRates();
                    break;
                case 'MENU':
                case 'HOME':
                    showView('welcome');
                    break;
                case 'PRACTICE':
                    openExerciseModal();
                    break;
                case 'STOCKS':
                case 'SECURITIES':
                case 'TICKERS':
                    openSecuritiesModal();
                    break;
                default:
                    // Try as ticker
                    state.currentTicker = command || 'AAPL';
                    document.getElementById('current-ticker').textContent = state.currentTicker + ' US';
                    showDescription();
            }
        }

        // ============================================
        // VIEW FUNCTIONS
        // ============================================
        function showDescription() {
            const ticker = state.currentTicker;
            const security = MarketData.securities[ticker] || MarketData.securities['AAPL'];
            const price = MarketData.getPrice(ticker);
            const change = (Math.random() - 0.5) * 4;
            const financials = MarketData.getFinancials(ticker);

            document.getElementById('des-timestamp').textContent = getTimestamp();

            const statsHtml = `
                <div class="stat-box">
                    <div class="stat-label">Last Price</div>
                    <div class="stat-value">$${formatNumber(price)}</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Change</div>
                    <div class="stat-value ${change >= 0 ? 'positive' : 'negative'}">${change >= 0 ? '+' : ''}${formatNumber(change)}%</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Market Cap</div>
                    <div class="stat-value">${financials.marketCap}T</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">P/E Ratio</div>
                    <div class="stat-value">${financials.pe}x</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Dividend Yield</div>
                    <div class="stat-value">${financials.dividendYield}%</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Sector</div>
                    <div class="stat-value" style="font-size: 12px;">${security.sector}</div>
                </div>
            `;

            document.getElementById('des-stats').innerHTML = statsHtml;
            showView('des');

            // Render chart
            setTimeout(() => renderDesChart(), 100);
        }

        // DES chart state
        const desChartState = {
            period: '6M'
        };

        function renderDesChart() {
            const ctx = document.getElementById('des-chart').getContext('2d');
            const days = periodToDays[desChartState.period] || 180;
            const data = MarketData.getPriceHistory(state.currentTicker, days);

            if (state.charts.des) state.charts.des.destroy();

            state.charts.des = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.date),
                    datasets: [{
                        data: data.map(d => d.price),
                        borderColor: '#00A3E0',
                        backgroundColor: 'rgba(0, 163, 224, 0.1)',
                        fill: true,
                        tension: 0.1,
                        pointRadius: 0,
                        borderWidth: 1.5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { 
                            display: true,
                            grid: { color: '#222' },
                            ticks: { color: '#666', maxTicksLimit: 6, font: { size: 9 } }
                        },
                        y: { 
                            display: true,
                            grid: { color: '#222' },
                            ticks: { color: '#666', font: { size: 9 } }
                        }
                    }
                }
            });
        }

        // Handle DES chart period change
        function handleDesPeriodChange(period, button) {
            desChartState.period = period;
            
            // Update active button styling
            const container = button.closest('.period-selector');
            container.querySelectorAll('.period-btn').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            
            // Re-render chart
            renderDesChart();
        }

        function showFinancialAnalysis() {
            document.getElementById('fa-timestamp').textContent = getTimestamp();
            const financials = MarketData.getFinancials(state.currentTicker);

            const html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Income Statement (USD Millions)</th>
                            <th class="right">FY 2021</th>
                            <th class="right">FY 2022</th>
                            <th class="right">FY 2023</th>
                            <th class="right">FY 2024E</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="highlight-row">
                            <td class="highlight">Revenue</td>
                            <td class="right white">${formatNumber(financials.revenue[0])}</td>
                            <td class="right white">${formatNumber(financials.revenue[1])}</td>
                            <td class="right white">${formatNumber(financials.revenue[2])}</td>
                            <td class="right white">${formatNumber(financials.revenue[3])}</td>
                        </tr>
                        <tr>
                            <td class="dim">Cost of Revenue</td>
                            <td class="right">${formatNumber(financials.revenue[0] * 0.57)}</td>
                            <td class="right">${formatNumber(financials.revenue[1] * 0.56)}</td>
                            <td class="right">${formatNumber(financials.revenue[2] * 0.56)}</td>
                            <td class="right">${formatNumber(financials.revenue[3] * 0.55)}</td>
                        </tr>
                        <tr>
                            <td class="highlight">Gross Profit</td>
                            <td class="right white">${formatNumber(financials.revenue[0] * 0.43)}</td>
                            <td class="right white">${formatNumber(financials.revenue[1] * 0.44)}</td>
                            <td class="right white">${formatNumber(financials.revenue[2] * 0.44)}</td>
                            <td class="right white">${formatNumber(financials.revenue[3] * 0.45)}</td>
                        </tr>
                        <tr>
                            <td class="dim">Operating Expenses</td>
                            <td class="right">${formatNumber(financials.revenue[0] * 0.14)}</td>
                            <td class="right">${formatNumber(financials.revenue[1] * 0.14)}</td>
                            <td class="right">${formatNumber(financials.revenue[2] * 0.15)}</td>
                            <td class="right">${formatNumber(financials.revenue[3] * 0.15)}</td>
                        </tr>
                        <tr class="highlight-row">
                            <td class="highlight">Operating Income</td>
                            <td class="right white">${formatNumber(financials.revenue[0] * 0.29)}</td>
                            <td class="right white">${formatNumber(financials.revenue[1] * 0.30)}</td>
                            <td class="right white">${formatNumber(financials.revenue[2] * 0.29)}</td>
                            <td class="right white">${formatNumber(financials.revenue[3] * 0.30)}</td>
                        </tr>
                        <tr class="highlight-row">
                            <td class="highlight">Net Income</td>
                            <td class="right positive">${formatNumber(financials.netIncome[0])}</td>
                            <td class="right positive">${formatNumber(financials.netIncome[1])}</td>
                            <td class="right positive">${formatNumber(financials.netIncome[2])}</td>
                            <td class="right positive">${formatNumber(financials.netIncome[3])}</td>
                        </tr>
                        <tr>
                            <td class="highlight">EPS (Diluted)</td>
                            <td class="right white">$${financials.eps[0]}</td>
                            <td class="right white">$${financials.eps[1]}</td>
                            <td class="right white">$${financials.eps[2]}</td>
                            <td class="right white">$${financials.eps[3]}</td>
                        </tr>
                    </tbody>
                </table>

                <div class="section-header-dark" style="margin-top: 20px;">
                    <span>Key Ratios</span>
                </div>
                <div class="stats-grid" style="margin: 0;">
                    <div class="stat-box">
                        <div class="stat-label">Gross Margin</div>
                        <div class="stat-value">44.2%</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Operating Margin</div>
                        <div class="stat-value">29.8%</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Net Margin</div>
                        <div class="stat-value">25.3%</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">ROE</div>
                        <div class="stat-value">147.5%</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">ROA</div>
                        <div class="stat-value">28.1%</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Debt/Equity</div>
                        <div class="stat-value">1.81x</div>
                    </div>
                </div>
            `;

            document.getElementById('fa-content').innerHTML = html;
            showView('fa');
        }

        // Chart state for GP view
        const chartState = {
            period: '6M',
            type: 'line'
        };

        function showPriceChart() {
            document.getElementById('gp-timestamp').textContent = getTimestamp();
            showView('gp');
            setTimeout(() => renderGpChart(), 100);
        }

        function renderGpChart() {
            const ctx = document.getElementById('gp-chart').getContext('2d');
            const days = periodToDays[chartState.period] || 180;
            const data = MarketData.getPriceHistory(state.currentTicker, days);

            if (state.charts.gp) state.charts.gp.destroy();

            // Determine chart configuration based on type
            let chartConfig;
            
            if (chartState.type === 'candlestick' || chartState.type === 'bar') {
                // For candlestick, we'll simulate with a bar chart showing price ranges
                const ohlcData = data.map(d => {
                    const open = d.price * (1 + (Math.random() - 0.5) * 0.02);
                    const close = d.price;
                    const high = Math.max(open, close) * (1 + Math.random() * 0.01);
                    const low = Math.min(open, close) * (1 - Math.random() * 0.01);
                    return { date: d.date, open, high, low, close };
                });

                chartConfig = {
                    type: 'bar',
                    data: {
                        labels: ohlcData.map(d => d.date),
                        datasets: [{
                            label: 'Price Range',
                            data: ohlcData.map(d => [d.low, d.high]),
                            backgroundColor: ohlcData.map(d => d.close >= d.open ? 'rgba(0, 255, 0, 0.7)' : 'rgba(255, 51, 51, 0.7)'),
                            borderColor: ohlcData.map(d => d.close >= d.open ? '#00FF00' : '#FF3333'),
                            borderWidth: 1,
                            barPercentage: 0.8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const idx = context.dataIndex;
                                        const d = ohlcData[idx];
                                        return [
                                            `Open: $${d.open.toFixed(2)}`,
                                            `High: $${d.high.toFixed(2)}`,
                                            `Low: $${d.low.toFixed(2)}`,
                                            `Close: $${d.close.toFixed(2)}`
                                        ];
                                    }
                                }
                            }
                        },
                        scales: {
                            x: { 
                                grid: { color: '#222' },
                                ticks: { color: '#888', maxTicksLimit: 8, font: { size: 10 } }
                            },
                            y: { 
                                grid: { color: '#222' },
                                ticks: { color: '#888', font: { size: 10 } }
                            }
                        }
                    }
                };
            } else if (chartState.type === 'area') {
                chartConfig = {
                    type: 'line',
                    data: {
                        labels: data.map(d => d.date),
                        datasets: [{
                            label: 'Price',
                            data: data.map(d => d.price),
                            borderColor: '#00A3E0',
                            backgroundColor: 'rgba(0, 163, 224, 0.3)',
                            fill: true,
                            tension: 0.2,
                            pointRadius: 0,
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            x: { 
                                grid: { color: '#222' },
                                ticks: { color: '#888', maxTicksLimit: 8, font: { size: 10 } }
                            },
                            y: { 
                                grid: { color: '#222' },
                                ticks: { color: '#888', font: { size: 10 } }
                            }
                        }
                    }
                };
            } else {
                // Default: line chart
                chartConfig = {
                    type: 'line',
                    data: {
                        labels: data.map(d => d.date),
                        datasets: [{
                            label: 'Price',
                            data: data.map(d => d.price),
                            borderColor: '#FFFFFF',
                            backgroundColor: 'rgba(0, 163, 224, 0.15)',
                            fill: false,
                            tension: 0.1,
                            pointRadius: 0,
                            borderWidth: 1.5
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            x: { 
                                grid: { color: '#222' },
                                ticks: { color: '#888', maxTicksLimit: 8, font: { size: 10 } }
                            },
                            y: { 
                                grid: { color: '#222' },
                                ticks: { color: '#888', font: { size: 10 } }
                            }
                        }
                    }
                };
            }

            state.charts.gp = new Chart(ctx, chartConfig);
        }

        // Handle chart type change
        function handleChartTypeChange(type) {
            chartState.type = type;
            if (state.currentView === 'gp') {
                renderGpChart();
            }
        }

        // Handle period change
        function handlePeriodChange(period, button) {
            chartState.period = period;
            
            // Update active button styling
            const container = button.closest('.period-selector');
            container.querySelectorAll('.period-btn').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            
            // Re-render chart
            if (state.currentView === 'gp') {
                renderGpChart();
            }
        }

        function showEarnings() {
            document.getElementById('ern-timestamp').textContent = getTimestamp();
            const earnings = MarketData.getEarnings(state.currentTicker);

            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Quarter</th>
                            <th class="right">Report Date</th>
                            <th class="right">Actual EPS</th>
                            <th class="right">Estimate</th>
                            <th class="right">Surprise</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            earnings.forEach(e => {
                const isPositive = e.surprise.startsWith('+');
                html += `
                    <tr>
                        <td class="highlight">${e.quarter}</td>
                        <td class="right dim">${e.date}</td>
                        <td class="right white">$${e.actual}</td>
                        <td class="right dim">$${e.estimate}</td>
                        <td class="right ${isPositive ? 'positive' : 'negative'}">${e.surprise}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            document.getElementById('ern-content').innerHTML = html;
            showView('ern');
        }

        function showNews() {
            document.getElementById('news-timestamp').textContent = getTimestamp();
            const news = MarketData.getNews();

            let html = '';
            news.forEach(item => {
                html += `
                    <div class="news-item">
                        <div class="news-time">${item.time}</div>
                        <div class="news-headline">${item.headline}</div>
                        <div class="news-source">${item.source}</div>
                    </div>
                `;
            });

            document.getElementById('news-content').innerHTML = html;
            showView('news');
        }

        function showEconomicIndicators() {
            document.getElementById('wei-timestamp').textContent = getTimestamp();
            const indicators = MarketData.getEconomicIndicators();

            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Indicator</th>
                            <th class="right">Actual</th>
                            <th class="right">Previous</th>
                            <th class="right">Forecast</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            indicators.forEach(ind => {
                const changeClass = ind.change === 'positive' ? 'positive' : ind.change === 'negative' ? 'negative' : '';
                html += `
                    <tr>
                        <td class="highlight">${ind.indicator}</td>
                        <td class="right white ${changeClass}">${ind.value}</td>
                        <td class="right dim">${ind.previous}</td>
                        <td class="right dim">${ind.forecast}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            document.getElementById('wei-content').innerHTML = html;
            showView('wei');
        }

        function showWorldEconomics() {
            document.getElementById('ecow-timestamp').textContent = getTimestamp();
            const data = MarketData.getWorldEconomics();

            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Country</th>
                            <th class="right">GDP Growth</th>
                            <th class="right">Inflation</th>
                            <th class="right">Unemployment</th>
                            <th class="right">Policy Rate</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            data.forEach(c => {
                const gdpClass = parseFloat(c.gdp) > 0 ? 'positive' : parseFloat(c.gdp) < 0 ? 'negative' : '';
                html += `
                    <tr>
                        <td class="highlight">${c.country}</td>
                        <td class="right ${gdpClass}">${c.gdp}</td>
                        <td class="right white">${c.inflation}</td>
                        <td class="right white">${c.unemployment}</td>
                        <td class="right white">${c.rate}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            document.getElementById('ecow-content').innerHTML = html;
            showView('ecow');
        }

        function showYieldCurve() {
            document.getElementById('gc-timestamp').textContent = getTimestamp();
            const curve = MarketData.getYieldCurve();

            let html = `
                <div style="background: var(--bb-panel); border: 1px solid var(--bb-border); padding: 15px;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Maturity</th>
                                <th class="right">Yield</th>
                                <th class="right">Change</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            curve.forEach(point => {
                const changeClass = parseFloat(point.change) >= 0 ? 'positive' : 'negative';
                const sign = parseFloat(point.change) >= 0 ? '+' : '';
                html += `
                    <tr>
                        <td class="highlight">${point.maturity}</td>
                        <td class="right white">${point.yield}%</td>
                        <td class="right ${changeClass}">${sign}${point.change}</td>
                    </tr>
                `;
            });

            html += '</tbody></table></div>';

            // Check for inversion
            const twoYear = parseFloat(curve.find(c => c.maturity === '2Y').yield);
            const tenYear = parseFloat(curve.find(c => c.maturity === '10Y').yield);
            if (twoYear > tenYear) {
                html += '<div style="margin-top: 15px; padding: 10px; background: rgba(255,51,51,0.2); border: 1px solid var(--bb-red); color: var(--bb-red);">âš ï¸ YIELD CURVE INVERTED (2Y > 10Y) - Potential recession indicator</div>';
            }

            document.getElementById('gc-data').innerHTML = html;
            showView('gc');

            setTimeout(() => renderYieldChart(curve), 100);
        }

        function renderYieldChart(data) {
            const ctx = document.getElementById('gc-chart').getContext('2d');

            if (state.charts.gc) state.charts.gc.destroy();

            state.charts.gc = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.maturity),
                    datasets: [{
                        label: 'Yield',
                        data: data.map(d => parseFloat(d.yield)),
                        borderColor: '#00A3E0',
                        backgroundColor: 'rgba(0, 163, 224, 0.15)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 4,
                        pointBackgroundColor: '#00A3E0',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { color: '#222' }, ticks: { color: '#888', font: { size: 10 } } },
                        y: { grid: { color: '#222' }, ticks: { color: '#888', font: { size: 10 } }, min: 4, max: 6 }
                    }
                }
            });
        }

        function showCurrencyRates() {
            document.getElementById('crncy-timestamp').textContent = getTimestamp();
            const rates = MarketData.getCurrencyRates();

            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Currency Pair</th>
                            <th class="right">Rate</th>
                            <th class="right">Change</th>
                            <th class="right">% Change</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            rates.forEach(rate => {
                const changeClass = parseFloat(rate.change) >= 0 ? 'positive' : 'negative';
                const sign = parseFloat(rate.change) >= 0 ? '+' : '';
                const pctChange = (parseFloat(rate.change) / parseFloat(rate.rate) * 100).toFixed(3);

                html += `
                    <tr>
                        <td class="highlight">${rate.pair}</td>
                        <td class="right white">${rate.rate}</td>
                        <td class="right ${changeClass}">${sign}${rate.change}</td>
                        <td class="right ${changeClass}">${sign}${pctChange}%</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            document.getElementById('crncy-content').innerHTML = html;
            showView('crncy');
        }

        // ============================================
        // EXERCISE MODAL
        // ============================================
        let exerciseState = { 
            currentIndex: 0, 
            completed: new Set(), 
            answers: {},
            studentInfo: {
                name: '',
                className: '',
                date: new Date().toISOString().split('T')[0]
            }
        };

        function openExerciseModal() {
            document.getElementById('exercise-modal').classList.add('active');
            
            // Populate student info fields
            document.getElementById('student-name').value = exerciseState.studentInfo.name;
            document.getElementById('student-class').value = exerciseState.studentInfo.className;
            document.getElementById('student-date').value = exerciseState.studentInfo.date;
            
            renderExercise();
            updateExerciseProgress();
        }

        function updateStudentInfo(field, value) {
            exerciseState.studentInfo[field] = value;
        }

        function closeExerciseModal() {
            document.getElementById('exercise-modal').classList.remove('active');
        }

        // ============================================
        // SCORE REPORT GENERATION
        // ============================================
        function generateReport() {
            // Validate student info
            if (!exerciseState.studentInfo.name.trim()) {
                alert('Please enter your name before saving the report.');
                document.getElementById('student-name').focus();
                return;
            }
            if (!exerciseState.studentInfo.className.trim()) {
                alert('Please enter your class before saving the report.');
                document.getElementById('student-class').focus();
                return;
            }

            // Count answered questions
            let answeredCount = 0;
            for (let i = 0; i < Exercises.length; i++) {
                if (exerciseState.answers[i] && exerciseState.answers[i].trim()) {
                    answeredCount++;
                }
            }

            // Build report HTML
            let answersHtml = '';
            for (let i = 0; i < Exercises.length; i++) {
                const exercise = Exercises[i];
                const answer = exerciseState.answers[i] || '';
                const isAnswered = answer.trim() !== '';
                
                answersHtml += `
                    <div class="report-answer-item">
                        <div class="report-answer-header">
                            <span class="report-answer-num">${i + 1}</span>
                            <span class="report-answer-title">${exercise.title}</span>
                            <span class="report-answer-status ${isAnswered ? 'answered' : 'unanswered'}">
                                ${isAnswered ? 'ANSWERED' : 'UNANSWERED'}
                            </span>
                        </div>
                        <div class="report-answer-question">${exercise.deliverable.question}</div>
                        <div class="report-answer-response ${isAnswered ? '' : 'empty'}">
                            ${isAnswered ? answer : 'No answer provided'}
                        </div>
                    </div>
                `;
            }

            const reportHtml = `
                <div class="report-content" id="report-printable">
                    <div class="report-header">
                        <div class="report-title">BLOOMBERG TERMINAL SIMULATOR</div>
                        <div class="report-subtitle">Practice Exercise Score Report</div>
                    </div>
                    
                    <div class="report-student-info">
                        <div class="report-info-item">
                            <div class="report-info-label">Student Name</div>
                            <div class="report-info-value">${exerciseState.studentInfo.name}</div>
                        </div>
                        <div class="report-info-item">
                            <div class="report-info-label">Class</div>
                            <div class="report-info-value">${exerciseState.studentInfo.className}</div>
                        </div>
                        <div class="report-info-item">
                            <div class="report-info-label">Date</div>
                            <div class="report-info-value">${formatReportDate(exerciseState.studentInfo.date)}</div>
                        </div>
                    </div>

                    <div class="report-summary">
                        <div class="summary-stat">
                            <div class="summary-stat-value">${answeredCount}</div>
                            <div class="summary-stat-label">Questions Answered</div>
                        </div>
                        <div class="summary-stat">
                            <div class="summary-stat-value">${Exercises.length}</div>
                            <div class="summary-stat-label">Total Questions</div>
                        </div>
                        <div class="summary-stat">
                            <div class="summary-stat-value">${Math.round((answeredCount / Exercises.length) * 100)}%</div>
                            <div class="summary-stat-label">Completion Rate</div>
                        </div>
                    </div>

                    <div class="report-answers">
                        ${answersHtml}
                    </div>

                    <div class="report-footer">
                        <div class="report-timestamp">Report generated: ${new Date().toLocaleString()}</div>
                    </div>
                </div>
            `;

            document.getElementById('report-body').innerHTML = reportHtml;
            document.getElementById('report-modal').classList.add('active');
        }

        function formatReportDate(dateStr) {
            if (!dateStr) return 'Not specified';
            const date = new Date(dateStr + 'T00:00:00');
            return date.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        function closeReportModal() {
            document.getElementById('report-modal').classList.remove('active');
        }

        function printReport() {
            window.print();
        }

        function downloadReport() {
            // Create a text version of the report for download
            let reportText = `BLOOMBERG TERMINAL SIMULATOR
Practice Exercise Score Report
================================

Student Information:
- Name: ${exerciseState.studentInfo.name}
- Class: ${exerciseState.studentInfo.className}
- Date: ${formatReportDate(exerciseState.studentInfo.date)}

`;
            let answeredCount = 0;
            for (let i = 0; i < Exercises.length; i++) {
                if (exerciseState.answers[i] && exerciseState.answers[i].trim()) {
                    answeredCount++;
                }
            }

            reportText += `Summary:
- Questions Answered: ${answeredCount} / ${Exercises.length}
- Completion Rate: ${Math.round((answeredCount / Exercises.length) * 100)}%

================================
EXERCISE RESPONSES
================================

`;

            for (let i = 0; i < Exercises.length; i++) {
                const exercise = Exercises[i];
                const answer = exerciseState.answers[i] || 'No answer provided';
                
                reportText += `Exercise ${i + 1}: ${exercise.title}
Question: ${exercise.deliverable.question}
Answer: ${answer}

`;
            }

            reportText += `
================================
Report generated: ${new Date().toLocaleString()}
`;

            // Create and download file
            const blob = new Blob([reportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `BMC_Practice_${exerciseState.studentInfo.name.replace(/\s+/g, '_')}_${exerciseState.studentInfo.date}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function renderExercise() {
            const exercise = Exercises[exerciseState.currentIndex];
            const stepsHtml = exercise.steps.map(step => '<li>' + step + '</li>').join('');
            
            document.getElementById('exercise-body').innerHTML = `
                <h3 class="exercise-title">ðŸŽ¯ ${exercise.title}</h3>
                <p class="exercise-instructions">${exercise.instructions}</p>
                <div class="exercise-steps">
                    <h4>ðŸ“‹ STEPS TO COMPLETE:</h4>
                    <ol>
                        ${stepsHtml}
                    </ol>
                </div>
                <div class="exercise-hint">
                    <h4>ðŸ’¡ HINT</h4>
                    <p>${exercise.hint}</p>
                </div>
                <div class="exercise-deliverable">
                    <h4>ðŸ“ YOUR ANSWER</h4>
                    <label class="deliverable-question">${exercise.deliverable.question}</label>
                    <input type="text" 
                           class="deliverable-input" 
                           id="deliverable-input-${exerciseState.currentIndex}"
                           placeholder="${exercise.deliverable.placeholder}"
                           value="${exerciseState.answers[exerciseState.currentIndex] || ''}"
                           onchange="saveAnswer(${exerciseState.currentIndex}, this.value)">
                </div>
            `;

            document.getElementById('exercise-counter').textContent = 
                (exerciseState.currentIndex + 1) + ' of ' + Exercises.length;
            
            document.getElementById('exercise-prev').disabled = exerciseState.currentIndex === 0;
            document.getElementById('exercise-next').textContent = 
                exerciseState.currentIndex === Exercises.length - 1 ? 'Finish âœ“' : 'Next â†’';
        }

        function saveAnswer(index, value) {
            exerciseState.answers[index] = value;
        }

        function updateExerciseProgress() {
            document.getElementById('exercise-progress').innerHTML = Exercises.map((_, i) => {
                let classes = 'progress-dot';
                if (i === exerciseState.currentIndex) classes += ' active';
                if (exerciseState.completed.has(i)) classes += ' completed';
                return `<div class="${classes}" onclick="goToExercise(${i})"></div>`;
            }).join('');
        }

        function nextExercise() {
            exerciseState.completed.add(exerciseState.currentIndex);
            if (exerciseState.currentIndex < Exercises.length - 1) {
                exerciseState.currentIndex++;
                renderExercise();
                updateExerciseProgress();
            } else {
                closeExerciseModal();
                alert('ðŸŽ‰ Congratulations! You have completed all 10 exercises!');
            }
        }

        function prevExercise() {
            if (exerciseState.currentIndex > 0) {
                exerciseState.currentIndex--;
                renderExercise();
                updateExerciseProgress();
            }
        }

        function goToExercise(index) {
            exerciseState.currentIndex = index;
            renderExercise();
            updateExerciseProgress();
        }

        // ============================================
        // SECURITIES MODAL
        // ============================================
        function openSecuritiesModal() {
            document.getElementById('securities-modal').classList.add('active');
            renderSecuritiesList();
            document.getElementById('securities-search').value = '';
            document.getElementById('securities-search').focus();
        }

        function closeSecuritiesModal() {
            document.getElementById('securities-modal').classList.remove('active');
        }

        function renderSecuritiesList() {
            // Group securities by sector
            const sectors = {};
            for (const [ticker, info] of Object.entries(MarketData.securities)) {
                if (!sectors[info.sector]) {
                    sectors[info.sector] = [];
                }
                sectors[info.sector].push({ ticker, ...info });
            }

            // Define sector order
            const sectorOrder = [
                'Index', 'Technology', 'Financial Services', 'Healthcare', 
                'Consumer Cyclical', 'Consumer Staples', 'Energy', 
                'Industrials', 'Communication Services', 'Utilities', 
                'Real Estate', 'Materials'
            ];

            let html = '';
            for (const sector of sectorOrder) {
                if (sectors[sector] && sectors[sector].length > 0) {
                    html += `
                        <div class="sector-group">
                            <div class="sector-title">${sector} (${sectors[sector].length})</div>
                            <div class="securities-grid">
                    `;
                    
                    // Sort by ticker within sector
                    sectors[sector].sort((a, b) => a.ticker.localeCompare(b.ticker));
                    
                    for (const sec of sectors[sector]) {
                        html += `
                            <div class="security-item" 
                                 data-ticker="${sec.ticker}" 
                                 data-name="${sec.name.toLowerCase()}"
                                 onclick="selectSecurity('${sec.ticker}')">
                                <span class="security-ticker">${sec.ticker}</span>
                                <span class="security-name">${sec.name}</span>
                            </div>
                        `;
                    }
                    
                    html += `
                            </div>
                        </div>
                    `;
                }
            }

            document.getElementById('securities-list').innerHTML = html;
        }

        function filterSecurities(query) {
            const searchTerm = query.toLowerCase().trim();
            const items = document.querySelectorAll('.security-item');
            
            items.forEach(item => {
                const ticker = item.dataset.ticker.toLowerCase();
                const name = item.dataset.name;
                
                if (searchTerm === '' || ticker.includes(searchTerm) || name.includes(searchTerm)) {
                    item.classList.remove('hidden');
                } else {
                    item.classList.add('hidden');
                }
            });

            // Hide empty sector groups
            document.querySelectorAll('.sector-group').forEach(group => {
                const visibleItems = group.querySelectorAll('.security-item:not(.hidden)');
                group.style.display = visibleItems.length > 0 ? 'block' : 'none';
            });
        }

        function selectSecurity(ticker) {
            closeSecuritiesModal();
            state.currentTicker = ticker;
            document.getElementById('current-ticker').textContent = ticker + ' US';
            document.getElementById('command-input').value = ticker;
            showDescription();
        }

        // ============================================
        // TAB NAVIGATION
        // ============================================
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.dataset.tab;
                
                switch(tabName) {
                    case 'overview':
                        showView('welcome');
                        break;
                    case 'fundamentals':
                        showFinancialAnalysis();
                        break;
                    case 'charts':
                        showPriceChart();
                        break;
                    case 'news':
                        showNews();
                        break;
                    case 'economics':
                        showEconomicIndicators();
                        break;
                }
            });
        });

        // ============================================
        // INITIALIZATION
        // ============================================
        function updateTime() {
            const now = new Date();
            document.getElementById('header-time').textContent = 
                now.toLocaleTimeString('en-US', { hour12: false });
            document.getElementById('footer-date').textContent = 
                now.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' });
        }

        function init() {
            updateTime();
            setInterval(updateTime, 1000);
            commandInput.focus();

            // Initialize welcome data
            document.getElementById('welcome-spx').textContent = formatNumber(MarketData.getPrice('SPX', 0.001));
            document.getElementById('welcome-djia').textContent = formatNumber(MarketData.getPrice('DJIA', 0.001));
            document.getElementById('welcome-ndx').textContent = formatNumber(MarketData.getPrice('NDX', 0.001));
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (document.getElementById('report-modal').classList.contains('active')) {
                    closeReportModal();
                }
                if (document.getElementById('exercise-modal').classList.contains('active')) {
                    closeExerciseModal();
                }
                if (document.getElementById('securities-modal').classList.contains('active')) {
                    closeSecuritiesModal();
                }
            }
        });

        // Close modals when clicking overlay
        document.getElementById('exercise-modal').addEventListener('click', (e) => {
            if (e.target.id === 'exercise-modal') closeExerciseModal();
        });
        document.getElementById('securities-modal').addEventListener('click', (e) => {
            if (e.target.id === 'securities-modal') closeSecuritiesModal();
        });
        document.getElementById('report-modal').addEventListener('click', (e) => {
            if (e.target.id === 'report-modal') closeReportModal();
        });

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
