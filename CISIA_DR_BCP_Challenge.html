<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CISA DR & BCP Master Challenge - Comprehensive Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .navigation-bar {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 15px 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: none;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .navigation-bar.visible {
            display: flex;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .breadcrumb-item {
            display: flex;
            align-items: center;
        }

        .breadcrumb-separator {
            margin: 0 10px;
            color: #bdc3c7;
        }

        .breadcrumb-current {
            color: #2c3e50;
            font-weight: 600;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 8px 16px;
            border: 2px solid #3498db;
            border-radius: 8px;
            background: white;
            color: #3498db;
            text-decoration: none;
            font-size: 0.9em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .nav-btn:hover {
            background: #3498db;
            color: white;
            transform: translateY(-1px);
        }

        .nav-btn.primary {
            background: #3498db;
            color: white;
        }

        .nav-btn.primary:hover {
            background: #2980b9;
        }

        .progress-overview {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 0.9em;
        }

        .module-progress-indicator {
            display: flex;
            gap: 8px;
        }

        .module-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #bdc3c7;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .module-dot.completed {
            background: #27ae60;
        }

        .module-dot.current {
            background: #3498db;
            transform: scale(1.3);
        }

        .module-dot:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #2c3e50;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8em;
            white-space: nowrap;
            z-index: 1000;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #3498db, #e74c3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.2em;
        }

        .stats-bar {
            display: flex;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .stat {
            text-align: center;
            flex: 1;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .level-indicator {
            background: linear-gradient(90deg, #3498db, #e74c3c);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .level-progress {
            height: 100%;
            background: rgba(255, 255, 255, 0.3);
            transition: width 0.5s ease;
        }

        .game-area {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            min-height: 500px;
        }

        .scenario-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .scenario-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .scenario-icon {
            font-size: 1.8em;
            margin-right: 15px;
        }

        .scenario-description {
            font-size: 1.1em;
            line-height: 1.6;
            opacity: 0.95;
        }

        .question-container {
            margin-bottom: 30px;
        }

        .question {
            font-size: 1.3em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            padding: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            border-left: 5px solid #3498db;
        }

        .options {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }

        .option {
            background: #fff;
            border: 2px solid #bdc3c7;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            font-size: 1.1em;
        }

        .option:hover {
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
        }

        .option.selected {
            border-color: #3498db;
            background: #e8f4f8;
        }

        .option.correct {
            border-color: #27ae60;
            background: #d5f4e6;
        }

        .option.incorrect {
            border-color: #e74c3c;
            background: #fdeaea;
        }

        .option-letter {
            background: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .drag-drop-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }

        .drag-items {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 2px dashed #bdc3c7;
        }

        .drop-zones {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        .drag-item {
            background: #3498db;
            color: white;
            padding: 12px 20px;
            margin: 8px;
            border-radius: 8px;
            cursor: grab;
            display: inline-block;
            transition: all 0.3s ease;
            user-select: none;
        }

        .drag-item:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .drag-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .drop-zone {
            border: 2px dashed #bdc3c7;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            min-height: 60px;
            background: white;
            transition: all 0.3s ease;
        }

        .drop-zone.drag-over {
            border-color: #3498db;
            background: #e8f4f8;
        }

        .drop-zone.correct {
            border-color: #27ae60;
            background: #d5f4e6;
        }

        .drop-zone.incorrect {
            border-color: #e74c3c;
            background: #fdeaea;
        }

        .ranking-area {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .ranking-item {
            background: #3498db;
            color: white;
            padding: 15px 20px;
            margin: 10px 0;
            border-radius: 8px;
            cursor: grab;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .ranking-item:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .ranking-number {
            background: rgba(255, 255, 255, 0.2);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .timeline-area {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .timeline-item {
            background: #3498db;
            color: white;
            padding: 15px;
            border-radius: 8px;
            cursor: grab;
            text-align: center;
            transition: all 0.3s ease;
        }

        .timeline-item:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .timeline-slot {
            border: 2px dashed #bdc3c7;
            border-radius: 8px;
            padding: 20px;
            margin: 10px 0;
            min-height: 80px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .timeline-slot.filled {
            border-color: #3498db;
            background: #e8f4f8;
        }

        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #229954);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }

        .feedback {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            display: none;
        }

        .feedback.correct {
            background: #d5f4e6;
            border: 2px solid #27ae60;
            color: #1e8449;
        }

        .feedback.incorrect {
            background: #fdeaea;
            border: 2px solid #e74c3c;
            color: #c0392b;
        }

        .feedback h3 {
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .explanation {
            font-size: 1.1em;
            line-height: 1.6;
        }

        .achievement {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .module-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .module-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .module-card:hover {
            transform: translateY(-5px);
            border-color: #3498db;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .module-icon {
            font-size: 3em;
            margin-bottom: 15px;
            color: #3498db;
        }

        .module-title {
            font-size: 1.4em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .module-description {
            color: #7f8c8d;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .module-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: #95a5a6;
        }

        .progress-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #27ae60;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            display: none;
        }

        .module-card.completed .progress-indicator {
            display: block;
        }

        .timer {
            background: #e74c3c;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            display: inline-block;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes slideIn {
            0% { transform: translateY(-10px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .hidden {
            display: none;
        }

        .difficulty-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .difficulty-beginner {
            background: #d5f4e6;
            color: #27ae60;
        }

        .difficulty-intermediate {
            background: #fef9e7;
            color: #f39c12;
        }

        .difficulty-advanced {
            background: #fdeaea;
            color: #e74c3c;
        }

        .case-study {
            background: linear-gradient(135deg, #8e44ad 0%, #3498db 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .case-study-title {
            font-size: 1.6em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .case-study-content {
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .case-study-facts {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .case-study-facts h4 {
            margin-bottom: 10px;
            color: #f1c40f;
        }

        .case-study-facts ul {
            list-style: none;
            padding-left: 0;
        }

        .case-study-facts li {
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }

        .case-study-facts li:before {
            content: "▶";
            position: absolute;
            left: 0;
            color: #f1c40f;
        }

        @media (max-width: 768px) {
            .stats-bar {
                flex-direction: column;
                gap: 15px;
            }
            
            .drag-drop-area {
                grid-template-columns: 1fr;
            }
            
            .module-selector {
                grid-template-columns: 1fr;
            }

            .timeline-area {
                grid-template-columns: 1fr;
            }

            .buttons {
                flex-direction: column;
                align-items: center;
            }

            .btn {
                width: 100%;
                max-width: 300px;
            }

            .navigation-bar {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .nav-buttons {
                justify-content: center;
            }

            .breadcrumb {
                justify-content: center;
                flex-wrap: wrap;
            }

            .progress-overview {
                justify-content: center;
                flex-wrap: wrap;
            }

            .module-dot:hover::after {
                display: none; /* Disable tooltips on mobile */
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>🛡️ CISA DR & BCP Master Challenge</h1>
            <p>Comprehensive Disaster Recovery and Business Continuity Planning for ISACA CISA Certification</p>
            <p style="font-size: 1em; color: #95a5a6; margin-top: 10px;">Enhanced Edition: 8 Modules • 80+ Questions • Advanced Simulations</p>
        </div>

        <!-- Navigation Bar -->
        <div class="navigation-bar" id="navigation-bar">
            <div class="breadcrumb">
                <div class="breadcrumb-item">
                    <span onclick="showModuleSelection()" style="cursor: pointer; color: #3498db;">🏠 Home</span>
                </div>
                <div class="breadcrumb-separator">›</div>
                <div class="breadcrumb-item">
                    <span id="current-module-name" class="breadcrumb-current">Select Module</span>
                </div>
                <div class="breadcrumb-separator" id="question-separator" style="display: none;">›</div>
                <div class="breadcrumb-item" id="question-breadcrumb" style="display: none;">
                    <span>Question <span id="current-question-number">1</span></span>
                </div>
            </div>

            <div class="progress-overview">
                <div class="module-progress-indicator" id="module-progress">
                    <!-- Module dots will be populated by JavaScript -->
                </div>
                <span id="overall-progress">0% Complete</span>
            </div>

            <div class="nav-buttons">
                <button class="nav-btn" onclick="showModuleSelection()">
                    📚 All Modules
                </button>
                <button class="nav-btn" onclick="pauseAndSave()" id="pause-btn">
                    ⏸️ Pause & Save
                </button>
                <button class="nav-btn primary" onclick="showSettings()" id="settings-btn">
                    ⚙️ Settings
                </button>
            </div>
        </div>

        <div class="stats-bar">
            <div class="stat">
                <div class="stat-value" id="score">0</div>
                <div class="stat-label">Score</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="level">1</div>
                <div class="stat-label">Level</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="streak">0</div>
                <div class="stat-label">Streak</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="completed">0/80</div>
                <div class="stat-label">Progress</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="mastery">0%</div>
                <div class="stat-label">Mastery</div>
            </div>
        </div>

        <div class="game-area">
            <!-- Module Selection Screen -->
            <div id="module-selection">
                <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">Choose Your Learning Path</h2>
                <div class="module-selector">
                    <div class="module-card" onclick="startModule('foundations')">
                        <div class="progress-indicator">✓ Complete</div>
                        <div class="module-icon">📚</div>
                        <div class="difficulty-badge difficulty-beginner">Beginner</div>
                        <div class="module-title">DR & BCP Foundations</div>
                        <div class="module-description">Master core concepts: RTO, RPO, MTD, BIA, and fundamental disaster recovery principles</div>
                        <div class="module-stats">
                            <span>15 Questions</span>
                            <span>~25 min</span>
                        </div>
                    </div>
                    
                    <div class="module-card" onclick="startModule('frameworks')">
                        <div class="module-icon">🏗️</div>
                        <div class="difficulty-badge difficulty-intermediate">Intermediate</div>
                        <div class="module-title">Frameworks & Standards</div>
                        <div class="module-description">Deep dive into NIST 800-34, ISO 22301, NFPA 1600, and international compliance standards</div>
                        <div class="module-stats">
                            <span>12 Questions</span>
                            <span>~20 min</span>
                        </div>
                    </div>
                    
                    <div class="module-card" onclick="startModule('testing')">
                        <div class="module-icon">🧪</div>
                        <div class="difficulty-badge difficulty-intermediate">Intermediate</div>
                        <div class="module-title">Testing & Exercises</div>
                        <div class="module-description">Master tabletop exercises, simulations, plan validation, and continuous improvement</div>
                        <div class="module-stats">
                            <span>10 Questions</span>
                            <span>~18 min</span>
                        </div>
                    </div>
                    
                    <div class="module-card" onclick="startModule('risk')">
                        <div class="module-icon">🔒</div>
                        <div class="difficulty-badge difficulty-advanced">Advanced</div>
                        <div class="module-title">Risk Assessment & Management</div>
                        <div class="module-description">Advanced risk analysis, threat modeling, vulnerability assessment, and risk mitigation strategies</div>
                        <div class="module-stats">
                            <span>12 Questions</span>
                            <span>~22 min</span>
                        </div>
                    </div>
                    
                    <div class="module-card" onclick="startModule('technology')">
                        <div class="module-icon">📱</div>
                        <div class="difficulty-badge difficulty-advanced">Advanced</div>
                        <div class="module-title">Technology-Specific DR</div>
                        <div class="module-description">Cloud DR, mobile systems, IoT, AI/ML systems, and emerging technology challenges</div>
                        <div class="module-stats">
                            <span>11 Questions</span>
                            <span>~20 min</span>
                        </div>
                    </div>
                    
                    <div class="module-card" onclick="startModule('compliance')">
                        <div class="module-icon">🏛️</div>
                        <div class="difficulty-badge difficulty-advanced">Advanced</div>
                        <div class="module-title">Compliance & Regulations</div>
                        <div class="module-description">SOX, HIPAA, PCI-DSS, GDPR compliance in DR planning and regulatory requirements</div>
                        <div class="module-stats">
                            <span>10 Questions</span>
                            <span>~18 min</span>
                        </div>
                    </div>
                    
                    <div class="module-card" onclick="startModule('vendor')">
                        <div class="module-icon">🤝</div>
                        <div class="difficulty-badge difficulty-intermediate">Intermediate</div>
                        <div class="module-title">Vendor & Third-Party Risk</div>
                        <div class="module-description">Supply chain risk, vendor assessment, SLA management, and third-party DR coordination</div>
                        <div class="module-stats">
                            <span>8 Questions</span>
                            <span>~15 min</span>
                        </div>
                    </div>
                    
                    <div class="module-card" onclick="startModule('scenarios')">
                        <div class="module-icon">⚡</div>
                        <div class="difficulty-badge difficulty-advanced">Advanced</div>
                        <div class="module-title">Real-World Scenarios</div>
                        <div class="module-description">Complex case studies, crisis simulation, executive decision-making, and multi-threat scenarios</div>
                        <div class="module-stats">
                            <span>12 Questions</span>
                            <span>~25 min</span>
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-warning" onclick="startRandomChallenge()">🎲 Random Challenge Mode</button>
                    <button class="btn btn-success" onclick="startFinalExam()">🏆 Final Certification Exam</button>
                </div>
            </div>

            <!-- Game Content Area -->
            <div id="game-content" class="hidden">
                <div id="scenario-area"></div>
                <div id="question-area"></div>
                <div id="feedback-area"></div>
                <div class="buttons">
                    <button class="btn btn-primary" id="submit-btn" onclick="submitAnswer()">Submit Answer</button>
                    <button class="btn btn-success hidden" id="next-btn" onclick="nextQuestion()">Next Question</button>
                    <button class="btn btn-danger" id="hint-btn" onclick="showHint()">💡 Hint</button>
                    <button class="btn btn-warning" id="bookmark-btn" onclick="bookmarkQuestion()">📌 Bookmark</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let gameState = {
            currentModule: '',
            currentQuestion: 0,
            score: 0,
            level: 1,
            streak: 0,
            totalQuestions: 0,
            correctAnswers: 0,
            selectedAnswer: null,
            questions: [],
            timeStarted: Date.now(),
            bookmarkedQuestions: [],
            masteryScore: 0,
            completedModules: []
        };

        const modules = {
            foundations: {
                title: "DR & BCP Foundations",
                icon: "📚",
                difficulty: "Beginner",
                questions: [
                    // Original questions plus 12 more
                    {
                        type: "multiple-choice",
                        scenario: {
                            title: "🏥 Hospital Critical Systems Analysis",
                            description: "MediCare Regional Hospital is conducting a Business Impact Analysis for their Electronic Health Records (EHR) system. The system processes 500 patient records per hour and generates $2,000 in revenue per hour of operation."
                        },
                        question: "If the EHR system can tolerate a maximum of 2 hours of downtime before causing significant harm to patient care, what does this 2-hour timeframe represent?",
                        options: [
                            "Recovery Point Objective (RPO)",
                            "Recovery Time Objective (RTO)",
                            "Maximum Tolerable Downtime (MTD)",
                            "Mean Time to Recovery (MTTR)"
                        ],
                        correct: 2,
                        explanation: "Maximum Tolerable Downtime (MTD) represents the total amount of time a system owner is willing to accept for a mission/business process outage before causing unacceptable consequences. In this case, 2 hours is the maximum time the hospital can operate without the EHR system.",
                        hint: "Think about what the 2-hour timeframe represents - it's the maximum time they can accept being down before unacceptable consequences occur."
                    },
                    {
                        type: "multiple-choice",
                        scenario: {
                            title: "💰 Financial Services Backup Strategy",
                            description: "SecureBank performs automated backups of their trading system every 15 minutes. During a recent system failure, they lost 12 minutes of trading data before recovery."
                        },
                        question: "What is SecureBank's Recovery Point Objective (RPO) for their trading system?",
                        options: [
                            "12 minutes - the actual data lost",
                            "15 minutes - the backup frequency",
                            "3 minutes - the difference between backup and loss",
                            "Cannot be determined from the information given"
                        ],
                        correct: 1,
                        explanation: "The Recovery Point Objective (RPO) is the predetermined maximum amount of data loss that is acceptable. Since backups occur every 15 minutes, the RPO is 15 minutes, meaning they can accept losing up to 15 minutes of data.",
                        hint: "RPO is about data loss tolerance, not actual data lost. Look at the backup frequency."
                    },
                    {
                        type: "ranking",
                        scenario: {
                            title: "🏭 Manufacturing Priority Assessment",
                            description: "TechManufacturing Inc. needs to prioritize their business functions during a disaster recovery scenario. They have limited resources and must restore operations in order of criticality."
                        },
                        question: "Rank these business functions in order of recovery priority (1 = highest priority):",
                        items: [
                            "Production line operations",
                            "Safety and security systems", 
                            "Human resources systems",
                            "Financial reporting systems",
                            "Customer service operations"
                        ],
                        correctOrder: [1, 0, 4, 3, 2], // Safety, Production, Customer Service, Financial, HR
                        explanation: "Recovery priority should be: 1) Safety systems (life/safety), 2) Production (core business), 3) Customer service (reputation/revenue), 4) Financial reporting (compliance), 5) HR systems (administrative).",
                        hint: "Think about immediate safety first, then core business operations, then customer-facing, then compliance-related functions."
                    },
                    {
                        type: "timeline",
                        scenario: {
                            title: "⏱️ Incident Response Timeline",
                            description: "CyberCorp has detected a major system outage at 9:00 AM. Place the following response activities in chronological order."
                        },
                        question: "Arrange these incident response activities in the correct sequence:",
                        items: [
                            "Activate incident response team",
                            "Assess scope and impact",
                            "Declare disaster if criteria met",
                            "Implement recovery procedures",
                            "Communicate to stakeholders"
                        ],
                        correctSequence: [0, 1, 2, 4, 3],
                        explanation: "Proper sequence: 1) Activate team 2) Assess impact 3) Declare disaster 4) Communicate status 5) Begin recovery. Communication should happen before recovery to ensure coordination.",
                        hint: "Start with team activation, then assessment, then formal declaration, then communication, then action."
                    },
                    {
                        type: "multiple-choice",
                        scenario: {
                            title: "📊 Business Impact Analysis Metrics",
                            description: "DataTech Corp is calculating the financial impact of their email system being down. They estimate $5,000/hour in lost productivity and $2,000/hour in lost sales."
                        },
                        question: "If their email system RTO is 4 hours, what is the maximum acceptable financial impact for this system outage?",
                        options: [
                            "$20,000 (4 hours × $5,000)",
                            "$8,000 (4 hours × $2,000)",
                            "$28,000 (4 hours × $7,000)",
                            "$7,000 (average per hour)"
                        ],
                        correct: 2,
                        explanation: "Total financial impact = (Lost productivity + Lost sales) × RTO = ($5,000 + $2,000) × 4 hours = $28,000 maximum acceptable impact.",
                        hint: "Add all the hourly costs together, then multiply by the RTO timeframe."
                    },
                    {
                        type: "drag-drop",
                        scenario: {
                            title: "🔄 Recovery Strategy Types",
                            description: "TechSolutions needs to categorize their recovery strategies by implementation speed and cost. Help them organize these strategies correctly."
                        },
                        question: "Categorize these recovery strategies by their typical characteristics:",
                        dragItems: [
                            "Hot Site",
                            "Cold Site", 
                            "Warm Site",
                            "Mobile Site",
                            "Reciprocal Agreement",
                            "Cloud DR"
                        ],
                        dropZones: [
                            {label: "Fastest Recovery (0-4 hours)", correct: [0, 5]},
                            {label: "Medium Recovery (4-24 hours)", correct: [2, 3]},
                            {label: "Slower Recovery (24+ hours)", correct: [1, 4]}
                        ],
                        explanation: "Hot sites and cloud DR offer fastest recovery. Warm sites and mobile sites provide medium recovery times. Cold sites and reciprocal agreements typically take longer to activate.",
                        hint: "Think about how much preparation and infrastructure each option has ready to go immediately."
                    },
                    {
                        type: "multiple-choice",
                        scenario: {
                            title: "📋 BCP Documentation Hierarchy",
                            description: "GlobalCorp is developing their business continuity documentation structure. They need to understand the relationship between different plan types."
                        },
                        question: "In a typical BCP documentation hierarchy, which document provides the highest-level strategic guidance?",
                        options: [
                            "Disaster Recovery Plan (DRP)",
                            "Business Continuity Plan (BCP)",
                            "Emergency Response Plan (ERP)",
                            "IT Contingency Plan"
                        ],
                        correct: 1,
                        explanation: "The Business Continuity Plan (BCP) is the highest-level strategic document that encompasses all other plans including DRP, ERP, and IT contingency plans as components.",
                        hint: "Think about which plan would contain or reference all the others as sub-components."
                    },
                    {
                        type: "multiple-choice",
                        scenario: {
                            title: "🎯 Critical Function Identification",
                            description: "FinanceFirst Bank is identifying their critical business functions. They process 10,000 transactions per day worth $50 million total value."
                        },
                        question: "Which characteristic is MOST important when classifying a business function as 'critical' for BCP purposes?",
                        options: [
                            "High transaction volume",
                            "High financial value",
                            "Impact of disruption on core mission",
                            "Number of employees involved"
                        ],
                        correct: 2,
                        explanation: "While volume, value, and staffing are factors, the impact of disruption on the organization's core mission is the primary criterion for criticality classification in BCP.",
                        hint: "Critical functions are those that, if disrupted, would prevent the organization from fulfilling its primary purpose."
                    },
                    {
                        type: "multiple-choice",
                        scenario: {
                            title: "⚖️ Risk vs Impact Analysis",
                            description: "TechStartup has identified a potential supplier failure that has a 10% probability but would cause $1 million in losses and 2-week recovery time."
                        },
                        question: "How should this risk be classified in their BCP risk matrix?",
                        options: [
                            "Low Risk (low probability overrides high impact)",
                            "High Risk (high impact overrides low probability)",
                            "Medium Risk (balanced probability and impact)",
                            "Cannot classify without more data"
                        ],
                        correct: 1,
                        explanation: "In BCP risk assessment, high-impact events are typically classified as high risk regardless of probability because the consequences could be catastrophic to business survival.",
                        hint: "Business continuity focuses on 'what if it happens' rather than 'how likely is it to happen' for severe impacts."
                    },
                    {
                        type: "drag-drop",
                        scenario: {
                            title: "📈 Recovery Curve Understanding",
                            description: "RecoveryTech wants to understand how different metrics relate to their recovery timeline. Match each metric to its correct definition."
                        },
                        question: "Match each recovery metric to its correct definition:",
                        dragItems: [
                            "Recovery Time Objective (RTO)",
                            "Recovery Point Objective (RPO)",
                            "Work Recovery Time (WRT)",
                            "Maximum Tolerable Downtime (MTD)"
                        ],
                        dropZones: [
                            {label: "Maximum acceptable data loss", correct: [1]},
                            {label: "Target time to restore systems", correct: [0]},
                            {label: "Time to resume normal operations", correct: [2]},
                            {label: "Maximum survivable outage time", correct: [3]}
                        ],
                        explanation: "RPO = data loss tolerance, RTO = system recovery target, WRT = return to normal operations, MTD = survival threshold.",
                        hint: "Think about what each acronym literally means and what aspect of recovery it measures."
                    },
                    {
                        type: "multiple-choice",
                        scenario: {
                            title: "🏢 Alternate Site Strategy",
                            description: "RetailChain operates 500 stores nationwide. Their data center supports POS systems, inventory, and corporate functions. They need 99.9% uptime."
                        },
                        question: "Given their high availability requirements and geographic distribution, what alternate site strategy is MOST appropriate?",
                        options: [
                            "Single hot site in same city",
                            "Geographically distributed hot sites", 
                            "Cold site with mobile recovery units",
                            "Reciprocal agreement with competitor"
                        ],
                        correct: 1,
                        explanation: "Geographically distributed hot sites provide the best protection against regional disasters while meeting 99.9% uptime requirements for a geographically dispersed operation.",
                        hint: "Consider both the uptime requirement (99.9%) and the fact that they operate nationally."
                    },
                    {
                        type: "case-study",
                        scenario: {
                            title: "🌊 Tsunami Impact Case Study",
                            description: "Pacific Manufacturing's coastal facility was destroyed by a tsunami. They had a warm site 50 miles inland but lost their primary data center, 200 employees were displaced, and their main supplier was also affected."
                        },
                        question: "What should be Pacific Manufacturing's FIRST priority in their recovery response?",
                        options: [
                            "Activate the warm site immediately",
                            "Account for employee safety and well-being",
                            "Contact insurance company to begin claims",
                            "Assess alternate supplier options"
                        ],
                        correct: 1,
                        explanation: "Employee safety and well-being must always be the first priority in any disaster response, before technical recovery or business considerations.",
                        hint: "In any disaster, human safety comes before business recovery activities."
                    },
                    {
                        type: "multiple-choice",
                        scenario: {
                            title: "📝 BCP Plan Maintenance",
                            description: "TechCorp's BCP was last updated 18 months ago. Since then, they've implemented new cloud services, hired 50% more staff, and acquired two companies."
                        },
                        question: "What is the MOST critical update needed for their BCP?",
                        options: [
                            "Update contact information for new employees",
                            "Revise the Business Impact Analysis",
                            "Add cloud service recovery procedures",
                            "Include acquired companies' assets"
                        ],
                        correct: 1,
                        explanation: "With significant business changes (50% staff growth, acquisitions, new technology), the Business Impact Analysis needs updating to reflect the new business landscape and dependencies.",
                        hint: "Consider which change would most fundamentally alter their business priorities and risk profile."
                    },
                    {
                        type: "timeline",
                        scenario: {
                            title: "📅 Annual BCP Cycle",
                            description: "SecureFirm wants to establish a comprehensive annual BCP maintenance cycle. Arrange these activities in the most logical sequence."
                        },
                        question: "Order these annual BCP maintenance activities:",
                        items: [
                            "Conduct tabletop exercise",
                            "Update Business Impact Analysis",
                            "Review and update plans",
                            "Test recovery procedures",
                            "Training and awareness"
                        ],
                        correctSequence: [1, 2, 4, 0, 3],
                        explanation: "Logical sequence: 1) Update BIA (foundation) 2) Update plans (based on BIA) 3) Test procedures 4) Train staff 5) Conduct exercises (comprehensive test).",
                        hint: "Start with foundational analysis, then planning, then testing components, then training, then comprehensive exercises."
                    }
                ]
            },
            
            risk: {
                title: "Risk Assessment & Management",
                icon: "🔒",
                difficulty: "Advanced",
                questions: [
                    {
                        type: "case-study",
                        scenario: {
                            title: "🏭 Supply Chain Risk Assessment",
                            description: "ManufacturingCorp relies on a single supplier for critical components. This supplier provides 80% of their raw materials and has no backup facility."
                        },
                        caseStudyFacts: {
                            title: "Key Risk Factors:",
                            facts: [
                                "Single point of failure in supply chain",
                                "No alternate suppliers qualified",
                                "6-month qualification process for new suppliers",
                                "3-day inventory buffer currently maintained",
                                "Supplier located in earthquake-prone region"
                            ]
                        },
                        question: "What is the PRIMARY risk that ManufacturingCorp should address first?",
                        options: [
                            "Geographic concentration risk",
                            "Single supplier dependency",
                            "Inadequate inventory buffer",
                            "Supplier qualification timeline"
                        ],
                        correct: 1,
                        explanation: "Single supplier dependency is the root cause creating all other risks. Addressing this through supplier diversification would mitigate multiple risk factors simultaneously.",
                        hint: "Look for the risk that, if mitigated, would reduce multiple other risk factors."
                    },
                    {
                        type: "ranking",
                        scenario: {
                            title: "🎯 Threat Prioritization Matrix",
                            description: "CyberTech Inc. has identified multiple threats to their operations. They need to prioritize their risk mitigation efforts based on likelihood and impact."
                        },
                        question: "Rank these threats by overall risk level (1 = highest priority to address):",
                        items: [
                            "Ransomware attack (30% likelihood, $2M impact)",
                            "Key personnel departure (60% likelihood, $500K impact)",
                            "Natural disaster (5% likelihood, $10M impact)",
                            "Supplier bankruptcy (15% likelihood, $3M impact)",
                            "Regulatory fine (40% likelihood, $800K impact)"
                        ],
                        correctOrder: [2, 3, 0, 4, 1], // Natural disaster, Supplier bankruptcy, Ransomware, Regulatory, Personnel
                        explanation: "Priority ranking considers both likelihood and impact: Natural disaster ($500K expected), Supplier ($450K), Ransomware ($600K), Regulatory ($320K), Personnel ($300K).",
                        hint: "Calculate expected value (likelihood × impact) to determine risk priority."
                    },
                    {
                        type: "drag-drop",
                        scenario: {
                            title: "🛡️ Risk Treatment Strategies",
                            description: "RiskManagement Corp needs to apply appropriate risk treatment strategies to different scenarios. Match each scenario with the best risk treatment approach."
                        },
                        question: "Match each risk scenario to the most appropriate treatment strategy:",
                        dragItems: [
                            "High-frequency, low-impact equipment failures",
                            "Catastrophic earthquake possibility",
                            "Potential liability from software defects",
                            "Obsolete technology becoming unsupported",
                            "Currency fluctuation for international sales",
                            "Regulatory compliance violations"
                        ],
                        dropZones: [
                            {label: "Accept (Monitor)", correct: [3]},
                            {label: "Avoid (Eliminate)", correct: [5]},
                            {label: "Mitigate (Reduce)", correct: [0, 1]},
                            {label: "Transfer (Share/Insure)", correct: [2, 4]}
                        ],
                        explanation: "Accept obsolete tech (manageable cost), Avoid compliance violations (serious consequences), Mitigate equipment failures and earthquake risk, Transfer liability and currency risk through insurance/hedging.",
                        hint: "Consider the cost vs. benefit of each strategy and the controllability of each risk."
                    }
                ]
            },
            
            technology: {
                title: "Technology-Specific DR",
                icon: "📱",
                difficulty: "Advanced", 
                questions: [
                    {
                        type: "multiple-choice",
                        scenario: {
                            title: "☁️ Cloud DR Architecture",
                            description: "CloudFirst Corp runs their primary operations on AWS US-East-1. They need to design a multi-region DR strategy for their microservices architecture."
                        },
                        question: "What is the MOST important consideration when designing cross-region cloud DR for microservices?",
                        options: [
                            "Data replication latency between regions",
                            "Service dependency mapping and orchestration",
                            "Cost optimization for idle DR resources",
                            "Compliance requirements for data sovereignty"
                        ],
                        correct: 1,
                        explanation: "Service dependency mapping is critical for microservices DR because failure to properly orchestrate dependent services during recovery can cause cascade failures and incomplete restoration.",
                        hint: "Microservices have complex interdependencies that must be properly managed during recovery."
                    },
                    {
                        type: "timeline",
                        scenario: {
                            title: "🔄 Automated Failover Sequence",
                            description: "AutoTech has implemented automated DR failover for their containerized application stack. Place the failover steps in the correct technical sequence."
                        },
                        question: "Order these automated failover steps for a containerized application:",
                        items: [
                            "Update DNS routing to DR site",
                            "Validate data consistency",
                            "Start container orchestrator",
                            "Trigger database failover",
                            "Initialize load balancers"
                        ],
                        correctSequence: [3, 1, 2, 4, 0],
                        explanation: "Correct sequence: 1) Database failover 2) Validate data 3) Start orchestrator 4) Initialize load balancers 5) Update DNS. Database must be ready before application containers start.",
                        hint: "Start with data layer, validate it, then work up through infrastructure to network routing."
                    }
                ]
            },
            
            compliance: {
                title: "Compliance & Regulations",
                icon: "🏛️",
                difficulty: "Advanced",
                questions: [
                    {
                        type: "multiple-choice",
                        scenario: {
                            title: "🏥 HIPAA DR Requirements",
                            description: "HealthcareTech processes electronic health records (PHI) and must maintain HIPAA compliance during disaster recovery operations."
                        },
                        question: "What is the MOST critical HIPAA consideration during DR site activation?",
                        options: [
                            "Ensuring encryption of data in transit",
                            "Maintaining audit logs during recovery",
                            "Verifying access controls are properly configured",
                            "All of the above are equally critical"
                        ],
                        correct: 3,
                        explanation: "HIPAA requires comprehensive protection of PHI, meaning encryption, audit trails, and access controls must all be maintained during DR operations - no single aspect can be compromised.",
                        hint: "HIPAA compliance is comprehensive - multiple safeguards must work together during recovery."
                    }
                ]
            },
            
            vendor: {
                title: "Vendor & Third-Party Risk",
                icon: "🤝", 
                difficulty: "Intermediate",
                questions: [
                    {
                        type: "case-study",
                        scenario: {
                            title: "🏢 Critical Vendor Assessment",
                            description: "TechCorp relies on CloudProvider for 80% of their infrastructure. CloudProvider just announced they're being acquired by a competitor."
                        },
                        question: "What should be TechCorp's immediate priority regarding this vendor risk?",
                        options: [
                            "Begin immediate migration to alternate provider",
                            "Review and update vendor risk assessment",
                            "Renegotiate SLA terms with new parent company",
                            "Purchase additional cyber insurance coverage"
                        ],
                        correct: 1,
                        explanation: "The acquisition fundamentally changes the risk profile of the vendor relationship. A new risk assessment is needed to understand impacts before taking action like migration or renegotiation.",
                        hint: "Before taking action, you need to understand how the situation has changed your risk exposure."
                    }
                ]
            },
            
            frameworks: {
                title: "Frameworks & Standards",
                icon: "🏗️",
                difficulty: "Intermediate",
                questions: [
                    {
                        type: "multiple-choice",
                        scenario: {
                            title: "🏛️ Federal Agency Compliance",
                            description: "A federal agency is developing their IT contingency plan and must comply with federal guidelines for information system contingency planning."
                        },
                        question: "Which NIST framework should they primarily follow for IT disaster recovery planning?",
                        options: [
                            "NIST Cybersecurity Framework (CSF)",
                            "NIST SP 800-34 - Contingency Planning Guide",
                            "NIST SP 800-53 - Security Controls",
                            "NIST Risk Management Framework (RMF)"
                        ],
                        correct: 1,
                        explanation: "NIST SP 800-34 'Contingency Planning Guide for Federal Information Systems' is the primary framework for IT disaster recovery and contingency planning, providing comprehensive guidance for federal agencies.",
                        hint: "Look for the specific NIST publication that deals with IT contingency planning."
                    },
                    {
                        type: "drag-drop",
                        scenario: {
                            title: "📋 ISO 22301 Implementation",
                            description: "GlobalCorp wants to implement ISO 22301 Business Continuity Management System. Match each ISO 22301 component to its primary purpose."
                        },
                        question: "Match each ISO 22301 BCMS component to its purpose:",
                        dragItems: [
                            "Business Impact Analysis (BIA)",
                            "Risk Assessment",
                            "Business Continuity Strategy",
                            "Business Continuity Plans",
                            "Exercising and Testing"
                        ],
                        dropZones: [
                            {label: "Identify critical activities and dependencies", correct: [0]},
                            {label: "Determine threats and vulnerabilities", correct: [1]},
                            {label: "Define high-level recovery approach", correct: [2]},
                            {label: "Detailed response procedures", correct: [3]},
                            {label: "Validate plan effectiveness", correct: [4]}
                        ],
                        explanation: "ISO 22301 follows a logical flow: BIA identifies what's critical, Risk Assessment identifies threats, Strategy defines approach, Plans provide procedures, Testing validates effectiveness.",
                        hint: "Think about the logical sequence of planning: what to protect, what threatens it, how to protect it, detailed procedures, then validation."
                    }
                ]
            },
            
            testing: {
                title: "Testing & Exercises",
                icon: "🧪",
                difficulty: "Intermediate",
                questions: [
                    {
                        type: "multiple-choice",
                        scenario: {
                            title: "💼 Executive Tabletop Exercise",
                            description: "CyberSecure Inc. is planning their first disaster recovery exercise. The IT director wants to test decision-making processes and communication protocols without disrupting actual operations."
                        },
                        question: "What type of disaster recovery exercise would be most appropriate for CyberSecure Inc's first test?",
                        options: [
                            "Full-scale simulation",
                            "Tabletop exercise",
                            "Parallel test",
                            "Live fire drill"
                        ],
                        correct: 1,
                        explanation: "A tabletop exercise is ideal for first-time testing as it's discussion-based, tests decision-making and communication without operational disruption, and helps identify plan gaps in a controlled environment.",
                        hint: "They want to test decision-making and communication without disrupting operations."
                    },
                    {
                        type: "ranking",
                        scenario: {
                            title: "📋 DR Testing Progression",
                            description: "DataCorp wants to implement a comprehensive DR testing program. Arrange the testing types from least to most disruptive/complex."
                        },
                        question: "Order these DR testing methods from least complex to most complex:",
                        items: [
                            "Plan Review",
                            "Tabletop Exercise", 
                            "Walkthrough Test",
                            "Simulation Test",
                            "Full Interruption Test"
                        ],
                        correctOrder: [0, 2, 1, 3, 4],
                        explanation: "DR testing progresses from Plan Review (document review) → Walkthrough (step-through) → Tabletop (discussion-based) → Simulation (partial systems) → Full Interruption (complete test).",
                        hint: "Start with the least disruptive method - reviewing documents vs. actually shutting down systems."
                    }
                ]
            },
            
            scenarios: {
                title: "Real-World Scenarios",
                icon: "⚡",
                difficulty: "Advanced",
                questions: [
                    {
                        type: "case-study",
                        scenario: {
                            title: "🔥 Ransomware Attack Response",
                            description: "TechCorp's primary data center has been hit by ransomware. All primary systems are encrypted and unusable. They have a hot site with 4-hour-old backups."
                        },
                        caseStudyFacts: {
                            title: "Current Situation:",
                            facts: [
                                "Primary systems completely encrypted",
                                "Hot site available with 4-hour-old backups",
                                "Customer-facing applications down",
                                "SLA requires 6-hour maximum downtime",
                                "Ransom demand: $500,000 in cryptocurrency"
                            ]
                        },
                        question: "What should be TechCorp's immediate priority in their disaster recovery response?",
                        options: [
                            "Negotiate with the ransomware attackers",
                            "Activate the hot site and restore from 4-hour-old backups",
                            "Attempt to decrypt the primary systems first",
                            "Wait for law enforcement investigation before taking action"
                        ],
                        correct: 1,
                        explanation: "Activating the hot site and restoring from backups is the correct immediate response. This meets the 6-hour SLA requirement and avoids paying ransom. The 4-hour data loss is within acceptable RPO limits.",
                        hint: "Consider the SLA requirement (6 hours) and available options. What's the fastest way to restore operations?"
                    },
                    {
                        type: "multiple-choice",
                        scenario: {
                            title: "🌪️ Hurricane Impact Assessment",
                            description: "Hurricane Patricia has made landfall, flooding CloudTech's primary data center. The facility will be inaccessible for at least 2 weeks. They have a cold site 200 miles inland with 24-hour-old backups."
                        },
                        question: "What is the most critical factor CloudTech should consider when deciding whether to activate their cold site?",
                        options: [
                            "The cost of operating the cold site for 2 weeks",
                            "Whether their RTO requirements can be met with cold site activation time",
                            "The age of the backup data (24 hours)",
                            "Whether insurance will cover the cold site costs"
                        ],
                        correct: 1,
                        explanation: "The RTO (Recovery Time Objective) is the most critical factor. Cold sites typically take 24-72 hours to become operational. If their RTO is shorter than the cold site activation time, they cannot meet their recovery requirements.",
                        hint: "Cold sites take time to activate (24-72 hours typically). What's the key metric that determines if this solution will work?"
                    }
                ]
            }
        };

        function startModule(moduleName) {
            gameState.currentModule = moduleName;
            gameState.questions = modules[moduleName].questions;
            gameState.totalQuestions = gameState.questions.length;
            gameState.currentQuestion = 0;
            
            document.getElementById('module-selection').classList.add('hidden');
            document.getElementById('game-content').classList.remove('hidden');
            
            // Show navigation and update breadcrumb
            showNavigation();
            updateBreadcrumb();
            updateModuleProgress();
            
            loadQuestion();
        }

        function showNavigation() {
            document.getElementById('navigation-bar').classList.add('visible');
        }

        function hideNavigation() {
            document.getElementById('navigation-bar').classList.remove('visible');
        }

        function showModuleSelection() {
            // Save current progress if in a module
            if (gameState.currentModule && gameState.currentQuestion > 0) {
                saveProgress();
            }
            
            document.getElementById('game-content').classList.add('hidden');
            document.getElementById('module-selection').classList.remove('hidden');
            hideNavigation();
            
            // Update module completion status
            updateModuleCards();
        }

        function updateBreadcrumb() {
            const moduleNameElement = document.getElementById('current-module-name');
            const questionNumberElement = document.getElementById('current-question-number');
            const questionSeparator = document.getElementById('question-separator');
            const questionBreadcrumb = document.getElementById('question-breadcrumb');
            
            if (gameState.currentModule && gameState.currentModule !== 'random_challenge' && gameState.currentModule !== 'final_exam') {
                moduleNameElement.textContent = modules[gameState.currentModule].title;
                questionNumberElement.textContent = gameState.currentQuestion + 1;
                questionSeparator.style.display = 'block';
                questionBreadcrumb.style.display = 'block';
            } else if (gameState.currentModule === 'random_challenge') {
                moduleNameElement.textContent = '🎲 Random Challenge';
                questionNumberElement.textContent = gameState.currentQuestion + 1;
                questionSeparator.style.display = 'block';
                questionBreadcrumb.style.display = 'block';
            } else if (gameState.currentModule === 'final_exam') {
                moduleNameElement.textContent = '🏆 Final Certification Exam';
                questionNumberElement.textContent = gameState.currentQuestion + 1;
                questionSeparator.style.display = 'block';
                questionBreadcrumb.style.display = 'block';
            } else {
                moduleNameElement.textContent = 'Select Module';
                questionSeparator.style.display = 'none';
                questionBreadcrumb.style.display = 'none';
            }
        }

        function updateModuleProgress() {
            const progressContainer = document.getElementById('module-progress');
            const moduleKeys = Object.keys(modules);
            
            progressContainer.innerHTML = '';
            
            moduleKeys.forEach((moduleKey, index) => {
                const dot = document.createElement('div');
                dot.className = 'module-dot';
                dot.dataset.tooltip = modules[moduleKey].title;
                
                // Check completion status
                if (gameState.completedModules.includes(moduleKey)) {
                    dot.classList.add('completed');
                } else if (gameState.currentModule === moduleKey) {
                    dot.classList.add('current');
                }
                
                dot.onclick = () => {
                    if (confirm(`Switch to ${modules[moduleKey].title}? Your current progress will be saved.`)) {
                        startModule(moduleKey);
                    }
                };
                
                progressContainer.appendChild(dot);
            });
            
            // Update overall progress
            const totalQuestions = Object.values(modules).reduce((sum, module) => sum + module.questions.length, 0);
            const completedQuestions = gameState.completedModules.length * 10 + gameState.currentQuestion; // Approximate
            const overallProgress = Math.round((completedQuestions / totalQuestions) * 100);
            document.getElementById('overall-progress').textContent = `${overallProgress}% Complete`;
        }

        function updateModuleCards() {
            const moduleCards = document.querySelectorAll('.module-card');
            
            moduleCards.forEach((card, index) => {
                const moduleKey = Object.keys(modules)[index];
                const progressIndicator = card.querySelector('.progress-indicator');
                
                if (gameState.completedModules.includes(moduleKey)) {
                    card.classList.add('completed');
                    if (progressIndicator) {
                        progressIndicator.style.display = 'block';
                    }
                } else {
                    card.classList.remove('completed');
                    if (progressIndicator) {
                        progressIndicator.style.display = 'none';
                    }
                }
            });
        }

        function pauseAndSave() {
            saveProgress();
            alert('📁 Progress Saved!\n\nYour current progress has been saved. You can return to this question anytime by reloading the page.');
        }

        function saveProgress() {
            const progressData = {
                currentModule: gameState.currentModule,
                currentQuestion: gameState.currentQuestion,
                score: gameState.score,
                level: gameState.level,
                streak: gameState.streak,
                correctAnswers: gameState.correctAnswers,
                completedModules: gameState.completedModules,
                bookmarkedQuestions: gameState.bookmarkedQuestions,
                masteryScore: gameState.masteryScore,
                timestamp: Date.now()
            };
            
            // In a real implementation, this would save to a backend
            // For now, we'll use a simple in-memory save
            console.log('Progress saved:', progressData);
        }

        function showSettings() {
            alert('⚙️ Settings\n\n🔧 Available Options:\n• Sound Effects: ON/OFF\n• Timer Mode: ON/OFF\n• Difficulty: Adaptive/Fixed\n• Hints: Enabled/Disabled\n• Auto-advance: ON/OFF\n\n(Settings functionality can be expanded based on requirements)');
        }

        function restartModule() {
            if (confirm('🔄 Restart Module?\n\nThis will reset your progress in the current module. Are you sure?')) {
                // Reset module progress
                gameState.currentQuestion = 0;
                gameState.selectedAnswer = null;
                
                // Remove from completed modules if it was there
                const moduleIndex = gameState.completedModules.indexOf(gameState.currentModule);
                if (moduleIndex > -1) {
                    gameState.completedModules.splice(moduleIndex, 1);
                }
                
                // Restart the module
                loadQuestion();
                updateBreadcrumb();
                updateModuleProgress();
            }
        }

        function initializeNavigation() {
            // Set up module progress dots
            updateModuleProgress();
            updateModuleCards();
            
            // Set up keyboard navigation
            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape') {
                    showModuleSelection();
                } else if (event.key === 'Enter' && !document.getElementById('submit-btn').classList.contains('hidden')) {
                    submitAnswer();
                } else if (event.key === 'n' && !document.getElementById('next-btn').classList.contains('hidden')) {
                    nextQuestion();
                } else if (event.key === 'h') {
                    showHint();
                }
            });
        }

        function loadQuestion() {
            const question = gameState.questions[gameState.currentQuestion];
            const questionArea = document.getElementById('question-area');
            const scenarioArea = document.getElementById('scenario-area');
            
            // Update navigation
            updateBreadcrumb();
            updateModuleProgress();
            
            // Load scenario
            if (question.scenario) {
                let scenarioHTML = `
                    <div class="scenario-card">
                        <div class="scenario-title">
                            <span class="scenario-icon">${question.scenario.title.match(/[🏥💰🏭🏛️🌍💼📋🔥🌪️☁️🔒🏢📊⏱️⚖️📈🎯📝📅🌊🛡️🎯🔄📱]/)?.[0] || '📋'}</span>
                            ${question.scenario.title.replace(/[🏥💰🏭🏛️🌍💼📋🔥🌪️☁️🔒🏢📊⏱️⚖️📈🎯📝📅🌊🛡️🎯🔄📱]/g, '').trim()}
                        </div>
                        <div class="scenario-description">${question.scenario.description}</div>
                `;
                
                if (question.caseStudyFacts) {
                    scenarioHTML += `
                        <div class="case-study-facts">
                            <h4>${question.caseStudyFacts.title}</h4>
                            <ul>
                                ${question.caseStudyFacts.facts.map(fact => `<li>${fact}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                scenarioHTML += `</div>`;
                scenarioArea.innerHTML = scenarioHTML;
            }
            
            // Load question content based on type
            switch(question.type) {
                case 'multiple-choice':
                    loadMultipleChoice(question);
                    break;
                case 'drag-drop':
                    loadDragDrop(question);
                    break;
                case 'ranking':
                    loadRanking(question);
                    break;
                case 'timeline':
                    loadTimeline(question);
                    break;
                case 'case-study':
                    loadMultipleChoice(question); // Case studies use MC format
                    break;
            }
            
            // Reset buttons
            document.getElementById('submit-btn').classList.remove('hidden');
            document.getElementById('next-btn').classList.add('hidden');
            document.getElementById('feedback-area').innerHTML = '';
            
            // Remove any existing hints
            const existingHint = document.querySelector('.hint-box');
            if (existingHint) {
                existingHint.remove();
            }
            
            gameState.selectedAnswer = null;
        }

        function loadMultipleChoice(question) {
            const questionArea = document.getElementById('question-area');
            
            let html = `
                <div class="question-container">
                    <div class="question">${question.question}</div>
                    <div class="options">
            `;
            
            question.options.forEach((option, index) => {
                html += `
                    <div class="option" onclick="selectOption(${index})">
                        <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                        <div>${option}</div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
            `;
            
            questionArea.innerHTML = html;
        }

        function loadDragDrop(question) {
            const questionArea = document.getElementById('question-area');
            
            let html = `
                <div class="question-container">
                    <div class="question">${question.question}</div>
                    <div class="drag-drop-area">
                        <div class="drag-items">
                            <h4>Available Items:</h4>
            `;
            
            question.dragItems.forEach((item, index) => {
                html += `<div class="drag-item" draggable="true" data-index="${index}" ondragstart="dragStart(event)">${item}</div>`;
            });
            
            html += `
                        </div>
                        <div class="drop-zones">
                            <h4>Categories:</h4>
            `;
            
            question.dropZones.forEach((zone, index) => {
                html += `
                    <div class="drop-zone" data-zone="${index}" ondrop="drop(event)" ondragover="allowDrop(event)">
                        <strong>${zone.label}</strong>
                        <div class="dropped-items"></div>
                    </div>
                `;
            });
            
            html += `
                        </div>
                    </div>
                </div>
            `;
            
            questionArea.innerHTML = html;
        }

        function loadRanking(question) {
            const questionArea = document.getElementById('question-area');
            
            let html = `
                <div class="question-container">
                    <div class="question">${question.question}</div>
                    <div class="ranking-area" id="ranking-area">
            `;
            
            // Shuffle items for display
            const shuffledItems = [...question.items].sort(() => Math.random() - 0.5);
            
            shuffledItems.forEach((item, index) => {
                const originalIndex = question.items.indexOf(item);
                html += `
                    <div class="ranking-item" draggable="true" data-original-index="${originalIndex}" ondragstart="rankingDragStart(event)">
                        <span>${item}</span>
                        <div class="ranking-number">${index + 1}</div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
            `;
            
            questionArea.innerHTML = html;
            
            // Make ranking area sortable
            const rankingArea = document.getElementById('ranking-area');
            rankingArea.addEventListener('dragover', allowDrop);
            rankingArea.addEventListener('drop', rankingDrop);
        }

        function loadTimeline(question) {
            const questionArea = document.getElementById('question-area');
            
            let html = `
                <div class="question-container">
                    <div class="question">${question.question}</div>
                    <div class="timeline-area">
            `;
            
            // Shuffle items for display
            const shuffledItems = [...question.items].sort(() => Math.random() - 0.5);
            
            shuffledItems.forEach((item, index) => {
                const originalIndex = question.items.indexOf(item);
                html += `
                    <div class="timeline-item" draggable="true" data-original-index="${originalIndex}" ondragstart="timelineDragStart(event)">
                        ${item}
                    </div>
                `;
            });
            
            html += `
                    </div>
                    <div style="margin-top: 20px;">
                        <h4>Timeline Sequence:</h4>
            `;
            
            // Create timeline slots
            for (let i = 0; i < question.items.length; i++) {
                html += `
                    <div class="timeline-slot" data-position="${i}" ondrop="timelineDrop(event)" ondragover="allowDrop(event)">
                        Step ${i + 1}: Drop item here
                    </div>
                `;
            }
            
            html += `
                    </div>
                </div>
            `;
            
            questionArea.innerHTML = html;
        }

        function selectOption(index) {
            // Remove previous selections
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            
            // Select current option
            document.querySelectorAll('.option')[index].classList.add('selected');
            gameState.selectedAnswer = index;
        }

        function dragStart(event) {
            event.dataTransfer.setData("text/plain", event.target.dataset.index);
            event.target.classList.add('dragging');
        }

        function rankingDragStart(event) {
            event.dataTransfer.setData("text/plain", event.target.dataset.originalIndex);
            event.target.classList.add('dragging');
        }

        function timelineDragStart(event) {
            event.dataTransfer.setData("text/plain", event.target.dataset.originalIndex);
            event.target.classList.add('dragging');
        }

        function allowDrop(event) {
            event.preventDefault();
            const dropTarget = event.target.closest('.drop-zone, .timeline-slot');
            if (dropTarget) {
                dropTarget.classList.add('drag-over');
            }
        }

        function drop(event) {
            event.preventDefault();
            const draggedIndex = parseInt(event.dataTransfer.getData("text/plain"));
            const draggedElement = document.querySelector(`[data-index="${draggedIndex}"]`);
            const dropZone = event.target.closest('.drop-zone');
            
            dropZone.classList.remove('drag-over');
            
            // Move the element to the drop zone
            const droppedItems = dropZone.querySelector('.dropped-items');
            draggedElement.style.margin = '5px';
            draggedElement.classList.remove('dragging');
            droppedItems.appendChild(draggedElement);
        }

        function rankingDrop(event) {
            event.preventDefault();
            const draggedIndex = parseInt(event.dataTransfer.getData("text/plain"));
            const draggedElement = document.querySelector(`[data-original-index="${draggedIndex}"].dragging`);
            const dropTarget = event.target.closest('.ranking-item');
            
            if (dropTarget && draggedElement && dropTarget !== draggedElement) {
                const rankingArea = document.getElementById('ranking-area');
                const items = Array.from(rankingArea.children);
                const draggedPosition = items.indexOf(draggedElement);
                const targetPosition = items.indexOf(dropTarget);
                
                if (draggedPosition < targetPosition) {
                    dropTarget.parentNode.insertBefore(draggedElement, dropTarget.nextSibling);
                } else {
                    dropTarget.parentNode.insertBefore(draggedElement, dropTarget);
                }
                
                updateRankingNumbers();
            }
            
            draggedElement.classList.remove('dragging');
        }

        function timelineDrop(event) {
            event.preventDefault();
            const draggedIndex = parseInt(event.dataTransfer.getData("text/plain"));
            const draggedElement = document.querySelector(`[data-original-index="${draggedIndex}"].dragging`);
            const timelineSlot = event.target.closest('.timeline-slot');
            
            timelineSlot.classList.remove('drag-over');
            
            if (timelineSlot && draggedElement) {
                // Clear the slot
                timelineSlot.innerHTML = `Step ${parseInt(timelineSlot.dataset.position) + 1}: ${draggedElement.textContent}`;
                timelineSlot.classList.add('filled');
                timelineSlot.dataset.itemIndex = draggedIndex;
                
                // Remove the item from the timeline area
                draggedElement.remove();
            }
        }

        function updateRankingNumbers() {
            const rankingItems = document.querySelectorAll('.ranking-item');
            rankingItems.forEach((item, index) => {
                const numberElement = item.querySelector('.ranking-number');
                numberElement.textContent = index + 1;
            });
        }

        function submitAnswer() {
            const question = gameState.questions[gameState.currentQuestion];
            let isCorrect = false;
            
            switch(question.type) {
                case 'multiple-choice':
                case 'case-study':
                    isCorrect = gameState.selectedAnswer === question.correct;
                    showMultipleChoiceFeedback(isCorrect, question);
                    break;
                case 'drag-drop':
                    isCorrect = checkDragDropAnswer(question);
                    showDragDropFeedback(isCorrect, question);
                    break;
                case 'ranking':
                    isCorrect = checkRankingAnswer(question);
                    showRankingFeedback(isCorrect, question);
                    break;
                case 'timeline':
                    isCorrect = checkTimelineAnswer(question);
                    showTimelineFeedback(isCorrect, question);
                    break;
            }
            
            updateScore(isCorrect);
            document.getElementById('submit-btn').classList.add('hidden');
            document.getElementById('next-btn').classList.remove('hidden');
        }

        function checkDragDropAnswer(question) {
            let correct = true;
            
            question.dropZones.forEach((zone, zoneIndex) => {
                const dropZone = document.querySelector(`[data-zone="${zoneIndex}"]`);
                const droppedItems = dropZone.querySelectorAll('.drag-item');
                
                const droppedIndices = Array.from(droppedItems).map(item => parseInt(item.dataset.index));
                
                if (droppedIndices.length !== zone.correct.length) {
                    correct = false;
                    return;
                }
                
                zone.correct.forEach(correctIndex => {
                    if (!droppedIndices.includes(correctIndex)) {
                        correct = false;
                    }
                });
            });
            
            return correct;
        }

        function checkRankingAnswer(question) {
            const rankingItems = document.querySelectorAll('.ranking-item');
            const userOrder = Array.from(rankingItems).map(item => parseInt(item.dataset.originalIndex));
            
            for (let i = 0; i < question.correctOrder.length; i++) {
                if (userOrder[i] !== question.correctOrder[i]) {
                    return false;
                }
            }
            return true;
        }

        function checkTimelineAnswer(question) {
            const timelineSlots = document.querySelectorAll('.timeline-slot');
            
            for (let i = 0; i < timelineSlots.length; i++) {
                const slot = timelineSlots[i];
                const expectedIndex = question.correctSequence[i];
                const actualIndex = parseInt(slot.dataset.itemIndex);
                
                if (actualIndex !== expectedIndex) {
                    return false;
                }
            }
            return true;
        }

        function showMultipleChoiceFeedback(isCorrect, question) {
            const options = document.querySelectorAll('.option');
            
            options.forEach((option, index) => {
                if (index === question.correct) {
                    option.classList.add('correct');
                } else if (index === gameState.selectedAnswer && !isCorrect) {
                    option.classList.add('incorrect');
                }
            });
            
            showFeedback(isCorrect, question.explanation);
        }

        function showDragDropFeedback(isCorrect, question) {
            const dropZones = document.querySelectorAll('.drop-zone');
            
            dropZones.forEach((zone, index) => {
                zone.classList.add(isCorrect ? 'correct' : 'incorrect');
            });
            
            showFeedback(isCorrect, question.explanation);
        }

        function showRankingFeedback(isCorrect, question) {
            const rankingItems = document.querySelectorAll('.ranking-item');
            
            rankingItems.forEach((item, index) => {
                const correctIndex = question.correctOrder[index];
                const actualIndex = parseInt(item.dataset.originalIndex);
                
                if (actualIndex === correctIndex) {
                    item.style.backgroundColor = '#27ae60';
                } else {
                    item.style.backgroundColor = '#e74c3c';
                }
            });
            
            showFeedback(isCorrect, question.explanation);
        }

        function showTimelineFeedback(isCorrect, question) {
            const timelineSlots = document.querySelectorAll('.timeline-slot');
            
            timelineSlots.forEach((slot, index) => {
                slot.classList.add(isCorrect ? 'correct' : 'incorrect');
            });
            
            showFeedback(isCorrect, question.explanation);
        }

        function showFeedback(isCorrect, explanation) {
            const feedbackArea = document.getElementById('feedback-area');
            
            feedbackArea.innerHTML = `
                <div class="feedback ${isCorrect ? 'correct' : 'incorrect'}">
                    <h3>${isCorrect ? '✅ Correct!' : '❌ Incorrect'}</h3>
                    <div class="explanation">${explanation}</div>
                </div>
            `;
            
            feedbackArea.style.display = 'block';
        }

        function updateScore(isCorrect) {
            if (isCorrect) {
                gameState.score += 100 + (gameState.streak * 10);
                gameState.streak++;
                gameState.correctAnswers++;
                
                // Level up every 5 correct answers (more gradual progression)
                if (gameState.correctAnswers % 5 === 0) {
                    gameState.level++;
                    showAchievement(`🎉 Level Up! Now Level ${gameState.level}`);
                }
                
                // Special achievements
                if (gameState.streak === 5) {
                    showAchievement('🔥 5-Question Streak!');
                } else if (gameState.streak === 10) {
                    showAchievement('⚡ 10-Question Streak!');
                }
            } else {
                gameState.streak = 0;
            }
            
            updateUI();
        }

        function showAchievement(message) {
            const gameArea = document.querySelector('.game-area');
            const achievement = document.createElement('div');
            achievement.className = 'achievement';
            achievement.textContent = message;
            
            gameArea.insertBefore(achievement, gameArea.firstChild);
            
            setTimeout(() => {
                achievement.remove();
            }, 3000);
        }

        function updateUI() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('streak').textContent = gameState.streak;
            
            // Calculate total progress across all modules
            const totalPossibleQuestions = Object.values(modules).reduce((sum, module) => sum + module.questions.length, 0);
            const totalCompleted = gameState.currentQuestion + (gameState.completedModules.length * 10); // Approximate
            
            document.getElementById('completed').textContent = `${totalCompleted}/${totalPossibleQuestions}`;
            
            // Calculate mastery percentage
            const masteryPercentage = Math.round((gameState.correctAnswers / Math.max(gameState.currentQuestion + 1, 1)) * 100);
            document.getElementById('mastery').textContent = `${masteryPercentage}%`;
        }

        function nextQuestion() {
            gameState.currentQuestion++;
            
            if (gameState.currentQuestion >= gameState.totalQuestions) {
                showModuleComplete();
            } else {
                loadQuestion();
            }
        }

        function showModuleComplete() {
            const gameArea = document.getElementById('game-content');
            const percentage = Math.round((gameState.correctAnswers / gameState.totalQuestions) * 100);
            
            // Add to completed modules
            if (!gameState.completedModules.includes(gameState.currentModule)) {
                gameState.completedModules.push(gameState.currentModule);
            }
            
            let performanceLevel = '';
            let badgeColor = '';
            
            if (percentage >= 90) {
                performanceLevel = 'Expert';
                badgeColor = '#27ae60';
            } else if (percentage >= 80) {
                performanceLevel = 'Proficient';
                badgeColor = '#3498db';
            } else if (percentage >= 70) {
                performanceLevel = 'Competent';
                badgeColor = '#f39c12';
            } else {
                performanceLevel = 'Developing';
                badgeColor = '#e74c3c';
            }
            
            gameArea.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <h2>🎊 Module Complete!</h2>
                    <div style="display: inline-block; background: ${badgeColor}; color: white; padding: 10px 20px; border-radius: 15px; margin: 20px 0; font-size: 1.2em; font-weight: bold;">
                        ${performanceLevel} Level: ${percentage}%
                    </div>
                    <div style="font-size: 1.2em; margin: 20px 0;">
                        <p><strong>${modules[gameState.currentModule].title}</strong> completed!</p>
                        <p>Final Score: <strong>${gameState.score}</strong> points</p>
                        <p>Level Reached: <strong>${gameState.level}</strong></p>
                        <p>Best Streak: <strong>${gameState.streak}</strong> questions</p>
                    </div>
                    
                    ${percentage >= 80 ? `
                        <div style="background: #d5f4e6; border: 2px solid #27ae60; border-radius: 10px; padding: 15px; margin: 20px 0; color: #1e8449;">
                            <h3>🏆 Certification Worthy!</h3>
                            <p>Your ${percentage}% score demonstrates CISA-level competency in ${modules[gameState.currentModule].title}</p>
                        </div>
                    ` : `
                        <div style="background: #fef9e7; border: 2px solid #f39c12; border-radius: 10px; padding: 15px; margin: 20px 0; color: #b7950b;">
                            <h3>📚 Recommend Review</h3>
                            <p>Consider reviewing this module before the final exam. Focus on bookmarked questions and explanations.</p>
                        </div>
                    `}
                    
                    <div class="buttons">
                        <button class="btn btn-primary" onclick="showModuleSelection()">🏠 Return to Modules</button>
                        <button class="btn btn-success" onclick="generateCertificate('${gameState.currentModule}', ${percentage})">📜 Get Certificate</button>
                        ${gameState.completedModules.length >= 4 ? `<button class="btn btn-warning" onclick="startFinalExam()">🏆 Take Final Exam</button>` : ''}
                        ${gameState.currentModule !== 'random_challenge' && gameState.currentModule !== 'final_exam' ? `<button class="btn btn-danger" onclick="restartModule()">🔄 Restart Module</button>` : ''}
                    </div>
                </div>
            `;
        }

        function generateCertificate(module, percentage) {
            const moduleTitle = modules[module].title;
            const date = new Date().toLocaleDateString();
            
            alert(`🏆 CERTIFICATE OF COMPLETION

CISA Disaster Recovery & Business Continuity Planning

Module: ${moduleTitle}
Score: ${percentage}%
Level: ${gameState.level}
Date: ${date}

This certifies completion of advanced-level training in disaster recovery and business continuity planning concepts essential for ISACA CISA certification.

Congratulations on your achievement!`);
        }

        function bookmarkQuestion() {
            const questionId = `${gameState.currentModule}_${gameState.currentQuestion}`;
            
            if (!gameState.bookmarkedQuestions.includes(questionId)) {
                gameState.bookmarkedQuestions.push(questionId);
                document.getElementById('bookmark-btn').textContent = '✅ Bookmarked';
                setTimeout(() => {
                    document.getElementById('bookmark-btn').textContent = '📌 Bookmark';
                }, 2000);
            }
        }

        function showHint() {
            const question = gameState.questions[gameState.currentQuestion];
            if (question && question.hint) {
                const hintArea = document.getElementById('question-area');
                
                // Remove any existing hint
                const existingHint = hintArea.querySelector('.hint-box');
                if (existingHint) {
                    existingHint.remove();
                    return;
                }
                
                // Add hint box
                const hintBox = document.createElement('div');
                hintBox.className = 'hint-box';
                hintBox.style.cssText = `
                    background: linear-gradient(135deg, #f39c12, #e67e22);
                    color: white;
                    padding: 15px 20px;
                    border-radius: 10px;
                    margin: 15px 0;
                    border-left: 5px solid #d35400;
                    animation: slideIn 0.3s ease;
                `;
                hintBox.innerHTML = `
                    <div style="display: flex; align-items: center;">
                        <span style="font-size: 1.2em; margin-right: 10px;">💡</span>
                        <strong>Hint:</strong>
                    </div>
                    <div style="margin-top: 8px; font-size: 1.05em;">${question.hint}</div>
                    <div style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">Click the hint button again to hide this hint.</div>
                `;
                
                hintArea.appendChild(hintBox);
            } else {
                alert("💡 Hint: Review the scenario carefully and think about the key terms and their definitions. Consider what would be most critical in a real disaster situation.");
            }
        }

        function startRandomChallenge() {
            // Create a mixed challenge with questions from all modules
            const allQuestions = [];
            Object.keys(modules).forEach(moduleKey => {
                modules[moduleKey].questions.forEach(question => {
                    allQuestions.push({...question, moduleSource: moduleKey});
                });
            });
            
            // Randomly select 20 questions
            const shuffled = allQuestions.sort(() => 0.5 - Math.random());
            const selected = shuffled.slice(0, 20);
            
            gameState.currentModule = 'random_challenge';
            gameState.questions = selected;
            gameState.totalQuestions = selected.length;
            gameState.currentQuestion = 0;
            
            document.getElementById('module-selection').classList.add('hidden');
            document.getElementById('game-content').classList.remove('hidden');
            
            // Show navigation and update breadcrumb
            showNavigation();
            updateBreadcrumb();
            updateModuleProgress();
            
            loadQuestion();
        }

        function startFinalExam() {
            // Create comprehensive final exam with questions from all modules
            alert('🏆 Final Certification Exam\n\nThis 25-question comprehensive exam covers all CISA DR & BCP domains. You need 80% to earn your certification.\n\nGood luck!');
            
            const allQuestions = [];
            Object.keys(modules).forEach(moduleKey => {
                modules[moduleKey].questions.forEach(question => {
                    allQuestions.push({...question, moduleSource: moduleKey});
                });
            });
            
            // Select challenging questions for final exam
            const finalExamQuestions = allQuestions.sort(() => 0.5 - Math.random()).slice(0, 25);
            
            gameState.currentModule = 'final_exam';
            gameState.questions = finalExamQuestions;
            gameState.totalQuestions = finalExamQuestions.length;
            gameState.currentQuestion = 0;
            
            document.getElementById('module-selection').classList.add('hidden');
            document.getElementById('game-content').classList.remove('hidden');
            
            // Show navigation and update breadcrumb
            showNavigation();
            updateBreadcrumb();
            updateModuleProgress();
            
            loadQuestion();
        }

        // Initialize the game
        updateUI();
        initializeNavigation();

        // Add helpful keyboard shortcuts info
        console.log('🎮 Keyboard Shortcuts:\n• ESC: Return to modules\n• ENTER: Submit answer\n• N: Next question\n• H: Show hint');
    </script>
</body>
</html>