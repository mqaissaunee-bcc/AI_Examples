<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CISA Domain 1 Learning Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #00FFC5 0%, #ADF5FF 50%, #0075A2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #333;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 30px;
            max-width: 900px;
            width: 90%;
            position: relative;
            overflow: hidden;
        }

        .game-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #00FFC5, #ADF5FF, #0075A2, #D55672);
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #0075A2, #481620);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .score-board {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            padding: 15px;
            background: linear-gradient(135deg, #D55672 0%, #481620 100%);
            border-radius: 15px;
            color: white;
            font-weight: bold;
        }

        .game-modes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .mode-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .mode-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            border-color: #0075A2;
        }

        .mode-card.active {
            background: linear-gradient(135deg, #0075A2 0%, #00FFC5 100%);
            color: white;
            border-color: #0075A2;
        }

        .mode-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .mode-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .mode-description {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .topic-selector {
            margin: 20px 0;
        }

        .topic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .topic-btn {
            padding: 15px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.9rem;
        }

        .topic-btn:hover, .topic-btn.active {
            border-color: #0075A2;
            background: #0075A2;
            color: white;
        }

        .content-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            display: none;
            max-height: 600px;
            overflow-y: auto;
        }

        .content-container::-webkit-scrollbar {
            width: 8px;
        }

        .content-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .content-container::-webkit-scrollbar-thumb {
            background: #0075A2;
            border-radius: 4px;
        }

        .content-container::-webkit-scrollbar-thumb:hover {
            background: #005580;
        }

        .content-container.active {
            display: block;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .question {
            font-size: 1.2rem;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .options {
            display: grid;
            gap: 15px;
        }

        .option {
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f9f9f9;
        }

        .option:hover {
            border-color: #0075A2;
            background: #e8f7ff;
            transform: translateX(5px);
        }

        .option.selected {
            border-color: #0075A2;
            background: #0075A2;
            color: white;
        }

        .option.correct {
            border-color: #28a745;
            background: #28a745;
            color: white;
        }

        .option.incorrect {
            border-color: #dc3545;
            background: #dc3545;
            color: white;
        }

        .explanation {
            margin-top: 20px;
            padding: 20px;
            background: #e8f7ff;
            border-left: 4px solid #0075A2;
            border-radius: 8px;
            display: none;
        }

        .explanation.show {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .flashcard {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            min-height: 300px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .flashcard:hover {
            transform: rotateY(5deg);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }

        .flashcard.flipped {
            background: linear-gradient(135deg, #D55672 0%, #481620 100%);
            color: white;
        }

        .card-content {
            font-size: 1.3rem;
            line-height: 1.6;
        }

        .card-hint {
            position: absolute;
            bottom: 20px;
            right: 20px;
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .card-progress {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 0.9rem;
            opacity: 0.8;
            font-weight: bold;
        }

        .learning-content h3 {
            color: #0075A2;
            margin-bottom: 15px;
            font-size: 1.4rem;
            border-bottom: 2px solid #ADF5FF;
            padding-bottom: 8px;
        }

        .learning-content p {
            line-height: 1.6;
            margin-bottom: 15px;
            text-align: justify;
            font-size: 1rem;
        }

        .learning-example {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #f0f8ff 0%, #e8f7ff 100%);
            border-radius: 12px;
            border-left: 5px solid #0075A2;
            box-shadow: 0 3px 10px rgba(0, 117, 162, 0.1);
        }

        .learning-example strong {
            color: #481620;
            font-size: 1.1rem;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
            gap: 15px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #0075A2 0%, #481620 100%);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-outline {
            background: transparent;
            color: #0075A2;
            border: 2px solid #0075A2;
        }

        .btn-outline:hover {
            background: #0075A2;
            color: white;
        }

        .results-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }

        .results-actions .btn {
            padding: 15px 20px;
            font-size: 0.9rem;
            border-radius: 12px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0075A2, #00FFC5);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .results-container {
            text-align: center;
            padding: 30px;
            display: none;
        }

        .results-container.show {
            display: block;
            animation: bounceIn 0.6s ease-out;
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .results-score {
            font-size: 3rem;
            font-weight: bold;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .title {
                font-size: 2rem;
            }
            
            .game-container {
                padding: 20px;
                width: 95%;
            }
            
            .score-board {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .controls {
                flex-direction: column;
                gap: 15px;
            }

            .game-modes {
                grid-template-columns: 1fr;
            }

            .results-actions {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .results-actions .btn {
                padding: 12px 15px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1 class="title">CISA Domain 1 Mastery</h1>
            <p class="subtitle">Information Systems Auditing Process (18% of Exam)</p>
            <div class="score-board">
                <div>Total Score: <span id="score">0</span></div>
                <div>Current Streak: <span id="streak">0</span></div>
                <div>Section Progress: <span id="progress">0</span>%</div>
            </div>
        </div>

        <div class="game-modes" id="gameMode">
            <div class="mode-card" data-mode="learn">
                <div class="mode-icon">üìö</div>
                <div class="mode-title">Learn Mode</div>
                <div class="mode-description">Study concepts with guided explanations</div>
            </div>
            <div class="mode-card" data-mode="quiz">
                <div class="mode-icon">üéØ</div>
                <div class="mode-title">Quiz Mode</div>
                <div class="mode-description">Test your knowledge with interactive questions</div>
            </div>
            <div class="mode-card" data-mode="flashcards">
                <div class="mode-icon">üÉè</div>
                <div class="mode-title">Flashcards</div>
                <div class="mode-description">Review key concepts and definitions</div>
            </div>
            <div class="mode-card" data-mode="scenario">
                <div class="mode-icon">üîç</div>
                <div class="mode-title">Scenarios</div>
                <div class="mode-description">Practice with real-world audit situations</div>
            </div>
        </div>

        <div class="topic-selector" id="topicSelector" style="display: none;">
            <h3>Choose Your Focus Area:</h3>
            <div class="topic-grid">
                <div class="topic-btn" data-topic="planning">Planning (A)</div>
                <div class="topic-btn" data-topic="execution">Execution (B)</div>
                <div class="topic-btn" data-topic="standards">Audit Standards</div>
                <div class="topic-btn" data-topic="controls">Types of Controls</div>
                <div class="topic-btn" data-topic="mixed">Mixed Topics</div>
            </div>
            <div style="margin-top: 20px; text-align: center;">
                <button class="btn btn-secondary" onclick="goBackToModes()">‚Üê Back to Game Modes</button>
            </div>
        </div>

        <div class="progress-bar" id="progressBar" style="display: none;">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="content-container" id="questionContainer">
            <div class="question" id="question"></div>
            <div class="options" id="options"></div>
            <div class="explanation" id="explanation"></div>
        </div>

        <div class="content-container" id="learningContainer">
            <div class="learning-content">
                <h3 id="learningTitle"></h3>
                <p id="learningText"></p>
                <div class="learning-example" id="learningExample"></div>
            </div>
        </div>

        <div class="flashcard" id="flashcard" style="display: none;">
            <div class="card-progress" id="cardProgress"></div>
            <div class="card-content" id="cardContent"></div>
            <div class="card-hint">Click to flip</div>
        </div>

        <div class="controls" id="controls" style="display: none;">
            <button class="btn btn-secondary" id="prevBtn">Previous</button>
            <button class="btn btn-secondary" onclick="goBackToTopics()">‚Üê Back to Topics</button>
            <button class="btn btn-primary" id="nextBtn">Next</button>
        </div>

        <div class="results-container" id="results">
            <h2>üéâ Complete!</h2>
            <div class="results-score" id="finalScore"></div>
            <p id="resultMessage"></p>
            <div class="results-actions">
                <button class="btn btn-primary" onclick="playAgain()">üîÑ Play Again</button>
                <button class="btn btn-secondary" onclick="goToMainScreen()">üè† Main Menu</button>
                <button class="btn btn-secondary" onclick="chooseAnotherSection()">üìö Try Another Section</button>
                <button class="btn btn-outline" onclick="resetGame()">üîÉ Reset All Progress</button>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let currentMode = '';
        let currentTopic = '';
        let currentQuestion = 0;
        let score = 0;
        let streak = 0;
        let answeredQuestions = [];
        let currentQuestions = [];

        // Fixed Question Bank with properly diversified correct answers
        const questionBank = {
            planning: [
                {
                    question: "Which ISACA standard specifically addresses the independence requirements for IS auditors?",
                    options: ["IS Auditing Standard 1001", "IS Auditing Standard 1002", "IS Auditing Standard 1003", "IS Auditing Standard 1004"],
                    correct: 2,
                    explanation: "IS Auditing Standard 1003 - Professional Independence specifically addresses the requirement for auditors to maintain independence in both fact and appearance when performing audit activities."
                },
                {
                    question: "What is the primary purpose of risk-based audit planning?",
                    options: ["To focus audit efforts on areas of highest risk", "To reduce audit costs", "To comply with regulations", "To ensure complete system coverage"],
                    correct: 0,
                    explanation: "Risk-based audit planning prioritizes audit activities based on risk assessment, ensuring audit resources are allocated to areas where they can provide the most value."
                },
                {
                    question: "According to ISACA standards, which factor is MOST important when establishing the audit universe?",
                    options: ["Available audit resources", "Management preferences", "Enterprise risk assessment results", "Previous year's audit results"],
                    correct: 2,
                    explanation: "The audit universe should be established based on enterprise risk assessment results to ensure all significant risk areas are identified."
                },
                {
                    question: "What is the primary objective of conducting a preliminary risk assessment during audit planning?",
                    options: ["To determine audit fees", "To satisfy regulatory requirements", "To establish auditor independence", "To identify areas requiring detailed testing"],
                    correct: 3,
                    explanation: "Preliminary risk assessment helps identify high-risk areas that require more detailed audit attention and testing."
                },
                {
                    question: "Which type of audit engagement provides assurance on the effectiveness of controls around financial reporting?",
                    options: ["Financial audit", "Operational audit", "Compliance audit", "Performance audit"],
                    correct: 0,
                    explanation: "Financial audits specifically focus on providing assurance over financial reporting controls and the accuracy of financial statements."
                },
                {
                    question: "When developing an audit strategy, what should be the auditor's PRIMARY consideration?",
                    options: ["Cost-effectiveness", "Risk and materiality assessments", "Management preferences", "Available audit tools"],
                    correct: 1,
                    explanation: "Risk and materiality assessments should drive the audit strategy to ensure audit efforts are focused on areas with the highest potential impact."
                },
                {
                    question: "What is the relationship between inherent risk and control risk in audit planning?",
                    options: ["They are mutually exclusive", "They always move in opposite directions", "Higher inherent risk requires stronger controls", "Control risk is irrelevant if inherent risk is low"],
                    correct: 2,
                    explanation: "Higher inherent risk areas typically require stronger controls to mitigate that risk, and auditors must assess both when planning their approach."
                }
            ],
            execution: [
                {
                    question: "What is the primary advantage of using Computer-Assisted Audit Techniques (CAATs)?",
                    options: ["Enhanced audit efficiency and effectiveness", "Reduced audit costs", "Elimination of sampling risk", "Automated report generation"],
                    correct: 0,
                    explanation: "CAATs enhance both efficiency (faster processing of large data volumes) and effectiveness (more comprehensive testing and analysis) of audit procedures."
                },
                {
                    question: "Which sampling method is most appropriate when the auditor wants to ensure all high-value transactions are tested?",
                    options: ["Random sampling", "Stratified sampling", "Systematic sampling", "Statistical sampling"],
                    correct: 1,
                    explanation: "Stratified sampling divides the population into subgroups (strata) and samples from each stratum, ensuring high-value transactions are specifically targeted."
                },
                {
                    question: "What is the most reliable form of audit evidence?",
                    options: ["Oral representations from management", "Evidence provided by internal audit", "Evidence obtained directly by the auditor", "Documentary evidence from third parties"],
                    correct: 2,
                    explanation: "Evidence obtained directly by the auditor through observation, inspection, or reperformance is considered the most reliable."
                },
                {
                    question: "Which audit technique is most effective for testing the completeness assertion?",
                    options: ["Vouching", "Analytical review", "Confirmation", "Tracing"],
                    correct: 3,
                    explanation: "Tracing involves following transactions from source documents to final recording, which is most effective for testing completeness."
                },
                {
                    question: "When using data analytics in an audit, what is the auditor's PRIMARY responsibility?",
                    options: ["Understanding data quality and limitations", "Ensuring 100% data accuracy", "Programming the analytics tools", "Validating all data sources"],
                    correct: 0,
                    explanation: "Auditors must understand the quality and limitations of data to properly interpret analytics results and draw appropriate conclusions."
                },
                {
                    question: "What is the main purpose of performing a walkthrough during an audit?",
                    options: ["To test control effectiveness", "To understand the process flow and identify controls", "To quantify risks", "To gather substantive evidence"],
                    correct: 1,
                    explanation: "Walkthroughs help auditors understand how transactions flow through the system and identify key controls within the process."
                },
                {
                    question: "Which factor most significantly affects the reliability of audit evidence?",
                    options: ["The volume of evidence", "The cost of obtaining evidence", "The independence of the source", "The format of the evidence"],
                    correct: 2,
                    explanation: "Evidence from independent sources is more reliable because it is less likely to be biased or manipulated."
                },
                {
                    question: "When should an auditor use substantive testing rather than relying on controls testing?",
                    options: ["When controls are well-designed", "When management requests it", "When audit time is unlimited", "When controls are weak or unreliable"],
                    correct: 3,
                    explanation: "Substantive testing directly examines transactions when controls cannot be relied upon due to weaknesses or ineffectiveness."
                },
                {
                    question: "What is the primary purpose of audit project management methodologies?",
                    options: ["To ensure audit objectives are met within time and resource constraints", "To reduce audit costs", "To satisfy regulatory requirements", "To standardize audit reports"],
                    correct: 0,
                    explanation: "Audit project management ensures that audit objectives are achieved efficiently within time, budget, and resource constraints."
                }
            ],
            standards: [
                {
                    question: "According to ISACA standards, what must an IS auditor do when they identify a significant deficiency?",
                    options: ["Report it immediately to senior management", "Document it and include in the final audit report", "Recommend corrective action to the auditee", "All of the above"],
                    correct: 3,
                    explanation: "ISACA standards require auditors to document significant deficiencies, report them appropriately, and provide recommendations for remediation."
                },
                {
                    question: "Which principle is fundamental to the ISACA Code of Professional Ethics?",
                    options: ["Professional competence and due care", "Profit maximization", "Client confidentiality only", "Regulatory compliance only"],
                    correct: 0,
                    explanation: "Professional competence and due care is a fundamental principle requiring auditors to maintain professional knowledge and skills."
                },
                {
                    question: "What does 'due professional care' require from an IS auditor?",
                    options: ["Perfect performance without errors", "The skill and care of a reasonably competent auditor", "Following management instructions exactly", "Completing audits quickly"],
                    correct: 1,
                    explanation: "Due professional care requires auditors to exercise the level of skill and care expected from a reasonably prudent professional."
                },
                {
                    question: "Which situation would most likely impair an auditor's independence?",
                    options: ["Auditing a department where a former colleague works", "Using the client's conference room", "Reviewing systems the auditor previously consulted on", "Receiving publicly available reports"],
                    correct: 2,
                    explanation: "Auditing systems that the auditor previously helped design or implement creates a self-review threat that impairs independence."
                },
                {
                    question: "According to ISACA standards, how should audit findings be prioritized in the audit report?",
                    options: ["By discovery order", "Alphabetically by system", "By management preferences", "By risk level and business impact"],
                    correct: 3,
                    explanation: "Audit findings should be prioritized based on their risk level and potential business impact."
                },
                {
                    question: "What is the primary purpose of ISACA's IS Auditing Guidelines?",
                    options: ["To offer practical guidance for implementing standards", "To provide mandatory requirements", "To replace professional judgment", "To standardize audit fees"],
                    correct: 0,
                    explanation: "ISACA Guidelines provide practical guidance to help auditors implement mandatory Standards effectively."
                },
                {
                    question: "Which of the following best describes professional skepticism?",
                    options: ["Assuming all information is incorrect", "Having a questioning mind and critical assessment attitude", "Being cynical about management", "Requiring extensive documentation for everything"],
                    correct: 1,
                    explanation: "Professional skepticism is an attitude of questioning mind and critical assessment of audit evidence without being cynical."
                }
            ],
            controls: [
                {
                    question: "Which of the following is an example of a compensating control?",
                    options: ["Manual review when automated controls fail", "Password complexity requirements", "Access control lists", "Encryption of sensitive data"],
                    correct: 0,
                    explanation: "Compensating controls are alternative controls implemented when primary controls are not feasible or have failed."
                },
                {
                    question: "What type of control is a disaster recovery plan?",
                    options: ["Preventive control", "Detective control", "Corrective control", "Directive control"],
                    correct: 2,
                    explanation: "A disaster recovery plan is a corrective control designed to restore operations after a disruptive event has occurred."
                },
                {
                    question: "Which control type is most effective at preventing unauthorized transactions?",
                    options: ["Preventive controls", "Detective controls", "Corrective controls", "Compensating controls"],
                    correct: 0,
                    explanation: "Preventive controls are specifically designed to prevent unwanted events from occurring before they happen."
                },
                {
                    question: "What is the primary characteristic of an automated control?",
                    options: ["Requires constant human oversight", "Operates consistently without human intervention", "Is always more effective than manual controls", "Cannot be overridden"],
                    correct: 1,
                    explanation: "Automated controls operate consistently according to their programming without requiring human intervention."
                },
                {
                    question: "Which of the following best describes segregation of duties?",
                    options: ["Dividing work among departments", "Creating backup procedures", "Separating conflicting responsibilities among different people", "Establishing job descriptions"],
                    correct: 2,
                    explanation: "Segregation of duties involves separating conflicting responsibilities among different individuals to prevent fraud and errors."
                },
                {
                    question: "What is the main purpose of application controls?",
                    options: ["To control physical access", "To manage network security", "To control environmental conditions", "To ensure complete, accurate, and authorized transaction processing"],
                    correct: 3,
                    explanation: "Application controls ensure that transactions are complete, accurate, and properly authorized throughout processing."
                },
                {
                    question: "Which control activity is most important for ensuring data integrity?",
                    options: ["Input validation and edit checks", "Physical security", "Password policies", "Backup procedures"],
                    correct: 0,
                    explanation: "Input validation and edit checks are crucial for maintaining data integrity by preventing incorrect data entry."
                }
            ],
            mixed: [
                {
                    question: "What is the primary difference between an audit and an assessment?",
                    options: ["Technical complexity", "Independent assurance vs management assessment", "External vs internal", "No difference"],
                    correct: 1,
                    explanation: "Audits provide independent, objective assurance while assessments may be performed by management or other stakeholders."
                },
                {
                    question: "Which factor is MOST important when determining audit sample size?",
                    options: ["Tolerable error rate and confidence level required", "Available audit time", "Size of auditor team", "Management preferences"],
                    correct: 0,
                    explanation: "Sample size is primarily determined by statistical factors including tolerable error rate and required confidence level."
                },
                {
                    question: "What is the audit risk model formula?",
                    options: ["AR = IR + CR + DR", "AR = IR √ó CR √ó DR", "AR = (IR + CR) √∑ DR", "AR = IR - CR - DR"],
                    correct: 1,
                    explanation: "The audit risk model is multiplicative: Audit Risk = Inherent Risk √ó Control Risk √ó Detection Risk."
                },
                {
                    question: "Which audit procedure is most effective for testing the existence assertion?",
                    options: ["Analytical review", "Confirmation", "Vouching to supporting documents", "Recomputation"],
                    correct: 2,
                    explanation: "Vouching involves examining supporting documentation for recorded transactions to verify they actually occurred."
                },
                {
                    question: "What is the primary purpose of audit working papers?",
                    options: ["To satisfy regulatory requirements", "To reduce audit costs", "To communicate with management", "To support audit conclusions and enable review"],
                    correct: 3,
                    explanation: "Audit working papers document the work performed, evidence obtained, and conclusions reached, supporting the audit opinion."
                },
                {
                    question: "When conducting post-audit follow-up, what is the auditor's primary objective?",
                    options: ["To evaluate whether identified risks have been sufficiently addressed", "To find new issues", "To test new controls", "To update the audit plan"],
                    correct: 0,
                    explanation: "Post-audit follow-up evaluates whether management has appropriately addressed previously identified risks and control deficiencies."
                }
            ]
        };

        const flashcards = {
            planning: [
                { front: "IS Auditing Standard 1001", back: "Audit Charter - Establishes the audit function's purpose, authority, and responsibility within the organization" },
                { front: "IS Auditing Standard 1002", back: "Organizational Independence - Auditors must be organizationally independent from the activities they audit" },
                { front: "IS Auditing Standard 1003", back: "Professional Independence - Auditors must maintain independence in fact and appearance" },
                { front: "Risk-Based Audit Planning", back: "An approach that prioritizes audit activities based on risk assessment to focus resources on highest-risk areas" },
                { front: "Audit Universe", back: "The comprehensive list of all auditable entities, processes, and systems within an organization's scope" },
                { front: "Audit Charter", back: "Document that formally establishes the audit function's purpose, authority, and responsibility" },
                { front: "Preliminary Risk Assessment", back: "Initial evaluation of risks to identify areas requiring detailed audit attention and testing" },
                { front: "Materiality", back: "The magnitude of an omission or misstatement that could influence economic decisions of users" },
                { front: "Audit Scope", back: "The extent and boundaries of an audit, defining what will and will not be covered" },
                { front: "Inherent Risk", back: "The risk of material misstatement in the absence of any related controls" },
                { front: "Control Risk", back: "The risk that a material misstatement will not be prevented or detected by internal controls" },
                { front: "Detection Risk", back: "The risk that audit procedures will fail to detect a material misstatement" },
                { front: "Operational Audit", back: "Audit that examines the efficiency and effectiveness of business operations and processes" },
                { front: "Compliance Audit", back: "Audit that verifies adherence to laws, regulations, policies, and procedures" },
                { front: "Financial Audit", back: "Audit that provides assurance on the accuracy of financial statements and related controls" }
            ],
            execution: [
                { front: "CAATs", back: "Computer-Assisted Audit Techniques - Software tools that help auditors examine and analyze large volumes of data efficiently" },
                { front: "Sampling Risk", back: "The risk that the auditor's conclusion based on a sample may differ from the conclusion reached if entire population were examined" },
                { front: "Audit Evidence Reliability Hierarchy", back: "1. Auditor-obtained evidence 2. External third-party evidence 3. Internal documentary evidence 4. Oral representations" },
                { front: "Vouching", back: "Audit technique that traces from accounting records back to source documents to test validity" },
                { front: "Tracing", back: "Audit technique that follows transactions from source documents to final recording to test completeness" },
                { front: "Analytical Review", back: "Evaluation of information by comparing it to expectations based on prior year, budget, or non-financial data" },
                { front: "Confirmation", back: "Audit procedure involving direct communication with third parties to verify account balances or information" },
                { front: "Walkthrough", back: "Procedure where auditor traces a transaction from initiation to final recording to understand the process" },
                { front: "Test of Controls", back: "Audit procedures designed to evaluate the operating effectiveness of controls" },
                { front: "Substantive Testing", back: "Audit procedures designed to detect material misstatements in account balances or transaction classes" },
                { front: "Statistical Sampling", back: "Sampling approach using probability theory to select items and evaluate results" },
                { front: "Judgmental Sampling", back: "Non-statistical sampling where auditor uses professional judgment to select items" },
                { front: "Audit Project Management", back: "Application of project management principles to ensure audit objectives are met within time and resource constraints" },
                { front: "Data Analytics", back: "The process of examining data sets to draw conclusions about the information they contain" },
                { front: "Audit Working Papers", back: "Documentation of audit procedures performed, evidence obtained, and conclusions reached" }
            ],
            standards: [
                { front: "Due Professional Care", back: "The level of care and competence that would be exercised by a reasonably prudent and competent IS auditor" },
                { front: "Professional Skepticism", back: "An attitude that includes a questioning mind and critical assessment of audit evidence" },
                { front: "Professional Independence", back: "Freedom from conditions that threaten the ability to carry out audit responsibilities in an unbiased manner" },
                { front: "Organizational Independence", back: "Auditor must be independent from the activities they audit within the organizational structure" },
                { front: "Professional Competence", back: "Auditor must possess the knowledge, skills, and experience necessary to perform audit duties" },
                { front: "Confidentiality", back: "Auditors must protect confidential information and not use it for personal gain" },
                { front: "Objectivity", back: "Mental attitude that allows auditors to perform work with honest belief in their conclusions" },
                { front: "Audit Standards", back: "Mandatory requirements that provide minimum level of acceptable performance for audit activities" },
                { front: "Audit Guidelines", back: "Recommended practices providing guidance for implementation of standards" },
                { front: "Quality Assurance", back: "Systematic process to ensure audit work meets professional standards and quality requirements" },
                { front: "ISACA Code of Professional Ethics", back: "Five principles: Professional competence, Confidentiality, Integrity, Objectivity, Professional behavior" },
                { front: "Audit Report Standards", back: "Reports must be accurate, objective, clear, concise, constructive, complete, and timely" },
                { front: "Post-Audit Follow-up", back: "Process to evaluate whether identified risks have been sufficiently addressed through corrective actions" }
            ],
            controls: [
                { front: "Preventive Controls", back: "Controls designed to prevent unwanted events from occurring (e.g., access controls, segregation of duties)" },
                { front: "Detective Controls", back: "Controls designed to detect unwanted events that have occurred (e.g., intrusion detection, reconciliation reports)" },
                { front: "Corrective Controls", back: "Controls designed to correct unwanted events after they occur (e.g., backup/restore, incident response)" },
                { front: "Compensating Controls", back: "Alternative controls that provide equivalent protection when primary controls are not feasible" },
                { front: "General Controls", back: "Controls that affect the overall IT environment and support effective functioning of application controls" },
                { front: "Application Controls", back: "Controls within business applications designed to ensure complete, accurate, and authorized transaction processing" },
                { front: "Segregation of Duties", back: "Separation of conflicting duties among different individuals to reduce risk of fraud or error" },
                { front: "Authorization Controls", back: "Controls ensuring that transactions are approved by appropriate personnel within their authority limits" },
                { front: "Input Controls", back: "Controls ensuring data entered into systems is complete, accurate, and properly authorized" },
                { front: "Processing Controls", back: "Controls ensuring data is processed completely and accurately throughout the application" },
                { front: "Output Controls", back: "Controls ensuring processed information is complete, accurate, and distributed to authorized recipients" },
                { front: "Control Environment", back: "The foundation for all other internal controls, reflecting the organization's control consciousness" },
                { front: "Manual Controls", back: "Controls performed by people, subject to human error but provide flexibility and judgment" },
                { front: "Automated Controls", back: "Controls performed by computer systems, consistent but may be bypassed or overridden" },
                { front: "Control Testing", back: "Audit procedures to evaluate the design and operating effectiveness of internal controls" }
            ],
            mixed: [
                { front: "Audit Risk Model", back: "Audit Risk = Inherent Risk √ó Control Risk √ó Detection Risk" },
                { front: "Materiality", back: "The magnitude of an omission or misstatement that could influence the economic decisions of users" },
                { front: "Walk-through", back: "A procedure where the auditor traces a transaction from initiation to final recording to understand the process" },
                { front: "Substantive Testing", back: "Audit procedures designed to detect material misstatements in financial statement assertions or business processes" },
                { front: "Tests of Controls", back: "Audit procedures designed to evaluate the operating effectiveness of controls" },
                { front: "Professional Judgment", back: "The application of relevant training, knowledge, and experience in making informed decisions" },
                { front: "Audit Opinion", back: "The auditor's formal conclusion about whether the subject matter meets applicable criteria" },
                { front: "Management Letter", back: "Communication to management regarding control deficiencies and improvement recommendations" },
                { front: "Continuous Auditing", back: "Methodology that enables auditors to provide assurance using automated testing and monitoring" },
                { front: "Audit Evidence", back: "Information used by the auditor to arrive at the conclusions on which the audit opinion is based" },
                { front: "Sampling", back: "Application of audit procedures to less than 100% of items within a population to form conclusions about the entire population" },
                { front: "Audit Planning", back: "Process of developing an overall strategy and detailed approach for the nature, timing, and extent of audit procedures" }
            ]
        };

        const learningContent = {
            planning: [
                {
                    title: "IS Audit Standards, Guidelines, and Codes of Ethics",
                    content: "ISACA has established a comprehensive framework of IS auditing standards that form the foundation of professional practice. The framework consists of three levels: Standards (mandatory requirements), Guidelines (recommended practices), and Tools & Techniques (detailed procedures). The Standards are organized into General Standards (1000 series covering independence, professional care, and competence), Performance Standards (1200 series covering planning, performance, and supervision), and Reporting Standards (1400 series covering reporting and follow-up). The ISACA Code of Professional Ethics establishes five fundamental principles that govern professional conduct: Professional competence and due care, Confidentiality, Integrity, Objectivity, and Professional behavior. These ethical principles must be applied throughout all audit activities and form the foundation of professional credibility.",
                    example: "Example: IS Auditing Standard 1003 requires professional independence, meaning an auditor cannot audit a payroll system they previously designed. The related guideline G3 provides specific guidance on assessing independence threats, while tools might include independence checklists and documentation templates."
                },
                {
                    title: "Types of Audits, Assessments, and Reviews",
                    content: "Different types of audit engagements serve various stakeholder needs and provide different levels of assurance. Financial audits focus on the accuracy of financial statements and effectiveness of internal controls over financial reporting, often required by regulations like Sarbanes-Oxley. Operational audits examine the efficiency and effectiveness of business processes and operations. Compliance audits verify adherence to laws, regulations, policies, and procedures. IT audits specifically assess technology controls, security measures, and IT governance. Performance audits evaluate whether objectives are being met efficiently and effectively. Assessments typically provide less formal assurance and may be performed by management or consultants. Reviews provide limited assurance and involve less extensive procedures than full audits. The type of engagement determines the scope, methodology, reporting requirements, and level of assurance provided.",
                    example: "Example: A SOX 404 compliance audit specifically examines internal controls over financial reporting for public companies, while a GDPR compliance audit focuses on data protection practices and privacy controls. Each requires different expertise, testing procedures, and reporting formats."
                },
                {
                    title: "Risk-Based Audit Planning",
                    content: "Risk-based audit planning is a systematic approach that aligns audit activities with organizational risks to maximize audit value and efficiency. The process begins with understanding the business environment, including organizational structure, business processes, technology infrastructure, and regulatory requirements. Risk identification considers various sources including enterprise risk assessments, prior audit results, management concerns, industry trends, and regulatory changes. Risk assessment evaluates both the likelihood and potential impact of identified risks, considering factors like materiality, business criticality, regulatory requirements, and control environment. The audit strategy is then developed to address the highest-priority risks first, allocating appropriate resources and expertise. Risk-based planning ensures that audit efforts focus on areas where they can provide the most value to the organization and stakeholders.",
                    example: "Example: In a healthcare organization, risk-based planning might prioritize auditing patient data systems (high risk due to HIPAA requirements and data sensitivity) over the cafeteria point-of-sale system (lower risk and business impact), even though both are IT systems."
                },
                {
                    title: "Types of Controls and Considerations", 
                    content: "Internal controls are processes designed to provide reasonable assurance regarding achievement of objectives in operational effectiveness, reliable reporting, and compliance. Controls can be classified by timing: Preventive controls stop problems before they occur (access controls, authorization requirements), Detective controls identify problems after they happen (monitoring, reconciliations), and Corrective controls fix problems and restore normal operations (backup/restore, incident response). Controls also vary by nature: Manual controls rely on people and provide flexibility but are subject to human error and override, while Automated controls are performed by systems and provide consistency but may be bypassed. Application controls are built into specific business applications to ensure complete, accurate, and authorized transaction processing, while General controls provide the foundation for the IT environment and support application controls. When evaluating controls, auditors must consider design effectiveness (whether the control addresses the risk) and operating effectiveness (whether the control is functioning as designed).",
                    example: "Example: In a purchase-to-pay process, preventive controls include purchase order approval requirements and vendor master file maintenance. Detective controls include three-way matching of purchase orders, receipts, and invoices. Corrective controls include processes for handling exceptions and disputed invoices."
                },
                {
                    title: "Audit Planning Documentation and Communication",
                    content: "Effective audit planning requires comprehensive documentation to support audit decisions and enable proper supervision and review. The audit plan should clearly articulate audit objectives, scope boundaries, risk assessment results, materiality considerations, audit approach and methodology, resource requirements, timeline, and key deliverables. Documentation must be sufficient to enable an experienced auditor to understand the planning decisions and rationale. Communication with stakeholders is essential throughout planning to ensure alignment of expectations, secure necessary resources, address concerns, and manage scope changes. Key stakeholders typically include audit committee members, senior management, process owners, IT personnel, and external parties when relevant. Regular planning updates may be necessary as new information becomes available or circumstances change. Proper planning documentation and communication helps ensure audit success and stakeholder satisfaction.",
                    example: "Example: The audit plan document should include executive summary, background and context, audit objectives and scope, risk assessment summary, audit approach and methodology, resource requirements and timeline, key stakeholders and communication plan, expected deliverables and reporting schedule, and any scope limitations or dependencies."
                },
                {
                    title: "Materiality Assessment and Audit Universe Development",
                    content: "Materiality assessment establishes thresholds for what constitutes significant issues requiring audit attention and reporting. For IT audits, materiality considerations extend beyond financial impact to include operational disruption, regulatory violations, security breaches, and reputational damage. Quantitative materiality might be based on financial metrics, transaction volumes, or system capacity, while qualitative materiality considers strategic importance, regulatory sensitivity, and stakeholder concerns. The audit universe represents all auditable entities within the organization's scope and should be regularly updated to reflect organizational changes, new systems, emerging risks, and regulatory requirements. Audit universe development involves identifying all business processes, IT systems, locations, vendors, and other auditable areas, then assessing and prioritizing them based on risk, materiality, and audit frequency requirements. This forms the foundation for multi-year audit planning and resource allocation decisions.",
                    example: "Example: For a $1B revenue company, financial materiality might be $5M, but a data breach affecting 10,000 customers could be material regardless of direct costs due to regulatory penalties and reputation impact. The audit universe would include all systems processing customer data, even if individually below financial materiality thresholds."
                }
            ],
            execution: [
                {
                    title: "Audit Project Management",
                    content: "Audit project management applies project management principles and methodologies to ensure audit objectives are achieved within time, budget, and resource constraints while maintaining quality standards. Key project management elements include scope management (defining and controlling what work is included), time management (developing schedules and managing deadlines), cost management (budgeting and controlling expenses), quality management (ensuring deliverables meet standards), human resource management (assembling and managing audit teams), communication management (ensuring effective information flow), risk management (identifying and mitigating project risks), and procurement management (managing external resources when needed). Effective audit project management requires clear project charters, detailed work breakdown structures, realistic schedules, regular progress monitoring, change control procedures, and stakeholder communication plans. Project management tools and techniques help track progress, manage resources, and ensure audit success.",
                    example: "Example: A complex ERP audit might be managed as a project with phases for planning (2 weeks), fieldwork (6 weeks), and reporting (2 weeks), with specific deliverables, milestones, resource assignments, and quality review checkpoints at each phase."
                },
                {
                    title: "Audit Testing and Sampling Methodology",
                    content: "Audit sampling allows auditors to draw conclusions about entire populations by examining representative subsets, making audits more efficient while maintaining effectiveness. Statistical sampling uses probability theory to select items and evaluate results, providing mathematical measures of sampling risk and enabling projections to the population. Non-statistical sampling relies on auditor judgment for both selection and evaluation but must still be representative. Key sampling concepts include population definition (what items are subject to testing), sampling unit (individual items being selected), sample size determination (based on risk, materiality, and desired confidence), selection method (random, systematic, stratified), and result evaluation (determining conclusions about the population). Different sampling methods serve different purposes: Random sampling gives each item equal chance of selection, Systematic sampling selects every nth item, Stratified sampling divides population into subgroups and samples each, and Cluster sampling selects groups of items. Proper sampling methodology is essential for drawing valid audit conclusions.",
                    example: "Example: When testing user access reviews, stratified sampling might divide users into executives (high risk), managers (medium risk), and staff (lower risk), then sample from each stratum to ensure all risk levels are tested, rather than simple random sampling which might miss high-risk executives due to their small numbers."
                },
                {
                    title: "Audit Evidence Collection Techniques",
                    content: "Audit evidence must be sufficient (adequate quantity), competent (reliable quality), and relevant (logically related to audit objectives) to support audit conclusions. Evidence collection techniques include Inquiry (asking questions of knowledgeable persons), Observation (watching processes or procedures being performed), Inspection (examining records, documents, or tangible assets), Reperformance (independently executing procedures or controls), Analytical procedures (comparing information to expectations), and Confirmation (obtaining direct responses from third parties). The reliability of evidence varies by source and nature: Evidence obtained directly by the auditor is most reliable, followed by evidence from independent external sources, internal documentary evidence, and oral representations (least reliable). Electronic evidence presents unique challenges including data integrity, completeness, and accessibility concerns. Auditors must understand system controls, data extraction methods, and electronic evidence authentication to properly evaluate computer-generated information.",
                    example: "Example: When testing accounts payable, inquiry involves asking staff about approval procedures, observation involves watching the three-way matching process, inspection involves examining purchase orders and invoices, reperformance involves independently performing the matching process, and confirmation involves directly contacting vendors to verify balances."
                },
                {
                    title: "Audit Data Analytics",
                    content: "Data analytics transforms audit practice by enabling examination of entire populations rather than samples, identifying patterns and anomalies that traditional methods might miss. Analytics techniques include Descriptive analytics (what happened - summarizing historical data), Diagnostic analytics (why it happened - identifying causes and relationships), Predictive analytics (what might happen - forecasting future trends), and Prescriptive analytics (what should be done - recommending actions). Common audit analytics include duplicate testing, gap analysis, Benford's Law analysis, ratio analysis, trend analysis, and regression analysis. Data analytics tools range from basic spreadsheet functions to sophisticated specialized software like ACL, IDEA, or Tableau. However, analytics require careful consideration of data quality, completeness, accuracy, and relevance. Auditors must understand data sources, extraction methods, transformation processes, and analytical limitations to properly interpret results and draw appropriate conclusions.",
                    example: "Example: Using analytics to examine all expense transactions for duplicate payments by comparing vendor, amount, date, and description fields might reveal potential duplicate payments that would be missed by traditional sampling, such as payments to the same vendor for identical amounts on consecutive days with slight spelling variations in vendor names."
                },
                {
                    title: "Reporting and Communication Techniques",
                    content: "Effective audit communication ensures that findings, conclusions, and recommendations are clearly understood by appropriate stakeholders and lead to positive organizational change. Audit reports must be accurate (factually correct), objective (unbiased and fair), clear (easily understood), concise (no unnecessary detail), constructive (helpful and positive), complete (all significant matters included), and timely (issued promptly). Report structure typically includes executive summary, audit objectives and scope, methodology overview, detailed findings with conditions/criteria/causes/effects, conclusions, and recommendations. Communication techniques vary by audience: Audit committees need high-level summaries focused on significant risks, management needs detailed findings with specific remediation guidance, and operational personnel need clear, actionable recommendations. Interim communication during fieldwork helps address issues promptly and avoid surprises in final reports. Follow-up communication ensures recommendations are understood and implementation progress is tracked.",
                    example: "Example: A finding about inadequate password controls should state the condition (current password requirements), criteria (policy standards), cause (lack of enforcement), effect (increased security risk), and recommendation (implement automated enforcement and monitoring), with different levels of detail for different audiences."
                },
                {
                    title: "Quality Assurance and Improvement of Audit Process",
                    content: "Quality assurance ensures audit work meets professional standards and organizational requirements while continuously improving audit effectiveness and efficiency. Quality control measures include proper supervision (experienced auditors reviewing work of less experienced staff), detailed review procedures (checking that procedures were performed properly and conclusions are supported), standardized methodologies (consistent approaches across audits), training programs (ensuring auditor competence), and performance monitoring (tracking audit quality metrics). Quality assurance activities include internal quality assessments (periodic reviews of audit methodology and results), external quality assessments (independent reviews by external parties), client feedback collection (satisfaction surveys and post-audit evaluations), and lessons learned processes (capturing and sharing insights from completed audits). Continuous improvement involves analyzing quality assessment results, identifying areas for enhancement, updating methodologies and tools, and implementing training programs to address identified gaps.",
                    example: "Example: Quality assurance procedures might include peer reviews of working papers before report issuance, annual client satisfaction surveys, external quality assessments every three years, post-audit lessons learned sessions, and tracking of audit findings to identify recurring issues that suggest methodology improvements are needed."
                }
            ],
            standards: [
                {
                    title: "ISACA Code of Professional Ethics - Detailed Analysis",
                    content: "The ISACA Code of Professional Ethics establishes fundamental principles that guide all professional activities and decisions. Professional competence and due care requires maintaining current knowledge, skills, and understanding of developments in IS audit practice, applying appropriate professional judgment, and performing work with diligence. This includes obtaining sufficient relevant evidence to support findings and recommendations, properly planning and supervising audit work, and maintaining competence through continuing professional education. Confidentiality requires respecting the confidentiality of information acquired during professional work and not using such information for personal benefit or in a manner that would be detrimental to legitimate objectives. Integrity demands honesty and straightforwardness in all professional relationships, refusing to be associated with reports or communications that are misleading, and disclosure of material facts when necessary. Objectivity requires maintaining mental independence and avoiding conflicts of interest that could compromise professional judgment. Professional behavior means complying with relevant laws and regulations, conducting oneself in a manner that reflects positively on the profession, and refusing to engage in activities that could discredit the profession.",
                    example: "Example: When an auditor discovers evidence of potential fraud during an audit, professional competence requires thoroughly investigating and documenting the issue, confidentiality requires limiting disclosure to appropriate parties, integrity demands honest reporting regardless of political implications, objectivity ensures the investigation is not influenced by personal relationships, and professional behavior requires following proper reporting protocols."
                },
                {
                    title: "Independence Requirements and Threat Assessment",
                    content: "Professional independence is essential for maintaining audit credibility and requires freedom from conditions that threaten the ability to carry out audit responsibilities objectively. Independence must be maintained both in fact (actual independence) and in appearance (perceived independence by reasonable third parties). Independence threats include Self-interest threats (financial relationships or dependencies), Self-review threats (auditing own work or decisions), Advocacy threats (promoting client interests), Familiarity threats (close personal relationships), and Intimidation threats (pressure from clients or others). Common safeguards include organizational independence (reporting to audit committee rather than management), professional standards and oversight, rotation of audit personnel, independent review of audit work, and clear policies prohibiting certain relationships. When independence threats cannot be reduced to acceptable levels through safeguards, the auditor must decline the engagement or remove themselves from specific audit areas. Independence considerations extend beyond the individual auditor to include audit firm relationships and financial interests.",
                    example: "Example: An auditor who previously served as IT director for a company faces both self-review threats (auditing systems they implemented) and familiarity threats (close relationships with former colleagues). Even if several years have passed, both actual and apparent independence may be compromised, requiring either assignment of different auditors to those systems or declining the engagement entirely."
                },
                {
                    title: "Due Professional Care and Professional Skepticism",
                    content: "Due professional care requires exercising the level of skill, knowledge, and diligence that would be expected from a reasonably prudent and competent IS auditor in similar circumstances. This includes proper planning to understand audit objectives and risks, adequate supervision of assistants, sufficient appropriate evidence collection, and reasonable conclusions based on evidence obtained. Professional skepticism is a critical attitude that includes maintaining a questioning mind throughout the audit, being alert to conditions that may indicate misstatement due to error or fraud, critically assessing audit evidence, and not accepting explanations without corroborating evidence. Professional skepticism does not mean assuming dishonesty but rather maintaining independence of mind and not accepting assertions without proper verification. These concepts work together to ensure audit quality: due professional care provides the foundation of competent performance, while professional skepticism ensures critical evaluation of evidence and conclusions.",
                    example: "Example: When management explains an unusual journal entry as a 'routine year-end adjustment,' professional skepticism requires the auditor to examine supporting documentation, understand the business rationale, verify proper authorization, confirm the accounting treatment, and consider whether the explanation is consistent with other audit evidence, rather than simply accepting the explanation."
                },
                {
                    title: "ISACA Standards Hierarchy and Application",
                    content: "ISACA's professional guidance framework provides a structured approach to audit practice through three levels of authority and specificity. Standards are mandatory requirements that provide minimum acceptable levels of performance and must be followed by all ISACA members and certification holders. They establish fundamental principles but allow flexibility in implementation based on specific circumstances. Guidelines provide recommended practices for implementing standards effectively and represent preferred approaches developed through professional consensus and experience. While not mandatory, Guidelines should be considered and departures should be justified. Tools & Techniques provide detailed procedures, examples, and step-by-step guidance for specific audit activities and represent one acceptable approach among potentially many. This hierarchy allows for consistency in fundamental principles while permitting flexibility in implementation to address varying organizational contexts, regulatory environments, and technological landscapes.",
                    example: "Example: Standard 1003 mandates professional independence (required for all audits). Guideline G3 provides specific recommendations for assessing independence threats and implementing safeguards (strongly recommended but flexible). Tools & Techniques might provide sample independence questionnaires and documentation templates (one acceptable approach among others)."
                },
                {
                    title: "Professional Competence and Continuing Education Requirements",
                    content: "Professional competence encompasses the knowledge, skills, and experience necessary to perform IS audit responsibilities effectively. Initial competence includes formal education, professional training, and relevant work experience that provide foundation knowledge in IT, business processes, audit methodology, and risk management. Ongoing competence requires maintaining and enhancing professional knowledge through continuing professional education (CPE), staying current with technological developments, understanding evolving regulatory requirements, and gaining experience in new audit areas. CISA certification holders must earn minimum CPE hours annually (20 hours) and over three-year periods (120 hours) to maintain certification. CPE should be relevant to current responsibilities and emerging practice areas including new technologies, cybersecurity developments, regulatory changes, and audit methodology enhancements. Professional competence also involves recognizing limitations and seeking appropriate consultation or additional expertise when encountering unfamiliar areas or complex technical issues.",
                    example: "Example: An auditor specializing in traditional IT infrastructure who is assigned to audit cloud computing environments should invest in CPE covering cloud architecture, security models, compliance frameworks, and cloud-specific audit approaches before conducting the audit, and may need to consult with cloud experts for complex technical issues."
                },
                {
                    title: "Audit Communication and Follow-up Standards",
                    content: "Effective audit communication ensures that audit results achieve their intended purpose of improving organizational controls and risk management. Communication must occur throughout the audit process including initial planning discussions, interim updates during fieldwork, draft report reviews, final report issuance, and follow-up activities. Reports should be distributed to appropriate stakeholders who can take corrective action and those with oversight responsibilities. Communication standards require that reports be accurate (factually correct and properly supported), objective (fair and unbiased), clear (easily understood by intended readers), concise (include necessary information without excessive detail), constructive (helpful and focused on improvement), complete (address all significant matters), and timely (issued promptly after field work completion). Follow-up procedures should evaluate whether management has taken appropriate corrective action to address reported deficiencies and whether such actions have been effective in reducing identified risks.",
                    example: "Example: After reporting a critical access control deficiency, follow-up might involve reviewing evidence of new access control procedures, testing the effectiveness of implemented controls, and verifying that the risk has been adequately addressed rather than simply confirming that management claims to have fixed the issue."
                }
            ],
            controls: [
                {
                    title: "Control Framework and COSO Integration",
                    content: "Internal control frameworks provide structured approaches for designing, implementing, and evaluating organizational controls. The COSO Internal Control Framework defines internal control as a process designed to provide reasonable assurance regarding achievement of objectives in three categories: operations (effectiveness and efficiency), reporting (reliability of financial and non-financial reporting), and compliance (adherence to laws and regulations). The framework consists of five components: Control Environment (foundation including integrity, ethical values, and governance), Risk Assessment (identification and analysis of risks), Control Activities (policies and procedures), Information and Communication (relevant information flow), and Monitoring Activities (ongoing evaluation of control effectiveness). These components must be present and functioning effectively for internal control to be effective. For IT auditors, understanding this framework helps evaluate how technology controls integrate with overall organizational control systems and support business objectives.",
                    example: "Example: In evaluating IT controls for financial reporting, an auditor would assess how the control environment establishes technology governance, how risk assessment identifies IT-related financial reporting risks, how control activities address those risks through both general and application controls, how information systems support financial reporting requirements, and how monitoring activities ensure ongoing control effectiveness."
                },
                {
                    title: "Preventive Controls Design and Implementation",
                    content: "Preventive controls are designed to prevent errors, irregularities, or security incidents before they occur, making them typically the most cost-effective type of control. Common preventive controls include authorization and approval requirements (ensuring only authorized personnel can initiate transactions), segregation of duties (separating conflicting responsibilities), physical access controls (preventing unauthorized access to assets), logical access controls (system-based access restrictions), input validation and edit checks (preventing erroneous data entry), and system configuration controls (ensuring systems are properly set up). Effective preventive controls require proper design (addressing the specific risk), appropriate implementation (controls are built into processes), consistent operation (controls function as intended), and regular monitoring (ensuring ongoing effectiveness). The strength and reliability of preventive controls often determines the extent of detective and corrective controls needed and influences the auditor's testing approach.",
                    example: "Example: In a procurement system, preventive controls might include purchase requisition approval workflows (authorization), separation between purchasing and receiving functions (segregation of duties), vendor master file maintenance restrictions (access control), and automated checks for valid account codes and budget availability (input validation)."
                },
                {
                    title: "Detective Controls and Monitoring Systems",
                    content: "Detective controls identify problems after they occur but ideally before significant damage is done. These controls are essential when preventive controls are not feasible, too expensive, or might fail. Common detective controls include reconciliations (comparing independent records), variance analysis (identifying unusual fluctuations), exception reporting (highlighting transactions outside normal parameters), log monitoring and review (detecting unauthorized activities), periodic reviews and assessments (systematic evaluation of processes), and analytical procedures (comparing actual results to expectations). Effective detective controls must operate with appropriate frequency (often enough to catch problems quickly), provide clear and actionable information (specific enough to enable investigation), have defined response procedures (what to do when problems are detected), and be performed by individuals independent of the processes being monitored. The timing and frequency of detective controls should be based on the risk level and potential impact of undetected problems.",
                    example: "Example: Daily bank reconciliations detect unauthorized payments or cash handling errors, automated exception reports highlighting transactions above certain thresholds identify potential fraud or policy violations, and weekly reviews of user access reports detect inappropriate access rights or terminated employees with active accounts."
                },
                {
                    title: "Corrective Controls and Business Continuity",
                    content: "Corrective controls restore normal operations after problems occur and minimize the impact of adverse events. These controls are essential for organizational resilience and business continuity. Common corrective controls include backup and restoration procedures (recovering from data loss), incident response plans (structured approach to handling security incidents), error correction processes (fixing identified problems), disaster recovery procedures (restoring operations after major disruptions), and business continuity plans (maintaining essential functions during disruptions). Effective corrective controls require regular testing (ensuring procedures work when needed), clear documentation (step-by-step instructions), trained personnel (people who know how to execute procedures), adequate resources (necessary tools and facilities), and regular updates (keeping procedures current with environmental changes). The speed and effectiveness of corrective controls often determine the ultimate impact of adverse events on the organization.",
                    example: "Example: When a server failure occurs, corrective controls might include automated failover to backup systems (immediate response), data restoration from verified backups (recovery), communication procedures to notify users and stakeholders (coordination), and systematic recovery procedures to restore full functionality (business continuity)."
                },
                {
                    title: "General Controls vs Application Controls",
                    content: "IT controls are typically categorized as either general controls or application controls, and both are necessary for effective technology control environments. General controls affect the overall IT environment and provide the foundation for effective application controls. They include access management (controlling who can access systems and data), change management (ensuring authorized and tested changes), system development controls (ensuring new systems are properly developed), operations management (ensuring systems operate effectively), and physical and environmental controls (protecting IT infrastructure). Application controls are built into specific business applications to ensure complete, accurate, and authorized transaction processing. They include input controls (ensuring data entered is complete and accurate), processing controls (ensuring transactions are properly processed), and output controls (ensuring information is appropriately distributed). The relationship between these control types is critical: weak general controls can undermine application controls, while strong general controls enable greater reliance on automated application controls.",
                    example: "Example: Strong application controls in a payroll system (input validation for employee data, calculation controls for pay computation, output controls for check distribution) can be undermined by weak general controls that allow unauthorized changes to the application code, employee master files, or pay rates. Conversely, strong general controls enable auditors to rely more heavily on automated application controls."
                },
                {
                    title: "Control Testing Strategies and Methodologies",
                    content: "Control testing evaluates whether controls are designed effectively (design testing) and operating as intended (operating effectiveness testing). Design testing involves understanding the control process, identifying control procedures, evaluating whether controls address identified risks, and assessing whether control design provides reasonable assurance. Operating effectiveness testing involves determining how controls were applied, the consistency of application, by whom they were applied, and what means were used. Testing methods include Inquiry (asking about control procedures), Observation (watching controls in operation), Inspection (examining evidence of control performance), and Reperformance (independently executing control procedures). The extent of testing depends on factors including control importance, risk level, prior audit results, changes in the control environment, and the auditor's reliance strategy. Test results must be evaluated to determine control effectiveness and the impact on audit strategy.",
                    example: "Example: Testing segregation of duties in accounts payable might involve reviewing system access rights and organizational charts (inspection), observing the invoice approval process (observation), interviewing personnel about their responsibilities (inquiry), and independently reviewing a sample of invoices for proper authorization and processing (reperformance)."
                },
                {
                    title: "Compensating Controls and Risk Mitigation",
                    content: "Compensating controls provide alternative risk mitigation when primary controls are not feasible, cost-effective, or have failed. To be effective, compensating controls must address the same risk as the primary control and provide equivalent risk reduction. Common situations requiring compensating controls include system limitations that prevent ideal control design, small organizations lacking resources for proper segregation of duties, legacy systems that cannot be easily modified, and temporary situations where primary controls are not functioning. Types of compensating controls include management review and approval (additional oversight), independent reconciliation and monitoring (detection of errors), additional documentation and audit trails (enhanced evidence), and enhanced supervision and training (human oversight). Compensating controls should be properly documented, consistently applied, regularly monitored for effectiveness, and periodically reassessed to determine if primary controls can be implemented.",
                    example: "Example: When a small organization cannot properly segregate purchasing, receiving, and accounts payable duties due to limited staff, compensating controls might include detailed monthly review of all purchases by the owner, independent reconciliation of purchase orders to receipts and invoices, and surprise audits of the purchasing process by an external accountant."
                }
            ],
            mixed: [
                {
                    title: "Integrated Audit Process and Risk Management",
                    content: "Modern audit practice integrates audit activities with organizational risk management and governance processes to provide comprehensive assurance and maximize value. This integration begins with understanding the organization's risk management framework, including how risks are identified, assessed, monitored, and reported. Audit planning should align with enterprise risk assessments, focusing on residual risks and control gaps identified by management. Throughout the audit process, auditors should consider how their findings relate to broader organizational risks and whether additional risks have been identified that should be communicated to management. The audit adds value by providing independent assessment of risk management effectiveness, validating management's risk assessments, identifying risks that management may have missed, and evaluating the design and effectiveness of risk mitigation strategies. Effective integration requires ongoing communication between audit and risk management functions, sharing of information and insights, and coordination of activities to avoid duplication while ensuring comprehensive coverage.",
                    example: "Example: If enterprise risk management identifies cybersecurity as a top organizational risk, the audit function should allocate appropriate resources to cybersecurity audits, develop expertise in security testing, coordinate with the security team to understand current threat landscape, and provide assurance on the effectiveness of security controls and incident response capabilities."
                },
                {
                    title: "Emerging Technologies and Audit Implications",
                    content: "Emerging technologies fundamentally change business processes, create new risks, and require evolved audit approaches. Artificial Intelligence and Machine Learning create risks related to algorithm bias, decision transparency, data quality, and model performance that require new audit procedures focused on data governance, model validation, and algorithmic accountability. Blockchain technology creates immutable transaction records but requires understanding of consensus mechanisms, smart contract risks, and privacy implications. Cloud computing changes the control environment by shifting responsibilities between organizations and service providers, requiring evaluation of service provider controls and shared responsibility models. Internet of Things devices create new data sources and attack vectors requiring assessment of device security, data collection practices, and network protections. Robotic Process Automation introduces risks related to bot management, exception handling, and process changes. Auditors must develop new competencies to address these technologies while maintaining professional skepticism about technology-driven solutions.",
                    example: "Example: Auditing an AI-powered credit approval system requires understanding the algorithm's logic and training data, testing for bias in decision-making, evaluating human oversight and intervention capabilities, assessing data quality and model performance monitoring, and reviewing model validation and approval processes."
                },
                {
                    title: "Regulatory Compliance and Multi-Framework Auditing",
                    content: "Organizations increasingly face multiple, overlapping regulatory requirements that create complex compliance obligations and audit challenges. Key regulations affecting IT auditing include Sarbanes-Oxley (internal controls over financial reporting), GDPR and privacy laws (data protection and privacy), HIPAA (healthcare information protection), PCI DSS (payment card security), industry-specific regulations (banking, insurance, utilities), and emerging cybersecurity regulations. Effective audit programs coordinate testing across multiple compliance requirements to avoid duplication while ensuring comprehensive coverage. This requires understanding regulatory relationships, identifying common control objectives, mapping controls to multiple requirements, and developing integrated testing approaches. Auditors must stay current with regulatory changes, enforcement trends, and industry guidance to provide relevant assurance. Multi-framework auditing also requires clear communication about which requirements are being addressed and any limitations in scope or approach.",
                    example: "Example: A healthcare organization must comply with HIPAA privacy requirements, SOX financial reporting controls, and state healthcare regulations. An integrated audit approach might test IT general controls that support all three requirements (access management, change control, monitoring) while conducting specific testing for unique requirements in each framework (HIPAA's minimum necessary standard, SOX entity-level controls, state data breach notification requirements)."
                },
                {
                    title: "Continuous Auditing and Real-Time Assurance",
                    content: "Continuous auditing uses technology to provide ongoing assurance through automated testing, monitoring, and analysis of business processes and controls. This approach shifts from periodic point-in-time audits to continuous risk and control monitoring that can identify issues as they occur. Key components include automated data extraction and analysis, exception identification and alerting, real-time dashboard reporting, and integration with business process monitoring. Benefits include faster issue identification, reduced audit lag time, more comprehensive testing (100% vs. sampling), and improved risk management. However, continuous auditing requires significant technology investment, data quality management, exception processing procedures, and careful consideration of what should be monitored continuously versus periodically. Implementation typically begins with high-risk processes and gradually expands based on experience and demonstrated value. Successful continuous auditing requires collaboration between audit, IT, and business functions to design effective monitoring procedures and response protocols.",
                    example: "Example: Continuous auditing of accounts payable might involve automated daily testing for duplicate payments, unusual payment patterns, policy violations (payments to unapproved vendors, amounts exceeding authorization limits), and segregation of duties violations, with real-time alerts for exceptions requiring investigation."
                }
            ]
        };

        const scenarios = [
            {
                question: "You are auditing a financial institution and discover that a database administrator has both read and write access to production financial data, and also has the ability to modify audit logs. What is your primary concern and recommendation?",
                options: ["The DBA needs additional training on security procedures", "There is inadequate segregation of duties and audit trail integrity issues", "The database needs better encryption", "More frequent password changes are required"],
                correct: 1,
                explanation: "This scenario presents a critical segregation of duties violation where one person has excessive privileges that could allow unauthorized changes and concealment of those changes by modifying audit logs. The recommendation would be to implement role separation and independent monitoring of privileged activities."
            },
            {
                question: "During an audit of change management processes, you find that emergency changes are frequently made without proper documentation or approval. 40% of changes in the last quarter were classified as 'emergency.' What should be your audit focus?",
                options: ["Review the technical quality of the emergency changes", "Evaluate the criteria and approval process for emergency changes", "Recommend hiring more IT staff to prevent emergencies", "Focus on the testing procedures for emergency changes"],
                correct: 1,
                explanation: "A high percentage of emergency changes suggests potential issues with planning, change categorization criteria, or abuse of emergency procedures. The auditor should evaluate whether the emergency classification is appropriate and if proper governance exists even for urgent changes."
            },
            {
                question: "While reviewing user access controls, you discover that 15% of terminated employees still have active system accounts after 30 days. Management claims this is acceptable because 'most don't know their passwords anyway.' How should you respond?",
                options: ["Accept management's explanation as reasonable", "Report this as a significant control deficiency requiring immediate remediation", "Recommend changing passwords instead of disabling accounts", "Focus only on high-privilege terminated accounts"],
                correct: 1,
                explanation: "Active accounts for terminated employees represent a significant security risk regardless of password knowledge. These accounts could be compromised, shared, or used by former employees, creating potential for fraud, data theft, or system misuse."
            },
            {
                question: "During a data center audit, you find that environmental controls are functioning properly, but there's no documented disaster recovery plan testing in the past 18 months. The DR plan exists but hasn't been tested. What's your primary concern?",
                options: ["The environmental controls need improvement", "Untested disaster recovery plans may not work when needed", "The DR plan documentation needs updating", "Staff need additional DR training"],
                correct: 1,
                explanation: "Disaster recovery plans that aren't regularly tested may fail when actually needed. Testing validates the plan's effectiveness, identifies gaps, and ensures staff are familiar with procedures. An untested plan provides false security."
            },
            {
                question: "You're auditing a procurement system and find that the same person can create vendors, approve purchase orders, and receive goods. When questioned, management says 'We trust our staff and haven't had any problems.' What's your audit conclusion?",
                options: ["The control is adequate due to management trust", "This represents a significant segregation of duties violation", "Additional monitoring compensates for the control weakness", "The risk is acceptable for this business process"],
                correct: 1,
                explanation: "Allowing one person to control all aspects of the procurement process creates significant fraud risk. Trust is not an adequate control, and the lack of problems so far doesn't mean problems won't occur. Proper segregation of duties is essential."
            },
            {
                question: "During an application audit, you discover that users can modify their own access permissions without approval. Management states this is efficient and reduces IT workload. Users seem knowledgeable about appropriate access levels. What's your assessment?",
                options: ["This is an acceptable practice given user knowledge", "Efficiency justifies the control weakness", "This represents a critical access control failure requiring immediate attention", "The practice is acceptable with additional user training"],
                correct: 2,
                explanation: "Allowing users to modify their own access permissions violates fundamental access control principles. This creates risk of privilege escalation, unauthorized access, and potential fraud. Efficiency cannot justify such a critical control weakness."
            },
            {
                question: "You're reviewing backup procedures and find that backups are performed daily and stored offsite. However, restore testing hasn't been performed in over a year, and the last test partially failed. What's your primary recommendation?",
                options: ["Increase backup frequency to twice daily", "Implement immediate restore testing and address any failures", "Change the offsite storage vendor", "Document the backup procedures better"],
                correct: 1,
                explanation: "Backups without successful restore testing provide false security. The previous partial failure indicates potential issues that could prevent successful recovery during an actual incident. Regular restore testing is essential to validate backup integrity."
            },
            {
                question: "During a payroll audit, you find that HR can add new employees and Payroll can process payments, but there's no independent verification that new employees are legitimate. All new hires appear to have proper documentation. What's your concern?",
                options: ["The documentation appears complete, so no issues exist", "Ghost employee fraud risk due to lack of independent verification", "HR needs additional training on proper procedures", "The current process is efficient and working well"],
                correct: 1,
                explanation: "Without independent verification of new employee legitimacy, there's risk of ghost employees being added to payroll. While documentation may appear proper, collusion between HR and Payroll staff could result in fraudulent payments to non-existent employees."
            },
            {
                question: "You are conducting an audit planning session and management insists that certain critical systems cannot be included in the audit scope due to 'business criticality' and potential disruption. How should you respond?",
                options: ["Accept the limitation and focus on other systems", "Negotiate alternative testing approaches that minimize business disruption", "Insist that all systems must be included without exception", "Report the scope limitation to the audit committee"],
                correct: 1,
                explanation: "Professional auditing standards require addressing scope limitations while working with management to achieve audit objectives. Negotiating alternative approaches (off-peak testing, read-only access, etc.) can often provide necessary assurance while addressing business concerns."
            },
            {
                question: "During audit fieldwork, you notice that the system logs you're reviewing show a pattern of administrative access occurring during non-business hours by an IT manager. When questioned, the manager explains these are routine maintenance activities. What should be your next step?",
                options: ["Accept the explanation and continue with the audit", "Verify the explanation by examining the specific activities performed during those sessions", "Report this as a potential security incident immediately", "Request that all after-hours access be pre-approved"],
                correct: 1,
                explanation: "Professional skepticism requires verifying explanations with corroborating evidence. The auditor should examine what specific activities were performed, whether they align with routine maintenance, if there's documentation or approval for the work, and whether the activities are consistent with the manager's job responsibilities."
            }
        ];

        // Initialize game
        function initGame() {
            document.querySelectorAll('.mode-card').forEach(card => {
                card.addEventListener('click', () => selectMode(card.dataset.mode));
            });

            document.querySelectorAll('.topic-btn').forEach(btn => {
                btn.addEventListener('click', () => selectTopic(btn.dataset.topic));
            });

            document.getElementById('nextBtn').addEventListener('click', nextQuestion);
            document.getElementById('prevBtn').addEventListener('click', prevQuestion);
            
            // Add flashcard next/previous functionality
            document.getElementById('flashcard').addEventListener('click', flipCard);
        }

        function selectMode(mode) {
            currentMode = mode;
            
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
            
            document.getElementById('topicSelector').style.display = 'block';
        }

        function selectTopic(topic) {
            currentTopic = topic;
            
            document.querySelectorAll('.topic-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-topic="${topic}"]`).classList.add('active');
            
            startMode();
        }

        function startMode() {
            document.getElementById('gameMode').style.display = 'none';
            document.getElementById('topicSelector').style.display = 'none';
            document.getElementById('progressBar').style.display = 'block';
            document.getElementById('controls').style.display = 'flex';
            
            currentQuestion = 0;
            score = 0;
            streak = 0;
            answeredQuestions = [];
            
            if (currentMode === 'quiz' || currentMode === 'scenario') {
                setupQuiz();
            } else if (currentMode === 'flashcards') {
                setupFlashcards();
            } else if (currentMode === 'learn') {
                setupLearning();
            }
        }

        function setupQuiz() {
            if (currentMode === 'scenario') {
                currentQuestions = [...scenarios];
            } else if (currentTopic === 'mixed') {
                currentQuestions = [
                    ...questionBank.planning,
                    ...questionBank.execution,
                    ...questionBank.standards,
                    ...questionBank.controls
                ].sort(() => Math.random() - 0.5);
            } else {
                currentQuestions = [...questionBank[currentTopic]];
            }
            
            document.getElementById('questionContainer').classList.add('active');
            document.getElementById('learningContainer').classList.remove('active');
            document.getElementById('flashcard').style.display = 'none';
            
            showQuestion();
        }

        function setupFlashcards() {
            let cards;
            if (currentTopic === 'mixed') {
                cards = [
                    ...flashcards.planning,
                    ...flashcards.execution,
                    ...flashcards.standards,
                    ...flashcards.controls
                ].sort(() => Math.random() - 0.5);
            } else {
                cards = [...flashcards[currentTopic]];
            }
            
            currentQuestions = cards;
            
            document.getElementById('questionContainer').classList.remove('active');
            document.getElementById('learningContainer').classList.remove('active');
            document.getElementById('flashcard').style.display = 'flex';
            
            showFlashcard();
        }

        function setupLearning() {
            let lessons;
            if (currentTopic === 'mixed') {
                lessons = [
                    ...learningContent.planning,
                    ...learningContent.execution,
                    ...learningContent.standards,
                    ...learningContent.controls
                ];
            } else {
                lessons = [...learningContent[currentTopic]];
            }
            
            currentQuestions = lessons;
            
            document.getElementById('questionContainer').classList.remove('active');
            document.getElementById('learningContainer').classList.add('active');
            document.getElementById('flashcard').style.display = 'none';
            
            showLearningContent();
        }

        function showQuestion() {
            if (currentQuestion >= currentQuestions.length) {
                showResults();
                return;
            }
            
            const question = currentQuestions[currentQuestion];
            
            document.getElementById('question').textContent = question.question;
            
            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.textContent = option;
                optionElement.addEventListener('click', () => selectOption(index));
                optionsContainer.appendChild(optionElement);
            });
            
            document.getElementById('explanation').style.display = 'none';
            document.getElementById('explanation').classList.remove('show');
            document.getElementById('nextBtn').textContent = 'Submit Answer';
            document.getElementById('nextBtn').disabled = true;
            
            updateProgress();
        }

        function showFlashcard() {
            if (currentQuestion >= currentQuestions.length) {
                showResults();
                return;
            }
            
            const card = currentQuestions[currentQuestion];
            document.getElementById('cardContent').textContent = card.front;
            document.getElementById('cardProgress').textContent = `Card ${currentQuestion + 1} of ${currentQuestions.length}`;
            document.getElementById('flashcard').classList.remove('flipped');
            
            // Update button text for flashcards
            if (currentQuestion === 0) {
                document.getElementById('prevBtn').textContent = 'Previous';
                document.getElementById('prevBtn').disabled = true;
            } else {
                document.getElementById('prevBtn').textContent = 'Previous';
                document.getElementById('prevBtn').disabled = false;
            }
            
            if (currentQuestion === currentQuestions.length - 1) {
                document.getElementById('nextBtn').textContent = 'Complete';
            } else {
                document.getElementById('nextBtn').textContent = 'Next Card';
            }
            document.getElementById('nextBtn').disabled = false;
            
            updateProgress();
        }

        function showLearningContent() {
            if (currentQuestion >= currentQuestions.length) {
                showResults();
                return;
            }
            
            const lesson = currentQuestions[currentQuestion];
            
            document.getElementById('learningTitle').textContent = lesson.title;
            document.getElementById('learningText').innerHTML = lesson.content;
            document.getElementById('learningExample').innerHTML = `<strong>üí° Practical Example:</strong><br>${lesson.example}`;
            
            if (currentQuestion === currentQuestions.length - 1) {
                document.getElementById('nextBtn').textContent = 'Complete Learning Module';
            } else {
                document.getElementById('nextBtn').textContent = `Next Lesson (${currentQuestion + 2}/${currentQuestions.length})`;
            }
            
            document.getElementById('prevBtn').disabled = currentQuestion === 0;
            document.getElementById('nextBtn').disabled = false;
            
            updateProgress();
        }

        function flipCard() {
            const flashcard = document.getElementById('flashcard');
            const card = currentQuestions[currentQuestion];
            
            if (flashcard.classList.contains('flipped')) {
                document.getElementById('cardContent').textContent = card.front;
                flashcard.classList.remove('flipped');
            } else {
                document.getElementById('cardContent').textContent = card.back;
                flashcard.classList.add('flipped');
            }
        }

        function selectOption(index) {
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            document.querySelectorAll('.option')[index].classList.add('selected');
            document.getElementById('nextBtn').disabled = false;
            
            answeredQuestions[currentQuestion] = index;
        }

        function nextQuestion() {
            if (currentMode === 'flashcards') {
                currentQuestion++;
                score += 5; // Points for reviewing flashcards
                updateScore();
                if (currentQuestion >= currentQuestions.length) {
                    showResults();
                } else {
                    showFlashcard();
                }
                return;
            }
            
            if (currentMode === 'learn') {
                currentQuestion++;
                score += 10;
                updateScore();
                if (currentQuestion >= currentQuestions.length) {
                    showResults();
                } else {
                    showLearningContent();
                }
                return;
            }
            
            const question = currentQuestions[currentQuestion];
            const selectedAnswer = answeredQuestions[currentQuestion];
            
            if (document.getElementById('nextBtn').textContent === 'Submit Answer') {
                const options = document.querySelectorAll('.option');
                
                if (selectedAnswer === question.correct) {
                    options[selectedAnswer].classList.add('correct');
                    score += 10;
                    streak++;
                } else {
                    options[selectedAnswer].classList.add('incorrect');
                    options[question.correct].classList.add('correct');
                    streak = 0;
                }
                
                document.getElementById('explanation').innerHTML = `<strong>Explanation:</strong><br>${question.explanation}`;
                document.getElementById('explanation').classList.add('show');
                
                document.getElementById('nextBtn').textContent = 'Next Question';
                updateScore();
                
                // Update progress to 100% on the last question
                if (currentQuestion === currentQuestions.length - 1) {
                    document.getElementById('progress').textContent = '100';
                    document.getElementById('progressFill').style.width = '100%';
                }
                
            } else {
                currentQuestion++;
                if (currentQuestion >= currentQuestions.length) {
                    showResults();
                } else {
                    showQuestion();
                }
            }
        }

        function prevQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                if (currentMode === 'flashcards') {
                    showFlashcard();
                } else if (currentMode === 'learn') {
                    showLearningContent();
                } else {
                    showQuestion();
                }
            }
        }

        function goBackToModes() {
            document.getElementById('gameMode').style.display = 'grid';
            document.getElementById('topicSelector').style.display = 'none';
            
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('active');
            });
            
            currentMode = '';
            currentTopic = '';
        }

        function goBackToTopics() {
            document.getElementById('topicSelector').style.display = 'block';
            document.getElementById('progressBar').style.display = 'none';
            document.getElementById('questionContainer').classList.remove('active');
            document.getElementById('learningContainer').classList.remove('active');
            document.getElementById('flashcard').style.display = 'none';
            document.getElementById('controls').style.display = 'none';
            
            document.querySelectorAll('.topic-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            currentTopic = '';
            currentQuestion = 0;
            score = 0;
            streak = 0;
            updateScore();
        }

        function updateScore() {
            document.getElementById('score').textContent = score;
            document.getElementById('streak').textContent = streak;
        }

        function updateProgress() {
            // Fixed progress calculation that reaches 100%
            let progress;
            if (currentQuestion === currentQuestions.length - 1 && 
                (currentMode === 'flashcards' || currentMode === 'learn' || 
                 (currentMode === 'quiz' || currentMode === 'scenario') && document.getElementById('nextBtn').textContent !== 'Submit Answer')) {
                progress = 100;
            } else {
                progress = Math.round((currentQuestion / currentQuestions.length) * 100);
            }
            
            document.getElementById('progress').textContent = progress;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function showResults() {
            // Ensure progress shows 100% when results are shown
            document.getElementById('progress').textContent = '100';
            document.getElementById('progressFill').style.width = '100%';
            
            document.getElementById('questionContainer').classList.remove('active');
            document.getElementById('learningContainer').classList.remove('active');
            document.getElementById('flashcard').style.display = 'none';
            document.getElementById('controls').style.display = 'none';
            document.getElementById('results').classList.add('show');
            
            let resultMessage = '';
            let nextSteps = '';
            
            if (currentMode === 'flashcards') {
                resultMessage = `You reviewed ${currentQuestions.length} flashcards! Great job studying CISA Domain 1 concepts.`;
                nextSteps = " Try the quiz mode to test your knowledge or explore another topic area.";
                document.getElementById('finalScore').textContent = `${currentQuestions.length} Cards Reviewed`;
            } else if (currentMode === 'learn') {
                resultMessage = `You completed ${currentQuestions.length} comprehensive learning modules! You've gained deep insights into CISA Domain 1 concepts.`;
                nextSteps = " Consider testing your knowledge with quiz mode or reviewing key terms with flashcards.";
                document.getElementById('finalScore').textContent = `${currentQuestions.length} Modules Complete`;
            } else {
                const percentage = Math.round((score / (currentQuestions.length * 10)) * 100);
                document.getElementById('finalScore').textContent = `${percentage}%`;
                
                if (percentage >= 90) {
                    resultMessage = 'üåü Outstanding! You have excellent mastery of CISA Domain 1 concepts! You\'re well-prepared for this section of the exam.';
                    nextSteps = " Try another topic area or challenge yourself with scenario mode.";
                } else if (percentage >= 80) {
                    resultMessage = 'üéâ Great job! You have a solid understanding of the material.';
                    nextSteps = " Review the explanations for missed questions and try another topic area to broaden your knowledge.";
                } else if (percentage >= 70) {
                    resultMessage = 'üëç Good work! You\'re on the right track.';
                    nextSteps = " Use the learning modules to strengthen weak areas, then practice with flashcards before retrying.";
                } else {
                    resultMessage = 'üìö Keep studying! This is a challenging certification.';
                    nextSteps = " Start with the learning modules to build your foundation, then practice with flashcards before attempting quizzes.";
                }
            }
            
            document.getElementById('resultMessage').textContent = resultMessage + nextSteps;
        }

        function playAgain() {
            // Reset current section and play again with same mode and topic
            currentQuestion = 0;
            score = 0;
            streak = 0;
            answeredQuestions = [];
            
            // Hide results and restart the current mode
            document.getElementById('results').classList.remove('show');
            document.getElementById('progressBar').style.display = 'block';
            document.getElementById('controls').style.display = 'flex';
            
            // Restart the same mode and topic
            if (currentMode === 'quiz' || currentMode === 'scenario') {
                setupQuiz();
            } else if (currentMode === 'flashcards') {
                setupFlashcards();
            } else if (currentMode === 'learn') {
                setupLearning();
            }
            
            updateScore();
        }

        function goToMainScreen() {
            // Go back to the main game mode selection screen
            document.getElementById('gameMode').style.display = 'grid';
            document.getElementById('topicSelector').style.display = 'none';
            document.getElementById('progressBar').style.display = 'none';
            document.getElementById('questionContainer').classList.remove('active');
            document.getElementById('learningContainer').classList.remove('active');
            document.getElementById('flashcard').style.display = 'none';
            document.getElementById('controls').style.display = 'none';
            document.getElementById('results').classList.remove('show');
            
            // Clear mode selection but keep the score
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelectorAll('.topic-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Reset mode and topic but keep accumulated score
            currentMode = '';
            currentTopic = '';
            currentQuestion = 0;
            answeredQuestions = [];
            
            // Keep the score to show overall progress across sections
            updateScore();
            document.getElementById('progress').textContent = '0';
            document.getElementById('progressFill').style.width = '0%';
        }

        function chooseAnotherSection() {
            // Go to topic selection to choose a different section
            document.getElementById('gameMode').style.display = 'none';
            document.getElementById('topicSelector').style.display = 'block';
            document.getElementById('progressBar').style.display = 'none';
            document.getElementById('questionContainer').classList.remove('active');
            document.getElementById('learningContainer').classList.remove('active');
            document.getElementById('flashcard').style.display = 'none';
            document.getElementById('controls').style.display = 'none';
            document.getElementById('results').classList.remove('show');
            
            // Clear topic selection but keep the current mode
            document.querySelectorAll('.topic-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Reset topic and question state but keep mode and accumulated score
            currentTopic = '';
            currentQuestion = 0;
            answeredQuestions = [];
            
            updateScore();
            document.getElementById('progress').textContent = '0';
            document.getElementById('progressFill').style.width = '0%';
        }

        function resetGame() {
            // Completely reset everything to initial state
            document.getElementById('gameMode').style.display = 'grid';
            document.getElementById('topicSelector').style.display = 'none';
            document.getElementById('progressBar').style.display = 'none';
            document.getElementById('questionContainer').classList.remove('active');
            document.getElementById('learningContainer').classList.remove('active');
            document.getElementById('flashcard').style.display = 'none';
            document.getElementById('controls').style.display = 'none';
            document.getElementById('results').classList.remove('show');
            
            // Reset all state variables
            currentMode = '';
            currentTopic = '';
            currentQuestion = 0;
            score = 0;
            streak = 0;
            answeredQuestions = [];
            
            // Reset all UI selections
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelectorAll('.topic-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            updateScore();
            document.getElementById('progress').textContent = '0';
            document.getElementById('progressFill').style.width = '0%';
        }

        // Initialize the game when page loads
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
