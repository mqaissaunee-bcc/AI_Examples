<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SELinux Security Management - Interactive Training</title>
    <style>
        /* ========== CSS RESET & BASE STYLES ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Color Palette */
            --primary-color: #2c5aa0;
            --secondary-color: #5c8ac7;
            --accent-color: #ff6b35;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --dark-bg: #1a1a2e;
            --light-bg: #f5f5f5;
            --card-bg: #ffffff;
            --text-primary: #333333;
            --text-secondary: #666666;
            --border-color: #e0e0e0;
            --terminal-bg: #0c0c0c;
            --terminal-text: #00ff00;
            
            /* Spacing */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            
            /* Typography */
            --font-main: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            --font-mono: 'Courier New', Courier, monospace;
        }

        body {
            font-family: var(--font-main);
            line-height: 1.6;
            color: var(--text-primary);
            background-color: var(--light-bg);
        }

        /* ========== LAYOUT ========== */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--spacing-md);
        }

        /* ========== HEADER ========== */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: var(--spacing-xl) var(--spacing-md);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: var(--spacing-sm);
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* ========== PROGRESS TRACKER ========== */
        .progress-container {
            background: white;
            padding: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: var(--border-color);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color), var(--secondary-color));
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: var(--spacing-md);
            color: white;
            font-weight: bold;
        }

        .progress-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--spacing-md);
            margin-top: var(--spacing-md);
        }

        .stat-item {
            text-align: center;
            padding: var(--spacing-md);
            background: var(--light-bg);
            border-radius: 6px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* ========== NAVIGATION TABS ========== */
        .nav-tabs {
            display: flex;
            gap: var(--spacing-sm);
            background: white;
            padding: var(--spacing-md);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: var(--spacing-lg);
            overflow-x: auto;
        }

        .nav-tab {
            padding: var(--spacing-md) var(--spacing-lg);
            background: var(--light-bg);
            border: 2px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-weight: 500;
        }

        .nav-tab:hover {
            background: var(--secondary-color);
            color: white;
        }

        .nav-tab.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* ========== CONTENT SECTIONS ========== */
        .content-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ========== CARDS ========== */
        .card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: var(--primary-color);
            margin-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: var(--spacing-sm);
        }

        .card h3 {
            color: var(--secondary-color);
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        /* ========== INTERACTIVE DIAGRAM ========== */
        .diagram-container {
            background: var(--light-bg);
            padding: var(--spacing-xl);
            border-radius: 8px;
            margin: var(--spacing-lg) 0;
        }

        .selinux-flow {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
            align-items: center;
        }

        .flow-item {
            background: white;
            padding: var(--spacing-lg);
            border-radius: 8px;
            border: 2px solid var(--primary-color);
            cursor: pointer;
            transition: all 0.3s ease;
            max-width: 600px;
            width: 100%;
        }

        .flow-item:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(44, 90, 160, 0.3);
        }

        .flow-item.active {
            background: var(--primary-color);
            color: white;
        }

        .flow-arrow {
            font-size: 2rem;
            color: var(--secondary-color);
        }

        .flow-details {
            margin-top: var(--spacing-md);
            padding: var(--spacing-md);
            background: var(--light-bg);
            border-radius: 6px;
            display: none;
        }

        .flow-item.active .flow-details {
            display: block;
            background: rgba(255,255,255,0.2);
        }

        /* ========== MODE SIMULATOR ========== */
        .mode-simulator {
            background: var(--light-bg);
            padding: var(--spacing-xl);
            border-radius: 8px;
            margin: var(--spacing-lg) 0;
        }

        .mode-controls {
            display: flex;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: var(--spacing-md) var(--spacing-lg);
            border: 2px solid var(--primary-color);
            background: white;
            color: var(--primary-color);
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .mode-btn:hover {
            background: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }

        .mode-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .mode-output {
            background: white;
            padding: var(--spacing-lg);
            border-radius: 6px;
            border-left: 4px solid var(--primary-color);
        }

        .mode-status {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: var(--spacing-md);
        }

        /* ========== VIRTUAL TERMINAL ========== */
        .terminal {
            background: var(--terminal-bg);
            color: var(--terminal-text);
            font-family: var(--font-mono);
            padding: var(--spacing-lg);
            border-radius: 8px;
            margin: var(--spacing-lg) 0;
            min-height: 400px;
            overflow-y: auto;
        }

        .terminal-header {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-sm);
            border-bottom: 1px solid #333;
        }

        .terminal-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .dot-red { background: #ff5f56; }
        .dot-yellow { background: #ffbd2e; }
        .dot-green { background: #27c93f; }

        .terminal-output {
            margin-bottom: var(--spacing-md);
            line-height: 1.8;
        }

        .terminal-prompt {
            color: #5c8ac7;
        }

        .terminal-input-line {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .terminal-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--terminal-text);
            font-family: var(--font-mono);
            font-size: 1rem;
            outline: none;
        }

        .terminal-error {
            color: var(--danger-color);
        }

        .terminal-success {
            color: var(--success-color);
        }

        /* ========== COMMAND BUILDER ========== */
        .command-builder {
            background: white;
            padding: var(--spacing-lg);
            border-radius: 8px;
            border: 2px solid var(--border-color);
        }

        .builder-section {
            margin-bottom: var(--spacing-lg);
        }

        .builder-section label {
            display: block;
            font-weight: bold;
            margin-bottom: var(--spacing-sm);
            color: var(--primary-color);
        }

        .builder-section input,
        .builder-section select {
            width: 100%;
            padding: var(--spacing-md);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
        }

        .generated-command {
            background: var(--terminal-bg);
            color: var(--terminal-text);
            padding: var(--spacing-lg);
            border-radius: 6px;
            font-family: var(--font-mono);
            margin-top: var(--spacing-md);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .copy-btn {
            background: var(--success-color);
            color: white;
            border: none;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: #218838;
        }

        /* ========== BOOLEAN DASHBOARD ========== */
        .boolean-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--spacing-md);
            margin: var(--spacing-lg) 0;
        }

        .boolean-item {
            background: white;
            padding: var(--spacing-md);
            border-radius: 6px;
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .boolean-item:hover {
            border-color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .boolean-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }

        .boolean-name {
            font-weight: bold;
            color: var(--primary-color);
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 26px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--success-color);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .boolean-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: var(--spacing-sm);
        }

        /* ========== AVC DECODER ========== */
        .avc-decoder {
            background: var(--light-bg);
            padding: var(--spacing-lg);
            border-radius: 8px;
        }

        .avc-input {
            width: 100%;
            min-height: 120px;
            padding: var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-family: var(--font-mono);
            font-size: 0.9rem;
            margin-bottom: var(--spacing-md);
        }

        .decode-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: var(--spacing-md) var(--spacing-xl);
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .decode-btn:hover {
            background: var(--secondary-color);
        }

        .decoded-output {
            background: white;
            padding: var(--spacing-lg);
            border-radius: 6px;
            margin-top: var(--spacing-md);
            border-left: 4px solid var(--warning-color);
        }

        .decoded-section {
            margin-bottom: var(--spacing-md);
        }

        .decoded-section strong {
            color: var(--primary-color);
        }

        /* ========== CHEATSHEET ========== */
        .cheatsheet {
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .cheatsheet-search {
            padding: var(--spacing-lg);
            border-bottom: 2px solid var(--border-color);
        }

        .cheatsheet-search input {
            width: 100%;
            padding: var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
        }

        .command-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .command-item {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            transition: background 0.3s ease;
        }

        .command-item:hover {
            background: var(--light-bg);
        }

        .command-syntax {
            font-family: var(--font-mono);
            background: var(--terminal-bg);
            color: var(--terminal-text);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: 4px;
            display: inline-block;
            margin-bottom: var(--spacing-sm);
        }

        .command-description {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-sm);
        }

        .command-example {
            background: var(--light-bg);
            padding: var(--spacing-md);
            border-radius: 4px;
            font-family: var(--font-mono);
            font-size: 0.9rem;
            margin-top: var(--spacing-sm);
        }

        /* ========== QUIZ ========== */
        .quiz-container {
            background: white;
            padding: var(--spacing-lg);
            border-radius: 8px;
        }

        .quiz-question {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: var(--spacing-lg);
            color: var(--primary-color);
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .quiz-option {
            padding: var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quiz-option:hover {
            border-color: var(--primary-color);
            background: var(--light-bg);
        }

        .quiz-option.selected {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: white;
        }

        .quiz-option.correct {
            border-color: var(--success-color);
            background: var(--success-color);
            color: white;
        }

        .quiz-option.incorrect {
            border-color: var(--danger-color);
            background: var(--danger-color);
            color: white;
        }

        .quiz-feedback {
            margin-top: var(--spacing-lg);
            padding: var(--spacing-md);
            border-radius: 6px;
            font-weight: bold;
        }

        .quiz-feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .quiz-feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .quiz-controls {
            display: flex;
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
        }

        .quiz-btn {
            padding: var(--spacing-md) var(--spacing-xl);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .submit-btn {
            background: var(--primary-color);
            color: white;
        }

        .submit-btn:hover {
            background: var(--secondary-color);
        }

        .next-btn {
            background: var(--success-color);
            color: white;
        }

        .next-btn:hover {
            background: #218838;
        }

        /* ========== CONTEXT LABEL EXPLORER ========== */
        .label-explorer {
            background: var(--light-bg);
            padding: var(--spacing-xl);
            border-radius: 8px;
        }

        .label-display {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: var(--spacing-xl);
        }

        .label-part {
            background: white;
            padding: var(--spacing-lg);
            border-radius: 8px;
            border: 3px solid var(--primary-color);
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 150px;
            text-align: center;
        }

        .label-part:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .label-part.active {
            background: var(--primary-color);
            color: white;
        }

        .label-part-name {
            font-size: 0.8rem;
            text-transform: uppercase;
            font-weight: bold;
            margin-bottom: var(--spacing-sm);
        }

        .label-part-value {
            font-size: 1.2rem;
            font-family: var(--font-mono);
        }

        .label-explanation {
            background: white;
            padding: var(--spacing-lg);
            border-radius: 6px;
            min-height: 100px;
        }

        /* ========== BUTTONS ========== */
        .btn {
            padding: var(--spacing-md) var(--spacing-lg);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary-color);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        /* ========== ALERTS ========== */
        .alert {
            padding: var(--spacing-md);
            border-radius: 6px;
            margin: var(--spacing-md) 0;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* ========== RESPONSIVE DESIGN ========== */
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8rem;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .mode-controls {
                flex-direction: column;
            }

            .label-display {
                flex-direction: column;
            }

            .boolean-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ========== UTILITY CLASSES ========== */
        .mb-1 { margin-bottom: var(--spacing-sm); }
        .mb-2 { margin-bottom: var(--spacing-md); }
        .mb-3 { margin-bottom: var(--spacing-lg); }
        .mt-1 { margin-top: var(--spacing-sm); }
        .mt-2 { margin-top: var(--spacing-md); }
        .mt-3 { margin-top: var(--spacing-lg); }
        .text-center { text-align: center; }
        .text-muted { color: var(--text-secondary); }
        .hidden { display: none !important; }

        /* ========== TABLES ========== */
        table {
            font-size: 0.95rem;
        }

        table th {
            font-weight: bold;
        }

        table code {
            background: rgba(0,0,0,0.05);
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: var(--font-mono);
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>üîí SELinux Security Management</h1>
            <p>Interactive Training Platform - Master Linux Security</p>
        </div>
    </header>

    <div class="container">
        <!-- Progress Tracker -->
        <div class="progress-container">
            <div class="progress-header">
                <h2>Your Learning Progress</h2>
                <button class="btn btn-primary" onclick="resetProgress()">Reset Progress</button>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">0%</div>
            </div>
            <div class="progress-stats">
                <div class="stat-item">
                    <div class="stat-value" id="completedModules">0</div>
                    <div class="stat-label">Modules Completed</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="commandsPracticed">0</div>
                    <div class="stat-label">Commands Practiced</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="quizScore">0%</div>
                    <div class="stat-label">Quiz Average</div>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="switchTab('introduction')">Introduction</div>
            <div class="nav-tab" onclick="switchTab('architecture')">Architecture</div>
            <div class="nav-tab" onclick="switchTab('modes')">Enforcement Modes</div>
            <div class="nav-tab" onclick="switchTab('contexts')">File Contexts</div>
            <div class="nav-tab" onclick="switchTab('booleans')">Booleans</div>
            <div class="nav-tab" onclick="switchTab('troubleshooting')">Troubleshooting</div>
            <div class="nav-tab" onclick="switchTab('terminal')">Virtual Terminal</div>
            <div class="nav-tab" onclick="switchTab('cheatsheet')">Command Reference</div>
        </div>

        <!-- Section 0: Introduction -->
        <div id="introduction" class="content-section active">
            <div class="card">
                <h2>üîí What is SELinux?</h2>
                <p><strong>Security-Enhanced Linux (SELinux)</strong> is a powerful security architecture integrated into the Linux kernel. Originally developed by the National Security Agency (NSA) and released to the open-source community in 2000, SELinux provides a mechanism for supporting mandatory access control (MAC) security policies.</p>

                <div class="alert alert-info">
                    <strong>In Simple Terms:</strong> SELinux is like having a sophisticated security guard that checks every single action on your system. Even if someone gains unauthorized access to your system, SELinux limits what they can do by enforcing strict rules about which processes can access which resources.
                </div>

                <h3>üéØ Why Do We Use SELinux?</h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin: 1.5rem 0;">
                    <div style="background: var(--light-bg); padding: 1.5rem; border-radius: 8px; border-left: 4px solid var(--primary-color);">
                        <h4 style="color: var(--primary-color); margin-bottom: 0.5rem;">üõ°Ô∏è Defense in Depth</h4>
                        <p>Traditional Linux permissions (DAC) control <em>who</em> can access files. But if an attacker compromises a user account or service, they gain all that user's permissions. SELinux adds an additional layer that controls <em>how</em> resources can be used, even by authorized users.</p>
                    </div>

                    <div style="background: var(--light-bg); padding: 1.5rem; border-radius: 8px; border-left: 4px solid var(--success-color);">
                        <h4 style="color: var(--success-color); margin-bottom: 0.5rem;">üîê Contain Security Breaches</h4>
                        <p>When a service like Apache is compromised, SELinux limits the damage. The attacker is confined to only what the Apache process is allowed to access‚Äîpreventing them from reading sensitive files, accessing other services, or escalating privileges.</p>
                    </div>

                    <div style="background: var(--light-bg); padding: 1.5rem; border-radius: 8px; border-left: 4px solid var(--warning-color);">
                        <h4 style="color: var(--warning-color); margin-bottom: 0.5rem;">üìú Compliance Requirements</h4>
                        <p>Many security standards and regulations (PCI-DSS, HIPAA, FIPS) require or strongly recommend mandatory access control systems. SELinux helps organizations meet these compliance requirements.</p>
                    </div>

                    <div style="background: var(--light-bg); padding: 1.5rem; border-radius: 8px; border-left: 4px solid var(--secondary-color);">
                        <h4 style="color: var(--secondary-color); margin-bottom: 0.5rem;">üéØ Principle of Least Privilege</h4>
                        <p>SELinux enforces that processes run with the minimum permissions necessary. This drastically reduces the attack surface and limits what malicious code can accomplish.</p>
                    </div>
                </div>

                <h3>üí° Real-World Attack Prevention Examples</h3>

                <div class="diagram-container">
                    <div style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;">
                        <h4 style="color: var(--danger-color);">‚ùå Without SELinux: Web Server Compromise</h4>
                        <ol style="margin-left: 1.5rem; line-height: 1.8;">
                            <li>Attacker exploits a vulnerability in your web application</li>
                            <li>Gains shell access as the Apache user (usually <code>apache</code> or <code>www-data</code>)</li>
                            <li>Can read any file the Apache user can read: <code>/etc/passwd</code>, database configs, SSH keys</li>
                            <li>Can write to web directories, upload malicious scripts</li>
                            <li>Can potentially connect to other internal services</li>
                            <li><strong>Result:</strong> Complete server compromise</li>
                        </ol>
                    </div>

                    <div style="background: white; padding: 1.5rem; border-radius: 8px;">
                        <h4 style="color: var(--success-color);">‚úÖ With SELinux Enforcing: Breach Contained</h4>
                        <ol style="margin-left: 1.5rem; line-height: 1.8;">
                            <li>Attacker exploits the same vulnerability</li>
                            <li>Gains shell access as Apache, but process runs with <code>httpd_t</code> context</li>
                            <li><strong>Cannot</strong> read <code>/etc/shadow</code> or SSH keys‚ÄîSELinux blocks access</li>
                            <li><strong>Cannot</strong> write outside designated web directories</li>
                            <li><strong>Cannot</strong> execute arbitrary binaries or scripts</li>
                            <li><strong>Cannot</strong> connect to databases or services without explicit policy rules</li>
                            <li><strong>Result:</strong> Attack contained, breach logged, administrator alerted</li>
                        </ol>
                    </div>
                </div>

                <h3>üîç How SELinux Differs from Traditional Permissions</h3>

                <table style="width: 100%; border-collapse: collapse; margin: 1.5rem 0; background: white;">
                    <thead>
                        <tr style="background: var(--primary-color); color: white;">
                            <th style="padding: 1rem; text-align: left; border: 1px solid var(--border-color);">Aspect</th>
                            <th style="padding: 1rem; text-align: left; border: 1px solid var(--border-color);">Traditional Permissions (DAC)</th>
                            <th style="padding: 1rem; text-align: left; border: 1px solid var(--border-color);">SELinux (MAC)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="padding: 1rem; border: 1px solid var(--border-color);"><strong>Control Type</strong></td>
                            <td style="padding: 1rem; border: 1px solid var(--border-color);">Discretionary - users control access to their own files</td>
                            <td style="padding: 1rem; border: 1px solid var(--border-color);">Mandatory - system-wide policy cannot be overridden</td>
                        </tr>
                        <tr style="background: var(--light-bg);">
                            <td style="padding: 1rem; border: 1px solid var(--border-color);"><strong>Access Model</strong></td>
                            <td style="padding: 1rem; border: 1px solid var(--border-color);">Based on user/group/world permissions</td>
                            <td style="padding: 1rem; border: 1px solid var(--border-color);">Based on security context labels and policy rules</td>
                        </tr>
                        <tr>
                            <td style="padding: 1rem; border: 1px solid var(--border-color);"><strong>Compromise Impact</strong></td>
                            <td style="padding: 1rem; border: 1px solid var(--border-color);">Attacker gains all permissions of compromised user</td>
                            <td style="padding: 1rem; border: 1px solid var(--border-color);">Attacker limited to process-specific policy rules</td>
                        </tr>
                        <tr style="background: var(--light-bg);">
                            <td style="padding: 1rem; border: 1px solid var(--border-color);"><strong>Root Override</strong></td>
                            <td style="padding: 1rem; border: 1px solid var(--border-color);">Root user can access everything</td>
                            <td style="padding: 1rem; border: 1px solid var(--border-color);">Even root processes must follow SELinux policy</td>
                        </tr>
                        <tr>
                            <td style="padding: 1rem; border: 1px solid var(--border-color);"><strong>Default Behavior</strong></td>
                            <td style="padding: 1rem; border: 1px solid var(--border-color);">Permissions granted, must explicitly deny</td>
                            <td style="padding: 1rem; border: 1px solid var(--border-color);">Access denied unless explicitly allowed</td>
                        </tr>
                    </tbody>
                </table>

                <h3>üéì Key Concepts You'll Learn</h3>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin: 1.5rem 0;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üèóÔ∏è</div>
                        <h4 style="margin-bottom: 0.5rem;">Architecture</h4>
                        <p style="font-size: 0.9rem; opacity: 0.9;">Security contexts, policy rules, and decision-making flow</p>
                    </div>

                    <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 1.5rem; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">‚öôÔ∏è</div>
                        <h4 style="margin-bottom: 0.5rem;">Modes</h4>
                        <p style="font-size: 0.9rem; opacity: 0.9;">Enforcing, Permissive, and Disabled operational modes</p>
                    </div>

                    <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 1.5rem; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üìÅ</div>
                        <h4 style="margin-bottom: 0.5rem;">File Contexts</h4>
                        <p style="font-size: 0.9rem; opacity: 0.9;">Managing security labels on files and directories</p>
                    </div>

                    <div style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; padding: 1.5rem; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üéõÔ∏è</div>
                        <h4 style="margin-bottom: 0.5rem;">Booleans</h4>
                        <p style="font-size: 0.9rem; opacity: 0.9;">Fine-tuning policy behavior without recompilation</p>
                    </div>

                    <div style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; padding: 1.5rem; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üîß</div>
                        <h4 style="margin-bottom: 0.5rem;">Troubleshooting</h4>
                        <p style="font-size: 0.9rem; opacity: 0.9;">Diagnosing and resolving access denial issues</p>
                    </div>
                </div>

                <h3>üöÄ Getting Started</h3>

                <div class="alert alert-info">
                    <strong>üëâ Ready to begin?</strong> This interactive training will guide you through each concept with:
                    <ul style="margin: 0.5rem 0 0 1.5rem;">
                        <li>Interactive diagrams and visual demonstrations</li>
                        <li>Hands-on command builders and simulators</li>
                        <li>A virtual terminal to practice real commands</li>
                        <li>Knowledge checks to reinforce learning</li>
                        <li>Comprehensive command reference</li>
                    </ul>
                </div>

                <div style="display: flex; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="navigateToTab('architecture')" style="font-size: 1.1rem; padding: 1rem 2rem;">
                        Start Learning: Architecture ‚Üí
                    </button>
                    <button class="btn btn-success" onclick="completeModule('introduction')" style="font-size: 1.1rem; padding: 1rem 2rem;">
                        Mark Introduction Complete
                    </button>
                </div>

                <h3 style="margin-top: 2rem;">üìñ Additional Resources</h3>
                <div style="background: var(--light-bg); padding: 1.5rem; border-radius: 8px;">
                    <p><strong>Want to dive deeper?</strong> After completing this training, explore these topics:</p>
                    <ul style="margin-left: 1.5rem; line-height: 2;">
                        <li><strong>Custom Policy Development:</strong> Creating your own SELinux modules</li>
                        <li><strong>Multi-Level Security (MLS):</strong> Advanced security categorization</li>
                        <li><strong>SELinux User Management:</strong> Mapping Linux users to SELinux users</li>
                        <li><strong>Audit2allow:</strong> Automated policy generation from denials</li>
                        <li><strong>SELinux in Containers:</strong> Securing Docker and Podman workloads</li>
                    </ul>
                </div>
            </div>

            <div class="card" style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white;">
                <h2 style="color: white; border-bottom-color: rgba(255,255,255,0.3);">üí≠ Remember</h2>
                <blockquote style="border-left: 4px solid white; padding-left: 1.5rem; margin: 1rem 0; font-size: 1.1rem; font-style: italic;">
                    "SELinux is not about making your system harder to use‚Äîit's about making it harder to compromise. The investment in learning SELinux pays dividends in security and peace of mind."
                </blockquote>
                <p style="margin-top: 1.5rem; opacity: 0.9;">By the end of this training, you'll understand not just <em>how</em> to use SELinux, but <em>why</em> it's one of the most important security features in modern Linux systems.</p>
            </div>
        </div>

        <!-- Section 1: Architecture -->
        <div id="architecture" class="content-section">
            <div class="card">
                <h2>SELinux Architecture & Concepts</h2>
                <p>Security Enhanced Linux (SELinux) is a critical security feature that provides mandatory access control (MAC). Unlike traditional discretionary access control (DAC), SELinux policies cannot be bypassed by users.</p>

                <h3>Interactive Context Label Explorer</h3>
                <div class="label-explorer">
                    <div class="label-display">
                        <div class="label-part active" onclick="explainLabelPart('user')">
                            <div class="label-part-name">User</div>
                            <div class="label-part-value">unconfined_u</div>
                        </div>
                        <div class="label-part" onclick="explainLabelPart('role')">
                            <div class="label-part-name">Role</div>
                            <div class="label-part-value">object_r</div>
                        </div>
                        <div class="label-part" onclick="explainLabelPart('type')">
                            <div class="label-part-name">Type</div>
                            <div class="label-part-value">httpd_sys_content_t</div>
                        </div>
                        <div class="label-part" onclick="explainLabelPart('level')">
                            <div class="label-part-name">Level</div>
                            <div class="label-part-value">s0</div>
                        </div>
                    </div>
                    <div class="label-explanation" id="labelExplanation">
                        <strong>User (unconfined_u):</strong> The SELinux user identity. This determines which roles can be accessed. The unconfined_u user has minimal restrictions.
                    </div>
                </div>

                <h3>SELinux Decision Flow</h3>
                <div class="diagram-container">
                    <div class="selinux-flow">
                        <div class="flow-item active" onclick="toggleFlowItem(this)">
                            <strong>1. Process Request</strong>
                            <p>A process attempts to access a resource (file, port, etc.)</p>
                            <div class="flow-details">
                                <strong>Example:</strong> The Apache web server (httpd) tries to read a file in /var/www/html/
                            </div>
                        </div>
                        <div class="flow-arrow">‚Üì</div>
                        <div class="flow-item" onclick="toggleFlowItem(this)">
                            <strong>2. Linux Security Module</strong>
                            <p>Request forwarded to SELinux subsystem</p>
                            <div class="flow-details">
                                The kernel's LSM framework intercepts the system call and queries SELinux for permission.
                            </div>
                        </div>
                        <div class="flow-arrow">‚Üì</div>
                        <div class="flow-item" onclick="toggleFlowItem(this)">
                            <strong>3. Context Matching</strong>
                            <p>SELinux compares process context with resource context</p>
                            <div class="flow-details">
                                <strong>Process context:</strong> system_u:system_r:httpd_t:s0<br>
                                <strong>File context:</strong> system_u:object_r:httpd_sys_content_t:s0
                            </div>
                        </div>
                        <div class="flow-arrow">‚Üì</div>
                        <div class="flow-item" onclick="toggleFlowItem(this)">
                            <strong>4. Policy Decision</strong>
                            <p>SELinux policy determines if access is allowed</p>
                            <div class="flow-details">
                                The policy rules define: "allow httpd_t httpd_sys_content_t:file { read getattr }"
                            </div>
                        </div>
                        <div class="flow-arrow">‚Üì</div>
                        <div class="flow-item" onclick="toggleFlowItem(this)">
                            <strong>5. Grant or Deny</strong>
                            <p>Access is either permitted or denied and logged</p>
                            <div class="flow-details">
                                If denied, an AVC (Access Vector Cache) denial is logged to /var/log/audit/audit.log
                            </div>
                        </div>
                    </div>
                </div>

                <div class="alert alert-info">
                    <strong>Key Concept:</strong> SELinux uses the Type Enforcement model where the <em>type</em> field is the primary mechanism for access control. If no explicit allow rule exists, access is denied by default.
                </div>

                <button class="btn btn-success" onclick="completeModule('architecture')">Mark Module Complete</button>
            </div>

            <!-- Quiz Section -->
            <div class="card">
                <h2>Knowledge Check: SELinux Basics</h2>
                <div class="quiz-container" id="quiz-architecture">
                    <div class="quiz-question" id="quizQuestion">
                        What does the 'type' field in an SELinux context primarily control?
                    </div>
                    <div class="quiz-options" id="quizOptions">
                        <div class="quiz-option" onclick="selectQuizOption(this, false)">
                            A) The user identity for authentication purposes
                        </div>
                        <div class="quiz-option" onclick="selectQuizOption(this, true)">
                            B) Access permissions through policy rules defining allowed interactions
                        </div>
                        <div class="quiz-option" onclick="selectQuizOption(this, false)">
                            C) The sensitivity level for multi-level security
                        </div>
                        <div class="quiz-option" onclick="selectQuizOption(this, false)">
                            D) The file ownership and group membership
                        </div>
                    </div>
                    <div id="quizFeedback"></div>
                    <div class="quiz-controls">
                        <button class="quiz-btn submit-btn" onclick="submitQuiz()">Submit Answer</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 2: Enforcement Modes -->
        <div id="modes" class="content-section">
            <div class="card">
                <h2>SELinux Enforcement Modes</h2>
                <p>SELinux operates in three distinct modes that control how policies are enforced:</p>

                <h3>Interactive Mode Simulator</h3>
                <div class="mode-simulator">
                    <div class="mode-controls">
                        <button class="mode-btn active" onclick="setMode('enforcing')">Enforcing</button>
                        <button class="mode-btn" onclick="setMode('permissive')">Permissive</button>
                        <button class="mode-btn" onclick="setMode('disabled')">Disabled</button>
                    </div>
                    <div class="mode-output">
                        <div class="mode-status" id="modeStatus">Current Mode: Enforcing</div>
                        <div id="modeDescription">
                            <strong>Enforcing Mode</strong> is the default and recommended mode for production systems.
                            <ul>
                                <li>‚úÖ All policy rules are actively enforced</li>
                                <li>üö´ Access violations are denied and logged</li>
                                <li>üîí Maximum security protection</li>
                                <li>üìù AVC denials written to audit log</li>
                            </ul>
                            <div class="alert alert-info mt-2">
                                <strong>Command:</strong> <code>setenforce 1</code> or <code>setenforce Enforcing</code>
                            </div>
                        </div>
                    </div>
                </div>

                <h3>Changing Modes at Runtime</h3>
                <div class="command-builder">
                    <div class="builder-section">
                        <label>Select Target Mode:</label>
                        <select id="modeSelect" onchange="generateModeCommand()">
                            <option value="1">Enforcing (1)</option>
                            <option value="0">Permissive (0)</option>
                        </select>
                    </div>
                    <div class="generated-command">
                        <code id="generatedModeCmd">setenforce 1</code>
                        <button class="copy-btn" onclick="copyCommand('generatedModeCmd')">Copy</button>
                    </div>
                </div>

                <h3>Persistent Configuration</h3>
                <p>To make mode changes persistent across reboots, edit <code>/etc/selinux/config</code>:</p>
                <div class="terminal">
                    <div class="terminal-output">
                        <span class="terminal-prompt">[root@host ~]#</span> cat /etc/selinux/config<br>
                        # This file controls the state of SELinux on the system.<br>
                        # SELINUX= can take one of these three values:<br>
                        #     enforcing - SELinux security policy is enforced.<br>
                        #     permissive - SELinux prints warnings instead of enforcing.<br>
                        #     disabled - No SELinux policy is loaded.<br>
                        <span class="terminal-success">SELINUX=enforcing</span><br>
                        # SELINUXTYPE= can take one of these values:<br>
                        #     targeted - Targeted processes are protected,<br>
                        #     minimum - Modification of targeted policy.<br>
                        #     mls - Multi Level Security protection.<br>
                        SELINUXTYPE=targeted
                    </div>
                </div>

                <div class="alert alert-warning mt-2">
                    <strong>‚ö†Ô∏è Important:</strong> Starting in RHEL 9, SELinux can only be fully disabled using the <code>selinux=0</code> kernel parameter at boot. The <code>SELINUX=disabled</code> option in /etc/selinux/config is no longer supported.
                </div>

                <button class="btn btn-success" onclick="completeModule('modes')">Mark Module Complete</button>
            </div>
        </div>

        <!-- Section 3: File Contexts -->
        <div id="contexts" class="content-section">
            <div class="card">
                <h2>Managing SELinux File Contexts</h2>
                <p>File contexts determine how SELinux labels files and directories. Proper context management is essential for applications to function correctly with SELinux enabled.</p>

                <h3>semanage fcontext Command Builder</h3>
                <div class="command-builder">
                    <div class="builder-section">
                        <label>Operation:</label>
                        <select id="fcontextOp" onchange="generateFcontextCommand()">
                            <option value="-a">Add (-a, --add)</option>
                            <option value="-d">Delete (-d, --delete)</option>
                            <option value="-l">List (-l, --list)</option>
                        </select>
                    </div>
                    <div class="builder-section">
                        <label>File Type:</label>
                        <select id="fcontextType" onchange="generateFcontextCommand()">
                            <option value="">all files (default)</option>
                            <option value="-f f">regular file (-f f)</option>
                            <option value="-f d">directory (-f d)</option>
                            <option value="-f l">symbolic link (-f l)</option>
                            <option value="-f s">socket (-f s)</option>
                            <option value="-f p">named pipe (-f p)</option>
                        </select>
                    </div>
                    <div class="builder-section">
                        <label>File Path Pattern (use regex):</label>
                        <input type="text" id="fcontextPath" placeholder="/custom/path(/.*)?" onkeyup="generateFcontextCommand()" value="/custom/web(/.*)?">
                    </div>
                    <div class="builder-section">
                        <label>SELinux Context Type:</label>
                        <input type="text" id="fcontextContext" placeholder="httpd_sys_content_t" onkeyup="generateFcontextCommand()" value="httpd_sys_content_t">
                    </div>
                    <div class="generated-command">
                        <code id="generatedFcontextCmd">semanage fcontext -a -t httpd_sys_content_t '/custom/web(/.*)?'</code>
                        <button class="copy-btn" onclick="copyCommand('generatedFcontextCmd')">Copy</button>
                    </div>
                </div>

                <h3>The Pirate Regex: (/.*)? üè¥‚Äç‚ò†Ô∏è</h3>
                <div class="alert alert-info">
                    <strong>Understanding the Pattern:</strong> The regex pattern <code>(/.*)?</code> is humorously called "the pirate" because it looks like a face with an eye patch and a hooked hand.<br><br>
                    <strong>What it means:</strong>
                    <ul>
                        <li><code>/</code> - A forward slash (directory separator)</li>
                        <li><code>.*</code> - Any characters (zero or more)</li>
                        <li><code>?</code> - The entire group is optional</li>
                    </ul>
                    This pattern matches the directory itself and all files within it (and subdirectories).
                </div>

                <h3>Applying File Contexts</h3>
                <p>After defining a policy with <code>semanage fcontext</code>, you must apply it using <code>restorecon</code>:</p>
                <div class="command-builder">
                    <div class="builder-section">
                        <label>Directory/File Path:</label>
                        <input type="text" id="restoreconPath" placeholder="/path/to/restore" onkeyup="generateRestoreconCommand()" value="/custom/web">
                    </div>
                    <div class="builder-section">
                        <label>Options:</label>
                        <div>
                            <input type="checkbox" id="restoreconRecursive" onchange="generateRestoreconCommand()" checked> 
                            <label for="restoreconRecursive">Recursive (-R)</label>
                        </div>
                        <div>
                            <input type="checkbox" id="restoreconVerbose" onchange="generateRestoreconCommand()"> 
                            <label for="restoreconVerbose">Verbose (-v)</label>
                        </div>
                    </div>
                    <div class="generated-command">
                        <code id="generatedRestoreconCmd">restorecon -R /custom/web</code>
                        <button class="copy-btn" onclick="copyCommand('generatedRestoreconCmd')">Copy</button>
                    </div>
                </div>

                <h3>Copy vs Move Behavior</h3>
                <div class="diagram-container">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <div style="background: white; padding: 1.5rem; border-radius: 8px;">
                            <h4 style="color: var(--primary-color);">cp (Copy) Command</h4>
                            <p>Creates a NEW inode</p>
                            <ul>
                                <li>üÜï New file with new attributes</li>
                                <li>üè∑Ô∏è Inherits context from destination</li>
                                <li>üìù Context determined by policy or parent directory</li>
                            </ul>
                            <div class="terminal" style="font-size: 0.9rem; min-height: auto; margin-top: 1rem;">
                                cp /tmp/file1 /var/www/html/<br>
                                <span class="terminal-success"># Gets httpd_sys_content_t</span>
                            </div>
                        </div>
                        <div style="background: white; padding: 1.5rem; border-radius: 8px;">
                            <h4 style="color: var(--secondary-color);">mv (Move) Command</h4>
                            <p>Moves existing inode (same filesystem)</p>
                            <ul>
                                <li>‚ôªÔ∏è Same inode, same attributes</li>
                                <li>üîÑ PRESERVES original context</li>
                                <li>‚ö†Ô∏è May need manual relabeling</li>
                            </ul>
                            <div class="terminal" style="font-size: 0.9rem; min-height: auto; margin-top: 1rem;">
                                mv /tmp/file1 /var/www/html/<br>
                                <span class="terminal-error"># Keeps user_tmp_t (wrong!)</span>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="btn btn-success" onclick="completeModule('contexts')">Mark Module Complete</button>
            </div>
        </div>

        <!-- Section 4: Booleans -->
        <div id="booleans" class="content-section">
            <div class="card">
                <h2>SELinux Booleans</h2>
                <p>Booleans allow selective enabling/disabling of policy features without recompiling the entire policy. They provide fine-grained control over application behavior.</p>

                <h3>Interactive Boolean Dashboard</h3>
                <div style="margin-bottom: 1rem;">
                    <input type="text" id="booleanSearch" placeholder="Search booleans..." style="width: 100%; padding: 0.75rem; border: 2px solid var(--border-color); border-radius: 6px;" onkeyup="filterBooleans()">
                </div>
                <div class="boolean-grid" id="booleanGrid">
                    <div class="boolean-item" data-name="httpd_enable_homedirs">
                        <div class="boolean-header">
                            <div class="boolean-name">httpd_enable_homedirs</div>
                            <label class="toggle-switch">
                                <input type="checkbox" onchange="toggleBoolean(this, 'httpd_enable_homedirs')">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="boolean-description">
                            Allow httpd to read user home directories. When enabled, Apache can serve content from ~/public_html directories.
                        </div>
                    </div>

                    <div class="boolean-item" data-name="httpd_can_network_connect">
                        <div class="boolean-header">
                            <div class="boolean-name">httpd_can_network_connect</div>
                            <label class="toggle-switch">
                                <input type="checkbox" onchange="toggleBoolean(this, 'httpd_can_network_connect')">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="boolean-description">
                            Allow httpd to make network connections. Required for Apache to act as a proxy or connect to backend services.
                        </div>
                    </div>

                    <div class="boolean-item" data-name="httpd_can_sendmail">
                        <div class="boolean-header">
                            <div class="boolean-name">httpd_can_sendmail</div>
                            <label class="toggle-switch">
                                <input type="checkbox" onchange="toggleBoolean(this, 'httpd_can_sendmail')">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="boolean-description">
                            Allow httpd to send email. Enables web applications to send mail through sendmail or similar services.
                        </div>
                    </div>

                    <div class="boolean-item" data-name="ftpd_anon_write">
                        <div class="boolean-header">
                            <div class="boolean-name">ftpd_anon_write</div>
                            <label class="toggle-switch">
                                <input type="checkbox" onchange="toggleBoolean(this, 'ftpd_anon_write')">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="boolean-description">
                            Allow anonymous FTP users to upload files. Security consideration: only enable if anonymous uploads are required.
                        </div>
                    </div>

                    <div class="boolean-item" data-name="ssh_sysadm_login">
                        <div class="boolean-header">
                            <div class="boolean-name">ssh_sysadm_login</div>
                            <label class="toggle-switch">
                                <input type="checkbox" onchange="toggleBoolean(this, 'ssh_sysadm_login')">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="boolean-description">
                            Allow SSH login for sysadm_r role. Required for system administrators to login via SSH with elevated SELinux privileges.
                        </div>
                    </div>

                    <div class="boolean-item" data-name="allow_execmem">
                        <div class="boolean-header">
                            <div class="boolean-name">allow_execmem</div>
                            <label class="toggle-switch">
                                <input type="checkbox" onchange="toggleBoolean(this, 'allow_execmem')">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="boolean-description">
                            Allow processes to execute memory regions. Some applications (like Java JIT compilers) require this permission.
                        </div>
                    </div>
                </div>

                <h3>Managing Booleans via Command Line</h3>
                <div class="terminal">
                    <div class="terminal-output">
                        <span class="terminal-prompt">[root@host ~]#</span> getsebool httpd_enable_homedirs<br>
                        httpd_enable_homedirs --> off<br><br>
                        
                        <span class="terminal-prompt">[root@host ~]#</span> setsebool httpd_enable_homedirs on<br>
                        <span class="terminal-success"># Temporary - resets on reboot</span><br><br>
                        
                        <span class="terminal-prompt">[root@host ~]#</span> setsebool -P httpd_enable_homedirs on<br>
                        <span class="terminal-success"># Persistent - survives reboot</span><br><br>
                        
                        <span class="terminal-prompt">[root@host ~]#</span> getsebool -a | grep httpd<br>
                        <span class="terminal-success"># Lists all httpd-related booleans</span>
                    </div>
                </div>

                <div class="alert alert-warning mt-2">
                    <strong>‚ö†Ô∏è Remember:</strong> Use the <code>-P</code> flag with <code>setsebool</code> to make changes persistent. Without it, settings revert after reboot!
                </div>

                <button class="btn btn-success" onclick="completeModule('booleans')">Mark Module Complete</button>
            </div>
        </div>

        <!-- Section 5: Troubleshooting -->
        <div id="troubleshooting" class="content-section">
            <div class="card">
                <h2>Troubleshooting SELinux Issues</h2>
                <p>When SELinux denies access, it generates detailed audit log entries. Learning to interpret these messages is crucial for effective troubleshooting.</p>

                <h3>AVC Message Decoder</h3>
                <div class="avc-decoder">
                    <textarea class="avc-input" id="avcInput" placeholder="Paste an AVC denial message here...">type=AVC msg=audit(1649326572.086:407): avc: denied { getattr } for pid=10731 comm="httpd" path="/lab-content/lab.html" dev="vda4" ino=18192752 scontext=system_u:system_r:httpd_t:s0 tcontext=unconfined_u:object_r:default_t:s0 tclass=file permissive=0</textarea>
                    <button class="decode-btn" onclick="decodeAVC()">Decode Message</button>
                    <div class="decoded-output" id="decodedOutput" style="display: none;"></div>
                </div>

                <h3>Using sealert for Detailed Analysis</h3>
                <p>The <code>sealert</code> command provides human-readable analysis of AVC denials with suggested solutions:</p>
                <div class="terminal">
                    <div class="terminal-output">
                        <span class="terminal-prompt">[root@host ~]#</span> sealert -l 35c9e452-2552-4ca3-8217-493b72ba6d0b<br><br>
                        
                        <span class="terminal-success">SELinux is preventing /usr/sbin/httpd from getattr access on the file /lab-content/lab.html.</span><br><br>
                        
                        <strong>***** Plugin restorecon (99.5 confidence) suggests *************************</strong><br><br>
                        
                        If you want to fix the label,<br>
                        /lab-content/lab.html default label should be httpd_sys_content_t.<br>
                        Then you can run restorecon. The access attempt may have been stopped due to insufficient permissions to access a parent directory in which case try to change the following command accordingly.<br>
                        <span class="terminal-success">Do</span><br>
                        # <strong>semanage fcontext -a -t FILE_TYPE '/lab-content/lab.html'</strong><br>
                        where FILE_TYPE is one of the following: httpd_sys_content_t, httpd_sys_script_exec_t.<br>
                        Then execute:<br>
                        # <strong>restorecon -v '/lab-content/lab.html'</strong><br><br>
                        
                        <strong>***** Plugin catchall (1.49 confidence) suggests **************************</strong><br><br>
                        
                        If you believe that httpd should be allowed getattr access on the lab.html file by default.<br>
                        Then you should report this as a bug.
                    </div>
                </div>

                <h3>Common Troubleshooting Workflow</h3>
                <div class="diagram-container">
                    <div class="selinux-flow">
                        <div class="flow-item">
                            <strong>Step 1: Check Logs</strong>
                            <p>Look for SELinux denials in /var/log/messages or /var/log/audit/audit.log</p>
                        </div>
                        <div class="flow-arrow">‚Üì</div>
                        <div class="flow-item">
                            <strong>Step 2: Use ausearch</strong>
                            <p>Filter audit logs: <code>ausearch -m AVC -ts recent</code></p>
                        </div>
                        <div class="flow-arrow">‚Üì</div>
                        <div class="flow-item">
                            <strong>Step 3: Run sealert</strong>
                            <p>Get detailed analysis and suggestions with the UUID from messages</p>
                        </div>
                        <div class="flow-arrow">‚Üì</div>
                        <div class="flow-item">
                            <strong>Step 4: Verify Contexts</strong>
                            <p>Check file contexts with <code>ls -Z</code> and process contexts with <code>ps -Z</code></p>
                        </div>
                        <div class="flow-arrow">‚Üì</div>
                        <div class="flow-item">
                            <strong>Step 5: Apply Fix</strong>
                            <p>Correct contexts, adjust booleans, or create custom policy</p>
                        </div>
                    </div>
                </div>

                <h3>ausearch Command Builder</h3>
                <div class="command-builder">
                    <div class="builder-section">
                        <label>Message Type:</label>
                        <select id="ausearchType" onchange="generateAusearchCommand()">
                            <option value="AVC">AVC (Access Vector Cache)</option>
                            <option value="SYSCALL">SYSCALL</option>
                            <option value="USER_LOGIN">USER_LOGIN</option>
                        </select>
                    </div>
                    <div class="builder-section">
                        <label>Time Filter:</label>
                        <select id="ausearchTime" onchange="generateAusearchCommand()">
                            <option value="recent">Recent</option>
                            <option value="today">Today</option>
                            <option value="yesterday">Yesterday</option>
                            <option value="this-week">This Week</option>
                        </select>
                    </div>
                    <div class="generated-command">
                        <code id="generatedAusearchCmd">ausearch -m AVC -ts recent</code>
                        <button class="copy-btn" onclick="copyCommand('generatedAusearchCmd')">Copy</button>
                    </div>
                </div>

                <button class="btn btn-success" onclick="completeModule('troubleshooting')">Mark Module Complete</button>
            </div>
        </div>

        <!-- Section 6: Virtual Terminal -->
        <div id="terminal" class="content-section">
            <div class="card">
                <h2>üñ•Ô∏è Virtual SELinux Terminal</h2>
                <p>Practice SELinux commands in a safe, simulated environment. Try commands like <code>getenforce</code>, <code>sestatus</code>, <code>ls -Z</code>, and more!</p>

                <div class="terminal" id="virtualTerminal">
                    <div class="terminal-header">
                        <span class="terminal-dot dot-red"></span>
                        <span class="terminal-dot dot-yellow"></span>
                        <span class="terminal-dot dot-green"></span>
                    </div>
                    <div class="terminal-output" id="terminalOutput">
                        <div class="terminal-success">Welcome to the SELinux Virtual Terminal!</div>
                        <div>Type 'help' for available commands, or try actual SELinux commands.</div>
                        <div style="margin-top: 1rem;">
                            <span class="terminal-prompt">[root@trainingsystem ~]# </span>
                        </div>
                    </div>
                    <div class="terminal-input-line">
                        <span class="terminal-prompt">[root@trainingsystem ~]#</span>
                        <input type="text" class="terminal-input" id="terminalInput" autofocus onkeypress="handleTerminalInput(event)">
                    </div>
                </div>

                <div class="alert alert-info mt-2">
                    <strong>Available Commands:</strong> getenforce, setenforce, sestatus, ls -Z, ps -Z, getsebool, setsebool, semanage, restorecon, ausearch, sealert, help, clear
                </div>
            </div>
        </div>

        <!-- Section 7: Command Cheatsheet -->
        <div id="cheatsheet" class="content-section">
            <div class="card">
                <h2>üìö SELinux Command Reference</h2>
                
                <div class="cheatsheet">
                    <div class="cheatsheet-search">
                        <input type="text" id="cheatsheetSearch" placeholder="Search commands..." onkeyup="filterCommands()">
                    </div>
                    <div class="command-list" id="commandList">
                        <!-- Commands will be dynamically populated -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== STATE MANAGEMENT ==========
        const appState = {
            currentTab: 'introduction',
            completedModules: new Set(),
            commandsPracticed: 0,
            quizScores: [],
            selinuxMode: 'enforcing',
            terminalHistory: [],
            terminalHistoryIndex: -1
        };

        // Load state from localStorage
        function loadState() {
            const saved = localStorage.getItem('selinuxTrainingState');
            if (saved) {
                const data = JSON.parse(saved);
                appState.completedModules = new Set(data.completedModules || []);
                appState.commandsPracticed = data.commandsPracticed || 0;
                appState.quizScores = data.quizScores || [];
                updateProgress();
            }
        }

        // Save state to localStorage
        function saveState() {
            const data = {
                completedModules: Array.from(appState.completedModules),
                commandsPracticed: appState.commandsPracticed,
                quizScores: appState.quizScores
            };
            localStorage.setItem('selinuxTrainingState', JSON.stringify(data));
        }

        // ========== NAVIGATION ==========
        function navigateToTab(tabName) {
            // Find the tab button and click it
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach((tab, index) => {
                tab.classList.remove('active');
                if ((index === 0 && tabName === 'introduction') ||
                    (index === 1 && tabName === 'architecture') ||
                    (index === 2 && tabName === 'modes') ||
                    (index === 3 && tabName === 'contexts') ||
                    (index === 4 && tabName === 'booleans') ||
                    (index === 5 && tabName === 'troubleshooting') ||
                    (index === 6 && tabName === 'terminal') ||
                    (index === 7 && tabName === 'cheatsheet')) {
                    tab.classList.add('active');
                }
            });
            
            // Update active content
            document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            
            appState.currentTab = tabName;
            
            // Scroll to top
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function switchTab(tabName) {
            // Update active tab
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update active content
            document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            
            appState.currentTab = tabName;
            
            // Scroll to top
            window.scrollTo(0, 0);
        }

        // ========== PROGRESS TRACKING ==========
        function updateProgress() {
            const totalModules = 6;
            const completed = appState.completedModules.size;
            const percentage = Math.round((completed / totalModules) * 100);
            
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressFill').textContent = percentage + '%';
            document.getElementById('completedModules').textContent = completed + '/' + totalModules;
            document.getElementById('commandsPracticed').textContent = appState.commandsPracticed;
            
            const avgScore = appState.quizScores.length > 0 
                ? Math.round(appState.quizScores.reduce((a, b) => a + b, 0) / appState.quizScores.length)
                : 0;
            document.getElementById('quizScore').textContent = avgScore + '%';
        }

        function completeModule(moduleName) {
            appState.completedModules.add(moduleName);
            saveState();
            updateProgress();
            alert('‚úÖ Module completed! Great job!');
        }

        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
                localStorage.removeItem('selinuxTrainingState');
                appState.completedModules.clear();
                appState.commandsPracticed = 0;
                appState.quizScores = [];
                updateProgress();
                alert('Progress has been reset.');
            }
        }

        // ========== LABEL EXPLORER ==========
        function explainLabelPart(part) {
            document.querySelectorAll('.label-part').forEach(el => el.classList.remove('active'));
            event.target.closest('.label-part').classList.add('active');
            
            const explanations = {
                user: '<strong>User (unconfined_u):</strong> The SELinux user identity. This determines which roles can be accessed. The unconfined_u user has minimal restrictions and is typically used for regular user processes.',
                role: '<strong>Role (object_r):</strong> Defines the role in Role-Based Access Control (RBAC). The object_r role is standard for files and resources. Processes typically use system_r or other specific roles.',
                type: '<strong>Type (httpd_sys_content_t):</strong> The most important field for access control. This type label determines what processes can access this resource. The _t suffix indicates a type context. This particular type allows Apache (httpd_t) to read these files.',
                level: '<strong>Level (s0):</strong> Used in Multi-Level Security (MLS) environments. s0 is the lowest sensitivity level. Advanced SELinux configurations use this for classified data separation, but it\'s typically s0 in standard deployments.'
            };
            
            document.getElementById('labelExplanation').innerHTML = explanations[part];
        }

        // ========== FLOW DIAGRAM ==========
        function toggleFlowItem(element) {
            document.querySelectorAll('.flow-item').forEach(item => item.classList.remove('active'));
            element.classList.add('active');
        }

        // ========== MODE SIMULATOR ==========
        function setMode(mode) {
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            appState.selinuxMode = mode;
            
            const descriptions = {
                enforcing: {
                    title: 'Enforcing Mode',
                    content: `<strong>Enforcing Mode</strong> is the default and recommended mode for production systems.
                        <ul>
                            <li>‚úÖ All policy rules are actively enforced</li>
                            <li>üö´ Access violations are denied and logged</li>
                            <li>üîí Maximum security protection</li>
                            <li>üìù AVC denials written to audit log</li>
                        </ul>
                        <div class="alert alert-info mt-2">
                            <strong>Command:</strong> <code>setenforce 1</code> or <code>setenforce Enforcing</code>
                        </div>`
                },
                permissive: {
                    title: 'Permissive Mode',
                    content: `<strong>Permissive Mode</strong> is useful for testing and troubleshooting.
                        <ul>
                            <li>‚ö†Ô∏è Policy violations are NOT enforced</li>
                            <li>üìù All violations are logged (as if denied)</li>
                            <li>üîß Ideal for debugging policy issues</li>
                            <li>‚è±Ô∏è Temporary mode for development</li>
                        </ul>
                        <div class="alert alert-warning mt-2">
                            <strong>Command:</strong> <code>setenforce 0</code> or <code>setenforce Permissive</code><br>
                            <strong>‚ö†Ô∏è Warning:</strong> Not recommended for production systems!
                        </div>`
                },
                disabled: {
                    title: 'Disabled Mode',
                    content: `<strong>Disabled Mode</strong> completely turns off SELinux.
                        <ul>
                            <li>‚ùå No SELinux protection whatsoever</li>
                            <li>üö´ No policy enforcement or logging</li>
                            <li>‚ö†Ô∏è System relies only on DAC permissions</li>
                            <li>üîÑ Requires reboot to enable/disable</li>
                        </ul>
                        <div class="alert alert-danger mt-2">
                            <strong>RHEL 9+:</strong> Can only be disabled with <code>selinux=0</code> kernel parameter<br>
                            <strong>‚ö†Ô∏è Strongly Discouraged:</strong> Disabling SELinux significantly reduces system security!
                        </div>`
                }
            };
            
            document.getElementById('modeStatus').textContent = 'Current Mode: ' + mode.charAt(0).toUpperCase() + mode.slice(1);
            document.getElementById('modeDescription').innerHTML = descriptions[mode].content;
        }

        // ========== COMMAND GENERATORS ==========
        function generateModeCommand() {
            const mode = document.getElementById('modeSelect').value;
            const cmd = `setenforce ${mode}`;
            document.getElementById('generatedModeCmd').textContent = cmd;
        }

        function generateFcontextCommand() {
            const op = document.getElementById('fcontextOp').value;
            const type = document.getElementById('fcontextType').value;
            const path = document.getElementById('fcontextPath').value;
            const context = document.getElementById('fcontextContext').value;
            
            let cmd = 'semanage fcontext ' + op;
            if (op === '-a' && type) cmd += ' ' + type;
            if (op === '-a' && context) cmd += ' -t ' + context;
            if (path && op !== '-l') cmd += " '" + path + "'";
            if (op === '-l') cmd += ' | grep ' + (path || 'custom');
            
            document.getElementById('generatedFcontextCmd').textContent = cmd;
        }

        function generateRestoreconCommand() {
            const path = document.getElementById('restoreconPath').value;
            const recursive = document.getElementById('restoreconRecursive').checked;
            const verbose = document.getElementById('restoreconVerbose').checked;
            
            let cmd = 'restorecon';
            if (recursive) cmd += ' -R';
            if (verbose) cmd += ' -v';
            cmd += ' ' + path;
            
            document.getElementById('generatedRestoreconCmd').textContent = cmd;
        }

        function generateAusearchCommand() {
            const type = document.getElementById('ausearchType').value;
            const time = document.getElementById('ausearchTime').value;
            const cmd = `ausearch -m ${type} -ts ${time}`;
            document.getElementById('generatedAusearchCmd').textContent = cmd;
        }

        function copyCommand(elementId) {
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚úì Copied!';
                setTimeout(() => btn.textContent = originalText, 2000);
            });
        }

        // ========== BOOLEAN MANAGEMENT ==========
        function toggleBoolean(checkbox, booleanName) {
            const status = checkbox.checked ? 'on' : 'off';
            alert(`Boolean ${booleanName} would be set to: ${status}\n\nCommand: setsebool -P ${booleanName} ${status}`);
        }

        function filterBooleans() {
            const searchTerm = document.getElementById('booleanSearch').value.toLowerCase();
            document.querySelectorAll('.boolean-item').forEach(item => {
                const name = item.getAttribute('data-name').toLowerCase();
                const description = item.querySelector('.boolean-description').textContent.toLowerCase();
                if (name.includes(searchTerm) || description.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // ========== AVC DECODER ==========
        function decodeAVC() {
            const input = document.getElementById('avcInput').value;
            const output = document.getElementById('decodedOutput');
            
            // Parse AVC message
            const patterns = {
                action: /{ (\w+) }/,
                process: /comm="([^"]+)"/,
                pid: /pid=(\d+)/,
                path: /path="([^"]+)"/,
                scontext: /scontext=([^\s]+)/,
                tcontext: /tcontext=([^\s]+)/,
                tclass: /tclass=(\w+)/
            };
            
            let decoded = '<h3>Decoded AVC Denial</h3>';
            
            const action = input.match(patterns.action);
            const process = input.match(patterns.process);
            const pid = input.match(patterns.pid);
            const path = input.match(patterns.path);
            const scontext = input.match(patterns.scontext);
            const tcontext = input.match(patterns.tcontext);
            const tclass = input.match(patterns.tclass);
            
            decoded += '<div class="decoded-section"><strong>üö´ Denial Summary:</strong><br>';
            decoded += `The process <code>${process ? process[1] : 'unknown'}</code> (PID: ${pid ? pid[1] : 'unknown'}) `;
            decoded += `was denied <code>${action ? action[1] : 'unknown'}</code> access `;
            decoded += `to the ${tclass ? tclass[1] : 'resource'} <code>${path ? path[1] : 'unknown'}</code></div>`;
            
            decoded += '<div class="decoded-section"><strong>üìã Source Context (Process):</strong><br>';
            decoded += `<code>${scontext ? scontext[1] : 'unknown'}</code></div>`;
            
            decoded += '<div class="decoded-section"><strong>üéØ Target Context (Resource):</strong><br>';
            decoded += `<code>${tcontext ? tcontext[1] : 'unknown'}</code></div>`;
            
            decoded += '<div class="decoded-section"><strong>üí° Likely Solution:</strong><br>';
            if (tcontext && tcontext[1].includes('default_t')) {
                decoded += 'The target file has the incorrect context type <code>default_t</code>. ';
                decoded += 'This usually means the file needs to be relabeled.<br><br>';
                decoded += '<strong>Recommended Action:</strong><br>';
                decoded += '1. Define the correct context policy with <code>semanage fcontext</code><br>';
                decoded += '2. Apply the context with <code>restorecon -v ' + (path ? path[1] : '/path/to/file') + '</code>';
            } else {
                decoded += 'Review the context mismatch and consider:<br>';
                decoded += '‚Ä¢ Adjusting file contexts with semanage/restorecon<br>';
                decoded += '‚Ä¢ Enabling relevant SELinux booleans<br>';
                decoded += '‚Ä¢ Checking if a policy module needs to be created';
            }
            decoded += '</div>';
            
            output.innerHTML = decoded;
            output.style.display = 'block';
        }

        // ========== VIRTUAL TERMINAL ==========
        const terminalCommands = {
            getenforce: () => appState.selinuxMode.charAt(0).toUpperCase() + appState.selinuxMode.slice(1),
            
            sestatus: () => {
                return `SELinux status:                 enabled
SELinuxfs mount:                /sys/fs/selinux
SELinux root directory:         /etc/selinux
Loaded policy name:             targeted
Current mode:                   ${appState.selinuxMode}
Mode from config file:          enforcing
Policy MLS status:              enabled
Policy deny_unknown status:     allowed
Memory protection checking:     actual (secure)
Max kernel policy version:      33`;
            },
            
            'ls -Z': () => {
                return `-rw-r--r--. root root unconfined_u:object_r:admin_home_t:s0 file1.txt
drwxr-xr-x. root root unconfined_u:object_r:admin_home_t:s0 documents
-rw-r--r--. root root system_u:object_r:httpd_sys_content_t:s0 index.html`;
            },
            
            'ps -Z': () => {
                return `LABEL                               PID TTY      STAT   TIME COMMAND
system_u:system_r:httpd_t:s0       1550 ?        Ss     0:00 /usr/sbin/httpd
system_u:system_r:sshd_t:s0-s0:c0  1234 ?        Ss     0:00 /usr/sbin/sshd
unconfined_u:unconfined_r:unconfined_t:s0-s0:c0 5678 pts/0 Ss 0:00 bash`;
            },
            
            'getsebool httpd_enable_homedirs': () => 'httpd_enable_homedirs --> off',
            
            'getsebool -a': () => {
                return `abrt_anon_write --> off
abrt_handle_event --> off
httpd_enable_homedirs --> off
httpd_can_network_connect --> off
allow_execmem --> off
ftpd_anon_write --> off`;
            },
            
            help: () => {
                return `Available commands:
  getenforce          - Display current SELinux mode
  setenforce [0|1]    - Set SELinux to permissive (0) or enforcing (1)
  sestatus            - Display SELinux status information
  ls -Z               - List files with SELinux contexts
  ps -Z               - List processes with SELinux contexts
  getsebool [name]    - Get SELinux boolean value(s)
  setsebool           - Set SELinux boolean (simulated)
  ausearch -m AVC     - Search for AVC denials (simulated)
  clear               - Clear terminal screen
  help                - Display this help message`;
            },
            
            clear: () => {
                document.getElementById('terminalOutput').innerHTML = '';
                return '';
            }
        };

        function handleTerminalInput(event) {
            if (event.key === 'Enter') {
                const input = document.getElementById('terminalInput');
                const command = input.value.trim();
                const output = document.getElementById('terminalOutput');
                
                // Add command to history
                appState.terminalHistory.push(command);
                appState.terminalHistoryIndex = appState.terminalHistory.length;
                
                // Display command
                const cmdLine = document.createElement('div');
                cmdLine.innerHTML = `<span class="terminal-prompt">[root@trainingsystem ~]#</span> ${command}`;
                output.appendChild(cmdLine);
                
                // Execute command
                let result = '';
                if (command === '') {
                    result = '';
                } else if (terminalCommands[command]) {
                    result = terminalCommands[command]();
                    appState.commandsPracticed++;
                    saveState();
                    updateProgress();
                } else if (command.startsWith('setenforce')) {
                    const mode = command.split(' ')[1];
                    if (mode === '0' || mode.toLowerCase() === 'permissive') {
                        appState.selinuxMode = 'permissive';
                        result = '<span class="terminal-success">SELinux mode set to Permissive</span>';
                    } else if (mode === '1' || mode.toLowerCase() === 'enforcing') {
                        appState.selinuxMode = 'enforcing';
                        result = '<span class="terminal-success">SELinux mode set to Enforcing</span>';
                    } else {
                        result = '<span class="terminal-error">setenforce: invalid argument. Use 0 or 1.</span>';
                    }
                    appState.commandsPracticed++;
                } else if (command.startsWith('setsebool')) {
                    result = '<span class="terminal-success">Boolean set successfully (simulated)</span>';
                    appState.commandsPracticed++;
                } else if (command.startsWith('ausearch')) {
                    result = 'type=AVC msg=audit(1649326572.086:407): avc: denied { getattr } for pid=10731';
                    appState.commandsPracticed++;
                } else {
                    result = `<span class="terminal-error">bash: ${command}: command not found</span>\nType 'help' for available commands.`;
                }
                
                if (result && command !== 'clear') {
                    const resultLine = document.createElement('div');
                    resultLine.innerHTML = result;
                    output.appendChild(resultLine);
                }
                
                // Clear input and scroll to bottom
                input.value = '';
                const terminal = document.getElementById('virtualTerminal');
                terminal.scrollTop = terminal.scrollHeight;
            } else if (event.key === 'ArrowUp') {
                event.preventDefault();
                if (appState.terminalHistoryIndex > 0) {
                    appState.terminalHistoryIndex--;
                    document.getElementById('terminalInput').value = appState.terminalHistory[appState.terminalHistoryIndex];
                }
            } else if (event.key === 'ArrowDown') {
                event.preventDefault();
                if (appState.terminalHistoryIndex < appState.terminalHistory.length - 1) {
                    appState.terminalHistoryIndex++;
                    document.getElementById('terminalInput').value = appState.terminalHistory[appState.terminalHistoryIndex];
                } else {
                    appState.terminalHistoryIndex = appState.terminalHistory.length;
                    document.getElementById('terminalInput').value = '';
                }
            }
        }

        // ========== QUIZ SYSTEM ==========
        let currentQuizAnswer = null;

        function selectQuizOption(element, isCorrect) {
            // Remove previous selections
            document.querySelectorAll('.quiz-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Mark this option as selected
            element.classList.add('selected');
            currentQuizAnswer = isCorrect;
        }

        function submitQuiz() {
            if (currentQuizAnswer === null) {
                alert('Please select an answer first!');
                return;
            }
            
            const feedback = document.getElementById('quizFeedback');
            const options = document.querySelectorAll('.quiz-option');
            
            // Disable further selection
            options.forEach(opt => {
                opt.style.pointerEvents = 'none';
                // Show correct/incorrect
                if (opt.classList.contains('selected')) {
                    if (currentQuizAnswer) {
                        opt.classList.add('correct');
                    } else {
                        opt.classList.add('incorrect');
                    }
                }
            });
            
            if (currentQuizAnswer) {
                feedback.innerHTML = '<div class="quiz-feedback correct">‚úÖ Correct! The type field is the primary mechanism for access control in SELinux targeted policy.</div>';
                appState.quizScores.push(100);
            } else {
                feedback.innerHTML = '<div class="quiz-feedback incorrect">‚ùå Incorrect. The correct answer is: The type field controls access permissions through policy rules.</div>';
                appState.quizScores.push(0);
            }
            
            saveState();
            updateProgress();
        }

        // ========== COMMAND CHEATSHEET ==========
        const commandReference = [
            {
                name: 'getenforce',
                syntax: 'getenforce',
                description: 'Display the current SELinux mode (Enforcing, Permissive, or Disabled)',
                example: 'getenforce\n# Output: Enforcing'
            },
            {
                name: 'setenforce',
                syntax: 'setenforce [0|1|Permissive|Enforcing]',
                description: 'Change the current SELinux mode temporarily (does not survive reboot)',
                example: 'setenforce 0  # Set to Permissive\nsetenforce 1  # Set to Enforcing'
            },
            {
                name: 'sestatus',
                syntax: 'sestatus [-v] [-b]',
                description: 'Display detailed SELinux status information including mode, policy, and status',
                example: 'sestatus\nsestatus -v  # Verbose output with process and file contexts'
            },
            {
                name: 'ls -Z',
                syntax: 'ls -Z [path]',
                description: 'List files and directories with their SELinux context labels',
                example: 'ls -Z /var/www/html\nls -Zd /home/user'
            },
            {
                name: 'ps -Z',
                syntax: 'ps -Z [options]',
                description: 'Display running processes with their SELinux context labels',
                example: 'ps -Z\nps -ZC httpd  # Show httpd processes with contexts'
            },
            {
                name: 'chcon',
                syntax: 'chcon [-t type] [-u user] [-r role] path',
                description: 'Change SELinux context on files temporarily (not recommended - use restorecon instead)',
                example: 'chcon -t httpd_sys_content_t /var/www/html/file.html'
            },
            {
                name: 'restorecon',
                syntax: 'restorecon [-R] [-v] path',
                description: 'Restore default SELinux contexts based on policy rules',
                example: 'restorecon -Rv /var/www/html'
            },
            {
                name: 'semanage fcontext',
                syntax: 'semanage fcontext [-a|-d|-l] [-t type] path_regex',
                description: 'Manage file context policy rules (persistent across relabeling)',
                example: 'semanage fcontext -a -t httpd_sys_content_t \'/web(/.*)?\'\\nrestorecon -Rv /web'
            },
            {
                name: 'getsebool',
                syntax: 'getsebool [-a] [boolean_name]',
                description: 'Display current value of SELinux boolean(s)',
                example: 'getsebool httpd_enable_homedirs\ngetsebool -a | grep httpd'
            },
            {
                name: 'setsebool',
                syntax: 'setsebool [-P] boolean_name [on|off]',
                description: 'Set SELinux boolean value. Use -P to make persistent.',
                example: 'setsebool -P httpd_enable_homedirs on'
            },
            {
                name: 'semanage boolean',
                syntax: 'semanage boolean [-l] [-C]',
                description: 'List SELinux booleans with detailed information',
                example: 'semanage boolean -l\nsemanage boolean -l -C  # Show only customized'
            },
            {
                name: 'ausearch',
                syntax: 'ausearch [-m message_type] [-ts time]',
                description: 'Search audit logs for specific events, commonly used for AVC denials',
                example: 'ausearch -m AVC -ts recent\nausearch -m AVC -ts today'
            },
            {
                name: 'sealert',
                syntax: 'sealert [-a log_file] [-l UUID]',
                description: 'Analyze SELinux AVC denials and provide troubleshooting suggestions',
                example: 'sealert -a /var/log/audit/audit.log\nsealert -l 35c9e452-2552-4ca3-8217-493b72ba6d0b'
            },
            {
                name: 'semodule',
                syntax: 'semodule [-l] [-i module.pp] [-r module_name]',
                description: 'Manage SELinux policy modules',
                example: 'semodule -l  # List installed modules\nsemodule -i mymodule.pp  # Install module'
            }
        ];

        function populateCommandReference() {
            const container = document.getElementById('commandList');
            container.innerHTML = '';
            
            commandReference.forEach(cmd => {
                const item = document.createElement('div');
                item.className = 'command-item';
                item.setAttribute('data-command', cmd.name.toLowerCase());
                item.innerHTML = `
                    <div class="command-syntax">${cmd.syntax}</div>
                    <div class="command-description">${cmd.description}</div>
                    <div class="command-example">${cmd.example}</div>
                `;
                container.appendChild(item);
            });
        }

        function filterCommands() {
            const searchTerm = document.getElementById('cheatsheetSearch').value.toLowerCase();
            document.querySelectorAll('.command-item').forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(searchTerm) ? 'block' : 'none';
            });
        }

        // ========== INITIALIZATION ==========
        document.addEventListener('DOMContentLoaded', function() {
            loadState();
            updateProgress();
            populateCommandReference();
            generateFcontextCommand();
            generateRestoreconCommand();
            generateAusearchCommand();
        });
    </script>
</body>
</html>
